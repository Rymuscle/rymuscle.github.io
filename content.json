{"meta":{"title":"Lant's Blog","subtitle":null,"description":null,"author":"Lant","url":"http://blog.renyimin.com"},"pages":[{"title":"åˆ†ç±»","date":"2017-09-17T02:40:28.000Z","updated":"2017-09-18T09:08:09.000Z","comments":false,"path":"categories/index.html","permalink":"http://blog.renyimin.com/categories/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2017-09-17T02:40:21.000Z","updated":"2017-09-18T09:08:03.000Z","comments":false,"path":"tags/index.html","permalink":"http://blog.renyimin.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"05. ä¸€æ¡æ¶ˆæ¯çš„ä¸€å£°","slug":"rabbitmq/2018-05-28-rabbitmq-05","date":"2018-05-28T09:16:23.000Z","updated":"2018-05-28T12:18:11.000Z","comments":true,"path":"2018/05/28/rabbitmq/2018-05-28-rabbitmq-05/","link":"","permalink":"http://blog.renyimin.com/2018/05/28/rabbitmq/2018-05-28-rabbitmq-05/","excerpt":"","text":"åˆ°ç°åœ¨, å·²ç»æˆåŠŸå®‰è£…è¿è¡Œäº†Rabbit, å¹¶ä¸”ç®€å•äº†è§£äº†RabbitMQçš„æ¶ˆæ¯é€šä¿¡æœºåˆ¶åŠRabbitå†…éƒ¨çš„ä¸€äº›ç»„ä»¶; æ¥ä¸‹æ¥éœ€è¦å°è¯•ä¸€ä¸‹ç¼–ç æ¥äº†è§£ä¸€æ¡æ¶ˆæ¯çš„ä¸€ç”Ÿ;12 é€šè¿‡ä¸Šè¿°çš„ç®€å•ä¾‹å­, ä½ å¯èƒ½å‘ç°åƒ äº¤æ¢æœº, é˜Ÿåˆ—, æ¶ˆæ¯ éƒ½æœ‰å¾ˆå¤šçš„å±æ€§å¯ä¾›é…ç½®, æ­¤å¤„å…ˆç®€å•ä»‹ç»ä¸¤ä¸ª, å…¶ä½™å±æ€§ä¼´éšç€åç»­çŸ¥è¯†éƒ½ä¼šä¸€ä¸€è¿›è¡Œäº†è§£; é˜Ÿåˆ—, äº¤æ¢æœºçš„éªŒè¯å±æ€§ é€šè¿‡æœ¬ç¯‡, å°†ä¼šè®¤è¯†exchange, queue, msgçš„ `` å±æ€§;","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/categories/RabbitMQ/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/tags/RabbitMQ/"}]},{"title":"06. æŒä¹…åŒ–ç­–ç•¥","slug":"rabbitmq/2018-05-28-rabbitmq-06","date":"2018-05-28T09:12:11.000Z","updated":"2018-05-28T11:54:52.000Z","comments":true,"path":"2018/05/28/rabbitmq/2018-05-28-rabbitmq-06/","link":"","permalink":"http://blog.renyimin.com/2018/05/28/rabbitmq/2018-05-28-rabbitmq-06/","excerpt":"","text":"æŒä¹…åŒ–æ–¹æ¡ˆRabbitMQ é»˜è®¤æƒ…å†µä¸‹, Exchange, é˜Ÿåˆ—, æ¶ˆæ¯ éƒ½æ˜¯éæŒä¹…çš„, è¿™æ„å‘³ç€ä¸€æ—¦æ¶ˆæ¯æœåŠ¡å™¨é‡å¯, æ‰€æœ‰å·²å£°æ˜çš„ Exchange, é˜Ÿåˆ—, ä»¥åŠ é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ éƒ½ä¼šä¸¢å¤±; è¦åšåˆ°æ¶ˆæ¯æŒä¹…åŒ–, å¿…é¡»ä¿è¯å¦‚ä¸‹ä¸‰ç‚¹è®¾ç½®æ­£ç¡®: exchangeäº¤æ¢å™¨: durableå±æ€§ä¸ºtrue; queueé˜Ÿåˆ—: durableå±æ€§ä¸ºtrue; é™¤äº†ä¸Šè¿°ä¸¤ç‚¹ä¹‹å¤–, è¿˜éœ€è¦åœ¨æŠ•é€’æ¶ˆæ¯æ—¶å€™, è®¾ç½®messageçš„ delivery_mode æ¨¡å¼ä¸º2æ¥æ ‡è¯†æ¶ˆæ¯ä¸ºæŒä¹…åŒ–æ¶ˆæ¯;è¦çŸ¥é“, ä¸€ä¸ªåŒ…å«æŒä¹…åŒ–æ¶ˆæ¯çš„éæŒä¹…åŒ–é˜Ÿåˆ—, åœ¨Rabbit Serveré‡å¯ä¹‹å, è¯¥é˜Ÿåˆ—å°†ä¼šä¸å¤å­˜åœ¨, æ¶ˆæ¯å°±ä¼šå˜æˆå­¤å„¿; æŒä¹…åŒ–åŸç†RabbitMQç¡®ä¿æŒä¹…åŒ–çš„æ¶ˆæ¯èƒ½åœ¨æœåŠ¡å™¨é‡å¯ä¹‹åæ¢å¤çš„æ–¹å¼æ˜¯, å°†å®ƒä»¬å†™å…¥ç£ç›˜ä¸Šçš„ä¸€ä¸ªæŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶ã€‚å½“å‘å¸ƒä¸€æ¡æŒä¹…æ€§æ¶ˆæ¯åˆ°ä¸€ä¸ªæŒä¹…äº¤æ¢æœºä¸Šæ—¶, Rabbitä¼šåœ¨æ¶ˆæ¯æäº¤åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ä¹‹åæ‰å‘é€å“åº”; è¿˜éœ€è¦æ³¨æ„çš„æ˜¯, å¦‚æœä¹‹åè¿™æ¡æ¶ˆæ¯è¢«è·¯ç”±åˆ°ä¸€ä¸ªéæŒä¹…åŒ–é˜Ÿåˆ—, åˆ™æ¶ˆæ¯åˆä¼šä»ä¸Šé¢çš„æ—¥å¿—æ–‡ä»¶ä¸­åˆ é™¤, å¹¶ä¸”æ— æ³•ä»æœåŠ¡å™¨é‡å¯ä¸­æ¢å¤;ä¸€æ—¦ä½ ä»æŒä¹…åŒ–é˜Ÿåˆ—ä¸­æ¶ˆè´¹äº†ä¸€æ¡æŒä¹…æ€§æ¶ˆæ¯(å¹¶ä¸”è¿›è¡Œäº†ç¡®è®¤), RabbitMQä¼šåœ¨æŒä¹…åŒ–æ—¥å¿—ä¸­æŠŠè¿™æ¡æ¶ˆæ¯æ ‡è®°ä¸ºç­‰å¾…åƒåœ¾æ”¶é›†; æŒä¹…åŒ–çš„é—®é¢˜ æŒä¹…åŒ–ç”±äºä¼šå†™ç£ç›˜, æ‰€ä»¥ä¼šæå¤§é™ä½RabbitMQæ¯ç§’å¤„ç†çš„æ¶ˆæ¯æ€»æ•°, é™ä½ååé‡; æŒä¹…åŒ–åœ¨Rabbitå†…å»ºé›†ç¾¤ç¯å¢ƒä¸‹å·¥ä½œçš„å¹¶ä¸å¥½, åé¢åœ¨å­¦ä¹ é›†ç¾¤æ—¶, ä¼šç»™å‡ºç›¸åº”çš„è§£å†³æ–¹æ¡ˆ; å…·ä½“ä»£ç ä¸‹é¢é€šè¿‡ä½¿ç”¨ Laravel + php-amqplib æ‰©å±•, é€šè¿‡åˆ›å»ºä¸€ä¸ªæŠ•é€’æ¶ˆæ¯çš„ç”Ÿäº§è€…, å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€æ¡æŒä¹…åŒ–æ¶ˆæ¯:12","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/categories/RabbitMQ/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/tags/RabbitMQ/"}]},{"title":"secret","slug":"2018-05-28-secret","date":"2018-05-28T05:02:56.000Z","updated":"2018-05-28T05:30:40.000Z","comments":true,"path":"2018/05/28/2018-05-28-secret/","link":"","permalink":"http://blog.renyimin.com/2018/05/28/2018-05-28-secret/","excerpt":"","text":"æƒ³è±¡åŠ›å°±æ˜¯ä¸€åˆ‡, å®ƒæ˜¯å£°æ˜å°†å‘ç”Ÿä¹‹äº‹çš„é¢„è§ˆ â€“ çˆ±å› æ–¯å¦ (1879-1955) è¦è¾¾æˆä½ ç”Ÿå‘½ä¸­æƒ³è¦çš„ä¸€åˆ‡, å…¶æ·å¾„å°±æ˜¯ â€“ å½“ä¸‹å°±â€æ˜¯â€å¿«ä¹çš„, å¹¶ä¸”â€æ„Ÿè§‰â€å¿«ä¹! è¿™æ˜¯æŠŠé‡‘é’±å’Œå…¶ä»–ä½ æƒ³è¦çš„äº‹ç‰©å¸¦è¿›ä½ ç”Ÿå‘½ä¸­æœ€å¿«çš„æ–¹å¼ã€‚ æˆ‘ç°åœ¨ç»ˆäºäº†è§£, å¯Œè¶³æ­£åœ¨é‚£å„¿ç­‰ç€æˆ‘ã€‚æˆ‘çš„ä»»åŠ¡ä¸æ˜¯å»æƒ³å‡ºé‡‘é’±è¦â€å¦‚ä½•â€åˆ°æ¥, è€Œæ˜¯å»è¦æ±‚, å»ç›¸ä¿¡æˆ‘å·²ç»åœ¨æ¥æ”¶è´¢å¯Œ, ä»¥åŠå½“ä¸‹å°±å»æ„Ÿè§‰å¹¸ç¦å¿«ä¹, è‡³äºå…¶ç»†èŠ‚, å°±äº¤ç»™å®‡å®™å»å¤„ç†å§! ğŸ’°æ¥çš„å®¹æ˜“è€Œä¸”é¢‘ç¹!","categories":[{"name":"secret","slug":"secret","permalink":"http://blog.renyimin.com/categories/secret/"}],"tags":[{"name":"secret","slug":"secret","permalink":"http://blog.renyimin.com/tags/secret/"}]},{"title":"04. æµ…æRabbitMQé€šä¿¡è¿‡ç¨‹","slug":"rabbitmq/2018-05-27-rabbitmq-04","date":"2018-05-27T10:30:26.000Z","updated":"2018-05-28T09:10:49.000Z","comments":true,"path":"2018/05/27/rabbitmq/2018-05-27-rabbitmq-04/","link":"","permalink":"http://blog.renyimin.com/2018/05/27/rabbitmq/2018-05-27-rabbitmq-04/","excerpt":"","text":"ä¸‹é¢ç»˜åˆ¶äº†ä¸€å¼ æ¯”è¾ƒç®€å•çš„Rabbitæ¶ˆæ¯é€šä¿¡æ¶æ„å›¾ æ¥ä¸‹æ¥éœ€è¦ç®€å•è®¤è¯†ä¸€ä¸‹ä¸Šå›¾ä¸­çš„å„ä¸ªæ¦‚å¿µç‚¹ Broker Server (Rabbit Server)RabbitMQæ˜¯ä½œä¸ºä¸€ä¸ªæ¶ˆæ¯æŠ•é€’çš„ä¸­é—´ä»£ç†æœåŠ¡å™¨å­˜åœ¨çš„(brokeræœ‰ ä¸­é—´äºº, ä»£ç†äººçš„æ„æ€);åº”ç”¨ç¨‹åºä»RabbitMQè·å–çš„æ•°æ®å¹¶ä¸æ˜¯Rabbitäº§ç”Ÿçš„, å¯ä»¥è®¤ä¸ºå®ƒåœ¨åº”ç”¨ç¨‹åºä¹‹é—´æ‰®æ¼”ç€è·¯ç”±å™¨çš„è§’è‰²; ExchangeRabbit Serverçš„å†…éƒ¨æ„ä»¶, ä¹Ÿå« äº¤æ¢æœº, å€¼å¾—æ³¨æ„çš„æ˜¯: æ¶ˆæ¯æ°¸è¿œä¸å¯èƒ½è¢«ç›´æ¥å‘é€åˆ°Rabbit Serverçš„Queueä¸­, å®ƒæ€»æ˜¯ä¼šç»è¿‡Rabbit Serverå†…éƒ¨çš„ exchangeäº¤æ¢æœº; ä¸ºä»€ä¹ˆRabbit Serverä¸æ˜¯å°†ç”Ÿäº§è€…æŠ•é€’çš„æ¶ˆæ¯ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—, è€Œå¿…é¡»è¦ç»è¿‡å†…éƒ¨çš„exchangeç»„ä»¶? æ¯•ç«Ÿå¯¹äºç”Ÿäº§è€…æ¥è¯´, åªæ˜¯å¸Œæœ›æ¶ˆæ¯èƒ½å¤Ÿåˆ°é˜Ÿåˆ—è€Œå·², Rabbit Serverä¸­ä¸ºå•¥è¿˜å¤šäº†ä¸€æ­¥? å¦‚æœæ²¡æœ‰exchangeå†…éƒ¨ç»„ä»¶, å¯¹äºç”Ÿäº§è€…æŠ•é€’æ¥çš„æ¶ˆæ¯, brokerå…¶å®è²Œä¼¼ä¹Ÿå¯ä»¥æ ¹æ®æ¶ˆæ¯å†…å®¹ä¸­çš„æŸä¸ªå±æ€§æ¥åˆ¤æ–­æ¶ˆæ¯è¯¥æŠ•é€’ç»™å“ªä¸ªé˜Ÿåˆ—, æˆ–è€…ä¹Ÿå¯ä»¥æŒ‡å®šæŠ•é€’ç»™å…¨éƒ¨é˜Ÿåˆ—, æˆ–è€…æ ¹æ®æ­£åˆ™æ¥æŠ•é€’ç»™æŸäº›é˜Ÿåˆ—; ä½†è¿™æ ·çš„è¯, ç›¸å½“äºç”Ÿäº§è€…å’Œé˜Ÿåˆ—ç›´æ¥é¢å¯¹é¢åšäº†å¼ºç»‘å®š; è€Œå¦‚æœæœ‰exchangeçš„è¯, å¯¹äºç»‘å®šå’Œè§£æç»‘å®š, ç›´æ¥äº¤ç”±exchangeæ¥è¿›è¡Œå³å¯, è¿™æ ·åœ¨å†…éƒ¨ä¹Ÿåšåˆ°äº†è§£è€¦å’Œå•ä¸€èŒè´£çš„åˆ’åˆ†, è¿™æ ·å°±å¯ä»¥å°†ä¸€äº›ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹å‡ºæ¥(æ¯”æ–¹ä½ æ˜¯è¦ç¾¤å‘, è¿˜æ˜¯æŒ‡å®šé˜Ÿåˆ—å‘é€, æˆ–è€…åŒ¹é…é˜Ÿåˆ—å‘é€, è¿™äº›ç»‘å®šå’Œè§£æå·¥ä½œéƒ½ç”±exchangeåœ¨ç”Ÿäº§è€…å’Œé˜Ÿåˆ—ä¸­é—´è¿›è¡Œå¤„ç†, ç”Ÿäº§è€…å’Œé˜Ÿåˆ—ä¸éœ€è¦ç›´æ¥é¢å¯¹é¢); åœ¨RabbitMQä¸­, exchangeç»„ä»¶æœ‰å››ç§ç±»å‹ ï¼š direct :ä½¿ç”¨è¿™ç§ç±»å‹, ä¼šå°†ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è®¾ç½®çš„ routingkey ä¸ queueå’Œexchangeç»‘å®šæ—¶çš„ bindingkey è¿›è¡Œç²¾ç¡®åŒ¹é…, å¦‚æœ routingkey å’Œ bindingkey å®Œå…¨ä¸€æ ·, é‚£ä¹ˆMessageå°±ä¼šè¢«ä¼ é€’åˆ°å½“å‰exchangeçš„å¯¹åº”queueä¸­;å¦‚æœä½¿ç”¨äº†directç±»å‹Exchange, ç»‘å®šé˜Ÿåˆ—å’Œexchangeæ—¶, å¯ä»¥ä¸å¿…æŒ‡å®š routingkey çš„åå­—, åœ¨æ­¤ç±»å‹ä¸‹åˆ›å»ºçš„queueæœ‰ä¸€ä¸ªé»˜è®¤çš„ routingkey, è¿™ä¸ª routingkey ä¸€èˆ¬å’Œ queue åŒå;æ³¨æ„: è™½ç„¶ä¸å¯ä»¥åˆ›å»ºä¸¤ä¸ªç›¸åŒåå­—çš„é˜Ÿåˆ—, ä½†æ˜¯å¤šä¸ªä¸åŒåçš„é˜Ÿåˆ—ä¸exchangeè¿›è¡Œç»‘å®šæ—¶, bindingkey å¯ä»¥ç›¸åŒ; æ‰€ä»¥å¯èƒ½ä¼šæœ‰å¤šä¸ªé˜Ÿåˆ—çš„bindingkeyéƒ½ ä¸ åŒä¸€æ¡æ¶ˆæ¯å‘å¸ƒæ—¶çš„routingkeyå¯ä»¥åŒ¹é…, ä»è€Œå¯¼è‡´åŒä¸€æ¡æ¶ˆæ¯è¢«exchangeè·¯ç”±åˆ°å¤šä¸ªé˜Ÿåˆ—ä¸­! fanout:ä½¿ç”¨è¿™ç§ç±»å‹, ä¼šå°†ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è®¾ç½®çš„ routingkey ä¸ queueå’Œexchangeç»‘å®šæ—¶çš„ bindingkey è¿›è¡Œæ¨¡å¼åŒ¹é…(æ­£åˆ™åŒ¹é…)æ¯”å¦‚ ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶è®¾ç½®çš„routing keyä¸º ab*, åˆ™å¯ä»¥ä¸ bindingkey ä¸º ab å¼€å¤´çš„æ‰€æœ‰çš„queueåŒ¹é…; topic ï¼šä½¿ç”¨è¿™ç§ç±»å‹, ä¼šå¿½ç•¥routingkeyçš„å­˜åœ¨, ç›´æ¥å°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ä¸å½“å‰exchangeç»‘å®šçš„queueä¸­; headers : ä¸å¤ªå®ç”¨, è€Œä¸”æ€§èƒ½æ¯”è¾ƒå·®, å‡ ä¹å†ä¹Ÿç”¨ä¸åˆ°äº† Queueç”Ÿäº§è€…æŠ•é€’ç»™broker serverçš„æ¶ˆæ¯, æœ€ç»ˆä¼šè¢«å­˜å‚¨åˆ°é˜Ÿåˆ—ä¸­, ç­‰å¾…æ¶ˆè´¹è€…å¤„ç†;é˜Ÿåˆ—åœ¨å£°æ˜å, éœ€è¦ä¸exchangeè¿›è¡Œç»‘å®š;æ³¨æ„: å¦‚æœä½ ä¸èƒ½æ‰¿æ‹…æ¶ˆæ¯ä¸¢å…¥â€é»‘æ´â€è€Œä¸¢å¤±çš„è¯, ä½ çš„åº”ç”¨æ— è®ºæ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€…, éƒ½åº”è¯¥å°è¯•å»åˆ›å»ºé˜Ÿåˆ—; BindingKeyé˜Ÿåˆ—åœ¨å£°æ˜å, éœ€è¦ä¸exchangeè¿›è¡Œç»‘å®š, ç»‘å®šçš„æ—¶å€™å¯ä»¥æ˜¾ç¤ºåœ°åŒºæŒ‡å®šä¸€ä¸ª routingkey, è¿™é‡Œæˆ‘ä»¬å« bindingkey;æ³¨æ„: æœ‰äº›é˜Ÿåˆ—åœ¨å£°æ˜å, åœ¨ä¸exchangeç»‘å®šæ—¶, æ²¡æœ‰æ˜¾ç¤ºåœ°å»è®¾ç½® bindingkey, æ­¤æ—¶ bindingkey é»˜è®¤ä¸ºé˜Ÿåˆ—åå­—; Producerå›¾ä¸­å·¦ä¾§çš„å®¢æˆ·ç«¯ç¨‹åºâ€™A,Bâ€™, å…¶å®å°±æ˜¯ç”Ÿäº§è€…: è¿æ¥åˆ° Rabbit Server , å¹¶å°†æ¶ˆæ¯æŠ•é€’åˆ° Rabbit Server;produceræ°¸è¿œä¸å¯èƒ½ç›´æ¥å°†æ¶ˆæ¯ä¸¢åˆ°é˜Ÿåˆ—ä¸­; RoutingKeyç”Ÿäº§è€…åœ¨æ¶ˆæ¯å‘å¸ƒæ—¶, éœ€è¦æŒ‡æ˜æ¶ˆæ¯çš„ routingkey, exchangeåˆ™ä¼šä¾æ®æ­¤routingkeyå»åŒ¹é… ä¸ è‡ªèº«ç»‘å®šçš„é‚£äº›é˜Ÿåˆ—åœ¨ç»‘å®šæ—¶ æ‰€æ˜¾ç¤ºè®¾ç½®çš„bindingkey(æˆ–è€…é˜Ÿåˆ—å), ä»è€Œå†³å®šæ¶ˆæ¯å°†ä¼šè¢«è·¯ç”±åˆ°ä¸è‡ªèº«ç»‘å®šçš„å“ªäº›é˜Ÿåˆ—ä¸­;å½“ç„¶, å¦‚æœexchangeè®¾ç½®çš„typeæ˜¯topicç±»å‹, åˆ™ä¼šå¿½ç•¥ routingkey å’Œ bindingkey çš„å­˜åœ¨; Consumerå›¾ä¸­å³ä¾§çš„å®¢æˆ·ç«¯ç¨‹åºâ€™1,2,3â€™, å…¶å®å°±æ˜¯æ¶ˆè´¹è€…: è¿æ¥åˆ° Rabbit Server , å¹¶ä» Rabbit Server ä¸­æ¥æ”¶æ¶ˆæ¯;å‘é€æ¶ˆæ¯æ—¶éœ€è¦æŒ‡å®š routingkey, å¦‚æœæ²¡æœ‰æŒ‡å®šroutingkeyæˆ–è€…æŒ‡å®šçš„routingkeyåŒ¹é…ä¸åˆ°å¯¹åº”çš„bindingkey, æ¶ˆæ¯ä¼šè¢« Rabbit æœåŠ¡ä¸¢å¼ƒæ‰, æ‰å…¥â€é»‘æ´â€; ConnectionConnectionå…¶å®å°±æ˜¯ä¸€ä¸ªTCPçš„è¿æ¥, Producer å’Œ Consumer éƒ½æ˜¯é€šè¿‡TCPè¿æ¥åˆ°RabbitMQ Serverçš„, ä»»ä½•ä¸Rabbit Serverå†…éƒ¨äº¤äº’çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦é€šè¿‡TCPè¿æ¥åˆ°RabbitMQ Server, åé¢ä¼šçœ‹åˆ°, ç¨‹åºçš„èµ·å§‹å°±æ˜¯å»ºç«‹è¿™ä¸ªTCPè¿æ¥;Connectionæ˜¯RabbitMQçš„socketé“¾æ¥, å®ƒå°è£…äº†socketåè®®ç›¸å…³éƒ¨åˆ†é€»è¾‘ ChannelChannel æ˜¯æˆ‘ä»¬ä¸RabbitMQæ‰“äº¤é“çš„æœ€é‡è¦çš„ä¸€ä¸ªæ¥å£, æˆ‘ä»¬å¤§éƒ¨åˆ†çš„ä¸šåŠ¡æ“ä½œæ˜¯åœ¨channelè¿™ä¸ªæ¥å£ä¸­å®Œæˆçš„ (åŒ…æ‹¬ å®šä¹‰exchange, å®šä¹‰queue, ç»‘å®šexchangeä¸queueã€å‘å¸ƒæ¶ˆæ¯ ç­‰); Channel æ˜¯è™šæ‹Ÿè¿æ¥, å®ƒå»ºç«‹åœ¨ä¸Šè¿°çš„TCPè¿æ¥ connection ä¸­, æ•°æ®æµåŠ¨éƒ½æ˜¯åœ¨channelä¸­è¿›è¡Œçš„, ç¨‹åºèµ·å§‹ç¬¬ä¸€æ­¥å°±æ˜¯å»ºç«‹TCPè¿æ¥ Connection, ç¬¬äºŒæ­¥å°±æ˜¯å»ºç«‹ä¿¡é“ Channel; ä¸ºä»€ä¹ˆä½¿ç”¨Channel, è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨TCPè¿æ¥ï¼Ÿå¯¹äºOSæ¥è¯´, å»ºç«‹å’Œå…³é—­TCPè¿æ¥æ˜¯æœ‰ä»£ä»·çš„, é¢‘ç¹çš„å»ºç«‹å…³é—­TCPè¿æ¥å¯¹äºç³»ç»Ÿçš„æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“, è€Œä¸”TCPçš„è¿æ¥æ•°ä¹Ÿæœ‰é™åˆ¶, è¿™ä¹Ÿé™åˆ¶äº†ç³»ç»Ÿå¤„ç†é«˜å¹¶å‘çš„èƒ½åŠ›;ä½†æ˜¯ï¼Œåœ¨TCPè¿æ¥ä¸­å»ºç«‹channelæ˜¯æ²¡æœ‰ä¸Šè¿°ä»£ä»·çš„, å¯¹äº producer æˆ–è€… consumer æ¥è¯´, å¯ä»¥å¹¶å‘çš„ä½¿ç”¨å¤šä¸ªchannelè¿›è¡Œ â€˜publishâ€™æˆ–è€…â€™receiveâ€™; vhostæœ€å, è¿˜æœ‰ä¸€ä¸ªåœ¨å›¾ä¸­å¹¶æœªä½“ç°å‡ºæ¥çš„æ¦‚å¿µ vhost æ¯ä¸€ä¸ªRabbitMQæœåŠ¡å™¨éƒ½èƒ½åˆ›å»ºè™šæ‹Ÿæ¶ˆæ¯æœåŠ¡å™¨, æˆ‘ä»¬ç§°ä¹‹ä¸ºè™šæ‹Ÿä¸»æœº(vhost), æ¯ä¸€ä¸ª vhost æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ª mini ç‰ˆçš„ RabbitMQ Server, æ‹¥æœ‰è‡ªå·±çš„ exchagne, queue, å’Œ bindings rule ç­‰ç­‰, æ›´é‡è¦çš„æ˜¯, å®ƒè¿˜æ‹¥æœ‰è‡ªå·±çš„ æƒé™æœºåˆ¶, è¿™ä½¿å¾—ä½ èƒ½å¤Ÿå®‰å…¨åœ°ä½¿ç”¨ä¸€ä¸ªRabbitMQæœåŠ¡å™¨æ¥æœåŠ¡ä¼—å¤šåº”ç”¨ç¨‹åº, è€Œä¸ç”¨æ‹…å¿ƒAåº”ç”¨å¯èƒ½ä¼šåˆ é™¤Båº”ç”¨æ­£åœ¨ä½¿ç”¨çš„é˜Ÿåˆ—; vhostä¹‹äºRabbitå°±åƒè™šæ‹Ÿæœºä¹‹äºç‰©ç†æœåŠ¡å™¨ä¸€æ ·: é€šè¿‡åœ¨å„ä¸ªå®ä¾‹é—´æä¾›é€»è¾‘ä¸Šéš”ç¦», å…è®¸ä½ ä¸ºä¸åŒåº”ç”¨ç¨‹åºå®‰å…¨ä¿å¯†åœ°è¿è¡Œæ•°æ®, è¿™å¾ˆæœ‰ç”¨, å®ƒæ—¢èƒ½å°†åŒä¸€Rabbitçš„ä¼—å¤šå®¢æˆ·ç«¯åŒºåˆ†å¼€æ¥, åˆå¯ä»¥é¿å…é˜Ÿåˆ—å’Œäº¤æ¢å™¨çš„å‘½åå†²çª; å¦åˆ™, ä½ å¯èƒ½ä¸å¾—ä¸å»è¿è¡Œå¤šä¸ªRabbit, å¹¶æ‰¿æ‹…éšä¹‹è€Œæ¥çš„ç®¡ç†é—®é¢˜, ç›¸å, ä½ å¯ä»¥åªè¿è¡Œä¸€ä¸ªRabbit, ç„¶åæŒ‰éœ€å¯åŠ¨æˆ–è€…å…³é—­vhost;å½“ä½ æœ‰å¤šä¸ªä¸åŒçš„åº”ç”¨è¦ä½¿ç”¨RabbitMQæ—¶, ä½ å¯ä»¥ä¸ºæ¯ä¸ªåº”ç”¨å®šä¹‰ä¸€ä¸ªvhostæ¥å°†åº”ç”¨ä»é€»è¾‘ä¸Šéš”ç¦»å¼€; vhostæ˜¯AMQPæ¦‚å¿µçš„åŸºç¡€, ä½ å¿…é¡»åœ¨è¿æ¥æ—¶è¿›è¡ŒæŒ‡å®š, ç”±äºRabbitMQåŒ…å«äº†å¼€ç®±å³ç”¨çš„é»˜è®¤vhost: / , å› æ­¤æ—¶å€™ç”¨èµ·æ¥éå¸¸ç®€å•, å¦‚æœä½ ä¸éœ€è¦å¤šä¸ªvhostçš„è¯, å°±ä½¿ç”¨é»˜è®¤çš„å³å¯;é€šè¿‡ä½¿ç”¨é»˜è®¤çš„guestç”¨æˆ·åå’Œå¯†ç guest, å°±å¯ä»¥è®¿é—®é»˜è®¤çš„ vhost, ä¸ºäº†å®‰å…¨èµ·è§, ä½ åº”è¯¥æ›´æ”¹å®ƒ; AMQP å¹¶æ²¡æœ‰æŒ‡å®šæƒé™æ§åˆ¶æ˜¯åœ¨vhostçº§åˆ«è¿˜æ˜¯åœ¨æœåŠ¡å™¨ç«¯çº§åˆ«å®ç°, è¿™ç•™ç»™äº†æ¶ˆæ¯æœåŠ¡å™¨çš„å¼€å‘è€…å»å†³å®š, è€Œåœ¨RabbitMQä¸­, æƒé™æ§åˆ¶æ˜¯ä»¥vhostä¸ºå•ä½çš„, å½“ä½ åœ¨Rabbité‡Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·æ—¶, ç”¨æˆ·é€šå¸¸ä¼šè¢«æŒ‡æ´¾ç»™è‡³å°‘ä¸€ä¸ªvhost, å¹¶ä¸”åªèƒ½è®¿é—®è¢«æŒ‡æ´¾çš„vhostå†…çš„é˜Ÿåˆ—, äº¤æ¢æœºå’Œç»‘å®š;å½“ä½ åœ¨è®¾è®¡æ¶ˆæ¯é€šä¿¡æ¶æ„æ—¶, è®°ä½vhostä¹‹é—´æ˜¯ç»å¯¹éš”ç¦»çš„, ä½ æ— æ³•å°† vhost â€˜aâ€™ ä¸­çš„äº¤æ¢æœºç»‘å®šåˆ° vhost â€˜bâ€™ ä¸­çš„é˜Ÿåˆ—å»; å¦å¤–éœ€è¦æ³¨æ„: å½“ä½ åœ¨RabbitMQé›†ç¾¤ä¸Šåˆ›å»ºvhostæ—¶, æ•´ä¸ªé›†ç¾¤ä¸Šéƒ½ä¼šåˆ›å»ºè¯¥vhost; å¦‚ä½•åˆ›å»ºvhost? vhostå’Œæƒé™æ§åˆ¶éå¸¸ç‹¬ç‰¹, å®ƒä»¬æ˜¯AMQPä¸­å”¯ä¸€æ— æ³•é€šè¿‡AMQPåè®®åˆ›å»ºçš„åŸºå…ƒ(ä¸åŒäºé˜Ÿåˆ—, äº¤æ¢æœºå’Œç»‘å®š), å¯¹äºRabbitMQæ¥è¯´, ä½ éœ€è¦é€šè¿‡ RabbitMQ å®‰è£…è·¯å¾„ä¸‹ ./sbin/ ç›®å½•ä¸­çš„ rabbitmqctl å·¥å…·æ¥åˆ›å»º å¦‚æœæƒ³çŸ¥é“ç‰¹å®šrabbitmqæœåŠ¡å™¨ä¸Šè¿è¡Œç€å“ªäº›vhostæ—¶, å¯ä»¥æ‰§è¡Œ 123renyimindeMacBook-Pro:~ renyimin$ rabbitmqctl list_vhostsListing vhosts/ åˆ›å»ºä¸€ä¸ªvhost 12renyimindeMacBook-Pro:~ renyimin$ rabbitmqctl add_vhost testCreating vhost &quot;test&quot; åˆ é™¤ä¸€ä¸ªvhost 12renyimindeMacBook-Pro:~ renyimin$ rabbitmqctl delete_vhost testDeleting vhost &quot;test&quot; å°ç»“è¿™ä¸€éƒ¨åˆ†åªæ˜¯å¤§æ¦‚äº†è§£ä¸€ä¸‹RabbitMQæœåŠ¡ä¸€äº›æ¦‚å¿µæ€§çŸ¥è¯†, å½“ç„¶, å…³äºè¿™äº›çŸ¥è¯†ç‚¹åœ¨åé¢è¿›è¡Œç¼–ç çš„æ—¶å€™ä¼šè¿›è¡Œè¿›ä¸€æ­¥æ‰©å±•, æ¯”å¦‚ é˜Ÿåˆ—, æ¶ˆæ¯, äº¤æ¢æœºçš„è¯¸å¤šå±æ€§éƒ½ä¼šæ¶‰åŠåˆ°;","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/categories/RabbitMQ/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/tags/RabbitMQ/"}]},{"title":"03. æœåŠ¡å™¨ç®¡ç†","slug":"rabbitmq/2018-05-27-rabbitmq-03","date":"2018-05-27T10:20:09.000Z","updated":"2018-05-28T09:07:06.000Z","comments":true,"path":"2018/05/27/rabbitmq/2018-05-27-rabbitmq-03/","link":"","permalink":"http://blog.renyimin.com/2018/05/27/rabbitmq/2018-05-27-rabbitmq-03/","excerpt":"","text":"å‰è¨€åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç» ä¸‹è½½å®‰è£…å¹¶æˆåŠŸå¯åŠ¨äº†RabbitmqæœåŠ¡, æ¥ä¸‹æ¥, å¯ä»¥ç®€å•äº†è§£ä¸€äº›ä¸æœåŠ¡å™¨ç®¡ç†ç›¸å…³çš„çŸ¥è¯†ç‚¹; Erlang å’Œ Erlang Cookieå‘½ä»¤è¡Œçš„åŸºæœ¬ä½¿ç”¨RabbitMQçš„å¯åŠ¨å¯ä»¥åœ¨å®‰è£…ç›®å½•ä¸‹çš„ â€˜sbin/â€˜ ç›®å½•ä¸‹, è¿è¡Œ rabbitmq-server -detached æ¥å¯åŠ¨åæ¥è¿è¡Œ;å¦‚æœå¯åŠ¨ä¸­é‡åˆ°äº†ä»»ä½•é”™è¯¯, å¯ä»¥æ£€æŸ¥RabbitMQçš„æ—¥å¿—æ–‡ä»¶; å¦‚æœä¸çŸ¥é“æ—¥å¿—æ–‡ä»¶çš„ä½ç½®, å¯ä»¥æŸ¥çœ‹: 2. é…ç½®ç›¸å…³ä¸€èˆ¬æƒ…å†µä¸‹, RabbitMQçš„é»˜è®¤é…ç½®å°±è¶³å¤Ÿäº†, é€šè¿‡åœ¨Webç®¡ç†å¹³å°å¯ä»¥çœ‹åˆ°, é»˜è®¤æ˜¯æ²¡æœ‰é…ç½®æ–‡ä»¶çš„; å¦‚æœå¸Œæœ›ç‰¹æ®Šè®¾ç½®çš„è¯, æœ‰å‡ ä¸ªä½ç½®å¯ä»¥è¿›è¡Œé…ç½®;æ³¨æ„, æ–‡ä»¶é»˜è®¤æ˜¯æ²¡æœ‰çš„, å¦‚æœéœ€è¦å¿…é¡»è‡ªå·±åˆ›å»º, è‡³äºåˆ›å»ºé…ç½®æ–‡ä»¶çš„ä½ç½®åœ¨å“ªé‡Œ, å¯ä»¥é€šè¿‡æ—¥å¿—æ–‡ä»¶æ¥æŸ¥çœ‹: 12345678910111213141516171819enyimindembp:rabbitmq renyimin$ pwd/usr/local/var/log/rabbitmqrenyimindembp:rabbitmq renyimin$ lslog rabbit@localhost-sasl.log rabbit@localhost.log rabbit@localhost_upgrade.logenyimindembp:rabbitmq renyimin$ head -20 rabbit\\@localhost.log=INFO REPORT==== 11-Dec-2017::15:37:02 ===Starting RabbitMQ 3.6.14 on Erlang 20.1.7Copyright (C) 2007-2017 Pivotal Software, Inc.Licensed under the MPL. See http://www.rabbitmq.com/=INFO REPORT==== 11-Dec-2017::15:37:02 ===node : rabbit@localhosthome dir : /Users/renyiminconfig file(s) : /usr/local/etc/rabbitmq/rabbitmq.config (not found)cookie hash : qNSOVbC4c3Bg7punCVVdaQ==log : /usr/local/var/log/rabbitmq/rabbit@localhost.logsasl log : /usr/local/var/log/rabbitmq/rabbit@localhost-sasl.logdatabase dir : /usr/local/var/lib/rabbitmq/mnesia/rabbit@localhost rabbitmq-env.confç¯å¢ƒå˜é‡çš„é…ç½®æ–‡ä»¶ rabbitmq-env.conf : å¯ä»¥ç”¨æ¥é…ç½®rabbitmqçš„ä¸€äº›åŸºæœ¬é…ç½®æ–‡ä»¶çš„è·¯å¾„; è¿™äº›æ–‡ä»¶çš„ä½ç½®æ˜¯ç‰¹å®šäºåˆ†å‘çš„, é»˜è®¤æƒ…å†µä¸‹, å®ƒä»¬å¯èƒ½ä¸ä¼šåˆ›å»º, ä½†å¸Œæœ›ä½äºæ¯ä¸ªå¹³å°çš„ä»¥ä¸‹ä½ç½®ï¼š é€šç”¨UNIX $ RABBITMQ_HOME/etc/rabbitmq / Debian /etc/rabbitmq/ RPM /etc/rabbitmq/ Mac OSX(Homebrew) $ {install_prefix}/etc/rabbitmq/ï¼ŒHomebrewå‰ç¼€é€šå¸¸æ˜¯/usr/local Windows ï¼…APPDATAï¼…\\RabbitMQ\\ ç°åœ¨ä¿®æ”¹ rabbitmq-env.conf ä¸­æŒ‡å®šçš„ rabbitmq.conf ä½ç½®ä¸º â€˜/usr/local/Cellar/rabbitmq/3.7.5/etc/rabbitmq/rabbitmq.confâ€™1234567891011121314renyimindembp:rabbitmq renyimin$ pwd/usr/local/etc/rabbitmqrenyimindembp:rabbitmq renyimin$ cat rabbitmq-env.confCONFIG_FILE=/usr/local/etc/rabbitmq/rabbitmqNODE_IP_ADDRESS=127.0.0.1NODENAME=rabbit@localhostrenyimindembp:rabbitmq renyimin$ vim rabbitmq-env.conf....renyimindembp:rabbitmq renyimin$ cat rabbitmq-env.conf#CONFIG_FILE=/usr/local/etc/rabbitmq/rabbitmqCONFIG_FILE=/usr/local/Cellar/rabbitmq/3.7.5/etc/rabbitmq/rabbitmqNODE_IP_ADDRESS=127.0.0.1NODENAME=rabbit@localhostrenyimindembp:rabbitmq renyimin$ æ”¹å®Œé‡å¯ä¹‹å, åœ¨Webç®¡ç†ç•Œé¢ä¼šå‘ç°ä¹Ÿæœ‰äº†é…ç½®æ–‡ä»¶çš„è·¯å¾„: rabbitmq.confå¦‚æœ rabbitmq.conf ä¸å­˜åœ¨, å¯ä»¥æ‰‹åŠ¨åˆ›å»º;å¦‚æœæ›´æ”¹ä½ç½®, è¯·è®¾ç½® RABBITMQ_CONFIG_FILE ç¯å¢ƒå˜é‡, RabbitMQä¼šè‡ªåŠ¨å°†.confæ‰©å±•åé™„åŠ åˆ°æ­¤å˜é‡çš„å€¼; é…ç½®å¯¹äºrabbitmq.configæ–‡ä»¶, rabbitå®˜ç½‘æä¾›äº†é»˜è®¤çš„rabbitmq.conf.example, å¯ä»¥ä»æ­¤å¤„è·å–;12 ä¸»è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttp://www.rabbitmq.com/configure.html RabbitMQæƒé™æ§åˆ¶è§£è¯»Rabbitæ—¥å¿—æ–‡ä»¶### åœ¨æˆåŠŸå¯åŠ¨äº†RabbitMQæœåŠ¡ä¹‹å, å‘½ä»¤è¡ŒæŸ¥çœ‹è™šæ‹Ÿæœº, é˜Ÿåˆ—, äº¤æ¢å™¨å’Œç»‘å®šçŠ¶æ€; é€šå¸¸æƒ…å†µä¸‹, ä½ æ˜¯åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥è¿è¡Œ rabbitmqctl æ¥ç®¡ç†è‡ªå·±çš„rabbitmqèŠ‚ç‚¹, ä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€šè¿‡ -n rabbit@[server_name]é€‰é¡¹æ¥ç®¡ç†è¿œç¨‹rabbitmqèŠ‚ç‚¹, @ç¬¦å·å°†èŠ‚ç‚¹æ ‡è¯†ç¬¦(rabbit@[server_name])åˆ†æˆä¸¤éƒ¨åˆ†: å·¦è¾¹çš„æ˜¯Erlangåº”ç”¨ç¨‹åºåç§°, åœ¨è¿™é‡Œæ°¸è¿œéƒ½æ˜¯ rabbit; å³è¾¹çš„æ˜¯æœåŠ¡å™¨ä¸»æœºåæˆ–è€…IPåœ°å€; ä½ è¦ç¡®ä¿è¿è¡ŒRabbitèŠ‚ç‚¹çš„æœåŠ¡å™¨å’Œè¿è¡Œ rabbitmqctl çš„å·¥ä½œç«™ç‚¹å®‰è£…äº†ç›¸åŒçš„ Erlang Cookie;","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/categories/RabbitMQ/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/tags/RabbitMQ/"}]},{"title":"02. Win,MacOS,Linuxä¸‹è½½å®‰è£…RabbitMQ","slug":"rabbitmq/2018-05-27-rabbitmq-02","date":"2018-05-27T04:20:21.000Z","updated":"2018-05-27T10:19:44.000Z","comments":true,"path":"2018/05/27/rabbitmq/2018-05-27-rabbitmq-02/","link":"","permalink":"http://blog.renyimin.com/2018/05/27/rabbitmq/2018-05-27-rabbitmq-02/","excerpt":"","text":"Windows ä¸‹è½½windowsç‰ˆRabbitMQ: åˆ°å®˜ç½‘ä¸‹è½½windows installerå³å¯; ç›´æ¥å‚»ç“œå¼åŒå‡»å®‰è£… (å¯èƒ½ä¼šæç¤º: Erlang could be detected. You must install Erlang before install RabbitMQ...., ç‚¹å‡»æ˜¯, ä¼šè·³è½¬åˆ° Erlang çš„ä¸‹è½½åœ°å€) ç„¶åä¸‹è½½å¹¶å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ Erlang (ä½ çš„RabbitMQå¯¹åº”çš„Erlangç‰ˆæœ¬è¯¥å¦‚ä½•é€‰æ‹©, å¯ä»¥å‚è€ƒWindows: With installer (recommended) | Manual) ç„¶åå‚»ç“œå¼ä¸‹è½½å®‰è£… Erlang å³å¯ å®‰è£…å®ŒErlangä¹‹å, åŒå‡»å®‰è£…RabbitMQ åœ¨å®‰è£…å®ŒRabbitMQä¹‹å, åœ¨Windowsçš„å¼€å§‹èœå•ä¸­ä¼šæœ‰ RabbitMQ æœåŠ¡ç›¸å…³çš„ä¸€äº›é€‰é¡¹å¯ä»¥ä½¿ç”¨, å¦‚ RabbitMQ service - start å¯åŠ¨RabbitMQæœåŠ¡ RabbitMQ service - stop å…³é—­RabbitMQæœåŠ¡ RabbitMQ Command Prompt è¿æ¥RabbitMQæœåŠ¡ (å‘½ä»¤è¡Œè¿æ¥å·¥å…·) â€¦â€¦ å½“ç„¶, ä½ å¯ä»¥é…ç½®rabbitmqå®‰è£…ç›®å½•ä¸‹çš„sbinç›®å½•åˆ°ç¯å¢ƒå˜é‡ä¸­, è¿™æ ·å°±å¯ä»¥ç›´æ¥cmdä½¿ç”¨ç›¸å…³çš„rabbitmqç›¸å…³å‘½ä»¤äº†; æ³¨æ„windowsä¸‹çš„é—®é¢˜: å¦‚æœå¯åŠ¨å‘½ä»¤è¡Œè¿æ¥å, æ‰§è¡Œ rabbitmqctl status æŠ¥é”™ä¸º erlang cookie é—®é¢˜, ç›®å‰æ‰¾åˆ°çš„è§£å†³æ–¹æ¡ˆæ˜¯: å°†C:\\Windows\\System32\\config\\systemprofile\\.erlang.cookie æ›¿æ¢åˆ° C:\\Users\\Administrator\\.erlang.cookie ä¹‹å, å¯ä»¥å¼€å¯rabbitmq-managementæ’ä»¶, æ¥é€šè¿‡Web UIçš„å½¢å¼æ¥è¿›è¡ŒRabbitMQçš„ç®¡ç† æ‰§è¡Œå¦‚ä¸‹æ“ä½œæ‰“å¼€rabbitmq-managementæ’ä»¶ 1234567891011121314151617181920E:\\rabbitmq\\rabbitmq_server-3.7.5\\sbin&gt;rabbitmqctl list_usersListing users ...guest [administrator]E:\\rabbitmq\\rabbitmq_server-3.7.5\\sbin&gt;rabbitmq-plugins enable rabbitmq_managementEnabling plugins on node rabbit@DHCCOEPA4DNL18R:rabbitmq_managementThe following plugins have been configured: rabbitmq_management rabbitmq_management_agent rabbitmq_web_dispatchApplying plugin configuration to rabbit@DHCCOEPA4DNL18R...The following plugins have been enabled: rabbitmq_management rabbitmq_management_agent rabbitmq_web_dispatchstarted 3 plugins.E:\\rabbitmq\\rabbitmq_server-3.7.5\\sbin&gt; è®¿é—®http://127.0.0.1:15672å³å¯æ‰“å¼€Webç®¡ç†ç•Œé¢, é»˜è®¤è´¦å·å’Œå¯†ç ä¸ºguest; Mac Macä¸‹è½½å®‰è£…RabbitMQæ¯”è¾ƒç®€å•, ç›´æ¥ home install rabbitmq å®‰è£…å®Œæˆå³å¯ 1234567891011121314151617181920renyimin$ brew info rabbitmqrabbitmq: stable 3.7.5Messaging brokerhttps://www.rabbitmq.com/usr/local/Cellar/rabbitmq/3.7.5 (232 files, 10.1MB) * // å¯ä»¥çœ‹åˆ°, hombrewå®‰è£…çš„è½¯ä»¶åŸºæœ¬ä¸Šä¼šè¢«æ”¾ç½®åˆ° `cd /usr/local/Cellar/` ä¸‹ Built from source on 2018-05-27 at 11:43:30From: https://github.com/Homebrew/homebrew-core/blob/master/Formula/rabbitmq.rb==&gt; DependenciesRequired: erlang âœ” // å¯ä»¥çœ‹åˆ°, å·²ç»è‡ªåŠ¨å¸®ä½ å®‰è£…äº†Erlangä¾èµ–==&gt; CaveatsManagement Plugin enabled by default at http://localhost:15672 // å¹¶ä¸”è‡ªåŠ¨å¼€å¯äº†æ’ä»¶ç®¡ç†Bash completion has been installed to: /usr/local/etc/bash_completion.dTo have launchd start rabbitmq now and restart at login: brew services start rabbitmqOr, if you don&apos;t want/need a background service you can just run: rabbitmq-serverrenyimindembp:Cellar renyimin$ æŒ‰ç…§æŒ‡ç¤º, å¯åŠ¨rabbitmqåå°è¿è¡Œ 12renyimin$ brew services start rabbitmq==&gt; Successfully started `rabbitmq` (label: homebrew.mxcl.rabbitmq) è®¿é—® http://127.0.0.1:15672, é»˜è®¤è´¦å·å¯†ç ä¸º guest Linux.. åç»­å®Œå–„ Docker.. åç»­å®Œå–„","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/categories/RabbitMQ/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/tags/RabbitMQ/"}]},{"title":"01. è®¤è¯†RabbitMQæ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶","slug":"rabbitmq/2018-05-27-rabbitmq-01","date":"2018-05-27T02:35:21.000Z","updated":"2018-05-27T10:44:34.000Z","comments":true,"path":"2018/05/27/rabbitmq/2018-05-27-rabbitmq-01/","link":"","permalink":"http://blog.renyimin.com/2018/05/27/rabbitmq/2018-05-27-rabbitmq-01/","excerpt":"","text":"ç®€ä»‹ RabbitMQæ˜¯ä¸€ä¸ªç”± Erlang å¼€å‘çš„ AMQP çš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶, éµå¾ª Mozilla Public Licenseå¼€æºåè®®; (rabbit : å…”å­, è¡ŒåŠ¨è¿…é€Ÿ, ç¹æ®–ç–¯ç‹‚) AMQP å³ Advanced Message Queuing Protocol(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®), ä¸€ä¸ªæä¾›ç»Ÿä¸€æ¶ˆæ¯æœåŠ¡çš„ åº”ç”¨å±‚ æ ‡å‡† é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®, æ˜¯åº”ç”¨å±‚åè®®çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†, ä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯, å¹¶ä¸å—å®¢æˆ·ç«¯/ä¸­é—´ä»¶ä¸åŒäº§å“, ä¸åŒçš„å¼€å‘è¯­è¨€ç­‰æ¡ä»¶çš„é™åˆ¶) åœ¨ã€ŠRabbitMQå®æˆ˜ é«˜æ•ˆéƒ¨ç½²åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ã€‹1.1èŠ‚ æ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶ çš„ç›¸å…³å†å²å¯ä»¥äº†è§£åˆ°, è™½ç„¶å‡ åå¹´å‰å°±å·²ç»å­˜åœ¨å¾ˆå¤šæ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶, ä½†æ˜¯ç”±äº ä¾›åº”å•†å£å’, å¯¼è‡´ä¸­å°å‹å…¬å¸å¯¹é«˜ä»·æ ¼MQä¾›åº”å•†ä¸æ»¡, è€Œå¤§å‹å…¬å¸ä¸å¯é¿å…åœ°ä½¿ç”¨æ¥è‡ªä¼—å¤šä¾›åº”å•†çš„MQäº§å“æ¥æœåŠ¡ä¼ä¸šå†…éƒ¨ä¸åŒçš„åº”ç”¨, è¿™äº›äº§å“ä½¿ç”¨ä¸åŒçš„API, ä¸åŒçš„åè®®, å› è€Œæ— æ³•è”åˆèµ·æ¥ç»„æˆå•ä¸€æ€»çº¿; è™½ç„¶åœ¨2001å¹´è¯ç”Ÿçš„JMSé€šè¿‡æä¾›å…¬å…±Java APIçš„æ–¹å¼, éšè—äº†å•ç‹¬MQäº§å“ä¾›åº”å•†æä¾›çš„å®é™…æ¥å£, ä»è€Œè·¨è¶Šäº†å£å’å’Œè§£å†³äº†äº’é€šé—®é¢˜ã€‚ä½†å…¶å®æˆ‘ä»¬éœ€è¦çš„æ˜¯æ–°çš„æ¶ˆæ¯é€šä¿¡æ ‡å‡†åŒ–æ–¹æ¡ˆ, æ‰€ä»¥å°±æœ‰äº† AMQP åè®®çš„è¯ç”Ÿ; ä¸Šé¢ç®€å•äº†è§£äº†Rabbitæ˜¯ä¸€æ¬¾å®ç°AMQPæ ‡å‡†åè®®çš„æ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶, æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æ¶ˆæ¯é˜Ÿåˆ—è½¯ä»¶èƒ½å¤Ÿå¸®æˆ‘ä»¬è§£å†³é‚£äº›é—®é¢˜? æ¶ˆæ¯é˜Ÿåˆ—è§£å†³çš„é—®é¢˜åº”ç”¨è§£è€¦é¦–å…ˆ, å½“ä½ å°†æ¶ˆæ¯é€šä¿¡é›†æˆåˆ°åº”ç”¨ç¨‹åºæ—¶, ä½ éœ€è¦ç†è§£ä½ æ­£åœ¨å°è¯•è§£å†³çš„é—®é¢˜ã€‚åƒæ¢ç´¢RabbitMQçš„å¤§å¤šæ•°äººä¸€æ ·, ä½ å¯èƒ½å¹¶ä¸æ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—, è€Œæ˜¯è§£å†³è§£è€¦é—®é¢˜çš„æ–¹æ³•ã€‚æ¯”å¦‚, ä½ å¯èƒ½æƒ³ç€:å¦‚ä½•å°†ä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡ä»è§¦å‘å®ƒçš„åº”ç”¨ç¨‹åºä¸­ç§»å‡º?å¦‚ä½•æ•´åˆç”¨ä¸åŒè¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åº, ä½¿å¾—ä»–ä»¬è¿è¡Œèµ·æ¥åƒå•ä¸ªç³»ç»Ÿ?è™½ç„¶çœ‹èµ·æ¥æ˜¯ä¸¤ä¸ªä¸åŒçš„é—®é¢˜, ä½†å´æœ‰ç€å…±åŒçš„æœ¬è´¨: è§£è€¦ è¯·æ±‚ å’Œ å¤„ç†, è¿™ä¸¤ä¸ªé—®é¢˜å‡éœ€è¦ä»åŒæ­¥ç¼–ç¨‹æ¨¡å‹è½¬å‘å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹; Coffee Bean æ¨¡å‹å½“ä½ åœ¨å’–å•¡é¦†ä¸‹äº†ä¸ªæ‹¿é“è®¢å•, ä½ å¹¶ä¸ä¼šä¸€ç›´ç­‰åœ¨æ”¶é“¶å°, ç›¸å, å’–å•¡é¦†ä¼šå°† æ¥å—è®¢å•çš„æ“ä½œ å’Œ è®¢å•å¤„ç†çš„æ“ä½œåˆ†å¼€;æ¥å•å‘˜ä¼šæ¥æ”¶ä½ çš„è¯·æ±‚(å’Œä½ çš„é’±), å¹¶å‘Šè¯‰å’–å•¡è°ƒç†å¸ˆä½ è®¢çš„æ˜¯ä»€ä¹ˆã€‚ç„¶åä½ åœ¨ç­‰å¾…è®¢å•å®Œæˆçš„è¿‡ç¨‹ä¸­å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹æƒ…, åŒæ—¶æ¥å•å‘˜ä¹Ÿå¯ä»¥è…¾å‡ºæ—¶é—´æ¥å…¶ä»–è®¢å•;å¦‚æœç­‰å¾…åˆ¶ä½œçš„å’–å•¡æŒ¤å‹å¤ªå¤šçš„è¯, ä»–ä»¬ä¼šå¢åŠ æ›´å¤šçš„å’–å•¡è°ƒç†å¸ˆä»¥å‡å°‘è®¢å•çš„æŒ¤å‹, è€Œæ— éœ€æ›´æ”¹æ¥å•å‘˜çš„æ•°é‡;é€šè¿‡è§£è€¦å¤„ç†è¿‡ç¨‹(åˆ†ç¦»è¯·æ±‚å’Œå¤„ç†), ä»–ä»¬ä»¥åŒæ ·æ•°é‡çš„å·¥ä½œäººå‘˜å®Œæˆäº†æ›´å¤šçš„å·¥ä½œ, åŒæ—¶å·¥ä½œæœ‰å¾ˆå®¹æ˜“æŒ‰éœ€æ‰©å±•;è€Œæ¶ˆæ¯é€šä¿¡å°±å¯ä»¥ä¸ºä½ çš„åº”ç”¨ç¨‹åºåšåŒæ ·çš„äº‹æƒ…! ç¼“è§£æµé‡é«˜å³°,æé«˜ç³»ç»Ÿååé‡å½“ç³»ç»Ÿä¸­çš„åŒæ­¥å¤„ç†æ–¹å¼åœ¨é¢å¯¹é«˜å¹¶å‘æ¶Œå…¥çš„å¤§é‡æ“ä½œæ—¶, ç³»ç»Ÿå¯èƒ½ä¼šæ— æ³•ç«‹å³åšå‡ºå“åº”, ä»è€Œä¸¥é‡å½±å“ç³»ç»Ÿçš„ååé‡æ—¶, æ¶ˆæ¯é˜Ÿåˆ—å°±å¯ä»¥ç”¨æ¥ç¼“è§£æµé‡é«˜å³°, æé«˜ç³»ç»Ÿååé‡;ä»ä¸Šé¢çš„ åº”ç”¨è§£è€¦ å¯ä»¥çœ‹åˆ°, æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†ä¸€ä¸ª å¼‚æ­¥é€šä¿¡åè®®, æ¶ˆæ¯çš„å‘é€è€… ä¸ç”¨ä¸€ç›´ç­‰å¾…ç›´åˆ°æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†,è€Œæ˜¯æ¶ˆæ¯è¢«æˆåŠŸå‘é€åå°±ç«‹å³è¿”å›, è€Œæ¶ˆæ¯åˆ™è¢«æš‚å­˜äºé˜Ÿåˆ—å½“ä¸­,æš‚æ—¶ç¼“è§£ç³»ç»Ÿå‹åŠ›, ç³»ç»Ÿåç»­åœ¨è¿›è¡Œé€ä¸€å¤„ç†; è¿™æ ·è‡ªç„¶ä¼šç¼“è§£æµé‡é«˜å³°, æé«˜ç³»ç»Ÿååé‡; ç³»ç»Ÿè°ƒç”¨ä¸­æ–­å¦‚æœç³»ç»ŸB,Cå‡ºç°ä¸­æ–­, ç³»ç»ŸAä¸­çš„æ“ä½œå·²ç»å®Œæˆ(æ— æ³•å›æ»š), é‚£ä¹ˆæ•´ä¸ªæµç¨‹å°±ä¼šä¸å®Œæ•´; æ­¤æ—¶å°±éœ€è¦ç³»ç»ŸAçš„åç»­æµç¨‹èƒ½å¤Ÿè¢«ä¿ç•™é‡è¯•; â€¦â€¦ å­¦ä¹ å†…å®¹å…³äºRabbitMQ, è¿™é‡Œæ•´ç†çš„å­¦ä¹ å†…å®¹åŒ…æ‹¬ ä¸‹è½½å®‰è£… æµ…æRabbitMQæ¶ˆæ¯é€šä¿¡è¿‡ç¨‹ æœåŠ¡å™¨è¿è¡ŒåŠç®¡ç† æ¶ˆæ¯é€šä¿¡åŠå„ç§ç»†èŠ‚é—®é¢˜ æ¶ˆæ¯é€šä¿¡å„ç§å®é™…æ¡ˆä¾‹åˆ†æ RabbitMQé›†ç¾¤","categories":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/categories/RabbitMQ/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://blog.renyimin.com/tags/RabbitMQ/"}]},{"title":"Linuxæ–‡æœ¬å¤„ç† - awk","slug":"linux/2018-05-18-awk","date":"2018-05-18T02:03:51.000Z","updated":"2018-05-27T14:50:27.000Z","comments":true,"path":"2018/05/18/linux/2018-05-18-awk/","link":"","permalink":"http://blog.renyimin.com/2018/05/18/linux/2018-05-18-awk/","excerpt":"","text":"ç®€ä»‹ Awkæ˜¯ä¸€ç§ä¾¿äºä½¿ç”¨ä¸”è¡¨è¾¾èƒ½åŠ›å¼ºçš„ç¨‹åºè®¾è®¡è¯­è¨€, æ²¡é”™, å®ƒæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€, å®ƒæ‹¥æœ‰æ•°ç»„, æ”¯æŒif-elseæ§åˆ¶è¯­å¥, for/whileå¾ªç¯è¯­å¥, å†…ç½®å‡½æ•°ç­‰åŠŸèƒ½; åŒæ—¶, å®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…·; ä¹‹æ‰€ä»¥å«AWKæ˜¯å› ä¸ºå…¶å–äº†ä¸‰ä½åˆ›å§‹äºº Alfred Ahoï¼ŒPeter Weinberger, å’Œ Brian Kernighan çš„Family Nameçš„é¦–å­—ç¬¦; awk å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ awkæ˜¯é€è¡Œå¤„ç†çš„, å°±æ˜¯è¯´, å½“awkå¤„ç†ä¸€ä¸ªæ–‡æœ¬æ—¶, ä¼šä¸€è¡Œä¸€è¡Œè¿›è¡Œå¤„ç†, å¤„ç†å®Œå½“å‰è¡Œ, å†å¤„ç†ä¸‹ä¸€è¡Œ, awké»˜è®¤ä»¥ â€œæ¢è¡Œç¬¦â€ ä¸ºæ ‡è®°æ¥è¯†åˆ«æ¯ä¸€è¡Œ, è·Ÿæˆ‘ä»¬äººç±»ä¸€æ ·, æ¯æ¬¡é‡åˆ°â€å›è½¦æ¢è¡Œâ€, å°±è®¤ä¸ºæ˜¯å½“å‰è¡Œçš„ç»“æŸ, æ–°çš„ä¸€è¡Œçš„å¼€å§‹; awkåœ¨é€è¡Œå¤„ç†æ–‡æœ¬æ—¶, ä¼šæœç´¢èƒ½å¤ŸåŒ¹é…ç¨‹åºä¸­ä»»æ„æ¨¡å¼(ä¹Ÿå°±æ˜¯åœ¨awkå‘½ä»¤ä¸­çš„â€™programâ€™ä¸­å¯ä»¥æœ‰å¤šä¸ªæ¨¡å¼)çš„è¡Œ, æ¯ä¸ªæ¨¡å¼ä¾æ¬¡æµ‹è¯•æ¯ä¸ªè¾“å…¥è¡Œ, å¯¹äºåŒ¹é…åˆ°æ¨¡å¼çš„è¡Œ, ä¼šæ‰§è¡Œawkå‘½ä»¤ä¸­æ¨¡å¼åé¢çš„åŠ¨ä½œ(ä¹Ÿè®¸åŒ…å«å¤šæ­¥), ç„¶åè¯»å–ä¸‹ä¸€è¡Œå¹¶ç»§ç»­åŒ¹é…, ç›´åˆ°æ‰€æœ‰çš„è¾“å…¥è¯»å–å®Œæ¯•; åŒæ—¶, awkä¼šæŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„åˆ†å‰²ç¬¦å»åˆ†å‰²å½“å‰è¡Œä¸ºå¤šä¸ªå­—æ®µ(æ¯ä¸ªå­—æ®µåˆ†åˆ«è¢«æ ‡è¯†ä¸º $1 ä¸€ç›´åˆ° $NF, $NFä¸ºawkä¸­çš„å˜é‡, è¡¨ç¤ºå½“å‰è¡Œè¢«åˆ†éš”å‡ºçš„æœ€å¤§å­—æ®µæ•°), å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ†å‰²ç¬¦, é»˜è®¤ä½¿ç”¨ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦, å¦å¤–, é»˜è®¤ä¼šå°†ç©ºæ ¼ç¬¦å’Œåˆ¶è¡¨ç¬¦éƒ½è§†ä¸ºç©ºæ ¼, è€Œä¸”å¤šä¸ªè¿ç»­çš„ç©ºæ ¼éƒ½è§†ä¸ºä¸€ä¸ª; ä½œä¸ºä¸€ä¸ªPHPå¼€å‘äººå‘˜, åœ¨å·¥ä½œä¸­, ä¸ä¸€å®šè¦æ±‚ä¼šå†™æ¯”è¾ƒå¤æ‚çš„awkè¯­å¥, ä½†å¯èƒ½ç»å¸¸ä¼šæ¥è§¦åˆ°å¼€å‘, æ²™ç›’, é¢„å‘, çº¿ä¸Šç­‰å„ç§ç¯å¢ƒ, æ­¤æ—¶å¯ä»¥ä½¿ç”¨awkå¯¹ä¸€äº›æ—¥å¿—æ–‡æœ¬åšä¸€äº›åˆ†æå¾ˆæ–¹ä¾¿çš„åˆ†æå·¥ä½œ; è¯­æ³•ç»“æ„ åŸºæœ¬è¯­æ³•ç»“æ„ä¸º: awk [options] &#39;program&#39; file1 , file2 ..., å…¶ä¸­, &#39;program&#39; åˆå¯ä»¥ç»†åˆ†ä¸º patternæ¨¡å¼ å’Œ actionåŠ¨ä½œ; ä¹Ÿå°±æ˜¯è¯´, awkçš„å®Œæ•´è¯­æ³•å…¶å®ä¸º awk [options] &#39;pattern {action}&#39; file1 , file2 ... pattern : æŒ‡çš„æ˜¯æ¨¡å¼, ç”¨æ¥åŒ¹é…awkå‘½ä»¤æ‰€å¤„ç†çš„æ–‡æœ¬ä¸­çš„æ¯ä¸€è¡Œå†…å®¹; æ³¨æ„æ¨¡å¼åŒ¹é…å­—ç¬¦ä¸²æ—¶, éœ€è¦ä½¿ç”¨åŒå¼•å· 123456789101112131415renyimindeMacBook-Pro:Desktop renyimin$ cat awk.logrenyimin 200 1200W ç”·renfumin 500 200W ç”·renjuanfang 1000 900W å¥³renyimindeMacBook-Pro:Desktop renyimin$ awk &apos;$1==&quot;renyimin&quot; &#123;print $1,$2,$3&#125;&apos; awk.logrenyimin 200 1200WrenyimindeMacBook-Pro:Desktop renyimin$ awk &apos;$1==&apos;renyimin&apos; &#123;print $1,$2,$3&#125;&apos; awk.logrenyimindeMacBook-Pro:Desktop renyimin$ awk &apos;$1==renyimin &#123;print $1,$2,$3&#125;&apos; awk.logrenyimindeMacBook-Pro:Desktop renyimin$ æ¨¡å¼å¯ä»¥ç»„åˆ(å¯ä»¥ä½¿ç”¨æ‹¬å·å’Œé€»è¾‘æ“ä½œç¬¦ä¸ &amp;&amp; ï¼Œ æˆ– || ï¼Œ ä»¥åŠé ! å¯¹æ¨¡å¼è¿›è¡Œç»„åˆ) 123renyimindeMacBook-Pro:Desktop renyimin$ awk &apos;$1==&quot;renyimin&quot; &amp;&amp; $2&gt;20 &#123;print $1,$2,$3&#125;&apos; awk.logrenyimin 200 1200WrenyimindeMacBook-Pro:Desktop renyimin$ awk &apos;$1==&quot;renyimin&quot; &amp;&amp; $2&gt;200 &#123;print $1,$2,$3&#125;&apos; awk.log æ¨¡å¼å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ 123456789101112renyimindeMacBook-Pro:linux renyimin$ cat test1.logBeth 4.00 0Dan 3.75 0kathy 4.00 10Mark 5.00 20Mary 5.50 22Susie 4.25 18renyimindeMacBook-Pro:linux renyimin$ awk &apos;$2*$3&gt;50 &#123;print $0&#125;&apos; test1.logMark 5.00 20Mary 5.50 22Susie 4.25 18renyimindeMacBook-Pro:linux renyimin$ ä¹Ÿå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ 123renyimindeMacBook-Pro:linux renyimin$ awk &apos;/Susie/ &#123;print $0&#125;&apos; test1.logSusie 4.25 18renyimindeMacBook-Pro:linux renyimin$ action æŒ‡çš„å°±æ˜¯åŠ¨ä½œ, awk æ“…é•¿æ–‡æœ¬æ ¼å¼åŒ–å¹¶å°†æ ¼å¼åŒ–åçš„æ–‡æœ¬è¾“å‡º, æ‰€ä»¥å®ƒæ¯”è¾ƒå¸¸ç”¨çš„ action æ˜¯ print å’Œ printf; â€˜æ¨¡å¼+åŠ¨ä½œâ€™ è¯­å¥ä¸­çš„ æ¨¡å¼ æˆ– åŠ¨ä½œéƒ½å¯ä»¥çœç•¥, ä½†ä¸æ˜¯ä¸¤è€…åŒæ—¶çœç•¥; æœ‰çš„awkå‘½ä»¤æœ‰ ä¸€ä¸ªæ¨¡å¼ + åŠ¨ä½œ æœ‰çš„awkå‘½ä»¤åªæœ‰ä¸€ä¸ªæ¨¡å¼, æ²¡æœ‰åŠ¨ä½œ(å¦‚æœæ²¡æœ‰åŠ¨ä½œ, é‚£ä¹ˆæ¨¡å¼åŒ¹é…åˆ°çš„æ¯ä¸€è¡Œéƒ½ä¼šè¢«å®Œæ•´æ‰“å°å‡ºæ¥, ç›¸å½“äºåŠ¨ä½œæ˜¯{print} æˆ–è€… {print $0}) æœ‰çš„awkå‘½ä»¤åªæœ‰å¤šä¸ªæ¨¡å¼, æ²¡æœ‰åŠ¨ä½œ(åŒä¸Š) æœ‰çš„awkå‘½ä»¤å¯ä»¥æœ‰å¤šä¸ªæ¨¡å¼ + ä¸€ä¸ªåŠ¨ä½œ è²Œä¼¼æ²¡æœ‰ æ¨¡å¼+åŠ¨ä½œ, æ¨¡å¼+åŠ¨ä½œ è¿™ç§awkå‘½ä»¤ å¤šä¸ªæ¨¡å¼å¯ä»¥ä½¿ç”¨æ‹¬å·å’Œé€»è¾‘æ“ä½œç¬¦ä¸&amp;&amp;, æˆ–||, ä»¥åŠ é! å¯¹æ¨¡å¼è¿›è¡Œç»„åˆ option é€‰é¡¹, å¯ä»¥ä¸ç”¨ä»»ä½•é€‰é¡¹, å¸¸ç”¨é€‰é¡¹ä¸º -F fs or --field-separator fs : æŒ‡å®šè¾“å…¥æ–‡ä»¶åˆ†éš”ç¬¦(), fså¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ (å½“ç„¶, ä¹Ÿå¯ä»¥ä½¿ç”¨å†…ç½®å˜é‡, ç»“åˆå‚æ•° -v, -v FS=&#39;åˆ†éš”ç¬¦&#39; æ¥æŒ‡å®šåˆ†éš”ç¬¦)-F è¿˜å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å®šåˆ¶æŒ‰ç…§æŸäº›å­—ç¬¦ä¸²æ¥åšåˆ†éš”, å­—ç¬¦éœ€è¦æ”¾åœ¨ &#39;[]&#39;ä¸­, æ¯”å¦‚å¯¹nginxçš„accessæ—¥å¿—ä½¿ç”¨[æˆ–è€…]æ¥åˆ†éš” 12345678910111213$ tail -5 c2b_oms.2018-03-30-access.logremote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:16:43:17 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[200] byte=[884] elapsed=[2.189] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[7.55]remote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:17:11:45 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[500] byte=[22005] elapsed=[0.136] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[-]remote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:17:13:25 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[200] byte=[695] elapsed=[0.115] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[9.50]remote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:17:14:41 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[500] byte=[22005] elapsed=[0.133] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[-]remote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:17:14:58 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[500] byte=[22005] elapsed=[0.139] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[-]$ tail -5 c2b_oms.2018-03-30-access.log | awk -F &apos;[][]&apos; &apos;&#123;print $8&#125;&apos;GET /api/v1/car_dealer/list HTTP/1.1GET /api/v1/car_dealer/list HTTP/1.1GET /api/v1/car_dealer/list HTTP/1.1GET /api/v1/car_dealer/list HTTP/1.1GET /api/v1/car_dealer/list HTTP/1.1[work@VM_0_206_centos nginx_log]$ æˆ–è€…è¿˜å¯ä»¥ä½¿ç”¨ tail -10 c2b_oms.2018-03-30-access.log | awk -F&#39;[\\\\[\\\\]]&#39; &#39;{print $2}&#39; å¯ä»¥æŒ‰ç…§ä»»æ„ä¸€æ®µå­—ç¬¦ä¸²è¿›è¡Œåˆ†éš”123456789[work@VM_0_206_centos nginx_log]$ tail -3 c2b_oms.2018-03-30-access.logremote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:11:26:09 +0800] request=[GET /api/v1/car_dealer/list?car_dealer_name_or_phone=18625036504 HTTP/1.1] status=[200] byte=[276] elapsed=[0.005] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[0.61]remote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:11:28:23 +0800] request=[GET /api/v1/car_dealer/list?car_dealer_name_or_phone=renyimin HTTP/1.1] status=[200] byte=[786] elapsed=[1.312] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[8.27]remote_addr=[172.16.254.2] http_x_forward=[-] time=[30/Mar/2018:11:29:39 +0800] request=[GET /api/v1/car_dealer/list?car_dealer_name_or_phone1=renyimin HTTP/1.1] status=[200] byte=[786] elapsed=[0.269] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[8.27][work@VM_0_206_centos nginx_log]$ tail -10 c2b_oms.2018-03-30-access.log | awk -F&apos;+0800&apos; &apos;&#123;print $2&#125;&apos;] request=[GET /api/v1/car_dealer/list?car_dealer_name_or_phone=18625036504 HTTP/1.1] status=[200] byte=[276] elapsed=[0.005] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[0.61]] request=[GET /api/v1/car_dealer/list?car_dealer_name_or_phone=renyimin HTTP/1.1] status=[200] byte=[786] elapsed=[1.312] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[8.27]] request=[GET /api/v1/car_dealer/list?car_dealer_name_or_phone1=renyimin HTTP/1.1] status=[200] byte=[786] elapsed=[0.269] refer=[-] body=[-] ua=[PostmanRuntime/6.1.6] cookie=[-] gzip=[8.27][work@VM_0_206_centos nginx_log]$ - `-v` å˜é‡èµ‹å€¼é€‰é¡¹: è¯¥é€‰é¡¹å°†ä¸€ä¸ªå€¼èµ‹äºˆä¸€ä¸ªå˜é‡, å®ƒä¼šåœ¨ç¨‹åºå¼€å§‹ä¹‹å‰è¿›è¡Œèµ‹å€¼, ä¸‹é¢çš„ä¾‹å­æè¿°äº†è¯¥é€‰é¡¹çš„ä½¿ç”¨ `-v` : å®šä¹‰ä¸€ä¸ªå˜é‡ (å˜é‡å¯ä»¥æ˜¯awkå†…ç½®çš„, ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„) 123$ awk -v name=Rymuscle &apos;BEGIN&#123;printf &quot;Name = %s\\n&quot;, name&#125;&apos;Name = Jerry$ - ä¸Šé¢ä»‹ç»äº†å¦‚ä½•è®¾å®šè¾“å…¥åˆ†éš”ç¬¦, å…¶å®è¿˜æœ‰è¾“å‡ºåˆ†éš”ç¬¦, å¯ä»¥ä½¿ç”¨ `-v OFS=&apos;åˆ†éš”ç¬¦&apos;`, æ¥å®šä¹‰è¾“å‡ºåˆ†éš”ç¬¦ (æ³¨æ„,åœ¨è¾“å‡ºæ—¶, å„å­—æ®µé—´çš„`é€—å·`å°±ä»£è¡¨äº†è¾“å‡ºåˆ†éš”ç¬¦, æ²¡æœ‰é€—å·åˆ™å„å­—æ®µä¼šç´§è¿ç€) - `-f scriptfile æˆ–è€… --file scriptfile` : ä»è„šæœ¬æ–‡ä»¶ä¸­è¯»å–awkå‘½ä»¤ å¤šæ–‡ä»¶å¤„ç†, ç”¨åˆ°äº†å†è¡¥å……~~ å†…ç½®çš„ä¸€äº›å˜é‡ä¸‹é¢å€¼åˆ—å‡ºæœ¬äººå¸¸ç”¨çš„ä¸€äº›awkå†…ç½®å˜é‡å˜é‡å¯ä»¥åœ¨BEGINè¯­å¥å—ä¸­å£°æ˜, ä¹Ÿå¯ä»¥åœ¨programä¸­å£°æ˜, ä¹Ÿå¯ä»¥ä½¿ç”¨å‚æ•° -v å£°æ˜ NF: è¡Œçš„å­—æ®µæ•°é‡, ä½ å¯ä»¥åœ¨awkå‘½ä»¤çš„programä¸­ä½¿ç”¨action, åœ¨actionä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯printæ‰€éœ€çš„å­—æ®µ, æ­¤æ—¶ä½ å¯èƒ½æ€»æ˜¯éœ€è¦é€šè¿‡ $1, $2 è¿™æ ·æ¥æŒ‡å®šç´¢è¦æ‰“å°çš„ä¸åŒå­—æ®µ, ä½†ä»»ä½•è¡¨è¾¾å¼éƒ½å¯ä»¥ä½¿ç”¨åœ¨$ä¹‹åæ¥è¡¨è¾¾ä¸€ä¸ªå­—æ®µçš„åºå·; è¡¨è¾¾å¼ä¼šè¢«æ±‚å€¼å¹¶ç”¨äºè¡¨ç¤ºå­—æ®µåºå·, åŒæ—¶, Awkä¼šå¯¹å½“å‰è¾“å…¥çš„è¡Œæœ‰å¤šå°‘ä¸ªå­—æ®µè¿›è¡Œè®¡æ•°, å¹¶ä¸”å°†å½“å‰è¡Œçš„å­—æ®µæ•°é‡å­˜å‚¨åœ¨ä¸€ä¸ªå†…å»ºçš„ç§°ä½œ NF çš„å˜é‡ä¸­; å› æ­¤, ç¨‹åº { print NF, $1, $NF } ä¼šä¾æ¬¡æ‰“å°å‡ºæ¯ä¸€è¡Œçš„å­—æ®µæ•°é‡, ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼, æœ€åä¸€ä¸ªå­—æ®µçš„å€¼; NR: å®ƒä¼šå­˜å‚¨å½“å‰å·²ç»è¯»å–äº†å¤šå°‘è¡Œçš„è®¡æ•°. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ $NR ç»™ç»“æœçš„æ¯ä¸€è¡ŒåŠ ä¸Šè¡Œå· 1234567renyimindeMacBook-Pro:linux renyimin$ awk &apos;&#123;print NR,$0&#125;&apos; awk.log1 renyimin &quot;200&quot; 1200W ç”·23 renfumin 500 &quot;200W&quot; ç”·4 renjuanfang 1000 900W &quot;å¥³&quot;5renyimindeMacBook-Pro:linux renyimin$ FS: é™¤äº†ä½¿ç”¨ -Få‚æ•°æŒ‡å®šå­—æ®µåˆ†éš”ç¬¦, ä¹Ÿå¯ä»¥é€šè¿‡ -v è®¾å®š FS å†…ç½®å˜é‡æ¥æŒ‡å®šå­—æ®µåˆ†éš”ç¬¦ (æˆ–è€…åœ¨BEGINä¸­æŒ‡å®šFSå˜é‡) OFS : ä¸Šé¢ä»‹ç»äº†å¦‚ä½•è®¾å®šè¾“å…¥åˆ†éš”ç¬¦, å…¶å®è¿˜æœ‰è¾“å‡ºåˆ†éš”ç¬¦, å¯ä»¥ä½¿ç”¨ -v OFS=&#39;åˆ†éš”ç¬¦&#39;(æˆ–è€…åœ¨BEGINä¸­æŒ‡å®šOFSå˜é‡), æ¥å®šä¹‰è¾“å‡ºåˆ†éš”ç¬¦ (æ³¨æ„,åœ¨è¾“å‡ºæ—¶, å„å­—æ®µé—´çš„é€—å·å°±ä»£è¡¨äº†è¾“å‡ºåˆ†éš”ç¬¦, æ²¡æœ‰é€—å·åˆ™å„å­—æ®µä¼šç´§è¿ç€) 123456789[work@VM_0_206_centos nginx_log]$ tail -3 c2b_oms.2018-03-30-access.log | awk -F&quot;[][]&quot; -v OFS=&apos;---&apos; &apos;&#123;print $2,$3&#125;&apos;172.16.254.2--- http_x_forward=172.16.254.2--- http_x_forward=172.16.254.2--- http_x_forward=[work@VM_0_206_centos nginx_log]$ tail -3 c2b_oms.2018-03-30-access.log | awk -F&quot;[][]&quot; &apos;BEGIN&#123;OFS=&quot;---&quot;&#125; &#123;print $2,$3&#125;&apos;172.16.254.2--- http_x_forward=172.16.254.2--- http_x_forward=172.16.254.2--- http_x_forward=[work@VM_0_206_centos nginx_log]$ å¦å¤–å£°æ˜å˜é‡ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ program ä¸­è¿›è¡Œ 123456[work@VM_0_206_centos nginx_log]$ tail -3 c2b_oms.2018-03-30-access.log | awk &apos;FS=&quot;[][]&quot;,OFS=&quot;---&quot; &#123;print $2,$3&#125;&apos;http_x_forward=[-]---time=[30/Mar/2018:11:26:09172.16.254.2--- http_x_forward=172.16.254.2--- http_x_forward=172.16.254.2--- http_x_forward=[work@VM_0_206_centos nginx_log]$ å…¶ä½™çš„, ç”¨åˆ°äº†å†è¡¥å……~~ BEGIN è¯­å¥å— BEGIN è¯­å¥å—çš„è¯­æ³•: åœ¨awkçš„programä¸­ BEGIN {awk-commands}: BEGINè¯­å¥å—åœ¨ç¨‹åºå¼€å§‹çš„ä½¿ç”¨æ‰§è¡Œ, å®ƒåªæ‰§è¡Œä¸€æ¬¡, åœ¨è¿™é‡Œå¯ä»¥åˆå§‹åŒ–å˜é‡æˆ–è€…æ‰“å°ä¸€ä¸ªå¼€å¤´ä»€ä¹ˆçš„â€¦ BEGIN æ˜¯AWKçš„å…³é”®å­—, å› æ­¤å®ƒå¿…é¡»ä¸ºå¤§å†™, æ³¨æ„, è¿™ä¸ªè¯­å¥å—æ˜¯å¯é€‰çš„; æµ‹è¯•: å¯ä»¥ä½¿ç”¨ print &quot;&quot; åœ¨è¾“å‡ºä¹‹å‰å…ˆæ‰“å°ä¸€ä¸ªç©ºè¡Œ1234567renyimindeMacBook-Pro:linux renyimin$ awk &apos;BEGIN &#123;print &quot;&quot;&#125; &#123;print NR,$0&#125;&apos; awk.log1 renyimin &quot;200&quot; 1200W ç”·23 renfumin 500 &quot;200W&quot; ç”·4 renjuanfang 1000 900W &quot;å¥³&quot;5 END è¯­å¥å—END åˆ™ç”¨äºå¤„ç†åŒ¹é…è¿‡çš„æœ€åä¸€ä¸ªæ–‡ä»¶çš„æœ€åä¸€è¡Œä¹‹åçš„ä½ç½®; å¤šåˆ†éš”ç¬¦æµ‹è¯• awk -F&#39;[],&quot; ]&#39; &#39;{print $2,$61,$2-$61}&#39; ttt.log // å¯ä»¥ä½¿ç”¨ -F[] å°†åˆ†éš”çš„å­—ç¬¦ä¸²åŒ…èµ·æ¥, è¿™æ ·å°±æ˜¯ä½¿ç”¨ ] æˆ–è€…, æˆ–è€…åŒå¼•å·æˆ–è€…ç©ºæ ¼æ¥è¿›è¡Œåˆ†éš”äº†; ç»ƒä¹ ä¸‹é¢æ ¹æ®nginxçš„access.logæ—¥å¿—æ¥åšä¸€äº›ç»ƒä¹  (è¿™ä¸ªæ—¥å¿—è¿˜æ˜¯æŒºå¤§é‡çš„)12wc c2b_bid.2018-04-23-access.log 65608 1501442 29580860 c2b_bid.2018-04-23-access.log ç»Ÿè®¡ç‹¬ç«‹ipçš„è®¿é—®é‡ - å…±æœ‰å¤šå°‘ç‹¬ç«‹IPè®¿é—®è¿‡æœ¬ç«™ç‚¹ 12-bash-4.2$ awk &apos;&#123;print $1&#125;&apos; c2b_bid.2018-04-23-access.log | sort -n | uniq | wc -l240 è¡¨ç¤ºå…±æœ‰240ä¸ªä¸åŒipè®¿é—®è¿‡ç«™ç‚¹ ç»Ÿè®¡ç‹¬ç«‹ipçš„è®¿é—®æƒ…å†µ - æ¯ä¸ªç‹¬ç«‹ipçš„è®¿é—®æ¬¡æ•° 1234567bash-4.2$ awk &apos;&#123;print $1&#125;&apos; c2b_bid.2018-04-23-access.log | sort -n | uniq -c 190 remote_addr=[100.116.226.0] 195 remote_addr=[100.116.226.1] 176 remote_addr=[100.116.226.10] 176 remote_addr=[100.116.226.100] ..... å°±ä¸å…¨éƒ¨åˆ—å‡ºäº† ç»Ÿè®¡è®¿é—®æœ€é¢‘ç¹çš„å‰10ä¸ªip 123456789101112-bash-4.2$ awk &apos;&#123;print $1&#125;&apos; c2b_bid.2018-04-23-access.log | sort -n | uniq -c | sort -rn | head -10 407 remote_addr=[100.116.251.123] 399 remote_addr=[100.116.251.65] 394 remote_addr=[100.116.251.56] 390 remote_addr=[100.116.251.97] 388 remote_addr=[100.116.251.11] 387 remote_addr=[100.116.251.110] 384 remote_addr=[100.116.251.98] 383 remote_addr=[100.116.251.83] 382 remote_addr=[100.116.251.8] 381 remote_addr=[100.116.251.40]-bash-4.2$ æŸ¥çœ‹è®¿é—®380æ¬¡ä»¥ä¸Šçš„ip 1234567891011121314-bash-4.2$ awk &apos;&#123;print $1&#125;&apos; c2b_bid.2018-04-23-access.log | sort -n | uniq -c | awk &apos;$1 &gt; 380 &#123;print&#125;&apos; | sort -rn 407 remote_addr=[100.116.251.123] 399 remote_addr=[100.116.251.65] 394 remote_addr=[100.116.251.56] 390 remote_addr=[100.116.251.97] 388 remote_addr=[100.116.251.11] 387 remote_addr=[100.116.251.110] 384 remote_addr=[100.116.251.98] 383 remote_addr=[100.116.251.83] 382 remote_addr=[100.116.251.8] 381 remote_addr=[100.116.251.40] 381 remote_addr=[100.116.251.38] 381 remote_addr=[100.116.251.118]-bash-4.2$ è¿™æ˜¯å¹³æ—¶æ—¥å¸¸çš„æ—¥å¿—åˆ†æå‘½ä»¤ æ—¥å¿—ä¸º: 123456tail -5 c2b_oms.2018-03-29-access.logremote_addr=[172.16.254.2] http_x_forward=[-] time=[29/Mar/2018:18:37:48 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[200] byte=[19305] elapsed=[0.002] refer=[-] body=[-] ua=[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36] cookie=[-] gzip=[3.19]remote_addr=[172.16.254.2] http_x_forward=[-] time=[29/Mar/2018:18:41:24 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[200] byte=[24131] elapsed=[0.004] refer=[-] body=[-] ua=[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36] cookie=[-] gzip=[3.96]remote_addr=[172.16.254.2] http_x_forward=[-] time=[29/Mar/2018:18:42:06 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[200] byte=[24130] elapsed=[0.004] refer=[-] body=[-] ua=[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36] cookie=[-] gzip=[3.96]remote_addr=[172.16.254.2] http_x_forward=[-] time=[29/Mar/2018:18:42:40 +0800] request=[GET /api/v1/car_dealer/list HTTP/1.1] status=[200] byte=[786] elapsed=[1.078] refer=[-] body=[-] ua=[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36] cookie=[-] gzip=[8.27]remote_addr=[172.16.254.2] http_x_forward=[-] time=[29/Mar/2018:18:42:57 +0800] request=[GET /favicon.ico HTTP/1.1] status=[404] byte=[9879] elapsed=[0.010] refer=[http://172.16.0.206:8888/] body=[-] ua=[Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36] cookie=[-] gzip=[2.27] åˆ†æä¸º: 123awk -F&apos;] &apos; &apos;&#123;status=substr($5,9);elapsed=substr($7,10);if(elapsed &gt;= 2 || status &gt;=500)print $4,status,elapsed; &#125;&apos; hera.2018-05-07-access.log &gt; /tmp/hera.2018-05-07.logcat /tmp/hera.2018-05-07.log | awk &apos;&#123;a[$4]+=1;&#125;END&#123;for(i in a)&#123;print i,a[i]&#125;&#125;&apos;cat /tmp/hera.2018-05-07.log | awk &apos;&#123;if($4 == 500)print $2,$4&#125;&apos; | sort","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"æ­£åˆ™è¡¨è¾¾å¼","slug":"linux/2018-05-17-regular","date":"2018-05-17T06:22:31.000Z","updated":"2018-05-17T06:22:36.000Z","comments":true,"path":"2018/05/17/linux/2018-05-17-regular/","link":"","permalink":"http://blog.renyimin.com/2018/05/17/linux/2018-05-17-regular/","excerpt":"","text":"","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"Linuxç¼–è¾‘å™¨","slug":"linux/2018-05-17","date":"2018-05-17T06:17:57.000Z","updated":"2018-05-17T06:21:20.000Z","comments":true,"path":"2018/05/17/linux/2018-05-17/","link":"","permalink":"http://blog.renyimin.com/2018/05/17/linux/2018-05-17/","excerpt":"","text":"vimè·³è½¬å…‰æ ‡è·³è½¬åˆ°æŸè¡Œå…‰æ ‡è·³è½¬åˆ°è¡Œé¦–å…‰æ ‡è·³è½¬åˆ°è¡Œå°¾ å¤åˆ¶ç²˜è´´å¤åˆ¶å½“å‰è¡Œå¤åˆ¶ä»å½“å‰è¡Œå¼€å§‹å¤šå°‘è¡Œå¤åˆ¶æŒ‡å®šæŸå‡ è¡Œ æœç´¢æ›¿æ¢åˆ†å±å‚ç›´æ°´å¹³åˆ†å±åˆ‡æ¢ç„¦ç‚¹","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"Linuxæ–‡æœ¬å¤„ç† - sort, uniq, wc","slug":"linux/2018-05-16-other-command","date":"2018-05-16T07:28:21.000Z","updated":"2018-05-23T05:27:37.000Z","comments":true,"path":"2018/05/16/linux/2018-05-16-other-command/","link":"","permalink":"http://blog.renyimin.com/2018/05/16/linux/2018-05-16-other-command/","excerpt":"","text":"sort Linux sortå‘½ä»¤ç”¨äºå°†æ–‡æœ¬æ–‡ä»¶å†…å®¹ä»¥è¡Œä¸ºå•ä½è¿›è¡Œæ’åº; è¯­æ³•: sort [-bcdfimMnr][-o&lt;è¾“å‡ºæ–‡ä»¶&gt;][-t&lt;åˆ†éš”å­—ç¬¦&gt;][+&lt;èµ·å§‹æ ä½&gt;-&lt;ç»“æŸæ ä½&gt;][--help][--verison][æ–‡ä»¶] sort å‘½ä»¤æ—¢å¯ä»¥ä»ç‰¹å®šçš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä» stdin ä¸­è·å–è¾“å…¥; é€‰é¡¹ 123456789101112-bï¼šå¿½ç•¥æ¯è¡Œå‰é¢å¼€å§‹å‡ºçš„ç©ºæ ¼å­—ç¬¦ï¼›-cï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²ç»æŒ‰ç…§é¡ºåºæ’åºï¼›-dï¼šæ’åºæ—¶ï¼Œå¤„ç†è‹±æ–‡å­—æ¯ã€æ•°å­—åŠç©ºæ ¼å­—ç¬¦å¤–ï¼Œå¿½ç•¥å…¶ä»–çš„å­—ç¬¦ï¼›-fï¼šæ’åºæ—¶ï¼Œå°†å°å†™å­—æ¯è§†ä¸ºå¤§å†™å­—æ¯ï¼›-iï¼šæ’åºæ—¶ï¼Œé™¤äº†040è‡³176ä¹‹é—´çš„ASCIIå­—ç¬¦å¤–ï¼Œå¿½ç•¥å…¶ä»–çš„å­—ç¬¦ï¼›-mï¼šå°†å‡ ä¸ªæ’åºå·çš„æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼›-Mï¼šå°†å‰é¢3ä¸ªå­—æ¯ä¾ç…§æœˆä»½çš„ç¼©å†™è¿›è¡Œæ’åºï¼›-nï¼šä¾ç…§æ•°å€¼çš„å¤§å°æ’åºï¼›-o&lt;è¾“å‡ºæ–‡ä»¶&gt;ï¼šå°†æ’åºåçš„ç»“æœå­˜å…¥åˆ¶å®šçš„æ–‡ä»¶ï¼›-rï¼šä»¥ç›¸åçš„é¡ºåºæ¥æ’åºï¼›-t&lt;åˆ†éš”å­—ç¬¦&gt;ï¼šæŒ‡å®šæ’åºæ—¶æ‰€ç”¨çš„æ ä½åˆ†éš”å­—ç¬¦ï¼›+&lt;èµ·å§‹æ ä½&gt;-&lt;ç»“æŸæ ä½&gt;ï¼šä»¥æŒ‡å®šçš„æ ä½æ¥æ’åºï¼ŒèŒƒå›´ç”±èµ·å§‹æ ä½åˆ°ç»“æŸæ ä½çš„å‰ä¸€æ ä½ã€‚ ç›®å‰å¸¸ç”¨çš„é€‰é¡¹æœ‰ -nr uniq uniq å‘½ä»¤ç”¨äºæŠ¥å‘Šæˆ–å¿½ç•¥æ–‡ä»¶ä¸­çš„é‡å¤è¡Œï¼Œä¸€èˆ¬ä¸sortå‘½ä»¤ç»“åˆä½¿ç”¨; ä¹‹æ‰€ä»¥è¦å’Œsortå‘½ä»¤ç»“åˆä½¿ç”¨, æ˜¯å› ä¸ºuniqå‘½ä»¤å€¼åªå¯ä»¥åˆ é™¤ç›¸é‚»çš„é‡å¤è¡Œ; å¦‚æœä¸€æ–‡æœ¬ä¸­æœ‰é‡å¤å´ä¸ç›¸é‚»çš„è¡Œ, å•ç‹¬ä½¿ç”¨uniqå‘½ä»¤åˆ™æ— æ³•åˆ é™¤, éœ€è¦ç»“åˆsortå‘½ä»¤; è¯­æ³•: uniq [-cdu][-f&lt;æ ä½&gt;][-s&lt;å­—ç¬¦ä½ç½®&gt;][-w&lt;å­—ç¬¦ä½ç½®&gt;][--help][--version][è¾“å…¥æ–‡ä»¶][è¾“å‡ºæ–‡ä»¶] é€‰é¡¹: 123456-cæˆ–â€”â€”countï¼šåœ¨æ¯åˆ—æ—è¾¹(è²Œä¼¼æ˜¯å·¦è¾¹)æ˜¾ç¤ºè¯¥è¡Œé‡å¤å‡ºç°çš„æ¬¡æ•°ï¼›-dæˆ–--repeatedï¼šä»…æ˜¾ç¤ºé‡å¤å‡ºç°çš„è¡Œåˆ—ï¼›-f&lt;æ ä½&gt;æˆ–--skip-fields=&lt;æ ä½&gt;ï¼šå¿½ç•¥æ¯”è¾ƒæŒ‡å®šçš„æ ä½ï¼›-s&lt;å­—ç¬¦ä½ç½®&gt;æˆ–--skip-chars=&lt;å­—ç¬¦ä½ç½®&gt;ï¼šå¿½ç•¥æ¯”è¾ƒæŒ‡å®šçš„å­—ç¬¦ï¼›-uæˆ–â€”â€”uniqueï¼šä»…æ˜¾ç¤ºå‡ºä¸€æ¬¡çš„è¡Œåˆ—ï¼›-w&lt;å­—ç¬¦ä½ç½®&gt;æˆ–--check-chars=&lt;å­—ç¬¦ä½ç½®&gt;ï¼šæŒ‡å®šè¦æ¯”è¾ƒçš„å­—ç¬¦ã€‚ ç›®å‰å¸¸ç”¨çš„é€‰é¡¹æœ‰ -c å‚æ•°ä»‹ç» è¾“å…¥æ–‡ä»¶: æŒ‡å®šè¦å»é™¤çš„é‡å¤è¡Œæ–‡ä»¶, å¦‚æœä¸æŒ‡å®šæ­¤é¡¹, åˆ™ä»æ ‡å‡†è¯»å–æ•°æ®; è¾“å‡ºæ–‡ä»¶: æŒ‡å®šè¦å»é™¤é‡å¤è¡Œåçš„å†…å®¹è¦å†™å…¥çš„è¾“å‡ºæ–‡ä»¶, å¦‚æœä¸æŒ‡å®šæ­¤é€‰é¡¹, åˆ™å°†å†…å®¹æ˜¾ç¤ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡(æ˜¾ç¤ºåˆ°ç»ˆç«¯); å®ä¾‹ uniq æ— æ³•å»é™¤ä¸ç›¸é‚»çš„é‡å¤è¡Œ1234567891011121314151617181920renyimindeMacBook-Pro:linux renyimin$ cat uniq.logrenyimin is a it manhe has many articlerenyimin comes from shanxi provincehe has many article// å¯ä»¥çœ‹åˆ°uniqå¹¶æ²¡æœ‰å¯¹ä¸ç›¸é‚»çš„é‡å¤è¡Œè¿›è¡Œå»é‡æ“ä½œrenyimindeMacBook-Pro:linux renyimin$ uniq uniq.logrenyimin is a it manhe has many articlerenyimin comes from shanxi provincehe has many articlerenyimindeMacBook-Pro:linux renyimin$ // å¦‚ä¸‹è¿›è¡Œæ’åºåå³å¯renyimindeMacBook-Pro:linux renyimin$ sort uniq.log | uniqhe has many articlerenyimin comes from shanxi provincerenyimin is a it manrenyimindeMacBook-Pro:linux renyimin$ - `-c` å‚æ•°, å¯¹æ–‡ä»¶ç›¸åŒè¡Œè¿›è¡Œå»é‡, å¹¶ç»Ÿè®¡æ¯è¡Œé‡å¤å‡ºç°çš„æ¬¡æ•° (ç±»ä¼¼äºmysqlçš„groupbyåˆ†ç»„ç»Ÿè®¡) 1234renyimindeMacBook-Pro:linux renyimin$ sort uniq.log | uniq -c2 he has many article1 renyimin comes from shanxi province1 renyimin is a it man - å½“ç„¶, è¿˜å¯ä»¥ç»§ç»­ç»“åˆsortæ¥æŒ‰ç…§é‡å¤æ¡æ•°æœ€å¤šçš„æ¥æ’åº 1234renyimindeMacBook-Pro:linux renyimin$ sort uniq.log | uniq -c | sort1 renyimin comes from shanxi province1 renyimin is a it man2 he has many article wc åˆ©ç”¨wcæŒ‡ä»¤æˆ‘ä»¬å¯ä»¥è®¡ç®—æ–‡ä»¶çš„ è¡Œæ•°ã€Byteæ•°ã€å­—æ•°ã€æˆ–æ˜¯åˆ—æ•°, è‹¥ä¸æŒ‡å®šæ–‡ä»¶åç§°ã€æˆ–æ˜¯æ‰€ç»™äºˆçš„æ–‡ä»¶åä¸ºâ€-â€œ, åˆ™wcæŒ‡ä»¤ä¼šä»æ ‡å‡†è¾“å…¥è®¾å¤‡è¯»å–æ•°æ®; è¯­æ³•: wc [-clw][--help][--version][æ–‡ä»¶...] é€‰é¡¹ 123456789-cæˆ–--bytesæˆ–--chars åªæ˜¾ç¤ºBytesæ•°-læˆ–--lines åªæ˜¾ç¤ºè¡Œæ•°-wæˆ–--words åªæ˜¾ç¤ºå­—æ•°--help åœ¨çº¿å¸®åŠ©--version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ ç›®å‰å¸¸ç”¨çš„é€‰é¡¹æœ‰ -lwc (è²Œä¼¼ä¹Ÿæ˜¯é»˜è®¤çš„é€‰é¡¹, è€Œä¸”æ— è®ºé€‰é¡¹çš„é¡ºåºæ˜¯æ€æ ·çš„, ç»“æœæ€»æ˜¯: â€œè¡Œæ•°, å­—æ•°, å­—èŠ‚æ•°, æ–‡ä»¶åâ€) å®ä¾‹ åŸºæœ¬ç”¨æ³• 12345678renyimindeMacBook-Pro:linux renyimin$ cat uniq.logrenyimin is a it manhe has many articlerenyimin comes from shanxi provincehe has many articlerenyimindeMacBook-Pro:linux renyimin$ wc uniq.log 4 18 97 uniq.logrenyimindeMacBook-Pro:linux renyimin$ ç»Ÿè®¡å¤šæ–‡ä»¶ 12345renyimindeMacBook-Pro:linux renyimin$ wc -l uniq.log uniq.log 4 uniq.log // ç¬¬ä¸€ä¸ªæ–‡ä»¶è¡Œæ•°ä¸º4 4 uniq.log // ç¬¬äºŒä¸ªæ–‡ä»¶è¡Œæ•°ä¸º4 8 total // ä¸¤ä¸ªæ–‡ä»¶æ€»çš„è¡Œæ•°ä¸º8renyimindeMacBook-Pro:linux renyimin$ ç»“åˆä¹‹å‰çš„ uniq, sort å‘½ä»¤, ç»Ÿè®¡å»é‡åçš„è¡Œæ•° 123456789101112renyimindeMacBook-Pro:linux renyimin$ cat uniq.logrenyimin is a it manhe has many articlerenyimin comes from shanxi provincehe has many article// æ€»å…±æœ‰4è¡ŒrenyimindeMacBook-Pro:linux renyimin$ sort uniq.log | wc -l 4// å»é‡åæœ‰3è¡ŒrenyimindeMacBook-Pro:linux renyimin$ sort uniq.log | uniq -c | wc -l 3 nlnlå‘½ä»¤åœ¨linuxç³»ç»Ÿä¸­ç”¨æ¥è®¡ç®—æ–‡ä»¶ä¸­è¡Œå·, nl å¯ä»¥å°†è¾“å‡ºçš„æ–‡ä»¶å†…å®¹è‡ªåŠ¨çš„åŠ ä¸Šè¡Œå·, å…¶é»˜è®¤çš„ç»“æœä¸ cat -n æœ‰ç‚¹ä¸å¤ªä¸€æ ·, nl å¯ä»¥å°†è¡Œå·åšæ¯”è¾ƒå¤šçš„æ˜¾ç¤ºè®¾è®¡, åŒ…æ‹¬ä½æ•°ä¸æ˜¯å¦è‡ªåŠ¨è¡¥é½ 0 ç­‰ç­‰çš„åŠŸèƒ½1ï¼å‘½ä»¤æ ¼å¼ : nl [é€‰é¡¹]... [æ–‡ä»¶]...2ï¼å‘½ä»¤å‚æ•°ï¼š -b ï¼šæŒ‡å®šè¡Œå·æŒ‡å®šçš„æ–¹å¼ï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼š -b a ï¼šè¡¨ç¤ºä¸è®ºæ˜¯å¦ä¸ºç©ºè¡Œï¼Œä¹ŸåŒæ ·åˆ—å‡ºè¡Œå·(ç±»ä¼¼ cat -n)ï¼› -b t ï¼šå¦‚æœæœ‰ç©ºè¡Œï¼Œç©ºçš„é‚£ä¸€è¡Œä¸è¦åˆ—å‡ºè¡Œå·(é»˜è®¤å€¼)ï¼› -n ï¼šåˆ—å‡ºè¡Œå·è¡¨ç¤ºçš„æ–¹æ³•ï¼Œä¸»è¦æœ‰ä¸‰ç§ï¼š -n ln ï¼šè¡Œå·åœ¨è¤å¹•çš„æœ€å·¦æ–¹æ˜¾ç¤ºï¼› -n rn ï¼šè¡Œå·åœ¨è‡ªå·±æ ä½çš„æœ€å³æ–¹æ˜¾ç¤ºï¼Œä¸”ä¸åŠ  0 ï¼› -n rz ï¼šè¡Œå·åœ¨è‡ªå·±æ ä½çš„æœ€å³æ–¹æ˜¾ç¤ºï¼Œä¸”åŠ  0 ï¼› -w ï¼šè¡Œå·æ ä½çš„å ç”¨çš„ä½æ•°ã€‚ -p åœ¨é€»è¾‘å®šç•Œç¬¦å¤„ä¸é‡æ–°å¼€å§‹è®¡ç®—ã€‚ è¯•ç”¨ 12345678910111213141516171819202122$ nl -ba Test.class.php 1 &lt;?php 2 interface Huma 3 &#123; 4 public static function say(); 5 &#125; 6 7 class Male implements Huma 8 &#123; 9 private static function say()10 &#123;11 echo &quot;I am a Male&quot;;12 &#125;13 &#125;1415 class Female implements Huma16 &#123;17 public static function say()18 &#123;19 echo &quot;I am a Female&quot;;20 &#125;21 &#125; å…¶ä»–æ¡ˆä¾‹ åœ¨å¤šä¸ªæ–‡ä»¶ä¸­åŒ¹é…æŸä¸ªå­—ç¬¦ä¸²(æ¯”å¦‚ â€˜&lt;?phpâ€™), å¹¶åˆ—å‡ºæ–‡ä»¶å: grep &#39;&lt;?php&#39; *.php é‡ç‚¹è¿˜æ˜¯å¤šç»ƒä¹ â€¦.","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"Jenkins","slug":"Jenkins/2018-05-15-01","date":"2018-05-15T10:28:18.000Z","updated":"2018-05-16T02:28:46.000Z","comments":true,"path":"2018/05/15/Jenkins/2018-05-15-01/","link":"","permalink":"http://blog.renyimin.com/2018/05/15/Jenkins/2018-05-15-01/","excerpt":"","text":"ä¸‹è½½å®‰è£… é»˜è®¤æƒ…å†µä¸‹, Jenkinsæä¾›äº† æœ€æ–°ç‰ˆæœ¬ å’Œ é•¿æœŸæ”¯æŒç‰ˆæœ¬(LTS) å¯ä¾›ä¸‹è½½; Docker æ‹‰å–Jenkinsé•œåƒ: docker pull jenkins/jenkins:lts åœ¨æœ¬æœºåˆ›å»ºç›®å½• /Users/renyimin/Desktop/jenkins_home, ä¸‹é¢å°†ä¼šä»¥rootç”¨æˆ·èº«ä»½å°†jenkinså®¹å™¨ä¸­çš„jenkins_homeç›®å½•æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Š, é˜²æ­¢å®¹å™¨åˆ é™¤, æ•°æ®ä¸¢å¤± Docker è¿è¡Œ: åœ¨è¾“å‡ºçš„æ§åˆ¶å°ä¿¡æ¯ä¸­, ä¸€å®šè¦è®°å¾—è®°å½•ç”Ÿæˆçš„ç§˜é’¥ä¸², ç¨åä¼šç”¨åˆ°, å¦‚ä¸‹:1234567891011121314151617May 15, 2018 10:55:38 AM jenkins.install.SetupWizard initINFO:***************************************************************************************************************************************************************************************Jenkins initial setup is required. An admin user has been created and a password generated.Please use the following password to proceed to installation:29b2b48ed7e14cb8bf9f706dde309995This may also be found at: /var/jenkins_home/secrets/initialAdminPassword*************************************************************************************************************************************************************************************** çœ‹åˆ°ç§˜é’¥ä¸²ç”Ÿæˆ, å°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨, è¾“å…¥ï¼šhttp://127.0.0.1:8080 è¿›å…¥jenkinsç³»ç»Ÿé…ç½®ç•Œé¢, è¾“å…¥åˆšåˆšè®°å½•çš„ç§˜é’¥ä¸² 29b2b48ed7e14cb8bf9f706dde309995: ç‚¹ç»§ç»­, åˆ°äº†é€‰æ‹©å®‰è£…æ’ä»¶çš„ç•Œé¢, è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å®‰è£…é»˜è®¤å¸¸ç”¨çš„æ’ä»¶, å¦‚å›¾: æ’ä»¶å®‰è£…å®Œæˆå, é€‰æ‹©ä»¥adminç®¡ç†å‘˜ç”¨æˆ·ç»§ç»­, å¦‚ä¸‹: ç„¶å å¼€å§‹ä½¿ç”¨Jenknsi : é€‰æ‹© â€œç”¨æˆ·â€-&gt;â€adminâ€-&gt;è®¾ç½®â€, æŠŠadminç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ä¿®æ”¹ä¸€ä¸‹, ç„¶åç‚¹å‡»ä¿å­˜, åˆ°æ­¤Jenkinså®‰è£…ç»“æŸ; å‚è€ƒ:https://www.cnblogs.com/soar1688/p/6833540.html","categories":[{"name":"æŒç»­é›†æˆ","slug":"æŒç»­é›†æˆ","permalink":"http://blog.renyimin.com/categories/æŒç»­é›†æˆ/"}],"tags":[{"name":"æŒç»­é›†æˆ","slug":"æŒç»­é›†æˆ","permalink":"http://blog.renyimin.com/tags/æŒç»­é›†æˆ/"}]},{"title":"Linuxæ–‡æœ¬å¤„ç† - grep","slug":"linux/2018-05-15-grep","date":"2018-05-15T02:09:02.000Z","updated":"2018-05-17T06:43:05.000Z","comments":true,"path":"2018/05/15/linux/2018-05-15-grep/","link":"","permalink":"http://blog.renyimin.com/2018/05/15/linux/2018-05-15-grep/","excerpt":"","text":"grep","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"Linuxæ–‡æœ¬å¤„ç† - sed","slug":"linux/2018-05-15-sed","date":"2018-05-15T02:08:21.000Z","updated":"2018-05-27T14:57:02.000Z","comments":true,"path":"2018/05/15/linux/2018-05-15-sed/","link":"","permalink":"http://blog.renyimin.com/2018/05/15/linux/2018-05-15-sed/","excerpt":"","text":"sedæŸ¥æ‰¾åŒ¹é…æŸä¸ªå­—ç¬¦ä¸²çš„è¡Œ tail -5 c2b_oms.2018-03-29-access.log | sed -n &#39;/2018:18:41:24/p&#39; /p æ˜¯æ‰“å°çš„æ„æ€ -n ä»…æ˜¾ç¤ºscriptå¤„ç†åçš„ç»“æœ, å³: åªæ‰“å°åŒ¹é…åˆ° â€˜2018:18:41:24â€™ çš„è¡Œ","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"IOç›¸å…³çš„ä¸€äº›æ¦‚å¿µ","slug":"socket/2018-05-13-IO","date":"2018-05-13T03:12:19.000Z","updated":"2018-05-13T12:02:54.000Z","comments":true,"path":"2018/05/13/socket/2018-05-13-IO/","link":"","permalink":"http://blog.renyimin.com/2018/05/13/socket/2018-05-13-IO/","excerpt":"","text":"IOåœ¨å¼€å§‹socketç¼–ç¨‹å‰, éœ€è¦å…ˆå¯¹ IO çš„æ¦‚å¿µæœ‰ä¸€å®šçš„è®¤è¯†: æˆ‘ä»¬é€šå¸¸ä½¿ç”¨phpçš„fopenæ‰“å¼€æ–‡ä»¶å…³é—­æ–‡ä»¶è¯»è¯»å†™å†™, è¿™å«æœ¬åœ°æ–‡ä»¶IO; è€Œåœ¨socketç¼–ç¨‹ä¸­, æœ¬è´¨å…¶å®æ˜¯ç½‘ç»œIO; åŒæ­¥å¼‚æ­¥é˜»å¡éé˜»å¡ä¹‹å‰åæ­£ä¸€ç›´æä¸æ¸…æ¥šåŒæ­¥å’Œé˜»å¡, å¼‚æ­¥å’Œéé˜»å¡çš„æ¦‚å¿µ, æ€»æ„Ÿè§‰åŒæ­¥å°±æ˜¯é˜»å¡, å¼‚æ­¥å°±æ˜¯éé˜»å¡çš„, æ€»æ˜¯æå¾—æ™•ä¹ä¹çš„, äºæ˜¯å°±é‡æ–°æŸ¥äº†äº›èµ„æ–™è¿›è¡Œäº†æ¢³ç†, å¦‚æœ‰ä¸å¯¹æ¬¢è¿å¤§å®¶æŒ‡æ­£; ç®€å•æ¥è¯´åŒæ­¥: åŒæ­¥ä½“ç°åœ¨, åœ¨ç­‰å¾…ä¸€ä»¶äº‹æƒ…çš„å¤„ç†ç»“æœæ—¶, å¯¹æ–¹æ˜¯å¦æä¾›é€šçŸ¥æœåŠ¡, å¦‚æœå¯¹æ–¹ä¸æä¾›é€šçŸ¥æœåŠ¡, åˆ™ä¸º åŒæ­¥; å¼‚æ­¥: å¼‚æ­¥ä½“ç°åœ¨, åœ¨ç­‰å¾…ä¸€ä»¶äº‹æƒ…çš„å¤„ç†ç»“æœæ—¶, å¯¹æ–¹æ˜¯å¦æä¾›é€šçŸ¥æœåŠ¡, å¦‚æœå¯¹æ–¹æä¾›é€šçŸ¥æœåŠ¡, åˆ™ä¸º å¼‚æ­¥; å¯¹äºå¸¸è§çš„Ajaxè¯·æ±‚, å‰ç«¯åœ¨ajaxè¯·æ±‚åé€šå¸¸è¿˜ä¼šæ‰§è¡Œä¸€äº›å…¶ä»–åŠ è½½æ“ä½œ(éé˜»å¡); åœ¨serverç«¯å¤„ç†å®Œå, ä¼šå°†æ•°æ®â€™é€šçŸ¥â€™åˆ°å‰ç«¯é¡µé¢; è€Œå¯¹äºæœ€è¿‘æ­£å¥½åœ¨çœ‹çš„RabbitMQæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿ, è™½ç„¶æœ¬è´¨ä¸Šæ¥è¯´ä¹Ÿæ˜¯å¼‚æ­¥çš„(å®ƒæ˜¯é€šè¿‡åˆ†éš”äº†æ•°æ®çš„å‘é€å’Œæ¥æ”¶æ¥è§£è€¦åº”ç”¨, æ•°æ®åœ¨æœ€ç»ˆè¢«æ¶ˆè´¹è€…å¤„ç†å®Œåä¹Ÿä¸ä¼šé€šçŸ¥åˆ°ç”Ÿäº§è€…, å› ä¸ºæ¶ˆæ¯ç³»ç»Ÿé‡‡ç”¨äº†å¾ˆå¤šæ‰‹æ®µå¦‚æŒä¹…åŒ–, é‡è¯•ç­‰æ¥ç¡®ä¿æ¶ˆæ¯ä¸€å®šä¼šè¢«æ‰§è¡Œ), ä½†å®è´¨ä¸Š, æ¶ˆæ¯ä¼šåœ¨å‘é€æˆåŠŸåä¼šç«‹å³å¾—åˆ°å“åº”, æ‰€ä»¥å•å°±ç”Ÿäº§è€…æˆåŠŸç”Ÿäº§æ¶ˆæ¯è¿™ä¸€æ­¥æ¥è¯´, å…¶å®æ˜¯åŒæ­¥çš„; é˜»å¡: é˜»å¡ä½“ç°åœ¨, åœ¨ç­‰å¾…ä¸€ä»¶äº‹æƒ…çš„å¤„ç†ç»“æœæ—¶, ä½ æ˜¯å¦è¿˜å»å¹²ç‚¹å…¶ä»–çš„äº‹æƒ…, å¦‚æœä¸å», åˆ™ä¸º é˜»å¡; éé˜»å¡: éé˜»å¡ä½“ç°åœ¨, åœ¨ç­‰å¾…ä¸€ä»¶äº‹æƒ…çš„å¤„ç†ç»“æœæ—¶, ä½ æ˜¯å¦è¿˜å»å¹²ç‚¹å…¶ä»–çš„äº‹æƒ…, å¦‚æœå»äº†, åˆ™ä¸º éé˜»å¡; ç»“åˆä¾‹å­æ¥è¯´æ­¤å¤„æ‰¾äº†ä¸€ä½æœ‹å‹å†™çš„ä¾‹å­, æ„Ÿè§‰å¾ˆä¸é”™åŒæ­¥é˜»å¡: ä½ å» ç”œåœ¨å¿ƒé¦’å¤´ åº—ä¹°å¤ªæé¦’å¤´, é˜¿æ¢…è¯´:â€æš‚æ—¶æ²¡, æ­£åœ¨è’¸å‘¢, ä½ è‡ªå·±çœ‹ç€ç‚¹å„¿!â€, äºæ˜¯ä½ å°±ç«™åœ¨æ—è¾¹åªç­‰é¦’å¤´, æ­¤æ—¶çš„ä½ , æ˜¯é˜»å¡çš„, ä¹Ÿæ˜¯åŒæ­¥çš„; é˜»å¡è¡¨ç°åœ¨ä½ é™¤äº†ç­‰é¦’å¤´ï¼Œåˆ«çš„ä»€ä¹ˆéƒ½ä¸åšäº†; åŒæ­¥è¡¨ç°åœ¨ç­‰é¦’å¤´çš„è¿‡ç¨‹ä¸­, é˜¿æ¢…ä¸æä¾›é€šçŸ¥æœåŠ¡, ä½ ä¸å¾—ä¸è‡ªå·±ä¸»åŠ¨æ£€æŸ¥ ï¼‚é¦’å¤´å‡ºç‚‰ï¼‚ çš„æ¶ˆæ¯; åŒæ­¥éé˜»å¡: ä½ å»ç”œåœ¨å¿ƒé¦’å¤´åº—ä¹°å¤ªæé¦’å¤´, é˜¿æ¢…è¯´:ï¼‚æš‚æ—¶æ²¡, æ­£åœ¨è’¸å‘¢, ä½ è‡ªå·±çœ‹ç€ç‚¹å„¿!ï¼‚, äºæ˜¯ä½ å°±ç«™åœ¨æ—è¾¹å‘å‘å¾®ä¿¡, ç„¶åé—®ä¸€å¥:ï¼‚å¥½äº†æ²¡ï¼Ÿï¼‚, ç„¶åç©ç©QQæ¸¸æˆ, ç„¶åå†é—®ä¸€å¥:ï¼‚å¥½äº†æ²¡ï¼Ÿï¼‚, æ­¤æ—¶çš„ä½ , æ˜¯éé˜»å¡çš„, ä¸è¿‡å´è¿˜æ˜¯åŒæ­¥çš„; éé˜»å¡è¡¨ç°åœ¨ä½ é™¤äº†ç­‰é¦’å¤´, è‡ªå·±è¿˜åœ¨å¹²åˆ«çš„äº‹æƒ…; åŒæ­¥è¡¨ç°åœ¨ç­‰é¦’å¤´çš„è¿‡ç¨‹ä¸­, ç”±äºé˜¿æ¢…ä¸æä¾›é€šçŸ¥æœåŠ¡, ä½ ä¸å¾—ä¸è‡ªå·±ä¸»åŠ¨æ£€æŸ¥ ï¼‚é¦’å¤´å‡ºç‚‰ï¼‚ çš„æ¶ˆæ¯; å¼‚æ­¥é˜»å¡: ä½ å»ç”œåœ¨å¿ƒé¦’å¤´åº—ä¹°å¤ªæé¦’å¤´, é˜¿æ¢…è¯´:ï¼‚æš‚æ—¶æ²¡, æ­£åœ¨è’¸å‘¢, è’¸å¥½äº†æˆ‘æ‰“ç”µè¯å‘Šè¯‰ä½ !ï¼‚, ä½†ä½ ä¾ç„¶ç«™åœ¨æ—è¾¹åªç­‰é¦’å¤´, æ­¤æ—¶çš„ä½ , æ˜¯é˜»å¡çš„, æ˜¯å¼‚æ­¥çš„; é˜»å¡è¡¨ç°åœ¨ä½ é™¤äº†ç­‰é¦’å¤´, ä¹Ÿæ²¡å»å¹²ç‚¹åˆ«çš„ä»€ä¹ˆ(æ¯”å¦‚ç©ç©æ‰‹æœºå•¥çš„); å¼‚æ­¥è¡¨ç°åœ¨ç­‰é¦’å¤´çš„è¿‡ç¨‹ä¸­, é˜¿æ¢…æä¾›ç”µè¯é€šçŸ¥ï¼‚é¦’å¤´å‡ºç‚‰ï¼‚çš„æ¶ˆæ¯, ä½ åªéœ€è¦ç­‰é˜¿æ¢…çš„ç”µè¯; å¼‚æ­¥éé˜»å¡: ä½ å»ç”œåœ¨å¿ƒé¦’å¤´åº—ä¹°å¤ªæé¦’å¤´, é˜¿æ¢…è¯´:ï¼‚æš‚æ—¶æ²¡, æ­£åœ¨è’¸å‘¢, è’¸å¥½äº†æˆ‘æ‰“ç”µè¯å‘Šè¯‰ä½ !ï¼‚, äºæ˜¯ä½ å°±èµ°äº†, å»ä¹°äº†åŒæ–°çƒé‹, çœ‹äº†çœ‹æ­¦é¦†, æ€»ä¹‹, ä»æ­¤ä¸å†è¿‡é—®é¦’å¤´çš„äº‹æƒ…, ä¸€å¿ƒåªç­‰é˜¿æ¢…ç”µè¯, æ­¤æ—¶çš„ä½ , æ˜¯éé˜»å¡çš„, æ˜¯å¼‚æ­¥çš„ éé˜»å¡è¡¨ç°åœ¨ä½ é™¤äº†ç­‰é¦’å¤´, è‡ªå·±è¿˜å»å¹²ç‚¹åˆ«çš„äº‹æƒ…; å¼‚æ­¥è¡¨ç°åœ¨ç­‰é¦’å¤´çš„è¿‡ç¨‹ä¸­, é˜¿æ¢…æä¾›ç”µè¯é€šçŸ¥ï¼‚é¦’å¤´å‡ºç‚‰ï¼‚çš„æ¶ˆæ¯, ä½ åªéœ€è¦ç­‰é˜¿æ¢…çš„ç”µè¯; å‚è€ƒ","categories":[{"name":"Socket","slug":"Socket","permalink":"http://blog.renyimin.com/categories/Socket/"}],"tags":[{"name":"Socket","slug":"Socket","permalink":"http://blog.renyimin.com/tags/Socket/"}]},{"title":"Linuxè½¯ä»¶å®‰è£…","slug":"linux/2018-05-13-install","date":"2018-05-13T03:02:35.000Z","updated":"2018-05-17T06:24:28.000Z","comments":true,"path":"2018/05/13/linux/2018-05-13-install/","link":"","permalink":"http://blog.renyimin.com/2018/05/13/linux/2018-05-13-install/","excerpt":"","text":"yumrpmç¼–è¯‘","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"Linuxç³»ç»Ÿç›‘æ§","slug":"linux/2018-05-10-system-monitor","date":"2018-05-10T05:20:29.000Z","updated":"2018-05-17T06:27:52.000Z","comments":true,"path":"2018/05/10/linux/2018-05-10-system-monitor/","link":"","permalink":"http://blog.renyimin.com/2018/05/10/linux/2018-05-10-system-monitor/","excerpt":"","text":"https://segmentfault.com/a/1190000005621984","categories":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://blog.renyimin.com/tags/Linux/"}]},{"title":"PHP-X","slug":"PHP/2018-05-09-PHP-X","date":"2018-05-09T12:29:31.000Z","updated":"2018-05-09T12:39:45.000Z","comments":true,"path":"2018/05/09/PHP/2018-05-09-PHP-X/","link":"","permalink":"http://blog.renyimin.com/2018/05/09/PHP/2018-05-09-PHP-X/","excerpt":"","text":"https://wiki.swoole.com/wiki/index/prid-15","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"01.","slug":"oauth/2018-04-28-CAS","date":"2018-04-28T13:10:12.000Z","updated":"2018-05-02T08:07:37.000Z","comments":true,"path":"2018/04/28/oauth/2018-04-28-CAS/","link":"","permalink":"http://blog.renyimin.com/2018/04/28/oauth/2018-04-28-CAS/","excerpt":"","text":"Single Sign Onå•ç‚¹ç™»å½•(Single Sign On), ç®€ç§°ä¸ºSSO, æ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€;SSOçš„å®šä¹‰æ˜¯åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­, ç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿ; CASç®€ä»‹ CASç”±Yaleè€¶é²å¤§å­¦ç ”å‘çš„ä¸€æ¬¾å¼€æºçš„,ä¼ä¸šçº§,SSOå•ç‚¹ç™»å½•è§£å†³æ–¹æ¡ˆ; CAS Github æºç ä¸‹è½½, è¿™é‡Œä½¿ç”¨çš„æ˜¯CAS5.1.9 CAS æ–‡æ¡£CASç³»ç»Ÿç»„ä»¶CASç³»ç»Ÿæ¶æ„ç”± CAS Server å’Œ CAS Client ä¸¤ä¸ªç‰©ç†ç»„ä»¶æ„æˆ, å®ƒä»¬é€šè¿‡å„ç§åè®®è¿›è¡Œé€šä¿¡;CAS Server CASæœåŠ¡å™¨æ˜¯åŸºäºSpringæ¡†æ¶æ„å»ºçš„Java servlet, å…¶ä¸»è¦èŒè´£æ˜¯éªŒè¯ç”¨æˆ·, å¹¶é€šè¿‡å‘å¸ƒå’ŒéªŒè¯ç¥¨è¯æ¥å¯¹ å¯ç”¨CASçš„æœåŠ¡(é€šå¸¸ç§°ä¸ºCASå®¢æˆ·ç«¯)çš„è®¿é—®æƒé™ è¿›è¡Œæˆæƒ;æœåŠ¡å™¨åœ¨æˆåŠŸç™»å½•å, ä¼šå‘ç”¨æˆ·æˆäºˆ ç¥¨è¯(TGT)æ—¶åˆ›å»ºSSOä¼šè¯;æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚, é€šè¿‡ä½¿ç”¨TGTä½œä¸ºæ ‡è®°çš„æµè§ˆå™¨é‡å®šå‘å‘æœåŠ¡å‘å‡ºæœåŠ¡ç¥¨æ®(ST);STéšåé€šè¿‡åå‘ä¿¡é“é€šä¿¡åœ¨CASæœåŠ¡å™¨ä¸Šè¿›è¡ŒéªŒè¯ã€‚ CAS Protocolæ–‡æ¡£ä¸­è¯¦ç»†æè¿°äº†è¿™äº›äº¤äº’; CAS ClientCAS Serveræ­å»º CAS å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ† CAS Server å’Œ CAS Client CAS Server ç”¨æ¥è´Ÿè´£ç”¨æˆ·çš„è®¤è¯å·¥ä½œ, å°±åƒæ˜¯æŠŠç¬¬ä¸€æ¬¡ç™»å½•ç”¨æˆ·çš„ä¸€ä¸ªæ ‡è¯†å­˜åœ¨è¿™é‡Œ, ä»¥ä¾¿æ­¤ç”¨æˆ·åœ¨å…¶ä»–ç³»ç»Ÿç™»å½•æ—¶éªŒè¯å…¶éœ€ä¸éœ€è¦å†æ¬¡ç™»å½•; CAS Client å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨, éœ€è¦æ¥å…¥CAS Serverç«¯; å½“ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„åº”ç”¨æ—¶, é¦–å…ˆéœ€è¦é‡å®šå‘åˆ°CAS Serverç«¯è¿›è¡ŒéªŒè¯, è¦æ˜¯åŸæ¥ç™»é™†è¿‡, å°±å…å»ç™»å½•, é‡å®šå‘åˆ°ä¸‹æ¸¸ç³»ç»Ÿ, å¦åˆ™è¿›è¡Œç”¨æˆ·åå¯†ç ç™»é™†æ“ä½œ; æœ¯è¯­Ticket Granting ticket (TGT): å¯ä»¥è®¤ä¸ºæ˜¯CAS Serveræ ¹æ®ç”¨æˆ·è´¦å·å’Œå¯†ç ç”Ÿæˆçš„ä¸€å¼ ç¥¨, å­˜åœ¨CAS Serverç«¯;Ticket-granting cookie (TGC): å…¶å®å°±æ˜¯ä¸€ä¸ªcookie, å­˜æ”¾ç”¨æˆ·èº«ä»½ä¿¡æ¯, ç”±CAS Serverå‘ç»™CAS Clientç«¯;Service ticket (ST): ç”±TGTç”Ÿæˆçš„ä¸€æ¬¡æ€§ç¥¨æ®, ç”¨äºéªŒè¯, åªèƒ½ç”¨ä¸€æ¬¡ã€‚ç›¸å½“äºserverå‘ç»™clientä¸€å¼ ç¥¨, ç„¶åclientæ‹¿ç€è¿™æ˜¯ä¸ªç¥¨å†æ¥æ‰¾serveréªŒè¯, çœ‹çœ‹æ˜¯ä¸æ˜¯serverç­¾å‘çš„;å°±åƒæ˜¯æˆ‘ç»™äº†ä½ ä¸€å¼ æˆ‘çš„ç…§ç‰‡, ç„¶åä½ æ‹¿ç…§ç‰‡å†æ¥é—®æˆ‘, è¿™ä¸ªç…§ç‰‡æ˜¯ä¸æ˜¯ä½ , æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆæ— èŠ TGT(Ticket Grangting Ticket) TGTæ˜¯CASä¸ºç”¨æˆ·ç­¾å‘çš„ç™»å½•ç¥¨æ®, æ‹¥æœ‰äº†TGT, ç”¨æˆ·å°±å¯ä»¥è¯æ˜è‡ªå·±åœ¨CASæˆåŠŸç™»å½•è¿‡; TGTå°è£…äº†Cookieå€¼ä»¥åŠæ­¤Cookieå€¼å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯; ç”¨æˆ·åœ¨CASè®¤è¯æˆåŠŸå, CASç”Ÿæˆcookie, å†™å…¥æµè§ˆå™¨, åŒæ—¶ç”Ÿæˆä¸€ä¸ªTGTå¯¹è±¡, æ”¾å…¥è‡ªå·±çš„ç¼“å­˜; TGTå¯¹è±¡çš„IDå°±æ˜¯cookieçš„å€¼ å½“HTTPå†æ¬¡è¯·æ±‚åˆ°æ¥æ—¶, å¦‚æœä¼ è¿‡æ¥çš„æœ‰CASç”Ÿæˆçš„cookie, åˆ™CASä»¥æ­¤cookieå€¼ä¸ºkeyæŸ¥è¯¢ç¼“å­˜ä¸­æœ‰æ— TGT, å¦‚æœæœ‰çš„è¯, åˆ™è¯´æ˜ç”¨æˆ·ä¹‹å‰ç™»å½•è¿‡, å¦‚æœæ²¡æœ‰, åˆ™ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•; STï¼ˆService Ticketï¼‰STæ˜¯CASä¸ºç”¨æˆ·ç­¾å‘çš„è®¿é—®æŸä¸€serviceçš„ç¥¨æ®ã€‚ç”¨æˆ·è®¿é—®serviceæ—¶ï¼Œserviceå‘ç°ç”¨æˆ·æ²¡æœ‰STï¼Œåˆ™è¦æ±‚ç”¨æˆ·å»CASè·å–STã€‚ç”¨æˆ·å‘CASå‘å‡ºè·å–STçš„è¯·æ±‚ï¼Œå¦‚æœç”¨æˆ·çš„è¯·æ±‚ä¸­åŒ…å«cookieï¼Œåˆ™CASä¼šä»¥æ­¤cookieå€¼ä¸ºkeyæŸ¥è¯¢ç¼“å­˜ä¸­æœ‰æ— TGTï¼Œå¦‚æœå­˜åœ¨TGTï¼Œåˆ™ç”¨æ­¤TGTç­¾å‘ä¸€ä¸ªSTï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·å‡­å€ŸSTå»è®¿é—®serviceï¼Œserviceæ‹¿STå»CASéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åï¼Œå…è®¸ç”¨æˆ·è®¿é—®èµ„æºã€‚ PGTï¼ˆProxy Granting Ticketï¼‰Proxy Serviceçš„ä»£ç†å‡­æ®ã€‚ç”¨æˆ·é€šè¿‡CASæˆåŠŸç™»å½•æŸä¸€Proxy Serviceåï¼ŒCASç”Ÿæˆä¸€ä¸ªPGTå¯¹è±¡ï¼Œç¼“å­˜åœ¨CASæœ¬åœ°ï¼ŒåŒæ—¶å°†PGTçš„å€¼ï¼ˆä¸€ä¸ªUUIDå­—ç¬¦ä¸²ï¼‰å›ä¼ ç»™Proxy Serviceï¼Œå¹¶ä¿å­˜åœ¨Proxy Serviceé‡Œã€‚Proxy Serviceæ‹¿åˆ°PGTåï¼Œå°±å¯ä»¥ä¸ºTarget Serviceï¼ˆback-end serviceï¼‰åšä»£ç†ï¼Œä¸ºå…¶ç”³è¯·PTã€‚","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"03. ä¸€äº›æ³¨æ„ç‚¹","slug":"OOP/PHP/2018-04-21-OOP-PHP-03","date":"2018-04-21T07:50:21.000Z","updated":"2018-04-21T11:21:42.000Z","comments":true,"path":"2018/04/21/OOP/PHP/2018-04-21-OOP-PHP-03/","link":"","permalink":"http://blog.renyimin.com/2018/04/21/OOP/PHP/2018-04-21-OOP-PHP-03/","excerpt":"","text":"ç±»å¸¸é‡ ç±»å¸¸é‡æ˜¯å…¬å…±çš„ åªèƒ½é€šè¿‡ç±»å, ä½¿ç”¨ :: é™æ€è®¿é—®ç±»å¸¸é‡ (ä¹Ÿå¯ä»¥ä½¿ç”¨å®ä¾‹åŒ–çš„å¯¹è±¡é€šè¿‡::æ¥è®¿é—®ç±»å¸¸é‡) å®¢æˆ·ç«¯ä»£ç ä¸èƒ½å¯¹å…¶è¿›è¡Œæ”¹å˜ å¸¸é‡å±æ€§ä½¿ç”¨ const å…³é”®å­—æ¥å£°æ˜, ä¸éœ€è¦ä½¿ç”¨ $ ç¬¦å· å¸¸é‡å±æ€§çš„å€¼åªèƒ½åŒ…å«åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼, ä¸èƒ½å°†ä¸€ä¸ªå¯¹è±¡æŒ‡æ´¾ç»™å¸¸é‡ å½“éœ€è¦åœ¨ç±»çš„æ‰€æœ‰å®ä¾‹ä¸­éƒ½èƒ½è®¿é—®æŸä¸ªå±æ€§, å¹¶ä¸”å±æ€§å€¼æ— éœ€æ”¹å˜æ—¶, åº”è¯¥ä½¿ç”¨å¸¸é‡ æŠ½è±¡ç±» ä¸èƒ½å®ä¾‹åŒ–æŠ½è±¡ç±» æŠ½è±¡ç±»ä¸­åº”è¯¥è‡³å°‘åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³• (ä½†ä¹Ÿä¸æ˜¯å¼ºåˆ¶æ€§çš„) æŠ½è±¡æ–¹æ³•ä½¿ç”¨abstractå…³é”®å­—å£°æ˜, ä¸èƒ½æœ‰å…·ä½“çš„å†…å®¹ æŠ½è±¡æ–¹æ³•ä¸èƒ½æœ‰æ¶ˆæ¯ä½“{}, å¹¶ä¸”éœ€è¦ä»¥;ç»“æŸ ç»§æ‰¿æŠ½è±¡æ–¹æ³•çš„å­ç±»å¿…é¡»å®ç°æŠ½è±¡ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³• ç»§æ‰¿æŠ½è±¡æ–¹æ³•çš„å­ç±»å®ç°äº†æŠ½è±¡ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ä¹‹å, è¿˜åº”è¯¥æ³¨æ„: æ–°å®ç°çš„è¿™ä¸ªæ–¹æ³•çš„è®¿é—®æ§åˆ¶æƒé™ä¸èƒ½æ¯”æŠ½è±¡æ–¹æ³•æ›´ä¸¥æ ¼; æ¥å£ æ¥å£ç›¸å¯¹äºæŠ½è±¡ç±», å¯èƒ½æ›´æ˜¯å½»åº•çš„, ä¸€ä¸ªçº¯ç²¹çš„æ¨¡æ¿; æ¥å£åªèƒ½å®šä¹‰åŠŸèƒ½, è€Œä¸åŒ…å«å®ç°çš„å†…å®¹; ä»»ä½•å®ç°äº†æ¥å£çš„ç±»éƒ½éœ€è¦å®ç°æ¥å£ä¸­æ‰€å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•, å¦åˆ™è¯¥ç±»å¿…é¡»å£°æ˜ä¸ºabstract; æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»å£°æ˜ä¸º public(æˆ–è€…ä¸å£°æ˜æƒé™, é»˜è®¤å°±ä¸ºpublic) æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ä¸èƒ½æœ‰æ¶ˆæ¯ä½“{}, å¹¶ä¸”éœ€è¦ä»¥;ç»“æŸ ä¸€ä¸ªç±»å¯ä»¥åŒæ—¶ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»å’Œå®ç°ä»»æ„ä¸ªæ¥å£, extendså­å¥åº”è¯¥åœ¨inplements å­å¥ä¹‹å‰; ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µæ˜¯: å®ç°æ¥å£çš„ç±»æ¥å—äº†å®ƒç»§æ‰¿çš„ç±»ä»¥åŠå®ç°çš„æ¥å£çš„ç±»å‹; (å¯¹äºé¢å‘å¯¹è±¡æ¥è¯´, ä¾èµ–æŠ½è±¡è€Œä¸ä¾èµ–å…·ä½“) finalå…³é”®å­— ~~æœªå®Œå¾…ç»­","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"02. å»¶è¿Ÿé™æ€ç»‘å®šstaticå…³é”®å­—","slug":"OOP/PHP/2018-04-21-OOP-PHP-02","date":"2018-04-21T07:03:35.000Z","updated":"2018-05-19T16:16:44.000Z","comments":true,"path":"2018/04/21/OOP/PHP/2018-04-21-OOP-PHP-02/","link":"","permalink":"http://blog.renyimin.com/2018/04/21/OOP/PHP/2018-04-21-OOP-PHP-02/","excerpt":"","text":"å»¶è¿Ÿé™æ€ç»‘å®šæ˜¯åœ¨PHP5.3å¼•å…¥çš„; static ç±»ä¼¼äº self, ä½†å®ƒæŒ‡çš„æ˜¯è°ƒç”¨ åŒ…å«staticçš„æ–¹æ³• çš„è°ƒç”¨ç±», è€Œä¸æ˜¯åŒ…å«staticçš„ç±»; ä¸€èˆ¬ static å’Œ self çš„ä½¿ç”¨è¯­æ³•æœ‰ä¸‹é¢ä¸¤ç§ new static() ä¸ new self() (ç”¨ä½œå®ä¾‹åŒ–) self:: ä¸ static:: (é™æ€æ–¹æ³•è°ƒç”¨) å¦‚ä½•ç†è§£ç¬¬2ç‚¹ä¸­çš„æ„æ€ å¦‚ä¸‹, Maleä¸Female ä¸¤ä¸ªç±»åˆ†åˆ«ç»§æ‰¿è‡ª Human, å¹¶ä¸”ç»§æ‰¿äº†createSelf()æ–¹æ³•, ç»“æœå´å‘ç°, Male å’Œ Female è°ƒç”¨createSelf()å, åˆ›å»ºçš„å´æ˜¯ Human å¯¹è±¡ 12345678910111213141516171819202122&lt;?phpclass Human&#123; public function createSelf() &#123; return new self(); &#125;&#125;class Male extends Human&#123;&#125;class Female extends Human&#123;&#125;$boy = new Male();var_dump($boy-&gt;createSelf());$girl = new Female();var_dump($girl-&gt;createSelf()); å¦‚æœHumanæ˜¯ä¸ªæŠ½è±¡ç±», ä½ ç”šè‡³æ— æ³•ä½¿ç”¨ new self() è€Œä½¿ç”¨äº†new static()æ•ˆæœå°±ä¸ä¸€æ ·äº† ä¸‹é¢, Maleä¸Female ä¸¤ä¸ªç±»åˆ†åˆ«ç»§æ‰¿è‡ª Human, å¹¶ä¸”ç»§æ‰¿äº†createSelf()æ–¹æ³•, ç»“æœ Male å’Œ Female è°ƒç”¨createSelf()å, åˆ›å»ºçš„ä¹Ÿéƒ½æ˜¯å„è‡ªçš„å¯¹è±¡å®ä¾‹12345678910111213141516171819202122&lt;?phpabstract class Huma&#123; public function createSelf() &#123; return new static(); &#125;&#125;class Male extends Huma&#123;&#125;class Female extends Huma&#123;&#125;$boy = new Male();var_dump($boy-&gt;createSelf());$girl = new Female();var_dump($girl-&gt;createSelf()); static å’Œ self åœ¨è°ƒç”¨é™æ€æ–¹æ³•æ—¶ä¹Ÿæ˜¯ä¸€æ ·çš„ å¦‚ä¸‹ç»“æœ, ä¸¤ä¸ªç±»éƒ½æ˜¯ Hello! 123456789101112131415161718192021222324252627282930313233&lt;?phpabstract class Huma&#123; public static function createSelf() &#123; self::say(); &#125; public static function say() &#123; echo &quot;Hello!&quot;; &#125;&#125;class Male extends Huma&#123; public static function say() &#123; echo &quot;I am a Male&quot;; &#125;&#125;class Female extends Huma&#123; public static function say() &#123; echo &quot;I am a Female&quot;; &#125;&#125;$boy = new Male();$boy-&gt;createSelf();$girl = new Female();$girl-&gt;createSelf(); å¦‚æœæƒ³åœ¨çˆ¶ç±»çš„å…¬å…±é™æ€æ–¹æ³•ä¸­, è°ƒç”¨å­ç±»è‡ªå·±é‡è½½çš„é™æ€æ–¹æ³•, é‚£å°±éœ€è¦ä½¿ç”¨ static:: 123456789101112131415161718192021222324252627282930313233&lt;?phpabstract class Huma&#123; public static function createSelf() &#123; static::say(); &#125; public static function say() &#123; echo &quot;Hello!&quot;; &#125;&#125;class Male extends Huma&#123; public static function say() &#123; echo &quot;I am a Male&quot;; &#125;&#125;class Female extends Huma&#123; public static function say() &#123; echo &quot;I am a Female&quot;; &#125;&#125;$boy = new Male();$boy-&gt;createSelf(); // I am a Male$girl = new Female();$girl-&gt;createSelf(); // I am a Female","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"01. æ™®é€šéé™æ€ ä¸ é™æ€","slug":"OOP/PHP/2018-04-21-OOP-PHP-01","date":"2018-04-21T06:16:26.000Z","updated":"2018-04-21T10:51:02.000Z","comments":true,"path":"2018/04/21/OOP/PHP/2018-04-21-OOP-PHP-01/","link":"","permalink":"http://blog.renyimin.com/2018/04/21/OOP/PHP/2018-04-21-OOP-PHP-01/","excerpt":"","text":"å¯¹äº å±æ€§ æ¥è¯´ç±»å†…éƒ¨çš„è°ƒç”¨æ–¹å¼ é™æ€å±æ€§æ˜¯ç±»çš„å±æ€§ æ™®é€šå±æ€§æ˜¯ç±»å…·ä½“å®ä¾‹åŒ–å‡ºçš„å¯¹è±¡çš„å±æ€§ æ‰€ä»¥äºŒè€…æ˜¯å®Œå…¨ä¸åŒçš„, è°ƒç”¨æ–¹å¼ä¹Ÿéå¸¸ä¸åŒ é™æ€å±æ€§ self::$é™æ€å±æ€§å ã€ç±»å::$é™æ€å±æ€§å æ™®é€šå±æ€§ $this-&gt;æ™®é€šå±æ€§å ç±»å¤–éƒ¨çš„è°ƒç”¨æ–¹å¼ é™æ€å±æ€§æ˜¯ç±»çš„å±æ€§ æ™®é€šå±æ€§æ˜¯ç±»å…·ä½“å®ä¾‹åŒ–å‡ºçš„å¯¹è±¡çš„å±æ€§ æ‰€ä»¥äºŒè€…æ˜¯å®Œå…¨ä¸åŒçš„, è°ƒç”¨æ–¹å¼ä¹Ÿéå¸¸ä¸åŒ é™æ€å±æ€§ ç±»å::$é™æ€å±æ€§å æ™®é€šå±æ€§ å®ä¾‹åŒ–å¯¹è±¡-&gt;æ™®é€šå±æ€§å å¯¹äº æ–¹æ³• æ¥è¯´å¯¹äºæ–¹æ³•, æ— è®º æ™®é€šè¿˜æ˜¯é™æ€, å®ƒä»¬éƒ½æ˜¯å±äºç±»çš„, æ‰€ä»¥ç†è®ºä¸Š, å®ƒä»¬çš„è°ƒç”¨æ–¹å¼ -&gt;/:: æ˜¯å¯ä»¥äº’æ¢çš„, ä½†äº‹å®ä¸Š, è¿˜æ˜¯åº”è¯¥ä¸¥æ ¼åŒºåˆ†, å¦åˆ™å¯èƒ½ä¼šæŠ¥ Deprecated...; ç±»å†…éƒ¨çš„è°ƒç”¨æ–¹å¼ æ™®é€šæ–¹æ³• å¯ä»¥ä½¿ç”¨ $this-&gt;æ™®é€šæ–¹æ³•å() æ¥è¿›è¡Œè°ƒç”¨; ä¹Ÿå¯ä»¥ä½¿ç”¨ self::$æ™®é€šæ–¹æ³•å() é™æ€æ–¹æ³• å¯ä»¥ä½¿ç”¨ self::$é™æ€æ–¹æ³•å() / ç±»å::$é™æ€æ–¹æ³•å() æ¥è¿›è¡Œè°ƒç”¨; ä¹Ÿå¯ä»¥ä½¿ç”¨ $this-&gt;$é™æ€æ–¹æ³•å() å³ç±»å†…éƒ¨ æ™®é€šæ–¹æ³• å’Œ é™æ€æ–¹æ³• çš„è°ƒç”¨æ–¹å¼å¯ä»¥äº’æ¢; ç±»å¤–éƒ¨çš„è°ƒç”¨æ–¹å¼ æ™®é€šæ–¹æ³• å¯ä»¥ä½¿ç”¨ å®ä¾‹åŒ–å¯¹è±¡-&gt;æ™®é€šæ–¹æ³•å() æ¥è¿›è¡Œè°ƒç”¨; æ³¨æ„: ä½¿ç”¨ ç±»å::æ™®é€šæ–¹æ³•å() / å®ä¾‹åŒ–å¯¹è±¡::æ™®é€šæ–¹æ³•å() éƒ½ä¼šæŠ¥ Deprecated:éé™æ€æ–¹æ³•ä¸åº”è¯¥æŒ‰ç…§é•œå¤´ç›–æ–¹æ³•çš„è°ƒç”¨æ–¹å¼æ¥ä½¿ç”¨ é™æ€æ–¹æ³• å¯ä»¥ä½¿ç”¨ ç±»å::$é™æ€æ–¹æ³•å() æ¥è¿›è¡Œè°ƒç”¨; æ³¨æ„ï¼šé™æ€æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ å®ä¾‹åŒ–å¯¹è±¡-&gt;æ™®é€šæ–¹æ³•å() æ¥è¿›è¡Œè°ƒç”¨; (é™æ€å±æ€§ä¸å¯ä»¥) é™æ€/éé™æ€æ–¹æ³•ä¸­çš„è°ƒç”¨æƒé™ é™æ€æ–¹æ³•ä¸­åªèƒ½ä½¿ç”¨ é™æ€è°ƒç”¨æ–¹å¼::æ¥è°ƒç”¨ é™æ€å±æ€§, é™æ€æ–¹æ³•, éé™æ€æ–¹æ³•; ä¸èƒ½ä½¿ç”¨::è°ƒç”¨éé™æ€å±æ€§; éé™æ€æ™®é€šæ–¹æ³•ä¸­å¯ä»¥è°ƒç”¨ é™æ€/éé™æ€ çš„ å±æ€§/æ–¹æ³•; å°ç»“ é™æ€å±æ€§/æ–¹æ³•, åªèƒ½é€šè¿‡ :: æ¥è®¿é—®; æ™®é€šå±æ€§åªèƒ½é€šè¿‡ -&gt; æ¥è®¿é—®; æ™®é€šæ–¹æ³•èƒ½é€šè¿‡ -&gt;/:: æ¥è®¿é—®; (ç±»å¤–éƒ¨åªèƒ½é€šè¿‡-&gt;)","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"Git","slug":"2018-04-08-rsa-01","date":"2018-04-08T02:41:16.000Z","updated":"2018-04-08T05:14:04.000Z","comments":true,"path":"2018/04/08/2018-04-08-rsa-01/","link":"","permalink":"http://blog.renyimin.com/2018/04/08/2018-04-08-rsa-01/","excerpt":"","text":"å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒæ ·çš„è§„åˆ™(â€œå¯†é’¥â€); è¿™ç§åŠ å¯†æ¨¡å¼æœ‰ä¸€ä¸ªæœ€å¤§å¼±ç‚¹: ç”²æ–¹å¿…é¡»æŠŠåŠ å¯†è§„åˆ™å‘Šè¯‰ä¹™æ–¹, å¦åˆ™ä¹™æ–¹æ— æ³•è§£å¯†; è¿™æ ·, ä¿å­˜å’Œä¼ é€’å¯†é’¥ å°±æˆäº†æœ€å¤´ç–¼çš„é—®é¢˜; éå¯¹ç§°åŠ å¯†ç®—æ³•ç®€ä»‹ éå¯¹ç§°åŠ å¯†ç®—æ³•æ¨¡å¼ 123ä¹™æ–¹ç”Ÿæˆä¸¤æŠŠå¯†é’¥(å…¬é’¥å’Œç§é’¥): å…¬é’¥æ˜¯å…¬å¼€çš„, ä»»ä½•äººéƒ½å¯ä»¥è·å¾—, ç§é’¥åˆ™æ˜¯ä¿å¯†çš„;ç”²æ–¹è·å–ä¹™æ–¹çš„å…¬é’¥, ç„¶åç”¨å®ƒå¯¹ä¿¡æ¯åŠ å¯†;ä¹™æ–¹å¾—åˆ°åŠ å¯†åçš„ä¿¡æ¯, ç”¨ç§é’¥è§£å¯†; å¦‚æœå…¬é’¥åŠ å¯†çš„ä¿¡æ¯åªæœ‰ç§é’¥è§£å¾—å¼€, é‚£ä¹ˆåªè¦ç§é’¥ä¸æ³„æ¼, é€šä¿¡å°±æ˜¯å®‰å…¨çš„; æ‰€è°“éå¯¹ç§°åŠ å¯†ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åŠ å¯†å’Œè§£å¯†éœ€è¦ä¸¤æŠŠé’¥åŒ™: ä¸€æŠŠå…¬é’¥å’Œä¸€æŠŠç§é’¥; RSAç®—æ³• 1977å¹´, ä¸‰ä½æ•°å­¦å®¶Rivestã€Shamir å’Œ Adleman è®¾è®¡äº†ä¸€ç§ç®—æ³•, å¯ä»¥å®ç°éå¯¹ç§°åŠ å¯†, è¿™ç§ç®—æ³•ç”¨ä»–ä»¬ä¸‰ä¸ªäººçš„åå­—å‘½å, å«åšRSAç®—æ³•ã€‚ä»é‚£æ—¶ç›´åˆ°ç°åœ¨, RSAç®—æ³•ä¸€ç›´æ˜¯æœ€å¹¿ä¸ºä½¿ç”¨çš„â€éå¯¹ç§°åŠ å¯†ç®—æ³•â€ã€‚ æ¯«ä¸å¤¸å¼ åœ°è¯´, åªè¦æœ‰è®¡ç®—æœºç½‘ç»œçš„åœ°æ–¹, å°±æœ‰RSAç®—æ³•; è¿™ç§ç®—æ³•éå¸¸å¯é , å¯†é’¥è¶Šé•¿, å®ƒå°±è¶Šéš¾ç ´è§£ã€‚æ ¹æ®å·²ç»æŠ«éœ²çš„æ–‡çŒ®, ç›®å‰è¢«ç ´è§£çš„æœ€é•¿RSAå¯†é’¥æ˜¯768ä¸ªäºŒè¿›åˆ¶ä½, ä¹Ÿå°±æ˜¯è¯´, é•¿åº¦è¶…è¿‡768ä½çš„å¯†é’¥, è¿˜æ— æ³•ç ´è§£(è‡³å°‘æ²¡äººå…¬å¼€å®£å¸ƒ)ã€‚ å› æ­¤å¯ä»¥è®¤ä¸º, 1024ä½çš„RSAå¯†é’¥åŸºæœ¬å®‰å…¨, 2048ä½çš„å¯†é’¥æå…¶å®‰å…¨; RSAç®—æ³•çš„åŸç†RSAç®—æ³•å¹¶ä¸éš¾, åªéœ€è¦ä¸€ç‚¹æ•°è®ºçŸ¥è¯†å°±å¯ä»¥ç†è§£ (è¦ç”¨åˆ°çš„å››ä¸ªæ•°å­¦æ¦‚å¿µ) ~~ æœªå®Œå¾…ç»­ äº’è´¨å…³ç³» å¦‚æœä¸¤ä¸ªæ­£æ•´æ•°, é™¤äº†1ä»¥å¤–, æ²¡æœ‰å…¶ä»–å…¬å› å­ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ•°æ˜¯äº’è´¨å…³ç³»(coprime), æ¯”å¦‚, 15å’Œ32æ²¡æœ‰å…¬å› å­, æ‰€ä»¥å®ƒä»¬æ˜¯äº’è´¨å…³ç³»; è¿™è¯´æ˜, ä¸æ˜¯è´¨æ•°ä¹Ÿå¯ä»¥æ„æˆäº’è´¨å…³ç³»ã€‚(è´¨æ•°(prime number)åˆç§°ç´ æ•°, æœ‰æ— é™ä¸ª, è´¨æ•°å®šä¹‰ä¸ºåœ¨å¤§äº1çš„è‡ªç„¶æ•°ä¸­, é™¤äº†1å’Œå®ƒæœ¬èº«ä»¥å¤–ä¸å†æœ‰å…¶ä»–å› æ•°) å…³äºäº’è´¨å…³ç³», ä¸éš¾å¾—åˆ°ä»¥ä¸‹ç»“è®º: ä»»æ„ä¸¤ä¸ªè´¨æ•°æ„æˆäº’è´¨å…³ç³», æ¯”å¦‚13å’Œ61; ä¸€ä¸ªæ•°æ˜¯è´¨æ•°, å¦ä¸€ä¸ªæ•°åªè¦ä¸æ˜¯å‰è€…çš„å€æ•°, ä¸¤è€…å°±æ„æˆäº’è´¨å…³ç³», æ¯”å¦‚3å’Œ10; å¦‚æœä¸¤ä¸ªæ•°ä¹‹ä¸­, è¾ƒå¤§çš„é‚£ä¸ªæ•°æ˜¯è´¨æ•°, åˆ™ä¸¤è€…æ„æˆäº’è´¨å…³ç³», æ¯”å¦‚97å’Œ57; 1å’Œä»»æ„ä¸€ä¸ªè‡ªç„¶æ•°æ˜¯éƒ½æ˜¯äº’è´¨å…³ç³»ï¼Œæ¯”å¦‚1å’Œ99; pæ˜¯å¤§äº1çš„æ•´æ•°, åˆ™på’Œp-1æ„æˆäº’è´¨å…³ç³», æ¯”å¦‚57å’Œ56; pæ˜¯å¤§äº1çš„å¥‡æ•°, åˆ™på’Œp-2æ„æˆäº’è´¨å…³ç³», æ¯”å¦‚17å’Œ15; http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html","categories":[{"name":"RSA","slug":"RSA","permalink":"http://blog.renyimin.com/categories/RSA/"}],"tags":[{"name":"RSA","slug":"RSA","permalink":"http://blog.renyimin.com/tags/RSA/"}]},{"title":"PHP7è¯­æ³•æ–°ç‰¹æ€§","slug":"PHP/2018-04-04-php7new-base","date":"2018-04-04T01:32:02.000Z","updated":"2018-04-04T02:30:39.000Z","comments":true,"path":"2018/04/04/PHP/2018-04-04-php7new-base/","link":"","permalink":"http://blog.renyimin.com/2018/04/04/PHP/2018-04-04-php7new-base/","excerpt":"","text":"nullåˆå¹¶è¿ç®—ç¬¦ ?? ?? : å¦‚æœå˜é‡å­˜åœ¨ä¸”å€¼ä¸ä¸ºNULLï¼Œ å®ƒå°±ä¼šè¿”å›è‡ªèº«çš„å€¼ï¼Œå¦åˆ™è¿”å›å®ƒçš„ç¬¬äºŒä¸ªæ“ä½œæ•°; å…ˆå›é¡¾ä¸€ä¸‹ isset ç”¨æ³•: åªæœ‰ æ˜¾ç¤ºå£°æ˜ä¸ºnull æˆ–è€… æœªå£°æ˜ çš„å˜é‡, issetçš„ç»“æœä¸ºfalse 1234567891011121314151617181920212223242526272829&lt;?php$a = 0;$b = 0.0;$c = &apos;&apos;;$d = &apos;0&apos;;$e = &apos;0.0&apos;;$f = &apos;null&apos;;$g = [];$h = [&apos;name&apos; =&gt; &apos;renyimin&apos;, &apos;age&apos; =&gt; null];$i = null;var_dump(isset($a)); // truevar_dump(isset($b)); // truevar_dump(isset($c)); // truevar_dump(isset($d)); // truevar_dump(isset($e)); // truevar_dump(isset($f)); // truevar_dump(isset($g)); // truevar_dump(isset($h[&apos;age&apos;])); // false// æ³¨æ„: array_key_exists å³ä½¿é”®çš„å€¼ä¸ºnull, ç»“æœä¹Ÿæ˜¯truevar_dump(array_key_exists(&apos;age&apos;, $h)); // truevar_dump(isset($h[&apos;address&apos;])); // false// æ³¨æ„: array_key_exists å³ä½¿é”®çš„å€¼ä¸ºnull, ç»“æœä¹Ÿæ˜¯true, é™¤éé”®çœŸçš„ä¸å­˜åœ¨var_dump(array_key_exists(&apos;address&apos;, $h)); // falsevar_dump(isset($h[&apos;address&apos;])); // falsevar_dump(isset($i)); // falsevar_dump(isset($j)); // false ?? ç¤ºä¾‹: 1234&lt;?php$a = 0;$c = $a ?? 10; // ç›¸å½“äº $c = isset($a) ? $a : 10;echo $c; ~~ æœªå®Œå¾…ç»­ ###","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"103. åˆ†åŒºç®¡ç†","slug":"mysql/2018-03-28-mysql-103","date":"2018-03-28T02:41:26.000Z","updated":"2018-03-28T02:10:14.000Z","comments":true,"path":"2018/03/28/mysql/2018-03-28-mysql-103/","link":"","permalink":"http://blog.renyimin.com/2018/03/28/mysql/2018-03-28-mysql-103/","excerpt":"","text":"åˆ†åŒºç®¡ç†MySQL5.1 æä¾›äº†è®¸å¤šä¿®æ”¹åˆ†åŒºè¡¨çš„æ–¹å¼, æ·»åŠ ã€åˆ é™¤ã€é‡æ–°å®šä¹‰ã€åˆå¹¶æˆ–æ‹†åˆ†å·²ç»å­˜åœ¨çš„åˆ†åŒºæ˜¯å¯èƒ½çš„, æ‰€æœ‰è¿™äº›æ“ä½œéƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨ALTER TABLEå‘½ä»¤çš„åˆ†åŒºæ‰©å±•æ¥å®ç°; å½“ç„¶, ä¹Ÿæœ‰è·å¾—åˆ†åŒºè¡¨å’Œåˆ†åŒºä¿¡æ¯çš„æ–¹å¼; dropåˆ é™¤åˆ†åŒºåŠæ•°æ® mysql&gt; alter table user drop partition p4; æ³¨æ„: åªèƒ½å¯¹æ¯ä¸ªåˆ†åŒºè¿›è¡Œåˆ é™¤, ä¸èƒ½é’ˆå¯¹æ¯ä¸ªå­åˆ†åŒºè¿›è¡Œåˆ é™¤æ“ä½œ, åˆ é™¤åˆ†åŒºåå­åˆ†åŒºè¿åŒæ•°æ®ä¸€å¹¶è¢«åˆ é™¤; åˆ é™¤åˆ†åŒºå, æ•°æ®ä¹Ÿè¢«åˆ é™¤äº†; drop partitionåˆ é™¤åˆ†åŒºçš„è¯­æ³•, åªèƒ½ç”¨äº range/list åˆ†åŒº (å¦‚æœç”¨æ¥åˆ é™¤hashåˆ†åŒºæˆ–è€…keyåˆ†åŒº,åˆ™ä¼šæŠ¥é”™) å¦‚æœè¦åˆ é™¤ hash/key åˆ†åŒº, åˆ™ç›´æ¥ä½¿ç”¨ä¸‹é¢removeæ¥ç§»é™¤åˆ†åŒºå³å¯, ä¸€èˆ¬ä¹Ÿä¸ç›´æ¥åˆ é™¤æ•°æ®; removeç§»é™¤åˆ†åŒº ä½¿ç”¨removeç§»é™¤åˆ†åŒº, æ³¨æ„ä»…ä»…æ˜¯ç§»é™¤åˆ†åŒº, å¹¶ä¸ä¼šåˆ é™¤æ•°æ® (å’Œdrop PARTITIONä¸ä¸€æ ·, åè€…ä¼šè¿åŒæ•°æ®ä¸€èµ·åˆ é™¤) ALTER TABLE tablename REMOVE PARTITIONING; è¿™æ ·å°±å¯ä»¥å°†ä¸€ä¸ªåŸæœ¬åˆ†åŒºçš„æ•°æ®è¡¨å˜æˆä¸åˆ†åŒºçš„è¡¨ ç§»é™¤åˆ†åŒºå‰ 123456789$ ls |grep user |xargs du -sh0B user#P#p1.MYD4.0K user#P#p1.MYI4.0K user#P#p2.MYD4.0K user#P#p2.MYI4.0K user#P#p3.MYD4.0K user#P#p3.MYI12K user.frm4.0K user.par ALTER TABLEuserREMOVE PARTITIONING; ç§»é™¤åˆ†åŒºå 1234$ ls |grep user |xargs du -sh4.0K user.MYD4.0K user.MYI12K user.frm æ³¨æ„: è¯¥è¯­æ³•æ˜¯å¯ä»¥é€‚ç”¨äº range/list/key/hash ç±»å‹çš„åˆ†åŒºçš„; åˆ›å»ºä¸åŒç±»å‹åˆ†åŒºåˆ†åŒºåˆ›å»ºç´¢å¼•(æ•´è¡¨åˆ›å»ºç´¢å¼•)æ–°å¢åˆ†åŒºæ–°å¢ä¸åŒç±»å‹åˆ†åŒºåˆå¹¶åˆ†åŒº åŸæœ¬åˆ†åŒºç»“æ„ 12345678910111213$ ls |grep user |xargs du -sh4.0K user#P#p0.MYD4.0K user#P#p0.MYI4.0K user#P#p1.MYD4.0K user#P#p1.MYI4.0K user#P#p2.MYD4.0K user#P#p2.MYI4.0K user#P#p3.MYD4.0K user#P#p3.MYI4.0K user#P#p4.MYD4.0K user#P#p4.MYI12K user.frm4.0K user.par åˆå¹¶ p2, p3è¿™ä¸¤ä¸ªåˆ†åŒº åˆ†åŒºå¹¶æ— å­åˆ†åŒº123456ALTER TABLE tb_sub_ev REORGANIZE PARTITION p2,p3 INTO ( PARTITION m_p2_p3 VALUES LESS THAN (2000) ( SUBPARTITION n0, SUBPARTITION n1 ) ); æ‹†åˆ†åˆ†åŒºé‡æ–°åˆ†åŒºæ¯æ—¥è‡ªåŠ¨æ–°å¢åˆ†åŒºæœªå®Œå¾…ç»­","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"}]},{"title":"102. åˆ†åŒºé”®, ä¸»é”®, å”¯ä¸€ç´¢å¼•å…³ç³»","slug":"mysql/2018-03-27-mysql-102","date":"2018-03-27T07:46:51.000Z","updated":"2018-03-28T02:09:40.000Z","comments":true,"path":"2018/03/27/mysql/2018-03-27-mysql-102/","link":"","permalink":"http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-102/","excerpt":"","text":"è‹¥è¡¨æœ‰ primary key æˆ– unique key, åœ¨å¯¹è¡¨è¿›è¡Œåˆ†åŒºæ—¶, éœ€è¦æ³¨æ„: åˆ†åŒºé”® å¿…é¡»åŒ…å«åœ¨primary keyæˆ–unique keyåˆ—å†…, è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¸»é”®çš„æ•ˆç‡, å¦åˆ™åŒä¸€ä¸»é”®åŒºçš„æ•°æ®ä¸€ä¸ªåœ¨ï¼¡åˆ†åŒº, ä¸€ä¸ªåœ¨ï¼¢åˆ†åŒº, æ˜¾ç„¶ä¼šæ¯”è¾ƒéº»çƒ¦; å¯ä»¥è¯´: åœ¨åˆ†åŒºè¡¨ä¸Š, ç”¨äºåˆ†åŒºè¡¨è¾¾å¼é‡Œçš„æ¯ä¸€ä¸ªå­—æ®µéƒ½å¿…é¡»æ˜¯å”¯ä¸€æ€§ç´¢å¼•çš„ä¸€éƒ¨åˆ†; å¦‚ä½•ç†è§£ä¸Šé¢çš„æ¦‚å¿µ? å¦‚æœè¡¨ä¸­æ—¢æœ‰ä¸»é”®, ä¹Ÿæœ‰å”¯ä¸€ç´¢å¼•: æ— è®ºå•åˆ—é”®è¿˜æ˜¯å¤šåˆ—é”®åˆ†åŒºéƒ½ä¼šå¤±è´¥ å•åˆ—å”¯ä¸€ç´¢å¼•é”®åˆ†åŒºæŠ¥é”™ 1234567891011121314151617CREATE TABLE IF NOT EXISTS `user` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;ç”¨æˆ·ID&apos;, `name` varchar(50) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;åç§°&apos;, `sex` int(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0ä¸ºç”·ï¼Œ1ä¸ºå¥³&apos;, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, PRIMARY KEY (`id`), UNIQUE KEY `age_unique` (`age`)) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (`age`)( PARTITION p0 VALUES LESS THAN (3), PARTITION p1 VALUES LESS THAN (6), PARTITION p2 VALUES LESS THAN (9), PARTITION p3 VALUES LESS THAN (12), PARTITION p4 VALUES LESS THAN (MAXVALUE));// 1503 - A PRIMARY KEY must include all columns in the table&apos;s partitioning function, Time: 0.011000s å•åˆ—ä¸»é”®åˆ†åŒºæŠ¥é”™CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL AUTO_INCREMENT COMMENT â€˜ç”¨æˆ·IDâ€™, name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™, sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, PRIMARY KEY (id), UNIQUE KEY `age_unique` (`age`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id)( PARTITION p0 VALUES LESS THAN (3), PARTITION p1 VALUES LESS THAN (6), PARTITION p2 VALUES LESS THAN (9), PARTITION p3 VALUES LESS THAN (12), PARTITION p4 VALUES LESS THAN (MAXVALUE));// 1503 - A UNIQUE INDEX must include all columns in the tableâ€™s partitioning function, Time: 0.008000s 1- å¤šåˆ—(ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•é”®)åˆ†åŒºæŠ¥é”™ // ä¸¤åˆ—åšåˆ†åŒºä¹Ÿæ˜¯å¤±è´¥çš„, å¦‚ä¸‹ä¼šæŠ¥é”™CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL AUTO_INCREMENT COMMENT â€˜ç”¨æˆ·IDâ€™, name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™, sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, PRIMARY KEY (id), UNIQUE KEY `age_unique` (`age`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id,age)( PARTITION p0 VALUES LESS THAN (3, 10), PARTITION p1 VALUES LESS THAN (6, 15), PARTITION p2 VALUES LESS THAN (9, 20), PARTITION p3 VALUES LESS THAN (12, 25), PARTITION p4 VALUES LESS THAN (MAXVALUE,MAXVALUE));// 1503 - A PRIMARY KEY must include all columns in the tableâ€™s partitioning function, Time: 0.012000s 123 4. è¡¨ä¸­åªæœ‰`ä¸»é”®`: åˆ†åŒºé”®å±äºä¸»é”®å†…çš„é”®å³å¯ (å¤šåˆ—åˆ†åŒº, éœ€è¦å°†åˆ—ä¸ä¸»é”®ä¸€èµ·ä½œä¸ºä¸»é”®æ‰è¡Œ) - åˆ†åŒºé”®å±äºä¸»é”®å†…çš„é”®å³å¯ CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL AUTO_INCREMENT COMMENT â€˜ç”¨æˆ·IDâ€™, name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™, sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, PRIMARY KEY (id)) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id)( PARTITION p0 VALUES LESS THAN (3), PARTITION p1 VALUES LESS THAN (6), PARTITION p2 VALUES LESS THAN (9), PARTITION p3 VALUES LESS THAN (12), PARTITION p4 VALUES LESS THAN (MAXVALUE)); 1- å¦‚æœæƒ³å¤šåˆ—åˆ†åŒº, åˆ™éœ€è¦å°†å¤šä½™çš„åˆ—ä¸ä¸»é”®ä¸€èµ·ä½œä¸ºä¸»é”® CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL AUTO_INCREMENT COMMENT â€˜ç”¨æˆ·IDâ€™, name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™, sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, PRIMARY KEY (id, age)) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id,age)( PARTITION p0 VALUES LESS THAN (3, 10), PARTITION p1 VALUES LESS THAN (6, 15), PARTITION p2 VALUES LESS THAN (9, 20), PARTITION p3 VALUES LESS THAN (12, 25), PARTITION p4 VALUES LESS THAN (MAXVALUE,MAXVALUE)); 125. è¡¨ä¸­åªæœ‰`å”¯ä¸€ç´¢å¼•`: åˆ†åŒºé”®å±äº`å”¯ä¸€ç´¢å¼•é”®`å†…çš„é”®å³å¯ (å¤šåˆ—åˆ†åŒº, éœ€è¦å°†å¤šä¸ªåˆ—ä¸€èµ·ä½œä¸ºå”¯ä¸€ç´¢å¼•) - åˆ†åŒºé”®å±äº`å”¯ä¸€ç´¢å¼•é”®`å†…çš„é”®å³å¯ CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL COMMENT â€˜ç”¨æˆ·IDâ€™, name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™, sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, UNIQUE KEY (id, age)) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id)( PARTITION p0 VALUES LESS THAN (3), PARTITION p1 VALUES LESS THAN (6), PARTITION p2 VALUES LESS THAN (9), PARTITION p3 VALUES LESS THAN (12), PARTITION p4 VALUES LESS THAN (MAXVALUE)); 1- å¤šåˆ—åˆ†åŒºæŠ¥é”™(ç«Ÿç„¶æ˜¯æŠ¥ä¸»é”®é”™): 1503 - A PRIMARY KEY must include all columns in the table&apos;s partitioning function, Time: 0.012000s CREATE TABLE IF NOT EXISTS user (id int(11) NOT NULL COMMENT â€˜ç”¨æˆ·IDâ€™,name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™,sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, age int(2) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜å¹´é¾„â€™,UNIQUE KEY id_u (id), UNIQUE KEY age_u (age)) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id, age)(PARTITION p0 VALUES LESS THAN (3,10),PARTITION p1 VALUES LESS THAN (6,15),PARTITION p2 VALUES LESS THAN (9,20),PARTITION p3 VALUES LESS THAN (12,25),PARTITION p4 VALUES LESS THAN (MAXVALUE,MAXVALUE)); 1- **å¤šä¸ªå”¯ä¸€ç´¢å¼•: æ— è®ºå•åˆ—åˆ†åŒºè¿˜æ˜¯å¤šåˆ—åˆ†åŒº, éƒ½ä¼šæŠ¥é”™** // å•åˆ—åˆ†åŒºæŠ¥é”™CREATE TABLE IF NOT EXISTS user ( id int(11) NOT NULL COMMENT â€˜ç”¨æˆ·IDâ€™, name varchar(50) NOT NULL DEFAULT â€˜â€™ COMMENT â€˜åç§°â€™, sex int(1) NOT NULL DEFAULT â€˜0â€™ COMMENT â€˜0ä¸ºç”·ï¼Œ1ä¸ºå¥³â€™, `age` int(2) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;å¹´é¾„&apos;, UNIQUE KEY id_u (id), UNIQUE KEY age_u (`age`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8PARTITION BY RANGE COLUMNS (id)( PARTITION p0 VALUES LESS THAN (3), PARTITION p1 VALUES LESS THAN (6), PARTITION p2 VALUES LESS THAN (9), PARTITION p3 VALUES LESS THAN (12), PARTITION p4 VALUES LESS THAN (MAXVALUE));``` å°ç»“ è¦è¿›è¡Œåˆ†åŒº, è¡¨ä¸­ä¸èƒ½åŒæ—¶å­˜åœ¨ä¸»é”®å’Œå”¯ä¸€ç´¢å¼•é”®, ä¹Ÿä¸èƒ½å­˜åœ¨å¤šä¸ªå”¯ä¸€ç´¢å¼•é”®; åˆ†åŒºçš„é”®å¿…é¡»åŒ…å«åœ¨ä¸»é”®å†… æˆ–è€… åŒ…å«åœ¨å”¯ä¸€ç´¢å¼•é”®å†…; æœ¬ç¯‡åªæ˜¯æµ‹è¯•äº†rangeè¿™ç§åˆ†åŒºç±»å‹, å…¶å®ä¸Šé¢çš„é™åˆ¶å¯¹äºrange/list/hash/keyç±»å‹çš„åˆ†åŒºéƒ½é€‚ç”¨;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"}]},{"title":"101. åˆ†åŒº,åˆ†è¡¨,åˆ†åº“","slug":"mysql/2018-03-27-mysql-101","date":"2018-03-27T03:37:12.000Z","updated":"2018-03-28T02:09:09.000Z","comments":true,"path":"2018/03/27/mysql/2018-03-27-mysql-101/","link":"","permalink":"http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/","excerpt":"","text":"å‰è¨€ MySQLæ˜¯ä»5.1å¼€å§‹æ”¯æŒåˆ†åŒºåŠŸèƒ½çš„, åœ¨MySQLä¸­, æ•°æ®æ˜¯ä»¥æ–‡ä»¶çš„å½¢åŠ¿å­˜åœ¨ç£ç›˜ä¸Šçš„, é»˜è®¤æ”¾åœ¨ â€˜/mysql/data/â€˜ ä¸‹(å¯ä»¥é€šè¿‡my.cnfä¸­çš„datadiræ¥æŒ‡å®š) MyISAMå¼•æ“ä¸­, ä¸€å¼ è¡¨ä¸»è¦å¯¹åº”ç€ä¸‰ä¸ªæ–‡ä»¶: .frm(ä¸è¡¨ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯éƒ½å­˜æ”¾åœ¨frmæ–‡ä»¶, åŒ…æ‹¬è¡¨ç»“æ„çš„å®šä¹‰ä¿¡æ¯ç­‰) .myd(å­˜æ”¾è¡¨æ•°æ®) .myi(å­˜è¡¨ç´¢å¼•) InnoDBå¼•æ“ä¸­, ä¸€å¼ è¡¨ä¹Ÿæ˜¯å¯¹åº”ç€ä¸‰ä¸ªæ–‡ä»¶: .frm(å’ŒMyISAMå·®ä¸å¤š) .ibdæ–‡ä»¶å’Œ.ibdataæ–‡ä»¶, éƒ½æ˜¯å­˜æ”¾innodbæ•°æ®çš„æ–‡ä»¶, ä¹‹æ‰€ä»¥ç”¨ä¸¤ç§æ–‡ä»¶æ¥å­˜æ”¾innodbçš„æ•°æ®, æ˜¯å› ä¸ºinnodbçš„æ•°æ®å­˜å‚¨æ–¹å¼èƒ½å¤Ÿé€šè¿‡é…ç½®æ¥å†³å®šæ˜¯ä½¿ç”¨å…±äº«è¡¨ç©ºé—´å­˜æ”¾å­˜å‚¨æ•°æ®, è¿˜æ˜¯ç”¨ç‹¬äº«è¡¨ç©ºé—´å­˜æ”¾å­˜å‚¨æ•°æ®ç‹¬äº«è¡¨ç©ºé—´å­˜å‚¨æ–¹å¼ä½¿ç”¨.ibdæ–‡ä»¶,å¹¶ä¸”æ¯ä¸ªè¡¨ä¸€ä¸ªibdæ–‡ä»¶;å…±äº«è¡¨ç©ºé—´å­˜å‚¨æ–¹å¼ä½¿ç”¨.ibdataæ–‡ä»¶ï¼Œæ‰€æœ‰è¡¨å…±åŒä½¿ç”¨ä¸€ä¸ªibdataæ–‡ä»¶å¯åœ¨mysqlçš„é…ç½®æ–‡ä»¶é€šè¿‡innodb_file_per_tableè¿›è¡Œé…ç½® å¦‚æœä¸€å¼ è¡¨çš„æ•°æ®é‡å¤ªå¤§, .ibd, .myd, .myi ä¹‹ç±»çš„æ–‡ä»¶å°±ä¼šå˜çš„å¾ˆå¤§, æŸ¥æ‰¾æ•°æ®å°±ä¼šå˜çš„å¾ˆæ…¢, æ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨mysqlçš„åˆ†åŒºåŠŸèƒ½, åœ¨ç‰©ç†ä¸Šå°†è¿™ä¸€å¼ è¡¨å¯¹åº”çš„ä¸‰ä¸ªæ–‡ä»¶, åˆ†å‰²æˆè®¸å¤šä¸ªå°å—, è¿™æ ·ä¹‹å, å¦‚æœæŸ¥æ‰¾ä¸€æ¡æ•°æ®æ—¶, å°±ä¸ç”¨å…¨éƒ¨æŸ¥æ‰¾äº†, åªè¦çŸ¥é“è¿™æ¡æ•°æ®åœ¨å“ªä¸€å—, ç„¶ååœ¨é‚£ä¸€å—æ‰¾å³å¯; å¦‚æœè¡¨çš„æ•°æ®å¤ªå¤§, å¯èƒ½ä¸€ä¸ªç£ç›˜æ”¾ä¸ä¸‹, æ­¤æ—¶, è¿˜å¯ä»¥æŠŠæ•°æ®åˆ†é…åˆ°ä¸åŒçš„ç£ç›˜é‡Œé¢å»; æŸ¥çœ‹å½“å‰MySQLç‰ˆæœ¬æ˜¯å¦æ”¯æŒåˆ†åŒº å¯¹äºMySQL5.6ä»¥ä¸‹ç‰ˆæœ¬, å¦‚æœæŸ¥è¯¢ç»“æœæ˜¾ç¤ºEmpty, è¡¨ç¤ºä¸æ”¯æŒåˆ†åŒº: 12mysql&gt; show variables like &apos;%partition%&apos;;Empty set (0.00 sec) å¯¹äºmysql5.6ä»¥åŠä»¥ä¸Šç‰ˆæœ¬, éœ€è¦ä½¿ç”¨ä¸‹é¢çš„æŸ¥è¯¢å‘½ä»¤: 1mysql&gt; show plugins; ä¸Šé¢çš„æŸ¥è¯¢æ–¹æ³•ä¼šæ˜¾ç¤ºæ‰€æœ‰æ’ä»¶, å¦‚æœæœ‰å¦‚ä¸‹æ’ä»¶çš„è¯, è¡¨ç¤ºæ”¯æŒåˆ†åŒº: 1| partition | ACTIVE | STORAGE ENGINE | NULL | GPL | åˆ†åŒºçš„2ç§æ–¹å¼æ¨ªå‘åˆ†åŒºæ¨ªå‘åˆ†åŒº: æ¯”å¦‚, æœ‰1000Wæ¡æ•°æ®, åˆ†æˆåä»½, å‰10Wæ¡æ•°æ®æ”¾åˆ°ç¬¬ä¸€ä¸ªåˆ†åŒº, ç¬¬äºŒä¸ª10Wæ¡æ•°æ®æ”¾åˆ°ç¬¬äºŒä¸ªåˆ†åŒº, ä¾æ­¤ç±»æ¨; ä¹Ÿå°±æ˜¯æŠŠè¡¨åˆ†æˆäº†åä»½(å’Œä½¿ç”¨mergeæ¥åˆ†è¡¨æœ‰ç‚¹åƒ, å–å‡ºä¸€æ¡æ•°æ®çš„æ—¶å€™, è¿™æ¡æ•°æ®åŒ…å«äº†è¡¨ç»“æ„ä¸­çš„æ‰€æœ‰å­—æ®µ); æ¨ªå‘åˆ†åŒº, å¹¶æ²¡æœ‰æ”¹å˜è¡¨çš„ç»“æ„; çºµå‘åˆ†åŒºçºµå‘åˆ†åŒº: æ¯”å¦‚, åœ¨è®¾è®¡ç”¨æˆ·è¡¨çš„æ—¶å€™, å¼€å§‹çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘å¥½, æŠŠç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯éƒ½æ”¾åˆ°äº†ä¸€å¼ è¡¨é‡Œé¢å», è¿™æ ·è¿™ä¸ªè¡¨é‡Œé¢å°±ä¼šæœ‰æ¯”è¾ƒå¤§çš„å­—æ®µ, å¦‚ä¸ªäººç®€ä»‹..ç­‰, è€Œè¿™äº›ç®€ä»‹ä¹Ÿè®¸ä¸ä¼šæœ‰å¥½å¤šäººå»çœ‹ï¼Œæ‰€ä»¥ç­‰åˆ°æœ‰äººè¦çœ‹çš„æ—¶å€™, å†å»æŸ¥æ‰¾(åˆ†è¡¨çš„æ—¶å€™, å¯ä»¥æŠŠè¿™æ ·çš„å¤§å­—æ®µä¸ä¸»è¡¨åˆ†å¼€æ¥); æ¨ªå‘åˆ†åŒºmysqlæä¾›çš„åˆ†åŒºå±äºç¬¬ä¸€ç§ æ¨ªå‘åˆ†åŒº, å¹¶ä¸”ç»†åˆ†æˆå¾ˆå¤šç§æ–¹å¼ rangeåˆ†åŒº æŒ‰ç…§RANGEåˆ†åŒºçš„è¡¨æ˜¯é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œåˆ†åŒºçš„, åˆ†åŒºè¡¨è¾¾å¼çš„å€¼ä½äºä¸€ä¸ªç»™å®šçš„è¿ç»­åŒºé—´å†…çš„é‚£äº›è¡Œ, ä¼šè¢«æ”¾åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ åˆ›å»ºè¡¨åŒæ—¶è¿›è¡Œåˆ†åŒº 12345678910111213CREATE TABLE IF NOT EXISTS `user` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;ç”¨æˆ·ID&apos;, `name` varchar(50) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;åç§°&apos;, `sex` int(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0ä¸ºç”·ï¼Œ1ä¸ºå¥³&apos;, PRIMARY KEY (`id`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 PARTITION BY RANGE (id) ( PARTITION p0 VALUES LESS THAN (3), PARTITION p1 VALUES LESS THAN ( 6 ),PARTITION p2 VALUES LESS THAN (9), PARTITION p3 VALUES LESS THAN (12), PARTITION p4 VALUES LESS THAN MAXVALUE ); æŸ¥çœ‹åˆ†åŒºæ•ˆæœ (åˆ°æ•°æ®è¡¨æ–‡ä»¶çš„å­˜æ”¾å¤„ $ cd /Library/Application\\ Support/appsolute/MAMP\\ PRO/db/mysql56/) 12345678910111213$ ls |grep user |xargs du -sh0B user#P#p0.MYD4.0K user#P#p0.MYI0B user#P#p1.MYD4.0K user#P#p1.MYI0B user#P#p2.MYD4.0K user#P#p2.MYI0B user#P#p3.MYD4.0K user#P#p3.MYI0B user#P#p4.MYD4.0K user#P#p4.MYI12K user.frm4.0K user.par æ’å…¥æ•°æ® 12345INSERT INTO `test`.`user` (`name` ,`sex`)VALUES (&apos;tank&apos;, &apos;0&apos;) ,(&apos;zhang&apos;,1),(&apos;ying&apos;,1),(&apos;å¼ &apos;,1),(&apos;æ˜ &apos;,0),(&apos;test1&apos;,1),(&apos;tank2&apos;,1) ,(&apos;tank1&apos;,1),(&apos;test2&apos;,1),(&apos;test3&apos;,1),(&apos;test4&apos;,1),(&apos;test5&apos;,1),(&apos;tank3&apos;,1) ,(&apos;tank4&apos;,1),(&apos;tank5&apos;,1),(&apos;tank6&apos;,1),(&apos;tank7&apos;,1),(&apos;tank8&apos;,1),(&apos;tank9&apos;,1) ,(&apos;tank10&apos;,1),(&apos;tank11&apos;,1),(&apos;tank12&apos;,1),(&apos;tank13&apos;,1),(&apos;tank21&apos;,1),(&apos;tank42&apos;,1); å†æ¬¡æŸ¥çœ‹åˆ†åŒºæ•ˆæœå¦‚ä¸‹å¯ä»¥çœ‹åˆ°, æ–‡ä»¶å¤§å°éƒ½æ˜¯4.0K, ä»è¿™å„¿æˆ‘ä»¬å¯ä»¥çœ‹å‡ºMyISAMå¼•æ“ä¸‹, åˆ†åŒºçš„æœ€å°åŒºå—æ˜¯4K (InnoDBè²Œä¼¼æ˜¯96k) 12345678910111213$ ls |grep user |xargs du -sh4.0K user#P#p0.MYD4.0K user#P#p0.MYI4.0K user#P#p1.MYD4.0K user#P#p1.MYI4.0K user#P#p2.MYD4.0K user#P#p2.MYI4.0K user#P#p3.MYD4.0K user#P#p3.MYI4.0K user#P#p4.MYD4.0K user#P#p4.MYI12K user.frm4.0K user.par æ•°æ®æµ‹è¯• åˆå§‹æ•°æ®ä¸º25æ¡ 1234567mysql&gt; select count(id) as count from user;+-------+| count |+-------+| 25 |+-------+1 row in set (0.00 sec) åˆ é™¤ç¬¬å››ä¸ªåˆ†åŒº 123mysql&gt; alter table user drop partition p4; Query OK, 0 rows affected (0.15 sec)Records: 0 Duplicates: 0 Warnings: 0 å¯ä»¥å‘ç°, å­˜æ”¾åœ¨ç¬¬å››ä¸ªåˆ†åŒºé‡Œé¢çš„14æ¡æ•°æ®ä¸¢å¤±äº†, å‰©ä¸‹çš„3ä¸ªåˆ†åŒºåªæœ‰11æ¡æ•°æ® 1234567mysql&gt; select count(id) as count from user; +-------+| count |+-------+| 11 |+-------+1 row in set (0.00 sec) æŸ¥çœ‹åˆ†åŒºæ–‡ä»¶, å‘ç°ç¬¬å››ä¸ªåˆ†åŒºç¡®å®è¢«åˆ é™¤äº† 1234567891011$ ls |grep user |xargs du -sh4.0K user#P#p0.MYD4.0K user#P#p0.MYI4.0K user#P#p1.MYD4.0K user#P#p1.MYI4.0K user#P#p2.MYD4.0K user#P#p2.MYI4.0K user#P#p3.MYD4.0K user#P#p3.MYI12K user.frm4.0K user.par å°ç»“: å¯ä»¥å‘ç°, åœ¨è¿›è¡Œrangeåˆ†åŒºå ä¼šç”Ÿæˆä¸€ä¸ª .paræ–‡ä»¶,ç”¨æ¥å­˜å‚¨åˆ†åŒºä¿¡æ¯; MyISAM/InnoDBå¼•æ“, åŸæœ‰çš„ .frm è¡¨ç»“æ„æ–‡ä»¶æ²¡æœ‰è¢«åˆ†éš”; MyISAMå¼•æ“, åŸæœ‰çš„ .MYDæ•°æ®æ–‡ä»¶, .MYIç´¢å¼•æ–‡ä»¶éƒ½è¢«åˆ†éš”äº†; InnoDBå¼•æ“, åŸæœ‰çš„ .idbæ•°æ®æ–‡ä»¶è¢«åˆ†éš”äº†; æ³¨æ„ å½“å¾€åˆ†åŒºåˆ—ä¸­æ’å…¥nullå€¼, RANGåˆ†åŒºä¼šå°†å…¶å½“ä½œæœ€å°å€¼æ¥å¤„ç†å³æ’å…¥æœ€å°çš„åˆ†åŒºä¸­ liståˆ†åŒºä¸­, NULLå€¼å¿…é¡»å‡ºç°åœ¨åˆ†åŒºæšä¸¾å€¼ä¸­, å¦åœ¨åœ¨æ’å…¥æ•°æ®æ˜¯ä¼šæŠ¥é”™ hashå’Œkeyä¼šå°†NULLå½“åš0å¤„ç† Liståˆ†åŒº RANGEåˆ†åŒºæ˜¯ä»å±äºä¸€ä¸ªè¿ç»­åŒºé—´å€¼çš„é›†åˆ, è€ŒLISTåˆ†åŒºæ˜¯åŸºäºæŸåˆ—çš„å€¼ä»å±äºä¸€ä¸ªå€¼åˆ—è¡¨é›†ä¸­çš„ä¸€ä¸ªå€¼ å¦‚æœä¸ç”¨ä¸»é”®, å¦‚ä¸‹liståˆ†åŒºå¯ä»¥åˆ›å»ºæˆåŠŸï¼Œä¸€èˆ¬æƒ…å†µä¸‹, ä¸€å¼ è¡¨è‚¯å®šä¼šæœ‰ä¸€ä¸ªä¸»é”®(æ‰€ä»¥å¦‚æœéœ€è¦ç”¨å…¶ä»–é”®æ¥åšåˆ†åŒº, å‚è€ƒä¸‹ä¸€ç¯‡åšæ–‡åˆ†åŒºé”®, ä¸»é”®, å”¯ä¸€ç´¢å¼•å…³ç³») 123456789101112131415161718192021CREATE TABLE IF NOT EXISTS `list_part` ( `id` int(11) NOT NULL COMMENT &apos;ç”¨æˆ·ID&apos;, `province_id` int(2) NOT NULL DEFAULT 0 COMMENT &apos;çœ&apos;, `name` varchar(50) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;åç§°&apos;, `sex` int(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0ä¸ºç”·, 1ä¸ºå¥³&apos;) ENGINE=INNODB DEFAULT CHARSET=utf8PARTITION BY LIST (province_id) ( PARTITION p0 VALUES IN (1,2,3,4,5,6,7,8), PARTITION p1 VALUES IN (9,10,11,12,16,21), PARTITION p2 VALUES IN (13,14,15,19), PARTITION p3 VALUES IN (17,18,20,22,23,24));// åˆ›å»ºæˆåŠŸ, ä¼šçœ‹åˆ°åˆ†åŒºæ•ˆæœ (InnoDBé»˜è®¤åˆ†åŒºæœ€å°æ˜¯96k)$ ls |grep list_part |xargs du -sh96K list_part#P#p0.ibd96K list_part#P#p1.ibd96K list_part#P#p2.ibd96K list_part#P#p3.ibd12K list_part.frm4.0K list_part.par æ³¨æ„ å½“å¾€åˆ†åŒºåˆ—ä¸­æ’å…¥nullå€¼, RANGåˆ†åŒºä¼šå°†å…¶å½“ä½œæœ€å°å€¼æ¥å¤„ç†å³æ’å…¥æœ€å°çš„åˆ†åŒºä¸­ liståˆ†åŒºä¸­, NULLå€¼å¿…é¡»å‡ºç°åœ¨åˆ†åŒºæšä¸¾å€¼ä¸­, å¦åœ¨åœ¨æ’å…¥æ•°æ®æ˜¯ä¼šæŠ¥é”™ hashå’Œkeyä¼šå°†NULLå½“åš0å¤„ç† RANGEåˆ†åŒºå¿…é¡»çš„è¿ç»­çš„ä¸”ä¸èƒ½é‡å (3,6,9,12,MAXVALUEå¯ä»¥, 3,6,5,12,MAXVALUEå°±ä¼šæŠ¥é”™) hashåˆ†åŒº HASHåˆ†åŒºä¸»è¦ç”¨æ¥ç¡®ä¿æ•°æ®åœ¨é¢„å…ˆç¡®å®šæ•°ç›®çš„åˆ†åŒºä¸­å¹³å‡åˆ†å¸ƒ, ä½ æ‰€è¦åšçš„åªæ˜¯ å¯¹å°†è¦è¢«å“ˆå¸Œçš„åˆ—å€¼, æŒ‡å®šä¸€ä¸ªåˆ—å€¼æˆ–è¡¨è¾¾å¼; æŒ‡å®šè¢«åˆ†åŒºçš„è¡¨å°†è¦è¢«åˆ†å‰²æˆçš„åˆ†åŒºæ•°é‡; å¯¹HASHåˆ†åŒºï¼Œä½¿ç”¨çš„ç”¨æˆ·å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå¤§äº0çš„æ•´æ•°å€¼; åˆ›å»ºè¡¨åŒæ—¶è¿›è¡Œhashåˆ†åŒº 12345678CREATE TABLE IF NOT EXISTS `hash_part` ( `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;è¯„è®ºID&apos;, `comment` varchar(1000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;è¯„è®º&apos;, `ip` varchar(25) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;æ¥æºIP&apos;, PRIMARY KEY (`id`) ) ENGINE=INNODB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 PARTITION BY HASH(id) PARTITIONS 3; æŸ¥çœ‹åˆ†åŒºæ•ˆæœ 123456$ ls |grep hash_part |xargs du -sh96K hash_part#P#p0.ibd96K hash_part#P#p1.ibd96K hash_part#P#p2.ibd12K hash_part.frm4.0K hash_part.par æ³¨æ„ å½“å¾€åˆ†åŒºåˆ—ä¸­æ’å…¥nullå€¼, RANGåˆ†åŒºä¼šå°†å…¶å½“ä½œæœ€å°å€¼æ¥å¤„ç†å³æ’å…¥æœ€å°çš„åˆ†åŒºä¸­ liståˆ†åŒºä¸­, NULLå€¼å¿…é¡»å‡ºç°åœ¨åˆ†åŒºæšä¸¾å€¼ä¸­, å¦åœ¨åœ¨æ’å…¥æ•°æ®æ˜¯ä¼šæŠ¥é”™ hashå’Œkeyä¼šå°†NULLå½“åš0å¤„ç† RANGEåˆ†åŒºå¿…é¡»çš„è¿ç»­çš„ä¸”ä¸èƒ½é‡å (3,6,9,12,MAXVALUEå¯ä»¥, 3,6,5,12,MAXVALUEå°±ä¼šæŠ¥é”™) keyåˆ†åŒº æŒ‰ç…§KEYè¿›è¡Œåˆ†åŒº, ç±»ä¼¼äºæŒ‰ç…§HASHåˆ†åŒº HASHåˆ†åŒºæ˜¯ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„è¡¨è¾¾å¼ è€ŒKEYåˆ†åŒºçš„å“ˆå¸Œå‡½æ•°æ˜¯ç”±MySQLæœåŠ¡å™¨æä¾› åˆ›å»ºè¡¨åŒæ—¶è¿›è¡Œkeyåˆ†åŒº 12345678CREATE TABLE IF NOT EXISTS `key_part` ( `news_id` int(11) NOT NULL COMMENT &apos;æ–°é—»ID&apos;, `content` varchar(1000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;æ–°é—»å†…å®¹&apos;, `u_id` varchar(25) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;æ¥æºIP&apos;, `create_time` DATE NOT NULL DEFAULT &apos;0000-00-00 00:00:00&apos; COMMENT &apos;æ—¶é—´&apos; ) ENGINE=INNODB DEFAULT CHARSET=utf8 PARTITION BY LINEAR HASH(YEAR(create_time)) PARTITIONS 3; æŸ¥çœ‹åˆ†åŒºæ•ˆæœ 123456$ ls |grep key_part |xargs du -sh96K key_part#P#p0.ibd96K key_part#P#p1.ibd96K key_part#P#p2.ibd12K key_part.frm4.0K key_part.par æ³¨æ„ å½“å¾€åˆ†åŒºåˆ—ä¸­æ’å…¥nullå€¼, RANGåˆ†åŒºä¼šå°†å…¶å½“ä½œæœ€å°å€¼æ¥å¤„ç†å³æ’å…¥æœ€å°çš„åˆ†åŒºä¸­ liståˆ†åŒºä¸­, NULLå€¼å¿…é¡»å‡ºç°åœ¨åˆ†åŒºæšä¸¾å€¼ä¸­, å¦åœ¨åœ¨æ’å…¥æ•°æ®æ˜¯ä¼šæŠ¥é”™ hashå’Œkeyä¼šå°†NULLå½“åš0å¤„ç† RANGEåˆ†åŒºå¿…é¡»çš„è¿ç»­çš„ä¸”ä¸èƒ½é‡å (3,6,9,12,MAXVALUEå¯ä»¥, 3,6,5,12,MAXVALUEå°±ä¼šæŠ¥é”™) å­åˆ†åŒº å­åˆ†åŒºæ˜¯åˆ†åŒºè¡¨ä¸­æ¯ä¸ªåˆ†åŒºçš„å†æ¬¡åˆ†å‰², å¯¹äºå·²ç»é€šè¿‡RANGEæˆ–LISTåˆ†åŒºäº†çš„è¡¨å†è¿›è¡Œå­åˆ†åŒºæ˜¯å¯èƒ½çš„, å­åˆ†åŒºæ—¢å¯ä»¥ä½¿ç”¨HASHåˆ†åŒº, ä¹Ÿå¯ä»¥ä½¿ç”¨KEYåˆ†åŒº; è¿™ä¹Ÿè¢«ç§°ä¸ºå¤åˆåˆ†åŒº(composite partitioning) å¦‚æœä¸€ä¸ªåˆ†åŒºä¸­åˆ›å»ºäº†å­åˆ†åŒº, å…¶ä»–åˆ†åŒºä¹Ÿè¦æœ‰å­åˆ†åŒº å¦‚æœåˆ›å»ºäº†å­åˆ†åŒº, æ¯ä¸ªåˆ†åŒºä¸­çš„å­åˆ†åŒºæ•°å¿…é¡»ç›¸åŒ åŒä¸€åˆ†åŒºå†…çš„å­åˆ†åŒº, åå­—ä¸ç›¸åŒ, ä¸åŒåˆ†åŒºå†…çš„å­åˆ†åŒºåå­å¯ä»¥ç›¸åŒ(5.1.50ä¸é€‚ç”¨) åˆ›å»ºè¡¨åŒæ—¶, è¿›è¡Œå­åˆ†åŒºæ“ä½œ 123456789101112131415161718CREATE TABLE IF NOT EXISTS `sub_part` ( `news_id` int(11) NOT NULL COMMENT &apos;æ–°é—»ID&apos;, `content` varchar(1000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;æ–°é—»å†…å®¹&apos;, `u_id` int(11) NOT NULL DEFAULT 0 COMMENT &apos;æ¥æºIP&apos;, `create_time` DATE NOT NULL DEFAULT &apos;0000-00-00 00:00:00&apos; COMMENT &apos;æ—¶é—´&apos; ) ENGINE=INNODB DEFAULT CHARSET=utf8 PARTITION BY RANGE(YEAR(create_time)) SUBPARTITION BY HASH(TO_DAYS(create_time))( PARTITION p0 VALUES LESS THAN (1990)( SUBPARTITION s0,SUBPARTITION s1,SUBPARTITION s2 ), PARTITION p1 VALUES LESS THAN (2000)( SUBPARTITION s3,SUBPARTITION s4,SUBPARTITION good ), PARTITION p2 VALUES LESS THAN MAXVALUE( SUBPARTITION tank0,SUBPARTITION tank1,SUBPARTITION tank3 ) ); æŸ¥çœ‹åˆ†åŒºå, æ•°æ®è¡¨æ–‡ä»¶ç»“æ„ 123456789101112$ ls |grep sub_part |xargs du -sh96K sub_part#P#p0#SP#s0.ibd96K sub_part#P#p0#SP#s1.ibd96K sub_part#P#p0#SP#s2.ibd96K sub_part#P#p1#SP#good.ibd96K sub_part#P#p1#SP#s3.ibd96K sub_part#P#p1#SP#s4.ibd96K sub_part#P#p2#SP#tank0.ibd96K sub_part#P#p2#SP#tank1.ibd96K sub_part#P#p2#SP#tank3.ibd12K sub_part.frm4.0K sub_part.par","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"}]},{"title":"Restful","slug":"http/2018-03-06-restful","date":"2018-03-16T11:36:23.000Z","updated":"2018-05-09T06:31:19.000Z","comments":true,"path":"2018/03/16/http/2018-03-06-restful/","link":"","permalink":"http://blog.renyimin.com/2018/03/16/http/2018-03-06-restful/","excerpt":"","text":"ç®€ä»‹RESTæœ¬èº«å¹¶æ²¡æœ‰åˆ›é€ æ–°çš„æŠ€æœ¯, ç»„ä»¶æˆ–æœåŠ¡, ä¸»è¦æŒ‡çš„æ˜¯ä¸€ç»„æ¶æ„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™, éšè—åœ¨RESTfulèƒŒåçš„ç†å¿µå°±æ˜¯ä½¿ç”¨Webçš„ç°æœ‰ç‰¹å¾å’Œèƒ½åŠ›, æ›´å¥½åœ°ä½¿ç”¨ç°æœ‰Webæ ‡å‡†ä¸­çš„ä¸€äº›å‡†åˆ™å’Œçº¦æŸ; å¦‚æœä¸€ä¸ªæ¶æ„ç¬¦åˆRESTçš„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™ï¼Œæˆ‘ä»¬å°±ç§°å®ƒä¸ºRESTfulæ¶æ„ã€‚ è™½ç„¶RESTæœ¬èº«å—WebæŠ€æœ¯çš„å½±å“å¾ˆæ·±, ä½†æ˜¯ç†è®ºä¸ŠRESTæ¶æ„é£æ ¼å¹¶ä¸æ˜¯ç»‘å®šåœ¨HTTPä¸Š, åªä¸è¿‡ç›®å‰HTTPæ˜¯å”¯ä¸€ä¸RESTç›¸å…³çš„å®ä¾‹; æ‰€ä»¥é€šå¸¸æè¿°çš„RESTä¹Ÿæ˜¯é€šè¿‡HTTPå®ç°çš„REST; URIçš„è®¾è®¡ URIçš„è®¾è®¡åº”è¯¥éµå¾ªå¯å¯»å€æ€§åŸåˆ™, å…·æœ‰è‡ªæè¿°æ€§, éœ€è¦åœ¨å½¢å¼ä¸Šç»™äººä»¥ç›´è§‰ä¸Šçš„å…³è”; æ¯”å¦‚: ç”¨_æˆ–-æ¥è®©URIå¯è¯»æ€§æ›´å¥½ä¾‹å¦‚å›½å†…æ¯”è¾ƒå‡ºåçš„å¼€æºä¸­å›½ç¤¾åŒº, å®ƒä¸Šé¢çš„æ–°é—»åœ°å€å°±é‡‡ç”¨è¿™ç§é£æ ¼, å¦‚ http://www.oschina.net/news/38119/oschina-translate-reward-plan ä½¿ç”¨/æ¥è¡¨ç¤ºèµ„æºçš„å±‚çº§å…³ç³»ä¾‹å¦‚ https://github.com/rymuscle/chat/issues å°±è¡¨ç¤ºäº†ä¸€ä¸ªå¤šçº§çš„èµ„æº, æŒ‡çš„æ˜¯rymuscleç”¨æˆ·çš„chaté¡¹ç›®çš„issuesåˆ—è¡¨ ä½¿ç”¨?ç”¨æ¥è¿‡æ»¤èµ„æº (å¦‚æœè®°å½•æ•°é‡å¾ˆå¤šï¼ŒæœåŠ¡å™¨ä¸å¯èƒ½éƒ½å°†å®ƒä»¬è¿”å›ç»™ç”¨æˆ·, æ¯”å¦‚åˆ†é¡µç­‰ç­›é€‰æ¡ä»¶)å¾ˆå¤šäººåªæ˜¯æŠŠ?ç®€å•çš„å½“åšæ˜¯å‚æ•°çš„ä¼ é€’, å¾ˆå®¹æ˜“é€ æˆURIè¿‡äºå¤æ‚ã€éš¾ä»¥ç†è§£; å…¶å®å¯ä»¥æŠŠ?ç”¨äºå¯¹èµ„æºçš„è¿‡æ»¤;ä¾‹å¦‚ https://github.com/rymuscle/chat/pulls ç”¨æ¥è¡¨ç¤ºgité¡¹ç›®çš„æ‰€æœ‰æ¨å…¥è¯·æ±‚;è€Œ /pulls?state=closed ç”¨æ¥è¡¨ç¤ºgité¡¹ç›®ä¸­å·²ç»å…³é—­çš„æ¨å…¥è¯·æ±‚, è¿™ç§URLé€šå¸¸å¯¹åº”çš„æ˜¯ä¸€äº›ç‰¹å®šæ¡ä»¶çš„æŸ¥è¯¢ç»“æœæˆ–ç®—æ³•è¿ç®—ç»“æœ; ,æˆ–;å¯ä»¥ç”¨æ¥è¡¨ç¤ºåŒçº§èµ„æºçš„å…³ç³» URIé‡Œå¸¦ä¸Šç‰ˆæœ¬å·, å¦‚ https://api.example.com/v1/ (Githubå°±æ˜¯è¿™æ ·åšçš„) å¦ä¸€ç§åšæ³•æ˜¯, å°†ç‰ˆæœ¬å·æ”¾åœ¨HTTPå¤´ä¿¡æ¯ä¸­, ä½†ä¸å¦‚æ”¾å…¥URLæ–¹ä¾¿å’Œç›´è§‚; URIä¸­åªåº”è¯¥æè¿°æ¸…æ¥šèµ„æºçš„åç§°, è€Œä¸åº”è¯¥åŒ…æ‹¬èµ„æºçš„æ“ä½œ(å› ä¸ºç»Ÿä¸€èµ„æºæ¥å£è¦æ±‚ä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•å¯¹èµ„æºè¿›è¡Œæ“ä½œ, æ–¹æ³•éƒ½æ˜¯æœ‰è¯­ä¹‰çš„, æ‰€ä»¥å·²ç»æ˜ç¡®æè¿°äº†è¿™æ¬¡çš„æ“ä½œå«ä¹‰) URIä¸åº”è¯¥å†ä½¿ç”¨åŠ¨ä½œæ¥æè¿°, å¦‚ä¸‹å°±æ˜¯ä¸€äº›ä¸ç¬¦åˆç»Ÿä¸€æ¥å£è¦æ±‚çš„URI (å®ƒä»¬éƒ½åœ¨URIä¸­å¯¹æ“ä½œè¿›è¡Œäº†æè¿°):1234GET /getUser/1POST /createUserPUT /updateUser/1DELETE /deleteUser/1 HTTPåŠ¨è¯æ¥å£åº”è¯¥ä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•å¦‚GETï¼ŒPUTå’ŒPOSTï¼Œå¹¶éµå¾ªè¿™äº›æ–¹æ³•çš„è¯­ä¹‰(é€šè¿‡æ˜ç¡®çš„æ–¹æ³•æ¥æè¿°æ“ä½œ), å¯ä»¥å‚è€ƒåšæ–‡ HTTPå„è¯·æ±‚æ–¹æ³•è¯¦è§£ æˆ–è€… Restfulæ¶æ„è¯¦è§£ çŠ¶æ€ç çŠ¶æ€ç åº”è¯¥ä½¿ç”¨HTTPæ ‡å‡†çŠ¶æ€ç  å¯ä»¥å‚è€ƒåšæ–‡ HTTPåè®®é¢„è§ˆ æ›´å¤šå‚è€ƒ","categories":[{"name":"Restful","slug":"Restful","permalink":"http://blog.renyimin.com/categories/Restful/"},{"name":"HTTP","slug":"Restful/HTTP","permalink":"http://blog.renyimin.com/categories/Restful/HTTP/"}],"tags":[{"name":"Restful","slug":"Restful","permalink":"http://blog.renyimin.com/tags/Restful/"},{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"yield åç¨‹","slug":"PHP/2018-01-13-yield","date":"2018-01-13T05:20:31.000Z","updated":"2018-04-04T09:46:45.000Z","comments":true,"path":"2018/01/13/PHP/2018-01-13-yield/","link":"","permalink":"http://blog.renyimin.com/2018/01/13/PHP/2018-01-13-yield/","excerpt":"","text":"è¿­ä»£å™¨è¿­ä»£ç”Ÿæˆå™¨ç®€ä»‹ (è¿­ä»£)ç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°, è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨, è€Œè¿™ä¸ªè¿­ä»£å™¨å®ç°äº†Iteratoræ¥å£, æ‰€ä»¥å«è¿­ä»£ç”Ÿæˆå™¨; å’Œæ™®é€šå‡½æ•°ä¸åŒ, ç”±äº(è¿­ä»£)ç”Ÿæˆå™¨è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨, æ‰€ä»¥(è¿­ä»£)ç”Ÿæˆå™¨å‡½æ•°ä¸­çš„è¿”å›å€¼å¯ä»¥ä¾æ¬¡è¿”å›, è€Œä¸æ˜¯åªè¿”å›ä¸€ä¸ªå•ç‹¬çš„å€¼; æˆ–è€…æ¢å¥è¯è¯´, (è¿­ä»£)ç”Ÿæˆå™¨ä½¿ä½ èƒ½æ›´æ–¹ä¾¿çš„å®ç°äº†è¿­ä»£å™¨æ¥å£; å¼•ç”¨ç½‘ä¸Šå¸¸è§çš„ç¤ºä¾‹ 1234567891011&lt;?phpfunction xrange($start, $end, $step = 1) &#123; for ($i = $start; $i &lt;= $end; $i += $step) &#123; yield $i; &#125;&#125;// var_dump(xrange(1, 1000000)); // object(Generator)[1]foreach (xrange(1, 1000000) as $num) &#123; echo $num;&#125; ä¸Šé¢è¿™ä¸ª xrange() å‡½æ•°æä¾›äº†å’ŒPHPçš„å†…å»ºå‡½æ•°range()ä¸€æ ·çš„åŠŸèƒ½, ä½†æ˜¯ä¸åŒçš„æ˜¯range()å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«å€¼ä»1åˆ°100ä¸‡0çš„æ•°ç»„; è€Œxrange()å‡½æ•°è¿”å›çš„æ˜¯ä¾æ¬¡è¾“å‡ºè¿™äº›å€¼çš„ä¸€ä¸ªè¿­ä»£å™¨, è€Œä¸ä¼šçœŸæ­£ä»¥æ•°ç»„å½¢å¼è¿”å›; è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯æ˜¾è€Œæ˜“è§çš„, å®ƒå¯ä»¥è®©ä½ åœ¨å¤„ç†å¤§æ•°æ®é›†åˆçš„æ—¶å€™ä¸ç”¨ä¸€æ¬¡æ€§çš„åŠ è½½åˆ°å†…å­˜ä¸­, ç”šè‡³ä½ å¯ä»¥å¤„ç†æ— é™å¤§çš„æ•°æ®æµ; å½“ç„¶, ä¹Ÿå¯ä»¥ä¸é€šè¿‡ç”Ÿæˆå™¨æ¥å®ç°è¿™ä¸ªåŠŸèƒ½, è€Œæ˜¯å¯ä»¥é€šè¿‡ç»§æ‰¿Iteratoræ¥å£å®ç°, ä½†é€šè¿‡ä½¿ç”¨ç”Ÿæˆå™¨å®ç°èµ·æ¥ä¼šæ›´æ–¹ä¾¿, ä¸ç”¨å†å»å®ç°iteratoræ¥å£ä¸­çš„5ä¸ªæ–¹æ³•äº†; ç”Ÿæˆå™¨å†…éƒ¨ è¦ä»ç”Ÿæˆå™¨è®¤è¯†åç¨‹, ç†è§£å®ƒå†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œæ˜¯éå¸¸é‡è¦çš„: ç”Ÿæˆå™¨æ˜¯ä¸€ç§å¯ä¸­æ–­çš„å‡½æ•°, åœ¨å®ƒé‡Œé¢çš„yieldæ„æˆäº†ä¸­æ–­ç‚¹; åƒä¸Šé¢çš„ä¾‹å­, è°ƒç”¨xrange(1,1000000)çš„æ—¶å€™, xrange()å‡½æ•°é‡Œä»£ç å…¶å®å¹¶æ²¡æœ‰çœŸæ­£åœ°è¿è¡Œ, å®ƒåªæ˜¯è¿”å›äº†ä¸€ä¸ªè¿­ä»£å™¨; è°ƒç”¨è¿­ä»£å™¨çš„æ–¹æ³•ä¸€æ¬¡, å…¶ä¸­çš„ä»£ç è¿è¡Œä¸€æ¬¡, ä¾‹å¦‚: å¦‚æœä½ è°ƒç”¨ç”Ÿæˆå™¨è¿”å›çš„è¿­ä»£å™¨çš„rewindæ–¹æ³• $range-&gt;rewind(), é‚£ä¹ˆxrange()é‡Œçš„ä»£ç å°±ä¼šè¿è¡Œåˆ°æ§åˆ¶æµç¬¬ä¸€æ¬¡å‡ºç°yieldçš„åœ°æ–¹, è€Œå‡½æ•°å†…ä¼ é€’ç»™yieldè¯­å¥çš„è¿”å›å€¼, å¯ä»¥é€šè¿‡$range-&gt;current()è·å–; ä¸ºäº†ç»§ç»­æ‰§è¡Œç”Ÿæˆå™¨ä¸­yieldåçš„ä»£ç , ä½ å°±éœ€è¦è°ƒç”¨è¿­ä»£å™¨çš„ $range-&gt;next() æ–¹æ³•, è¿™å°†å†æ¬¡å¯åŠ¨ç”Ÿæˆå™¨, ç›´åˆ°ä¸‹ä¸€æ¬¡yieldè¯­å¥å‡ºç°; å› æ­¤, è¿ç»­è°ƒç”¨next()å’Œcurrent()æ–¹æ³•, ä½ å°±èƒ½ä»ç”Ÿæˆå™¨é‡Œè·å¾—æ‰€æœ‰çš„å€¼,ç›´åˆ°å†æ²¡æœ‰yieldè¯­å¥å‡ºç°; å¯¹xrange()æ¥è¯´, è¿™ç§æƒ…å½¢å‡ºç°åœ¨$iè¶…è¿‡$endæ—¶, åœ¨è¿™ç§æƒ…å†µä¸‹, æ§åˆ¶æµå°†åˆ°è¾¾å‡½æ•°çš„ç»ˆç‚¹, å› æ­¤å°†ä¸æ‰§è¡Œä»»ä½•ä»£ç , ä¸€æ—¦è¿™ç§æƒ…å†µå‘ç”Ÿ, vaild()æ–¹æ³•å°†è¿”å›å‡, è¿™æ—¶è¿­ä»£ç»“æŸ; ç¤ºä¾‹1 123456789101112131415161718192021&lt;?phpfunction gen() &#123; var_dump(&apos;cat&apos;); yield &apos;t&apos;; var_dump(&apos;dog&apos;);&#125;$gen = gen();$gen-&gt;rewind(); // æŒ‡é’ˆä¼šèµ°åˆ°ç¬¬ä¸€ä¸ªyieldå¤„, æ‰€ä»¥ä¼šç»è¿‡ catvar_dump($gen-&gt;current()); // è·å–ç¬¬ä¸€ä¸ªyieldå¤„çš„å€¼var_dump(&apos;----------&apos;);$gen-&gt;next(); // ä¼šå¾€ä¸‹èµ°, èµ°åˆ°ä¸‹ä¸€ä¸ªyieldå¤„, æ‰€ä»¥ä¼šç»è¿‡ dogvar_dump($gen-&gt;current()); // è·å–ä¸‹ä¸€ä¸ªyieldå¤„çš„å€¼ (ä½†æ˜¯åé¢å·²ç»æ²¡æœ‰yieldäº†, æ‰€ä»¥ä¸ºnull)// ç»“æœ:string(3) &quot;cat&quot;string(1) &quot;t&quot;string(10) &quot;----------&quot;string(3) &quot;dog&quot;NULL ç¤ºä¾‹2 1234567891011121314151617181920212223242526272829303132333435363738&lt;?phpfunction gen() &#123; var_dump(&apos;cat&apos;); yield &apos;t&apos;; var_dump(&apos;dog&apos;); yield &apos;g&apos;; var_dump(&apos;pig&apos;); yield &apos;p&apos;;&#125;$gen = gen();$gen-&gt;rewind(); // æŒ‡é’ˆä¼šèµ°åˆ°ç¬¬ä¸€ä¸ªyieldå¤„, æ‰€ä»¥ä¼šç»è¿‡ catvar_dump($gen-&gt;current()); // è·å–ç¬¬ä¸€ä¸ªyieldå¤„çš„å€¼var_dump(&apos;----------&apos;);$gen-&gt;next(); // ä¼šå¾€ä¸‹èµ°, èµ°åˆ°ä¸‹ä¸€ä¸ªyieldå¤„, æ‰€ä»¥ä¼šç»è¿‡ dogvar_dump($gen-&gt;current()); // è·å–ä¸‹ä¸€ä¸ªyieldå¤„çš„å€¼ (ä½†æ˜¯åé¢å·²ç»æ²¡æœ‰yieldäº†, æ‰€ä»¥ä¸ºnull)var_dump(&apos;----------&apos;);$gen-&gt;next(); // ä¼šå¾€ä¸‹èµ°, èµ°åˆ°ä¸‹ä¸€ä¸ªyieldå¤„, æ‰€ä»¥ä¼šç»è¿‡ pigvar_dump($gen-&gt;current()); // è·å–ä¸‹ä¸€ä¸ªyieldå¤„çš„å€¼ (p)var_dump(&apos;----------&apos;);$gen-&gt;next(); // ä¼šå¾€ä¸‹èµ°, ä»€ä¹ˆä¹Ÿæ²¡æœ‰var_dump($gen-&gt;current()); // è·å–ä¸‹ä¸€ä¸ªyieldå¤„çš„å€¼ (ä¸ºnull)// ç»“æœstring(3) &quot;cat&quot;string(1) &quot;t&quot;string(10) &quot;----------&quot;string(3) &quot;dog&quot;string(1) &quot;g&quot;string(10) &quot;----------&quot;string(3) &quot;pig&quot;string(1) &quot;p&quot;string(10) &quot;----------&quot;NULL ä¸Šé¢ç¤ºä¾‹ä¸­ä½¿ç”¨(è¿­ä»£)ç”Ÿæˆå™¨æ—¶, yield éƒ½åªæ˜¯ç®€å•åœ°ä½œä¸ºä¸€ä¸ªè¯­å¥æ¥ä½¿ç”¨, è¿™æ ·åªèƒ½å®ç° ç”Ÿæˆå™¨åˆ°è°ƒç”¨è€…çš„å•å‘é€šä¿¡; è¿­ä»£å™¨åœ¨è¿›è¡Œå¾ªç¯(è¿­ä»£)å‰, éœ€è¦å…ˆè¿›è¡Œrewind; ç®€å•ç†è§£ åç¨‹(Coroutine) åç¨‹çš„æ”¯æŒæ˜¯åœ¨è¿­ä»£ç”Ÿæˆå™¨çš„åŸºç¡€ä¸Š, å¢åŠ äº†è°ƒç”¨è€…å¯ä»¥å›é€æ•°æ®ç»™ç”Ÿæˆå™¨çš„åŠŸèƒ½(è°ƒç”¨è€…å‘é€æ•°æ®ç»™è¢«è°ƒç”¨çš„ç”Ÿæˆå™¨å‡½æ•°), è¿™å°±æŠŠç”Ÿæˆå™¨åˆ°è°ƒç”¨è€…çš„å•å‘é€šä¿¡è½¬å˜ä¸ºä¸¤è€…ä¹‹é—´çš„åŒå‘é€šä¿¡; è°ƒç”¨è€…ä¼ é€’æ•°æ®ç»™ç”Ÿæˆå™¨, æ˜¯é€šè¿‡è¿­ä»£å™¨çš„send()æ–¹æ³•å®ç°çš„; ä¸‹é¢å°±æ˜¯ä¸€ä¸ªç®€å•çš„åç¨‹ç¤ºä¾‹, ç”¨æ¥æ¼”ç¤ºè¿™ç§é€šä¿¡å¦‚ä½•è¿è¡Œçš„ ä¸‹é¢ä¾‹å­å¯ä»¥çœ‹åˆ°åœ¨ç”Ÿæˆå™¨å†…éƒ¨, yield ä¸å†æ˜¯ç®€å•çš„è¯­å¥, è€Œæ˜¯ä¸€ä¸ªå¯ä»¥æ¥æ”¶è°ƒç”¨è€…å‚æ•°å¹¶è¿›è¡Œèµ‹å€¼çš„è¡¨è¾¾å¼ 12345678910111213141516171819202122232425262728293031323334353637&lt;?phpfunction gen() &#123; var_dump(&apos;cat&apos;); $ret1 = (yield &apos;yield1&apos;); var_dump($ret1 . &apos;dog&apos;); $ret2 = (yield &apos;yield2&apos;); var_dump($ret2 . &apos;pig&apos;);&#125;$gen = gen();$gen-&gt;rewind(); // æŒ‡é’ˆä¼šèµ°åˆ°ç¬¬ä¸€ä¸ª yield å¤„, æ‰€ä»¥ä¼šç»è¿‡ cat// catecho &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;current());// yield1echo &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;send(&apos;lala&apos;)); // å¦‚æœç¬¬ä¸€æ¬¡sendä¹‹å‰æ²¡æœ‰rewindå°†æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªyield, åˆ™sendä¼š: è‡ªåŠ¨å…ˆè¿›è¡Œä¸€æ¬¡rewind // 2. ç”±äºæŒ‡é’ˆè¿˜åœ¨ç¬¬ä¸€ä¸ªyieldå¤„, æ­¤æ—¶sendä¼ é€’å‚æ•°è¿˜æ˜¯ä¼ åˆ°ç¬¬ä¸€ä¸ªyieldå¤„ (yield &apos;yield1&apos;) // 3. æ‰§è¡Œnext åˆ°ä¸‹ä¸€ä¸ªyield (ä¼šç»è¿‡ $ret.dog ) // 4. è¿”å›nextä¹‹åçš„yieldå€¼(yield &apos;yield2&apos; )// laladog// yield2echo &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;current()); // åˆ°äº†ç¬¬äºŒä¸ªyieldå¤„, ç”±äºæ²¡æœ‰ä¼ é€’è‡³, æ‰€ä»¥å¯ä»¥é€šè¿‡currentç›´æ¥è·å– yield &apos;yield2&apos; ä¼ ç»™è°ƒç”¨è€…çš„ &apos;yield2&apos;// yield2echo &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;send(&apos;haha&apos;)); // ç”±äºæŒ‡é’ˆæ²¡å˜, è¿˜åœ¨ç¬¬äºŒä¸ªyieldå¤„, ä¼ é€’äº† haha ç»™ç”Ÿæˆå™¨ // ç„¶åæ‰§è¡Œäº†next ç»§ç»­å¾€ä¸‹èµ°, ä¼šç»è¿‡ var_dump($ret . &apos;pig&apos;); // è¿”å›nextä¹‹åçš„yieldå€¼ (å·²ç»è¿›è¡Œäº†next, è€Œä¹‹åæ²¡æœ‰yieldäº†, æ‰€ä»¥ä¼šè¿”å›null)// hahapig// nullecho &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;current()); // ç”±äºä¸Šé¢å·²ç»èµ°äº†next, è€Œä¸‹é¢å•¥éƒ½æ²¡æœ‰äº†......// null ç¬¬ä¸€æ¬¡sendä¼šé»˜è®¤æ‰§è¡Œrewind 123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;?phpfunction gen() &#123; var_dump(&apos;cat&apos;); $ret1 = (yield &apos;yield1&apos;); var_dump($ret1 . &apos;dog&apos;); $ret2 = (yield &apos;yield2&apos;); var_dump($ret2 . &apos;pig&apos;);&#125;$gen = gen();echo &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;send(&apos;lala&apos;)); // å¦‚æœç¬¬ä¸€æ¬¡sendä¹‹å‰æ²¡æœ‰rewindå°†æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªyield, åˆ™sendä¼š: è‡ªåŠ¨å…ˆè¿›è¡Œä¸€æ¬¡rewind (æ‰€ä»¥ä¹Ÿä¼šç»è¿‡ cat ) // 2. ç”±äºæŒ‡é’ˆè¿˜åœ¨ç¬¬ä¸€ä¸ªyieldå¤„, æ­¤æ—¶sendä¼ é€’å‚æ•°è¿˜æ˜¯ä¼ åˆ°ç¬¬ä¸€ä¸ªyieldå¤„ (yield &apos;yield1&apos;) // 3. æ‰§è¡Œnext åˆ°ä¸‹ä¸€ä¸ªyield (ä¼šç»è¿‡ $ret.dog ) // 4. è¿”å›nextä¹‹åçš„yieldå€¼(yield &apos;yield2&apos; )// cat// laladog// yield2echo &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;current()); // åˆ°äº†ç¬¬äºŒä¸ªyieldå¤„, ç”±äºæ²¡æœ‰ä¼ é€’è‡³, æ‰€ä»¥å¯ä»¥é€šè¿‡currentç›´æ¥è·å– yield &apos;yield2&apos; ä¼ ç»™è°ƒç”¨è€…çš„ &apos;yield2&apos;// yield2echo &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;send(&apos;haha&apos;)); // ç”±äºæŒ‡é’ˆæ²¡å˜, è¿˜åœ¨ç¬¬äºŒä¸ªyieldå¤„, ä¼ é€’äº† haha ç»™ç”Ÿæˆå™¨ // ç„¶åæ‰§è¡Œäº†next ç»§ç»­å¾€ä¸‹èµ°, ä¼šç»è¿‡ var_dump($ret . &apos;pig&apos;); // è¿”å›nextä¹‹åçš„yieldå€¼ (å·²ç»è¿›è¡Œäº†next, è€Œä¹‹åæ²¡æœ‰yieldäº†, æ‰€ä»¥ä¼šè¿”å›null)// hahapig// nullecho &apos;+++++++++++++++++++&apos;;var_dump($gen-&gt;current()); // ç”±äºä¸Šé¢å·²ç»èµ°äº†next, è€Œä¸‹é¢å•¥éƒ½æ²¡æœ‰äº†......// null//function foo() &#123;// $string = yield;// echo $string;// for ($i = 1; $i &lt;= 3; $i++) &#123;// yield $i;// &#125;//&#125;////$generator = foo();//$generator-&gt;send(&apos;Hello world!&apos;);//foreach ($generator as $value) echo &quot;$value\\n&quot;; æ›´å¤šå°ä¾‹å­ (å¯å‚è€ƒPHPæ‰‹å†Œ) å¯ä»¥è¿­ä»£ä¸‰æ¬¡ 123456789101112131415161718&lt;?phpfunction printer() &#123; $i = 3; while ($i&gt;0) &#123; echo 33; $string = yield; echo $string; $i--; echo $i; &#125;&#125;$printer = printer();$printer-&gt;send(&apos;Hello world!&apos;);echo &quot;&lt;br/&gt;++++++++++&lt;br/&gt;&quot;;$printer-&gt;send(&apos;haha&apos;);echo &quot;&lt;br/&gt;++++++++++&lt;br/&gt;&quot;;$printer-&gt;send(&apos;heihei&apos;); å¯ä»¥ä¸€ç›´è¿­ä»£ 1234567891011121314151617&lt;?phpfunction printer() &#123; while (true) &#123; echo 33; $string = yield; echo $string; &#125;&#125;$printer = printer();$printer-&gt;send(&apos;Hello world!&apos;);echo &quot;&lt;br/&gt;++++++++++&lt;br/&gt;&quot;;$printer-&gt;send(&apos;haha&apos;);echo &quot;&lt;br/&gt;++++++++++&lt;br/&gt;&quot;;$printer-&gt;send(&apos;heihei&apos;);echo &quot;&lt;br/&gt;++++++++++&lt;br/&gt;&quot;;$printer-&gt;send(&apos;heihei2&apos;); ä¸ªäººæ„Ÿè§‰é‡ç‚¹åœ¨äºç†è§£è°ƒç”¨è€…å‘å‡ºsend()å, send()çš„æ‰§è¡ŒåŒ…æ‹¬next()åŠè¿”å› (ä»¥åŠ, å¦‚æœæ˜¯åˆæ¬¡æ‰§è¡Œsendçš„è¯, ä¼šéšå¼æ‰§è¡Œrewind); ä¹Ÿå¯ä»¥å‚è€ƒé¸Ÿå“¥åšå®¢å¯¹sendçš„è¯´æ˜ åç¨‹å®ç°ä»»åŠ¡è°ƒåº¦ ä¸Šé¢çš„ä¾‹å­æ¯”è¾ƒç®€å•, å¯èƒ½æ— æ³•ä½“ç³»ä¼šåˆ°åç¨‹çš„ä¼˜ç‚¹, æ¥ä¸‹æ¥å¯ä»¥å°è¯•åˆ©ç”¨åç¨‹å»å®ç°å¤šä»»åŠ¡è°ƒåº¦ è¦è§£å†³çš„é—®é¢˜æ˜¯å½“ä½ æƒ³å¹¶å‘åœ°è¿è¡Œå¤šä»»åŠ¡(æˆ–è€…â€ç¨‹åºâ€)æ—¶, æˆ‘ä»¬éƒ½çŸ¥é“CPUåœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªä»»åŠ¡(ä¸è€ƒè™‘å¤šæ ¸çš„æƒ…å†µ), å› æ­¤å¤„ç†å™¨éœ€è¦åœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´è¿›è¡Œåˆ‡æ¢, è€Œä¸”æ€»æ˜¯è®©æ¯ä¸ªä»»åŠ¡è¿è¡Œä¸€å°ä¼šå„¿; å¤šä»»åŠ¡åä½œè¿™ä¸ªæœ¯è¯­ä¸­çš„åä½œå¾ˆå¥½çš„è¯´æ˜äº†å¦‚ä½•è¿›è¡Œè¿™ç§åˆ‡æ¢çš„: å®ƒè¦æ±‚å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡è‡ªåŠ¨æŠŠæ§åˆ¶ä¼ å›ç»™è°ƒåº¦å™¨, è¿™æ ·å°±å¯ä»¥è¿è¡Œå…¶ä»–ä»»åŠ¡äº†;è¿™ä¸æŠ¢å å¤šä»»åŠ¡ç›¸å, æŠ¢å å¤šä»»åŠ¡æ˜¯è¿™æ ·çš„: è°ƒåº¦å™¨å¯ä»¥ä¸­æ–­è¿è¡Œäº†ä¸€æ®µæ—¶é—´çš„ä»»åŠ¡, ä¸ç®¡å®ƒå–œæ¬¢è¿˜æ˜¯ä¸å–œæ¬¢;åä½œå¤šä»»åŠ¡åœ¨Windowsçš„æ—©æœŸç‰ˆæœ¬(windows95)å’ŒMac OSä¸­æœ‰ä½¿ç”¨, ä¸è¿‡å®ƒä»¬åæ¥éƒ½åˆ‡æ¢åˆ°ä½¿ç”¨æŠ¢å…ˆå¤šä»»åŠ¡äº†, ç†ç”±ç›¸å½“æ˜ç¡®: å¦‚æœä½ ä¾é ç¨‹åºè‡ªåŠ¨äº¤å‡ºæ§åˆ¶çš„è¯, é‚£ä¹ˆä¸€äº›æ¶æ„çš„ç¨‹åºå°†å¾ˆå®¹æ˜“å ç”¨æ•´ä¸ªCPU, ä¸ä¸å…¶ä»–ä»»åŠ¡å…±äº«; ç°åœ¨ä½ åº”å½“æ˜ç™½åç¨‹å’Œä»»åŠ¡è°ƒåº¦ä¹‹é—´çš„å…³ç³»: yieldæŒ‡ä»¤æä¾›äº†ä»»åŠ¡ä¸­æ–­è‡ªèº«çš„ä¸€ç§æ–¹æ³•, ç„¶åæŠŠæ§åˆ¶äº¤å›ç»™ä»»åŠ¡è°ƒåº¦å™¨; å› æ­¤åç¨‹å¯ä»¥è¿è¡Œå¤šä¸ªå…¶ä»–ä»»åŠ¡, æ›´è¿›ä¸€æ­¥æ¥è¯´, yieldå¯ä»¥ç”¨æ¥åœ¨ä»»åŠ¡å’Œè°ƒåº¦å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡; æ‰‹å†Œä¸­è¿™ä¸ªä¾‹å­æœ‰ç©ºå¯ä»¥ç¨ç¨å¾®å“å‘³ä¸€ä¸‹: 123456789101112131415161718&lt;?phpfunction nums() &#123; for ($i = 0; $i &lt; 5; ++$i) &#123; //get a value from the caller $cmd = (yield $i); if($cmd == &apos;stop&apos;) return;//exit the function &#125;&#125;$gen = nums();foreach($gen as $v)&#123; if($v == 3)//we are satisfied $gen-&gt;send(&apos;stop&apos;); echo &quot;&#123;$v&#125;\\n&quot;;&#125; å¤šä»»åŠ¡è°ƒåº¦çš„å®ç° ä¸¤ä¸ªä½¿ç”¨åç¨‹å‡½æ•°çš„ä»»åŠ¡: 12345678910111213function task1() &#123; for ($i = 1; $i &lt;= 10; ++$i) &#123; echo &quot;This is task 1 iteration $i.\\n&quot;; yield; &#125;&#125;function task2() &#123; for ($i = 1; $i &lt;= 5; ++$i) &#123; echo &quot;This is task 2 iteration $i.\\n&quot;; yield; &#125;&#125; Taskä»»åŠ¡ç±»åŒ…è£… ä»»åŠ¡åç¨‹å‡½æ•° 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?php/** * å¦‚ä»£ç , ä¸€ä¸ªä»»åŠ¡å°±æ˜¯ç”¨ä»»åŠ¡IDæ ‡è®°çš„ä¸€ä¸ªåç¨‹(å‡½æ•°). * ä½¿ç”¨setSendValue()æ–¹æ³•, ä½ å¯ä»¥æŒ‡å®šå“ªäº›å€¼å°†è¢«å‘é€åˆ°ä¸‹æ¬¡çš„æ¢å¤(åœ¨ä¹‹åä½ ä¼šäº†è§£åˆ°æˆ‘ä»¬éœ€è¦è¿™ä¸ª), * run()å‡½æ•°ç¡®å®æ²¡æœ‰åšä»€ä¹ˆ, é™¤äº†è°ƒç”¨send()æ–¹æ³•çš„ååŒç¨‹åº * è¦ç†è§£ä¸ºä»€ä¹ˆæ·»åŠ äº†ä¸€ä¸ª beforeFirstYieldflagå˜é‡ */class Task &#123; protected $taskId; protected $coroutine; protected $sendValue = null; protected $beforeFirstYield = true; public function __construct($taskId, Generator $coroutine) &#123; $this-&gt;taskId = $taskId; $this-&gt;coroutine = $coroutine; &#125; public function getTaskId() &#123; return $this-&gt;taskId; &#125;// public function setSendValue($sendValue) &#123;// $this-&gt;sendValue = $sendValue;// &#125; public function run() &#123; // ç”±äºsendçš„ç‰¹æ€§, ä¼šå¯¼è‡´å…ˆnext, æ‰€ä»¥ä¸‹é¢åœ¨è®¾ç½®äº†ä¸€ä¸ªåˆå§‹æ ‡å¿—beforeFirstYield, åˆå§‹æ—¶, å…ˆè·å–äº†current if ($this-&gt;beforeFirstYield) &#123; $this-&gt;beforeFirstYield = false; return $this-&gt;coroutine-&gt;current(); &#125; else &#123; // æ³¨æ„: æ‰§è¡Œsendä¹‹åä¼šè¿”å›nextä¹‹åçš„yieldå€¼ $retval = $this-&gt;coroutine-&gt;send(&apos;ç›®å‰è¿˜æ²¡ç”¨åˆ°åŒå‘é€šä¿¡&apos;); return $retval; &#125; &#125; public function isFinished() &#123; return !$this-&gt;coroutine-&gt;valid(); &#125;&#125; å®ç°Schedulerè°ƒåº¦å™¨ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phpclass Scheduler &#123; protected $maxTaskId = 0; protected $taskMap = []; // taskId =&gt; task protected $taskQueue; public function __construct() &#123; $this-&gt;taskQueue = new SplQueue(); &#125; public function newTask(Generator $coroutine) &#123; // ç”Ÿæˆä»»åŠ¡id $tid = ++$this-&gt;maxTaskId; // å°†åç¨‹å‡½æ•°å°åŒ…åˆ°Taskç±»ä¸­ ä½œä¸ºä»»åŠ¡ $task = new Task($tid, $coroutine); // æ”¾å…¥è°ƒåº¦å™¨çš„ä»»åŠ¡æ± ä¸­ $this-&gt;taskMap[$tid] = $task; // å°†ä»»åŠ¡æ”¾å…¥è°ƒåº¦å™¨çš„é˜Ÿåˆ—ä¸­ $this-&gt;schedule($task); return $tid; &#125; public function schedule(Task $task) &#123; $this-&gt;taskQueue-&gt;enqueue($task); &#125; public function run() &#123; while (!$this-&gt;taskQueue-&gt;isEmpty()) &#123; // ä»è°ƒåº¦å™¨é˜Ÿåˆ—ä¸­å¼¹å‡ºä»»åŠ¡, å‡†å¤‡æ‰§è¡Œ $task = $this-&gt;taskQueue-&gt;dequeue(); // æ‰§è¡Œä»»åŠ¡ $task-&gt;run(); // å¦‚æœä»»åŠ¡æ‰§è¡Œå®Œæ¯•, åˆ™ä»è°ƒåº¦å™¨çš„ä»»åŠ¡æ± ä¸­æ¸…é™¤ä»»åŠ¡ if ($task-&gt;isFinished()) &#123; unset($this-&gt;taskMap[$task-&gt;getTaskId()]); &#125; else &#123; // å¦åˆ™, å†æ¬¡å°†å¼¹å‡ºçš„ä»»åŠ¡æ”¾å…¥è°ƒåº¦å™¨çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ $this-&gt;schedule($task); &#125; &#125; &#125;&#125; æµ‹è¯• test.php 12345678910111213141516171819202122&lt;?phprequire_once &apos;Task.php&apos;;require_once &apos;Scheduler.php&apos;;function task1() &#123; for ($i = 1; $i &lt;= 10; ++$i) &#123; echo &quot;This is task 1 iteration $i.\\n&quot;; yield; &#125;&#125;function task2() &#123; for ($i = 1; $i &lt;= 5; ++$i) &#123; echo &quot;This is task 2 iteration $i.\\n&quot;; yield; &#125;&#125;$scheduler = new Scheduler;$scheduler-&gt;newTask(task1());$scheduler-&gt;newTask(task2());$scheduler-&gt;run(); å½“ç„¶, ä¸Šé¢æ˜¯å…·æœ‰ä¸¤ä¸ªç®€å•ä»»åŠ¡(æ²¡ä»€ä¹ˆæ„ä¹‰çš„ä»»åŠ¡)çš„è°ƒåº¦å™¨; ä»»åŠ¡å’Œè°ƒåº¦å™¨ä¹‹é—´çš„é€šä¿¡ ä¸Šé¢å¯ä»¥çœ‹åˆ°, è°ƒåº¦å™¨å·²ç»è¿è¡Œäº†, é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸ªé—®é¢˜: ä»»åŠ¡å’Œè°ƒåº¦å™¨ä¹‹é—´çš„é€šä¿¡; æ¥ä¸‹æ¥å°†æ¨¡æ‹Ÿ è¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œä¼šè¯æ—¶çš„æ–¹å¼ â€“ ç³»ç»Ÿè°ƒç”¨, æ¥åšä»»åŠ¡å’Œè°ƒåº¦å™¨ä¹‹é—´çš„é€šä¿¡æˆ‘ä»¬éœ€è¦ç³»ç»Ÿè°ƒç”¨çš„ç†ç”±æ˜¯æ“ä½œç³»ç»Ÿä¸è¿›ç¨‹ç›¸æ¯”å®ƒå¤„åœ¨ä¸åŒçš„æƒé™çº§åˆ«ä¸Š, å› æ­¤ä¸ºäº†æ‰§è¡Œç‰¹æƒçº§åˆ«çš„æ“ä½œ(å¦‚æ€æ­»å¦ä¸€ä¸ªè¿›ç¨‹), å°±ä¸å¾—ä¸ä»¥æŸç§æ–¹å¼æŠŠæ§åˆ¶ä¼ å›ç»™å†…æ ¸, è¿™æ ·å†…æ ¸å°±å¯ä»¥æ‰§è¡Œæ‰€è¯´çš„æ“ä½œäº†; å†è¯´ä¸€é, è¿™ç§è¡Œä¸ºåœ¨å†…éƒ¨æ˜¯é€šè¿‡ä½¿ç”¨ä¸­æ–­æŒ‡ä»¤æ¥å®ç°çš„. è¿‡å»ä½¿ç”¨çš„æ˜¯é€šç”¨çš„intæŒ‡ä»¤, å¦‚ä»Šä½¿ç”¨çš„æ˜¯æ›´ç‰¹æ®Šå¹¶ä¸”æ›´å¿«é€Ÿçš„syscall/sysenteræŒ‡ä»¤; æˆ‘ä»¬çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿå°†åæ˜ è¿™ç§è®¾è®¡: ä¸æ˜¯ç®€å•åœ°æŠŠè°ƒåº¦å™¨ä¼ é€’ç»™ä»»åŠ¡(è¿™æ ·å°±å…è®¸å®ƒåšå®ƒæƒ³åšçš„ä»»ä½•äº‹), æˆ‘ä»¬å°†é€šè¿‡ç»™yieldè¡¨è¾¾å¼ä¼ é€’ä¿¡æ¯æ¥ä¸ç³»ç»Ÿè°ƒç”¨é€šä¿¡, è¿™å„¿yieldå³æ˜¯ä¸­æ–­, ä¹Ÿæ˜¯ä¼ é€’ä¿¡æ¯ç»™è°ƒåº¦å™¨(å’Œä»è°ƒåº¦å™¨ä¼ é€’å‡ºä¿¡æ¯)çš„æ–¹æ³•; ä¸ºäº†è¯´æ˜ç³»ç»Ÿè°ƒç”¨, æˆ‘ä»¬å¯¹å¯è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨åšä¸€ä¸ªå°å°çš„å°è£…: 1 ~~æœªå®Œå¾…ç»­","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"08. å¹¶è¡Œè¿æ¥, æŒä¹…è¿æ¥","slug":"http/2017-12-06-HTTP-08","date":"2017-12-06T12:10:11.000Z","updated":"2018-05-09T06:26:48.000Z","comments":true,"path":"2017/12/06/http/2017-12-06-HTTP-08/","link":"","permalink":"http://blog.renyimin.com/2017/12/06/http/2017-12-06-HTTP-08/","excerpt":"","text":"å¸¸è¢«è¯¯è§£çš„Connectioné¦–éƒ¨ HTTPå…è®¸åœ¨å®¢æˆ·ç«¯å’Œæœ€ç»ˆçš„æºç«¯æœåŠ¡å™¨ä¹‹é—´å­˜åœ¨ä¸€ä¸²HTTPä¸­é—´å®ä½“(ä»£ç†, é«˜é€Ÿç¼“å­˜ç­‰)ã€‚å¯ä»¥ä»å®¢æˆ·ç«¯å¼€å§‹, é€è·³åœ°å°†HTTPæŠ¥æ–‡ç»è¿‡è¿™äº›ä¸­é—´è®¾å¤‡, è½¬å‘åˆ°æºç«¯æœåŠ¡å™¨ä¸Šå»(æˆ–è€…è¿›è¡Œåå‘ä¼ é€’)ã€‚ HTTPçš„ Connection é¦–éƒ¨å­—æ®µä¸­æœ‰ä¸€ä¸ªç”±,åˆ†éš”çš„è¿æ¥æ ‡ç­¾åˆ—è¡¨; Connectioné¦–éƒ¨å¯ä»¥æ‰¿è½½3ç§ä¸åŒç±»å‹çš„æ ‡ç­¾, å› æ­¤éå¸¸ä»¤äººè´¹è§£: HTTPé¦–éƒ¨å­—æ®µå, åˆ—å‡ºäº†åªä¸æ­¤é“¾æ¥æœ‰å…³çš„é¦–éƒ¨; ä»»æ„æ ‡ç­¾å€¼, ç”¨äºæè¿°æ­¤é“¾æ¥çš„éæ ‡å‡†é€‰é¡¹; close, è¯´æ˜æ“ä½œå®Œæˆä¹‹åéœ€è¦å…³é—­è¿™æ¡æŒä¹…è¿æ¥; å¦‚æœè¿æ¥æ ‡ç­¾ä¸­åŒ…å«äº†ä¸€ä¸ªHTTPé¦–éƒ¨å­—æ®µçš„åç§°, é‚£ä¹ˆè¿™ä¸ªé¦–éƒ¨å­—æ®µå°±åŒ…å«äº†ä¸€äº›è¿æ¥æœ‰å…³çš„ä¿¡æ¯, ä¸èƒ½å°†å…¶è½¬å‘å‡ºå», åœ¨å°†æŠ¥æ–‡è½¬å‘å‡ºå»ä¹‹å‰, å¿…é¡»åˆ é™¤Connectioné¦–éƒ¨åˆ—å‡ºçš„æ‰€æœ‰é¦–éƒ¨å­—æ®µã€‚ ç”±äºConnectioné¦–éƒ¨å¯ä»¥é˜²æ­¢æ— æ„ä¸­å¯¹æœ¬åœ°é¦–éƒ¨çš„è½¬å‘, å› æ­¤å°†é€è·³å­—é¦–éƒ¨åæ”¾å…¥Connectioné¦–éƒ¨è¢«ç§°ä¸ºâ€å¯¹é¦–éƒ¨çš„ä¿æŠ¤â€ã€‚(Connectioné¦–éƒ¨æ˜¯ä¸ªé€è·³é¦–éƒ¨, åªé€‚ç”¨äºå•æ¡ä¼ è¾“é“¾è·¯, ä¸åº”è¯¥æ²¿ç€ä¼ è¾“é“¾è·¯å‘ä¸‹ä¼ è¾“ (å‚è€ƒP101)) å¹¶è¡Œè¿æ¥ åœ¨ä¸²è¡Œè¯·æ±‚æ—¶, æµè§ˆå™¨å¯ä»¥å…ˆå®Œæ•´åœ°è¯·æ±‚åŸå§‹çš„HTMLé¡µé¢, ç„¶åè¯·æ±‚ç¬¬ä¸€ä¸ªåµŒå…¥å¯¹è±¡, ç„¶åè¯·æ±‚ç¬¬äºŒä¸ªåµŒå…¥å¯¹è±¡ç­‰, ä»¥è¿™ç§ç®€å•çš„æ–¹å¼å¯¹æ¯ä¸ªåµŒå…¥å¼å¯¹è±¡è¿›è¡Œä¸²è¡Œå¤„ç†, å¾ˆæ˜æ˜¾è¿™æ ·å¤„ç†å¾ˆæ…¢!! HTTPå…è®¸å®¢æˆ·ç«¯æ‰“å¼€å¤šæ¡è¿æ¥, å¹¶è¡Œåœ°æ‰§è¡Œå¤šä¸ªHTTPäº‹åŠ¡, å¦‚ä¸‹å›¾, å¹¶è¡ŒåŠ è½½äº†å››å¹…åµŒå…¥å¼å›¾ç‰‡, æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰è‡ªå·±çš„TCPè¿æ¥: å¹¶è¡Œè¿æ¥å¯èƒ½ä¼šæé«˜é¡µé¢çš„åŠ è½½é€Ÿåº¦ åŒ…å«åµŒå…¥å¯¹è±¡çš„ç»„åˆé¡µé¢å¦‚æœèƒ½é€šè¿‡å¹¶è¡Œè¿æ¥å…‹æœå•æ¡è¿æ¥çš„ç©ºè½½æ—¶é—´å’Œå¸¦å®½é™åˆ¶, åŠ è½½é€Ÿåº¦ä¹Ÿä¼šæœ‰æ‰€æé«˜ã€‚æ—¶å»¶å¯ä»¥é‡å èµ·æ¥, è€Œä¸”å¦‚æœå•æ¡è¿æ¥æ²¡æœ‰å……åˆ†åˆ©ç”¨å®¢æˆ·ç«¯çš„å› ç‰¹ç½‘å¸¦å®½, å¯ä»¥å°†ä¸ºç”¨å¸¦å®½åˆ†é…æ¥è£…è½½å…¶ä»–å¯¹è±¡ã€‚ å¦‚ä¸‹å›¾, ä¸²è¡Œå’Œå¹¶è¡Œçš„å¯¹æ¯”, å¹¶è¡Œæƒ…å†µä¸‹, å…ˆè£…è½½çš„æ˜¯å°é—­çš„HTMLé¡µé¢, ç„¶åå¹¶è¡Œå¤„ç†å…¶ä½™3ä¸ªäº‹åŠ¡, æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰è‡ªå·±çš„è¿æ¥ã€‚(å›¾ç‰‡çš„è£…è½½æ˜¯å¹¶è¡Œçš„, è¿æ¥çš„æ—¶å»¶ä¹Ÿæ˜¯é‡å çš„) ç”±äºè½¯ä»¶å¼€é”€çš„å­˜åœ¨, æ¯ä¸ªè¿æ¥è¯·æ±‚ä¹‹é—´æ€»ä¼šæœ‰ä¸€äº›å°çš„æ—¶å»¶, ä½†è¿æ¥è¯·æ±‚å’Œä¼ è¾“æ—¶é—´åŸºæœ¬ä¸Šéƒ½æ˜¯é‡å èµ·æ¥çš„! å¹¶è¡Œè¿æ¥ä¸ä¸€å®šæ›´å¿« å³ä½¿å¹¶è¡Œè¿æ¥çš„é€Ÿåº¦å¯èƒ½ä¼šæ›´å¿«, ä½†æ˜¯å¹¶ä¸ä¸€å®šæ€»æ˜¯æ›´å¿« å› ä¸ºåœ¨å®¢æˆ·ç«¯çš„ç½‘ç»œå¸¦å®½å¦‚æœä¸è¶³æ—¶, å¤§éƒ¨åˆ†çš„æ—¶é—´å¯èƒ½éƒ½æ˜¯ç”¨æ¥ä¼ é€æ•°æ®çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, ä¸€ä¸ªè¿æ¥åˆ°é€Ÿåº¦è¾ƒå¿«æœåŠ¡å™¨ä¸Šçš„HTTPäº‹åŠ¡å°±ä¼šå¾ˆå®¹æ˜“è€—å°½æ‰€æœ‰å¯ç”¨çš„Modemå¸¦å®½ã€‚ å¦‚æœå¹¶è¡ŒåŠ è½½å¤šä¸ªå¯¹è±¡, æ¯ä¸ªå¯¹è±¡éƒ½ä¼šå»ç«äº‰è¿™æœ‰é™çš„å¸¦å®½, æ¯ä¸ªå¯¹è±¡éƒ½ä¼šä»¥è¾ƒæ…¢çš„é€Ÿåº¦æŒ‰æ¯”ä¾‹åŠ è½½, è¿™æ ·å¸¦æ¥çš„æ€§èƒ½æå‡å°±å¾ˆå°, ç”šè‡³æ²¡ä»€ä¹ˆæå‡ã€‚ è€Œä¸”æ‰“å¼€å¤§é‡è¿æ¥ä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜èµ„æº, ä»è€Œå¼•å‘è‡ªèº«æ€§èƒ½é—®é¢˜ã€‚ å¤æ‚çš„Webæœ‰å¯èƒ½ä¼šæœ‰æ•°åæˆ–æ•°ç™¾ä¸ªå†…åµŒå¯¹è±¡, å®¢æˆ·ç«¯å¯èƒ½å¯ä»¥æ‰“å¼€æ•°ç™¾ä¸ªè¿æ¥, ä½†WebæœåŠ¡å™¨é€šå¸¸è¦åŒæ—¶å¤„ç†å¾ˆå¤šå…¶ä»–ç”¨æˆ·çš„è¯·æ±‚, æ‰€ä»¥å¾ˆå°‘æœ‰WebæœåŠ¡å™¨å¸Œæœ›å‡ºç°è¿™æ ·çš„æƒ…å†µã€‚ ä¸€ç™¾ä¸ªç”¨æˆ·åŒæ—¶å‘å‡ºç”³è¯·, æ¯ä¸ªç”¨æˆ·æ‰“å¼€100ä¸ªè¿æ¥, æœåŠ¡å™¨å°±è¦è´Ÿè´£å¤„ç†1Wä¸ªè¿æ¥, è¿™ä¼šé€ æˆæœåŠ¡å™¨æ€§èƒ½çš„ä¸¥é‡ä¸‹é™ã€‚å¯¹é«˜è´Ÿè·çš„ä»£ç†æ¥è¯´ä¹ŸåŒæ ·å¦‚æ­¤ã€‚ å®é™…ä¸Š, æµè§ˆå™¨ç¡®å®ä½¿ç”¨äº†å¹¶è¡Œè¿æ¥, ä½†å®ƒä»¬ä¼šå°†å¹¶è¡Œè¿æ¥çš„æ€»æ•°é™åˆ¶ä¸ºä¸€ä¸ªè¾ƒå°çš„å€¼(é€šå¸¸æ˜¯å››ä¸ª)ã€‚æœåŠ¡å™¨å¯ä»¥éšæ„å…³é—­æ¥è‡ªç‰¹å®šå®¢æˆ·ç«¯çš„è¶…é‡è¿æ¥ã€‚ å¹¶è¡Œè¿æ¥å¯èƒ½è®©äººâ€æ„Ÿè§‰â€æ›´å¿«ä¸€äº›é€šè¿‡ä¸Šé¢çš„ä»‹ç», æˆ‘ä»¬çŸ¥é“å¹¶è¡Œè¿æ¥å¹¶ä¸æ€»æ˜¯èƒ½ä½¿é¡µé¢åŠ è½½æ›´å¿«, ä½†å³ä½¿å®é™…ä¸Šæ²¡æœ‰åŠ å¿«é¡µé¢çš„ä¼ è¾“é€Ÿåº¦, å¹¶è¡Œè¿æ¥é€šå¸¸ä¹Ÿä¼šè®©ç”¨æˆ·è§‰å¾—é¡µé¢åŠ è½½çš„æ›´å¿«äº†,å› ä¸ºå¤šä¸ªç»„ä»¶å¯¹è±¡åŒæ—¶å‡ºç°å±å¹•ä¸Šæ—¶, ç”¨æˆ·èƒ½å¤Ÿçœ‹åˆ°åŠ è½½çš„è¿›å±•ã€‚å¦‚æœæ•´ä¸ªå±å¹•ä¸Šæœ‰å¾ˆå¤šåŠ¨ä½œåœ¨è¿›è¡Œ, å³ä½¿å®é™…ä¸Šæ•´ä¸ªé¡µé¢çš„ä¸‹è½½æ—¶é—´æ›´é•¿, ç”¨æˆ·ä¹Ÿä¼šè®¤ä¸ºWebé¡µé¢åŠ è½½å¾—æ›´å¿«ä¸€äº›ã€‚ æŒä¹…è¿æ¥ HTTP/1.1(ä»¥åŠHTTP/1.0çš„å„ç§å¢å¼ºç‰ˆæœ¬)å…è®¸HTTPè®¾å¤‡åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åå°†TCPè¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€, ä»¥ä¾¿æœªæ¥çš„HTTPè¯·æ±‚èƒ½å¤Ÿé‡ç”¨ç°å­˜çš„è¿æ¥ã€‚åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åä»ç„¶ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€çš„TCPè¿æ¥è¢«ç§°ä¸ºæŒä¹…è¿æ¥ã€‚ éæŒä¹…è¿æ¥ä¼šåœ¨æ¯ä¸ªäº‹åŠ¡ç»“æŸä¹‹åå…³é—­, æŒä¹…è¿æ¥ä¼šåœ¨ä¸åŒäº‹åŠ¡ä¹‹é—´ä¿æŒæ‰“å¼€çŠ¶æ€, ç›´åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å…¶å†³å®šå°†å…¶å…³é—­ä¸ºæ­¢ã€‚ é‡ç”¨å·²å¯¹ç›®æ ‡æœåŠ¡å™¨æ‰“å¼€çš„ç©ºé—²æŒä¹…è¿æ¥, å°±å¯ä»¥é¿å¼€ç¼“æ…¢çš„è¿æ¥å»ºç«‹é˜¶æ®µã€‚è€Œä¸”å·²ç»æ‰“å¼€çš„è¿æ¥è¿˜å¯ä»¥é¿å…æ…¢å¯åŠ¨çš„æ‹¥å¡ä½¿ç”¨é˜¶æ®µ, ä»¥ä¾¿æ›´å¿«é€Ÿåœ°è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚ æŒä¹…è¿æ¥å’Œå¹¶è¡Œè¿æ¥ ä¹‹å‰å·²ç»äº†è§£è¿‡â€å¹¶è¡Œè¿æ¥å¯ä»¥æé«˜å¤åˆé¡µé¢çš„ä¼ è¾“é€Ÿåº¦, ä½†å¹¶è¡Œè¿æ¥ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹â€;è€ŒæŒä¹…è¿æ¥æœ‰ä¸€äº›æ¯”å¹¶è¡Œè¿æ¥æ›´å¥½çš„åœ°æ–¹,æŒä¹…è¿æ¥é™ä½äº†æ—¶å»¶å’Œè¿æ¥å»ºç«‹çš„å¼€é”€, å°†è¿æ¥ä¿æŒåœ¨å·²è°ƒè°çŠ¶æ€, è€Œä¸”å‡å°‘äº†æ‰“å¼€è¿æ¥çš„æ½œåœ¨æ•°é‡ã€‚ä½†æ˜¯, ç®¡ç†æŒä¹…è¿æ¥æ—¶è¦ç‰¹åˆ«å°å¿ƒ, ä¸ç„¶å°±ä¼šç§¯ç´¯å¤§é‡çš„ç©ºé—²è¿æ¥, è€—è´¹æœ¬åœ°ä»¥åŠè¿œç¨‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šçš„èµ„æºã€‚ æŒä¹…è¿æ¥ä¸å¹¶è¡Œè¿æ¥é…åˆä½¿ç”¨å¯èƒ½æ˜¯æ›´é«˜æ•ˆçš„æ–¹å¼ã€‚ç°åœ¨, å¾ˆå¤šWebåº”ç”¨ç¨‹åºéƒ½ä¼šæ‰“å¼€å°‘é‡çš„å¹¶è¡Œè¿æ¥, å…¶ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯æŒä¹…è¿æ¥ã€‚ æŒä¹…è¿æ¥æœ‰ä¸¤ç§ç±»å‹: æ¯”è¾ƒè€çš„ HTTP/1.0+&quot;keep-alive&quot; è¿æ¥, ä»¥åŠç°ä»£çš„ HTTP/1.1 &quot;persistent&quot; è¿æ¥ã€‚ HTTP/1.0+keep-aliveè¿æ¥ å‰è¨€:å¤§çº¦ä»1996å¹´å¼€å§‹, å¾ˆå¤šHTTP/1.0æµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½è¿›è¡Œäº†æ‰©å±•, ä»¥æ”¯æŒä¸€ç§è¢«ç§°ä¸ºkeep-aliveè¿æ¥çš„æ—©æœŸå®éªŒå‹æŒä¹…è¿æ¥ã€‚è¿™äº›æ—©æœŸçš„æŒä¹…è¿æ¥æ”¶åˆ°äº†ä¸€äº›äº’æ“ä½œæ€§è®¾è®¡æ–¹é¢é—®é¢˜çš„å›°æ‰°, è¿™äº›é—®é¢˜åœ¨åæœŸçš„HTTP/1.1ç‰ˆæœ¬ä¸­éƒ½å¾—åˆ°äº†ä¿®æ­£, ä½†å¾ˆå¤šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»ç„¶åœ¨ä½¿ç”¨è¿™äº›æ—©æœŸçš„keep-aliveè¿æ¥ã€‚ ä¸‹å›¾åœ¨â€ä¸²è¡Œè¿æ¥ä¸Šå®ç°äº†4ä¸ªHTTPäº‹åŠ¡çš„æ—¶é—´çº¿â€ ä¸ â€œåœ¨ä¸€æ¡æŒä¹…è¿æ¥ä¸Šå®ç°åŒæ ·äº‹åŠ¡â€ æ‰€éœ€çš„æ—¶é—´çº¿è¿›è¡Œäº†æ¯”è¾ƒ, æ˜¾ç¤ºäº†keep-aliveè¿æ¥çš„ä¸€äº›æ€§èƒ½ä¼˜ç‚¹ ç”±äºå»é™¤äº†åˆ›å»ºè¿æ¥å’Œå…³é—­è¿æ¥çš„å¼€é”€, æ‰€ä»¥æ—¶é—´çº¿æœ‰æ‰€ç¼©å‡ Keep-Aliveæ“ä½œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¦é…åˆ keep-aliveå·²ç»ä¸å†ä½¿ç”¨äº†, è€Œä¸”åœ¨å½“å‰çš„HTTP/1.1è§„èŒƒä¸­ä¹Ÿå·²ç»æ²¡æœ‰äº†å¯¹å®ƒçš„è¯´æ˜äº†ã€‚ä½†æµè§ˆå™¨å’ŒæœåŠ¡å™¨å¯¹keep-aliveæ¡æ‰‹çš„ä½¿ç”¨ä»ç„¶ç›¸å½“å¹¿æ³›, å› æ­¤HTTPçš„å®ç°è€…åº”è¯¥åšå¥½ä¸ä¹‹è¿›è¡Œäº¤äº’æ“ä½œçš„å‡†å¤‡. å®ç°HTTP/1.0 keep aliveè¿æ¥çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åŒ…å«Connection: Keep-Aliveé¦–éƒ¨è¯·æ±‚å°†ä¸€æ¡è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ å¦‚æœæœåŠ¡å™¨æ„¿æ„ä¸ºä¸‹ä¸€æ¡è¯·æ±‚å°†è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€, å°±åœ¨å“åº”ä¸­åŒ…å«ç›¸åŒçš„é¦–éƒ¨ã€‚å¦‚æœå“åº”ä¸­æ²¡æœ‰Connection: Keep-Aliveé¦–éƒ¨, å®¢æˆ·ç«¯å°±è®¤ä¸ºæœåŠ¡å™¨ä¸æ”¯æŒkeep-alive, ä¼šåœ¨å‘å›å“åº”æŠ¥æ–‡ä¹‹åå…³é—­è¿æ¥ã€‚ è¿˜æœ‰keep-aliveé¦–éƒ¨ æ³¨æ„, keep-Aliveé¦–éƒ¨åªæ˜¯è¯·æ±‚å°†è¿æ¥ä¿æŒåœ¨æ´»è·ƒçŠ¶æ€ã€‚å‘å‡ºkeep-aliveè¯·æ±‚ä¹‹å, å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¹¶ä¸ä¸€å®šä¼šåŒæ„è¿›è¡Œkeep-aliveä¼šè¯ã€‚ å®ƒä»¬å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­ç©ºé—²çš„keep-aliveè¿æ¥, å¹¶å¯éšæ„é™åˆ¶keep-aliveè¿æ¥æ‰€å¤„ç†äº‹åŠ¡çš„æ•°é‡ã€‚ å¯ä»¥ç”¨Keep-Aliveé€šç”¨é¦–éƒ¨å­—æ®µä¸­æŒ‡å®šçš„, æœ‰é€—å·åˆ†éš”çš„é€‰é¡¹æ¥è°ƒèŠ‚keep-aliveçš„è¡Œä¸º: å‚æ•°timeout: æ˜¯åœ¨Keep-Aliveå“åº”é¦–éƒ¨å‘é€çš„, å®ƒä¼°è®¡äº†æœåŠ¡å™¨å¸Œæœ›å°†è¿æ¥ä¿æŒåœ¨æ´»è·ƒçŠ¶æ€çš„æ—¶é—´ã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ‰¿è¯ºå€¼ã€‚ å‚æ•°max: æ˜¯åœ¨Keep-Aliveå“åº”é¦–éƒ¨å‘é€çš„, å®ƒä¼°è®¡äº†æœåŠ¡å™¨è¿˜å¸Œæœ›ä¸ºå¤šå°‘ä¸ªäº‹åŠ¡ä¿æŒæ­¤è¿æ¥çš„æ´»è·ƒçŠ¶æ€ã€‚è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ‰¿è¯ºå€¼ã€‚ Keep-Aliveé¦–éƒ¨è¿˜å¯ä»¥æ”¯æŒä»»æ„æœªç»å¤„ç†çš„å±æ€§, è¿™äº›å±æ€§ä¸»è¦ç”¨äºè¯Šæ–­å’Œè°ƒè¯•ã€‚è¯­æ³•ä¸º name [=value]ã€‚ Keep-Aliveé¦–éƒ¨å®Œå…¨æ˜¯å¯é€‰çš„, ä½†åªæœ‰åœ¨æä¾›äº† Connection:Keep-Alive æ—¶æ‰èƒ½ä½¿ç”¨å®ƒã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­è¯´æ˜æœåŠ¡å™¨æœ€å¤šè¿˜ä¼šä¸ºå¦å¤–5ä¸ªäº‹åŠ¡ä¿æŒè¿æ¥çš„æ‰“å¼€çŠ¶æ€, æˆ–è€…å°†æ‰“å¼€çŠ¶æ€ä¿æŒåˆ°è¿æ¥ç©ºé—²äº†2åˆ†é’Ÿä¹‹åã€‚ 12Connection: Keep-AliveKeep-Alive: max=5, timeout=120 keep-aliveè¿æ¥çš„é™åˆ¶å’Œè§„åˆ™ åœ¨HTTP/1.0ä¸­, keep-aliveå¹¶ä¸æ˜¯é»˜è®¤ä½¿ç”¨çš„ã€‚å®¢æˆ·ç«¯å¿…é¡»å‘é€ä¸€ä¸ª Connection: Keep-Alive è¯·æ±‚é¦–éƒ¨æ¥æ¿€æ´»keep-aliveè¿æ¥ã€‚ Connection: Keep-Alive é¦–éƒ¨å¿…é¡»éšæ‰€æœ‰å¸Œæœ›ä¿æŒæŒä¹…è¿æ¥çš„æŠ¥æ–‡ä¸€èµ·å‘é€ã€‚ å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰å‘é€Connection: Keep-Aliveé¦–éƒ¨, æœåŠ¡å™¨å°±ä¼šåœ¨é‚£æ¡è¯·æ±‚ä¹‹åå…³é—­è¿æ¥ã€‚ å®¢æˆ·ç«¯å¦‚æœæ¢æ˜å“åº”ä¸­æ²¡æœ‰Connection: Keep-Aliveå“åº”é¦–éƒ¨, å°±å¯ä»¥çŸ¥é“æœåŠ¡å™¨å‘å‡ºå“åº”ä¹‹åæ˜¯å¦ä¼šå…³é—­è¿æ¥äº†ã€‚ ä¸€èˆ¬éƒ½æ˜¯åœ¨æ£€æµ‹åˆ°è¿æ¥å…³é—­ä¹‹å, å°±å¯ä»¥ç¡®å®šæŠ¥æ–‡å®ä½“ä¸»ä½“éƒ¨åˆ†çš„é•¿åº¦ã€‚å¦‚æœæƒ³â€æ— éœ€æ£€æµ‹åˆ°è¿æ¥å…³é—­ å°±èƒ½ç¡®å®šæŠ¥æ–‡å®ä½“ä¸»ä½“éƒ¨åˆ†çš„é•¿åº¦â€, é‚£ä½ çš„å“åº”æŠ¥æ–‡çš„å®ä½“ä¸»ä½“éƒ¨åˆ†å¿…é¡»æœ‰æ­£ç¡®çš„Connect-Length, æœ‰å¤šéƒ¨ä»¶åª’ä½“ç±»å‹, æˆ–è€…ç”¨åˆ†å—ä¼ è¾“ç¼–ç çš„æ–¹å¼è¿›è¡Œäº†ç¼–ç ã€‚ åœ¨ä¸€æ¡keep-aliveä¿¡é“ä¸­å›é€é”™è¯¯çš„ Connection-Length æ˜¯å¾ˆç³Ÿç³•çš„äº‹, è¿™æ ·çš„è¯, äº‹åŠ¡å¤„ç†çš„å¦ä¸€ç«¯å°±æ— æ³•ç²¾ç¡®åœ°æ£€æµ‹å‡ºä¸€æ¡æŠ¥æ–‡çš„ç»“æŸå’Œå¦ä¸€æ¡æŠ¥æ–‡çš„å¼€å§‹äº†ã€‚ ä»£ç†å’Œç½‘å…³å¿…é¡»æ‰§è¡ŒConnectioné¦–éƒ¨çš„è§„åˆ™, ä»£ç†æˆ–ç½‘å…³å¿…é¡»åœ¨å°†æŠ¥æ–‡è½¬å‘å‡ºå»æˆ–å°†å…¶é«˜é€Ÿç¼“å­˜ä¹‹å‰, åˆ é™¤åœ¨Connectioné¦–éƒ¨ä¸­å‘½åçš„æ‰€æœ‰é¦–éƒ¨å­—æ®µä»¥åŠConnectioné¦–éƒ¨æœ¬èº«ã€‚ ä¸¥æ ¼æ¥è¯´, ä¸åº”è¯¥ä¸æ— æ³•ç¡®å®šæ˜¯å¦æ”¯æŒConnectioné¦–éƒ¨çš„ä»£ç†æœåŠ¡å™¨å»ºç«‹keep-aliveè¿æ¥, ä»¥é˜²æ­¢å‡ºç°ä¸‹é¢è¦ä»‹ç»çš„å“‘ä»£ç†é—®é¢˜, åœ¨å®é™…åº”ç”¨ä¸­ä¸æ˜¯æ€»èƒ½åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚ ä»æŠ€æœ¯ä¸Šæ¥è®², åº”è¯¥å¿½ç•¥æ‰€æœ‰æ¥è‡ªHTTP/1.0è®¾å¤‡çš„Connectioné¦–éƒ¨å­—æ®µ(åŒ…æ‹¬Connection:Keep-Alive), å› ä¸ºä»–ä»¬å¯èƒ½æ˜¯ç”±æ¯”è¾ƒè€çš„ä»£ç†æœåŠ¡å™¨è¯¯è½¬å‘çš„ã€‚ä½†æ˜¯å®é™…ä¸Š, å°½ç®¡å¯èƒ½ä¼šæœ‰åœ¨è€ä»£ç†ä¸ŠæŒ‚èµ·çš„å±é™©, æœ‰äº›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿˜æ˜¯ä¼šè¿åè¿™æ¡è§„åˆ™ã€‚ é™¤éé‡å¤å‘é€è¯·æ±‚ä¼šäº§ç”Ÿå…¶ä»–å‰¯ä½œç”¨, å¦åˆ™ â€œå¦‚æœåœ¨å®¢æˆ·ç«¯å—åˆ°å®Œæ•´å“åº”ä¹‹å‰è¿æ¥å°±å…³é—­äº†, é‚£ä¹ˆå®¢æˆ·ç«¯ä¸€å®šè¦åšå¥½é‡è¯•è¯·æ±‚çš„å‡†å¤‡â€ã€‚ Keep-Aliveå’Œå“‘ä»£ç† æ­£å¸¸æƒ…å†µä¸‹, å¦‚æœå®¢æˆ·ç«¯ä¸ä¸€å°æœåŠ¡å™¨å¯¹è¯, å®¢æˆ·ç«¯å¯ä»¥å‘é€ä¸€ä¸ª Connection:Keep-Alive é¦–éƒ¨æ¥å‘ŠçŸ¥æœåŠ¡å™¨å®ƒå¸Œæœ›ä¿æŒè¿æ¥çš„æ´»è·ƒçŠ¶æ€, å¦‚æœæœåŠ¡å™¨æ”¯æŒkeep-alive, å°±å›é€ä¸€ä¸ª Connection:Keep-Alive é¦–éƒ¨, å¦åˆ™å°±ä¸å›é€ã€‚ é—®é¢˜æ˜¯å‡ºåœ¨ä»£ç†ä¸Š â€” å°¤å…¶æ˜¯é‚£äº›ä¸ç†è§£Connectioné¦–éƒ¨, è€Œä¸”ä¸çŸ¥é“åœ¨æ²¿ç€è½¬å‘é“¾è·¯å°†æŠ¥æ–‡è½¬å‘å‡ºå»ä¹‹å‰åº”è¯¥å°†Connectioné¦–éƒ¨åˆ é™¤çš„ä»£ç†ã€‚ å¾ˆå¤šè€å¼æˆ–ç®€å•çš„ä»£ç†éƒ½æ˜¯ç›²ä¸­ç»§(blind relay), ä»–ä»¬åªæ˜¯å°†å­—èŠ‚ä»ä¸€ä¸ªè¿æ¥è½¬å‘åˆ°ä¸¤ä¸€ä¸ªè¿æ¥ä¸­å», ä¸å¯¹Connectioné¦–éƒ¨è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚ ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªWebå®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ªä½œä¸ºç›²ä¸­ç»§ä½¿ç”¨çš„å“‘ä»£ç†ä¸WebæœåŠ¡å™¨è¿›è¡Œå¯¹è¯çš„ä¾‹å­: æ›´å¤šå‚è€ƒ: P101 ç›²ä¸­ç»§çš„æ›´å¤šé—®é¢˜å‚è€ƒ 4.5.7 (??) ä¸ºäº†é˜²æ­¢æ­¤ç±»ä»£ç†é€šä¿¡é—®é¢˜çš„å‘ç”Ÿ, ç°åœ¨çš„ä»£ç†éƒ½å†³ä¸èƒ½è½¬å‘Connectioné¦–éƒ¨å’Œæ‰€æœ‰åå­—å‡ºç°åœ¨Connectionå€¼ä¸­çš„é¦–éƒ¨ã€‚ å¦å¤–è¿˜æœ‰å‡ ä¸ªä¸èƒ½ä½œä¸ºConnectioné¦–éƒ¨çš„å€¼, å¹¶ä¸”ä¹Ÿä¸èƒ½è¢«ä»£ç†è½¬å‘æˆ–ä½œä¸ºç¼“å­˜å“åº”ä½¿ç”¨çš„é¦–éƒ¨: Proxy-Authenticate, Proxy-Connection, Transfer-Encoding å’Œ Upgrade; HTTP/1.1 persistentè¿æ¥ HTTP/1.1ä¸»é”®åœæ­¢äº†å¯¹keep-aliveè¿æ¥çš„æ”¯æŒ, ç”¨ä¸€ç§åä¸ºæŒä¹…è¿æ¥(persistent connection)çš„æ”¹è¿›å‹è®¾è®¡å–ä»£äº†å®ƒã€‚ æŒä¹…è¿æ¥çš„ç›®çš„ä¸keep-aliveè¿æ¥çš„ç›®çš„ç›¸åŒ, ä½†æœºåˆ¶æ›´ä¼˜ä¸€äº›ã€‚ ä¸HTTP/1.0çš„keep-aliveè¿æ¥ä¸åŒ, HTTP/1.1æŒä¹…è¿æ¥åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ¿€æ´»çš„ã€‚é™¤éç‰¹åˆ«æŒ‡æ˜, å¦åˆ™HTTP/1.1å‡å®šæ‰€æœ‰è¿æ¥éƒ½æ˜¯æŒä¹…çš„ã€‚ è¦åœ¨äº‹åŠ¡å¤„ç†ç»“æŸä¹‹åå°†è¿æ¥å…³é—­, HTTP/1.1åº”ç”¨ç¨‹åºå¿…é¡»å‘æŠ¥æ–‡ä¸­æ˜¾ç¤ºåœ°æ·»åŠ ä¸€ä¸ªConnection:closeé¦–éƒ¨ã€‚ è¿™æ˜¯ä¸ä»¥å‰çš„HTTPåè®®å¾ˆé‡è¦çš„åŒºåˆ«, åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­, keep-aliveè¿æ¥è¦ä¹ˆæ˜¯å¯é€‰çš„, è¦ä¹ˆæ ¹æœ¬å°±ä¸æ”¯æŒã€‚ HTTP/1.1å®¢æˆ·ç«¯å‡å®šåœ¨æ”¶åˆ°å“åº”å, é™¤éå“åº”ä¸­åŒ…å«äº† Connection:closeé¦–éƒ¨, ä¸ç„¶HTTP/1.1è¿æ¥å°±ä»ç»´æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ ä½†æ˜¯, å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»ç„¶å¯ä»¥éšæ—¶å…³é—­ç©ºé—²çš„è¿æ¥ã€‚ ä¸å‘é€ Connection:close å¹¶ä¸ä»¥ä¸ºè¿™æœåŠ¡å™¨æ‰¿è¯ºæ°¸è¿œå°†è¿æ¥ä¿æŒåœ¨æ‰“å¼€çŠ¶æ€ã€‚ persistentè¿æ¥çš„é™åˆ¶å’Œè§„åˆ™ (??) å‘é€äº† Connection:close è¯·æ±‚é¦–éƒ¨ä¹‹å, å®¢æˆ·ç«¯å°±æ— æ³•åœ¨é‚£æ¡è¿æ¥ä¸Šå‘é€æ›´å¤šçš„è¯·æ±‚äº†ã€‚ å¦‚æœå®¢æˆ·ç«¯ä¸æƒ³åœ¨è¿æ¥ä¸Šå‘é€å…¶ä»–è¯·æ±‚äº†, å°±åº”è¯¥åœ¨æœ€åä¸€æ¡è¯·æ±‚ä¸­å‘é€ä¸€ä¸ª Connection:close è¯·æ±‚é¦–éƒ¨ã€‚ åªæœ‰å½“è¿æ¥ä¸Šæ‰€æœ‰çš„æŠ¥æ–‡éƒ½æœ‰æ­£ç¡®çš„, è‡ªå®šä¹‰æŠ¥æ–‡é•¿åº¦æ—¶ â€“ ä¹Ÿå°±æ˜¯, å®ä½“ä¸»ä½“éƒ¨åˆ†çš„é•¿åº¦éƒ½å’Œå“åº” Connect-Length ä¸€è‡´, æˆ–è€…æ˜¯ç”¨åˆ†å—ä¼ è¾“ç¼–ç æ–¹å¼ç¼–ç çš„ â€” è¿æ¥æ‰èƒ½æŒä¹…ä¿æŒã€‚ HTTP/1.1çš„ä»£ç†å¿…é¡»èƒ½å¤Ÿåˆ†åˆ«ç®¡ç†ä¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æŒä¹…è¿æ¥ â€” æ¯ä¸ªæŒä¹…è¿æ¥éƒ½å€¼é€‚ç”¨äºä¸€è·³ä¼ è¾“ã€‚ (ç”±äºè¾ƒè€çš„ä»£ç†ä¼šè½¬å‘Connectioné¦–éƒ¨, æ‰€ä»¥)HTTP/1.1çš„ä»£ç†æœåŠ¡å™¨ä¸åº”è¯¥ä¸HTTP/1.0å®¢æˆ·ç«¯å»ºç«‹æŒä¹…è¿æ¥, é™¤éä»–ä»¬äº†è§£å®¢æˆ·ç«¯çš„å¤„ç†èƒ½åŠ›ã€‚ å®é™…ä¸Š, è¿™ä¸€ç‚¹æ˜¯å¾ˆéš¾åšåˆ°çš„, å¾ˆå¤šå‚å•†éƒ½è¿èƒŒäº†è¿™ä¸€åŸåˆ™ã€‚ å°½ç®¡æœåŠ¡å™¨ä¸åº”è¯¥è¯•å›¾åœ¨ä¼ è¾“æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­å…³é—­è¿æ¥, è€Œä¸”åœ¨å…³é—­è¿æ¥ä¹‹å‰è‡³å°‘åº”è¯¥å“åº”ä¸€æ¡è¯·æ±‚, ä½†ä¸ç®¡Connectioné¦–éƒ¨å–äº†ä»€ä¹ˆå€¼, HTTP/1.1è®¾å¤‡éƒ½å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­è¿æ¥ã€‚ HTTP/1.1åº”ç”¨ç¨‹åºå¿…é¡»èƒ½å¤Ÿä»å¼‚æ­¥çš„å…³é—­ä¸­æ¢å¤å‡ºæ¥, åªè¦ä¸å­˜åœ¨å¯èƒ½ä¼šç´¯ç§¯èµ·æ¥çš„å‰¯ä½œç”¨, å®¢æˆ·ç«¯éƒ½åº”è¯¥é‡è¯•è¿™æ¡è¯·æ±‚ã€‚(??) é™¤éé‡å¤å‘é€è¯·æ±‚ä¼šäº§ç”Ÿå…¶ä»–å‰¯ä½œç”¨, å¦åˆ™ â€œå¦‚æœåœ¨å®¢æˆ·ç«¯æ”¶åˆ°å®Œæ•´å“åº”ä¹‹å‰è¿æ¥å°±å…³é—­äº†, é‚£ä¹ˆå®¢æˆ·ç«¯å¿…é¡»è¦é‡æ–°å‘é€è¯·æ±‚â€ ä¸€ä¸ªç”¨æˆ·å®¢æˆ·ç«¯å¯¹ä»»ä½•æœåŠ¡å™¨æˆ–ä»£ç†, æœ€å¤šåªèƒ½ç»´æŠ¤ä¸¤æ¡æŒä¹…è¿æ¥, ä»¥é˜²æœåŠ¡å™¨è¿‡è½½ã€‚ ä»£ç†å¯èƒ½éœ€è¦æ›´å¤šåˆ°æœåŠ¡å™¨çš„è¿æ¥æ¥æ”¯æŒå¹¶å‘ç”¨æˆ·çš„é€šä¿¡, æ‰€ä»¥å¦‚æœæœ‰Nä¸ªç”¨æˆ·è¯•å›¾è®¿é—®æœåŠ¡å™¨çš„è¯, ä»£ç†æœ€å¤šè¦ç»´æŒ2Næ¡åˆ°ä»»æ„æœåŠ¡å™¨æˆ–çˆ¶ä»£ç†çš„è¿æ¥ã€‚ ç®¡é“åŒ–è¿æ¥ HTTP/1.1å…è®¸åœ¨æŒä¹…è¿æ¥ä¸Šå¯é€‰åœ°ä¼šç”¨è¯·æ±‚ç®¡é“ã€‚è¿™æ˜¯åœ¨keep-aliveè¿æ¥ä¸Šçš„è¿›ä¸€æ­¥æ€§èƒ½ä¼˜åŒ–ã€‚åœ¨ç›¸åº”åˆ°è¾¾ä¹‹å‰, å¯ä»¥å°†å¤šæ¡è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ã€‚ å½“ç¬¬ä¸€æ¡è¯·æ±‚é€šè¿‡ç½‘ç»œæµå‘åœ°çƒå¦ä¸€ç«¯çš„æœåŠ¡å™¨æ—¶, ç¬¬äºŒæ¡å’Œç¬¬ä¸‰æ¡ä¹Ÿå¯ä»¥å¼€å§‹å‘é€äº†ã€‚ åœ¨é«˜æ—¶å»¶ç½‘ç»œæ¡ä»¶ä¸‹, è¿™æ ·åšå¯ä»¥é™ä½ç½‘ç»œçš„å›ç¯æ—¶é—´, æé«˜æ€§èƒ½ã€‚ å¦‚ä¸‹å›¾: å¯¹ç®¡é“åŒ–è¿æ¥çš„é™åˆ¶ å¦‚æœHTTPå®¢æˆ·ç«¯æ— æ³•ç¡®è®¤è¿æ¥æ˜¯æŒä¹…çš„, å°±ä¸åº”è¯¥ä½¿ç”¨ç®¡é“ã€‚ å¿…é¡»æŒ‰ç…§ä¸è¯·æ±‚ç›¸åŒçš„é¡ºåºå›é€HTTPå“åº”ã€‚HTTPæŠ¥æ–‡ä¸­æ²¡æœ‰åºåˆ—å·æ ‡ç­¾, å› æ­¤å¦‚æœæ”¶åˆ°çš„å“åº”å¤±åºäº†, å°±æ²¡åŠæ³•å°†å…¶ä¸è¯·æ±‚åŒ¹é…èµ·æ¥äº†ã€‚ HTTPå®¢æˆ·ç«¯å¿…é¡»åšå¥½è¿æ¥ä¼šåœ¨ä»»æ„æ—¶åˆ»å…³é—­çš„å‡†å¤‡, è¿˜è¦å‡†å¤‡å¥½é‡å‘æ‰€æœ‰æœªå®Œæˆçš„ç®¡é“åŒ–è¯·æ±‚ã€‚ å¦‚æœå®¢æˆ·ç«¯æ‰“å¼€äº†ä¸€æ¡æŒä¹…è¿æ¥, å¹¶ç«‹å³å‘å‡ºäº†10æ¡è¯·æ±‚, æœåŠ¡å™¨å¯èƒ½åœ¨åªå¤„ç†äº†5æ¡è¯·æ±‚åå…³é—­äº†è¿æ¥, å‰©ä¸‹çš„5æ¡è¯·æ±‚ä¼šå¤±è´¥, å®¢æˆ·ç«¯å¿…é¡»èƒ½å¤Ÿåº”å¯¹è¿™äº›è¿‡æ—©å…³é—­è¿æ¥çš„æƒ…å†µ, é‡æ–°å‘å‡ºè¿™äº›è¯·æ±‚ã€‚ HTTPå®¢æˆ·ç«¯ä¸åº”è¯¥ç”¨ç®¡é“åŒ–çš„æ–¹å¼å‘é€å›äº§ç”Ÿå‰¯ä½œç”¨çš„è¯·æ±‚(æ¯”å¦‚POST)ã€‚ æ€»ä¹‹, å‡ºé”™çš„æ—¶å€™, ç®¡é“åŒ–æ–¹å¼ä¼šé˜»å¡å®¢æˆ·ç«¯äº†è§£æœåŠ¡å™¨æ‰§è¡Œçš„æ˜¯ä¸€ç³»åˆ—ç®¡é“åŒ–è¯·æ±‚ä¸­çš„å“ªä¸€äº›ã€‚ç”±äºæ— æ³•å®‰å…¨åœ°é‡è¯•POSTè¿™æ ·çš„éå¹‚ç­‰è¯·æ±‚, æ‰€ä»¥å‡ºé”™æ—¶, å°±å­˜åœ¨æŸäº›æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œçš„é£é™©ã€‚ å…³é—­è¿æ¥â€œä»»æ„â€è§£é™¤è¿æ¥æ‰€æœ‰HTTPå®¢æˆ·ç«¯, æœåŠ¡å™¨æˆ–ä»£ç†éƒ½å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­ä¸€æ¡TCPä¼ è¾“è¿æ¥, é€šå¸¸ä¼šåœ¨ä¸€æ¡æŠ¥æ–‡ç»“æŸæ—¶å…³é—­è¿æ¥, ä½†å‡ºé”™çš„æ—¶å€™, ä¹Ÿå¯èƒ½åœ¨é¦–éƒ¨è¡Œä¸­é—´, æˆ–å…¶ä»–å¥‡æ€ªçš„åœ°æ–¹å…³é—­è¿æ¥ã€‚å¯¹ç®¡é“åŒ–æŒä¹…è¿æ¥æ¥è¯´, è¿™ç§æƒ…å½¢æ˜¯å¾ˆå¸¸è§çš„ã€‚HTTPåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ç»è¿‡ä»»æ„ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå…³é—­æŒä¹…è¿æ¥ã€‚æ¯”å¦‚ï¼Œåœ¨æŒä¹…è¿æ¥ç©ºé—²ä¸€æ®µæ—¶é—´ä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå†³å®šå°†å…¶å…³é—­ã€‚ä½†æ˜¯ï¼ŒæœåŠ¡å™¨æ°¸è¿œéƒ½æ— æ³•ç¡®å®šåœ¨å®ƒå…³é—­â€ç©ºé—²â€è¿æ¥çš„é‚£ä¸€åˆ»ï¼Œåœ¨çº¿è·¯çš„é‚£ä¸€å¤´çš„å®¢æˆ·ç«¯æœ‰æ²¡æœ‰æ•°æ®è¦å‘é€ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯å°±ä¼šåœ¨å†™å…¥åŠæˆªè¯·æ±‚æŠ¥æ–‡æ—¶å‘ç°å‡ºç°äº†è¿æ¥é”™è¯¯ã€‚ Conetent-Length åŠ æˆªå°¾æ“ä½œæ¯æ¡HTTPå“åº”éƒ½åº”è¯¥æœ‰ç²¾ç¡®çš„Content-Lengthé¦–éƒ¨ï¼Œç”¨æ¥æè¿°å“åº”ä¸»ä½“çš„å°ºå¯¸ã€‚å¦‚æœè€çš„HTTPæœåŠ¡å™¨çœç•¥äº†Content-Lengthæˆ–è€…åŒ…å«é”™è¯¯çš„é•¿åº¦æŒ‡ç¤ºï¼Œè¿™æ ·å°±è¦ä¸€æ¥æœåŠ¡å™¨å‘å‡ºè¿æ¥å…³é—­æ¥è¯´æ˜æ•°æ®çš„çœŸæ˜¯æœ«å°¾ã€‚ è¿æ¥å…³é—­å®¹é™,é‡è¯•åŠå¹‚ç­‰æ€§å³ä½¿åœ¨éé”™è¯¯æƒ…å†µä¸‹,è¿æ¥ä¹Ÿå¯ä»¥åœ¨ä»»æ„æ—¶åˆ»å…³é—­ã€‚HTTPåº”ç”¨ç¨‹åºè¦åšå¥½æ­£ç¡®å¤„ç†éé¢„æœŸå…³é—­çš„å‡†å¤‡ã€‚å¦‚æœåœ¨å®¢æˆ·ç«¯æ‰§è¡Œäº‹åŠ¡çš„è¿‡ç¨‹ä¸­, ä¼ è¾“è¿æ¥å…³é—­äº†, é‚£ä¹ˆ, é™¤éäº‹åŠ¡å¤„ç†ä¼šå¸¦æ¥ä¸€äº›å‰¯ä½œç”¨, å¦åˆ™å®¢æˆ·ç«¯å°±åº”è¯¥é‡æ–°æ‰“å¼€è¿æ¥, å¹¶é‡è¯•ä¸€æ¬¡ã€‚å¯¹ç®¡é“åŒ–è¿æ¥æ¥è¯´, è¿™ç§æƒ…å†µæ›´åŠ ä¸¥é‡ä¸€äº›ã€‚å®¢æˆ·ç«¯å¯ä»¥å°†å¤§é‡è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿ, ä½†æºç«¯æœåŠ¡å™¨å¯ä»¥å…³é—­è¿æ¥, è¿™æ ·å°±ä¼šç•™ä¸‹å¤§é‡æœªå¤„ç†çš„è¯·æ±‚, éœ€è¦é‡æ–°è°ƒåº¦ã€‚ å‰¯ä½œç”¨æ˜¯å¾ˆé‡è¦çš„é—®é¢˜, å¦‚æœåœ¨å‘é€å‡ºä¸€äº›è¯·æ±‚æ•°æ®ä¹‹å, æ”¶åˆ°è¿”å›ç»“æœä¹‹å‰, è¿æ¥å…³é—­äº†, å®¢æˆ·ç«¯å°±æ— æ³•ç™¾åˆ†ä¹‹ç™¾åœ°ç¡®å®šæœåŠ¡å™¨ç«¯å®é™…æ¿€æ´»äº†å¤šå°‘äº‹åŠ¡ã€‚æœ‰äº›äº‹åŠ¡, æ¯”å¦‚GETä¸€ä¸ªé™æ€çš„HTMLé¡µé¢, å¯ä»¥åå¤æ‰§è¡Œå¤šæ¬¡, ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ã€‚è€Œå…¶ä»–ä¸€äº›äº‹åŠ¡, æ¯”å¦‚å‘ä¸€ä¸ªåœ¨çº¿ä¹¦åº—POSTä¸€å¼ è®¢å•, å°±ä¸èƒ½é‡å¤æ‰§è¡Œ, ä¸ç„¶ä¼šæœ‰ä¸‹å¤šå¼ è®¢å•çš„å±é™©ã€‚ å¦‚æœä¸€ä¸ªäº‹åŠ¡ï¼Œ ä¸ç®¡æ˜¯æ‰§è¡Œä¸€æ¬¡è¿˜æ˜¯å¾ˆå¤šæ¬¡ï¼Œå¾—åˆ°çš„ç»“æœéƒ½ç›¸åŒ, è¿™ä¸ªäº‹åŠ¡å°±æ˜¯å¹‚ç­‰çš„ã€‚å®ç°è€…ä»¬å¯ä»¥è®¤ä¸ºGETã€HEADã€PUTã€DELETEã€TRACEå’ŒOPTIONSæ–¹æ³•éƒ½å…±äº«è¿™ä¸€ç‰¹æ€§ã€‚å®¢æˆ·ç«¯ä¸åº”è¯¥ä»¥ç®¡é“åŒ–æ–¹å¼ä¼ é€éå¹‚ç­‰è¯·æ±‚(æ¯”å¦‚POST)ã€‚å¦åˆ™ï¼Œä¼ è¾“è¿æ¥çš„è¿‡æ—©ç»ˆæ­¢å°±ä¼šé€ æˆä¸€äº›ä¸ç¡®å®šçš„åæœã€‚è¦å‘é€ä¸€æ¡éå¹‚ç­‰è¯·æ±‚ï¼Œå°±éœ€è¦ç­‰å¾…æ¥è‡ªå‰ä¸€æ¡æ¸…æ±‚çš„å“åº”çŠ¶æ€ã€‚ å°½ç®¡ç”¨æˆ·Agentä»£ç†å¯èƒ½ä¼šè®©æ“ä½œå‘˜æ¥é€‰æ‹©æ˜¯å¦å¯¹è¯·æ±‚è¿›è¡Œé‡è¯•ï¼Œä½†ä¸€å®šä¸èƒ½è‡ªåŠ¨é‡è¯•éå¹‚ç­‰æ–¹æ³•æˆ–åºåˆ—ã€‚æ¯”å¦‚ï¼Œå¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šåœ¨é‡è½½ä¸€ä¸ªç¼“å­˜çš„POSTå“åº”æ—¶æä¾›ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦å¸Œæœ›å†æ¬¡å‘èµ·äº‹åŠ¡å¤„ç†ã€‚ æ­£å¸¸å…³é—­è¿æ¥ æ­£å¸¸å…³é—­è¿æ¥TCPè¿æ¥æ˜¯åŒå‘çš„ã€‚TCPè¿æ¥çš„æ¯ä¸€ç«¯éƒ½æœ‰ä¸€ä¸ªè¾“å…¥é˜Ÿåˆ—å’Œä¸€ä¸ªè¾“å‡ºé˜Ÿåˆ—, ç”¨äºæ•°æ®çš„è¯»æˆ–å†™ã€‚æ”¾å…¥ä¸€ç«¯è¾“å‡ºé˜Ÿåˆ—ä¸­çš„æ•°æ®æœ€ç»ˆä¼šå‡ºç°åœ¨å¦ä¸€ç«¯çš„è¾“å…¥é˜Ÿåˆ—ä¸­ã€‚ å®Œå…¨å…³é—­ä¸åŠå…³é—­åº”ç”¨ç¨‹åºå¯ä»¥å…³é—­TCPè¾“å…¥å’Œè¾“å‡ºä¿¡é“ä¸­çš„ä»»æ„ä¸€ä¸ª, æˆ–è€…å°†ä¸¤è€…éƒ½å…³é—­äº†ã€‚å¥—æ¥å­—è°ƒç”¨close()ä¼šå°†TCPè¿æ¥çš„è¾“å…¥å’Œè¾“å‡ºä¿¡é“éƒ½å…³é—­äº†, è¿™è¢«ç§°ä½œ â€œå®Œå…¨å…³é—­â€ã€‚è¿˜å¯ä»¥ç”¨å¥—æ¥å­—è°ƒç”¨shutdown()å•ç‹¬å…³é—­è¾“å…¥æˆ–è¾“å‡ºä¿¡é“ã€‚è¿™è¢«ç§°ä¸ºâ€åŠå…³é—­â€ã€‚ TCPå…³é—­åŠé‡ç½®é”™è¯¯â€¦. å‚è€ƒã€ŠHTTPæƒå¨æŒ‡å—ã€‹â€“ ç¬¬å››ç« ã€Šå›¾è§£HTTPåè®®ã€‹https://developer.mozilla.org/en-US/docs/Web/HTTPhttps://tools.ietf.org/html/rfc2616","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"11. å†…å®¹åå•†ä¸è½¬ç ","slug":"http/2017-12-06-HTTP-11","date":"2017-12-06T10:50:27.000Z","updated":"2018-05-09T06:26:42.000Z","comments":true,"path":"2017/12/06/http/2017-12-06-HTTP-11/","link":"","permalink":"http://blog.renyimin.com/2017/12/06/http/2017-12-06-HTTP-11/","excerpt":"","text":"å‰è¨€ ä¸€ä¸ªURLå¸¸å¸¸éœ€è¦ä»£è¡¨è‹¥å¹²ä¸åŒçš„èµ„æº ä¾‹å¦‚é‚£ç§éœ€è¦ä»¥å¤šç§è¯­è¨€æä¾›å…¶å†…å®¹çš„ç½‘ç«™ç«™ç‚¹ã€‚ å¦‚æœæŸä¸ªç«™ç‚¹æœ‰ â€˜è¯´æ³•è¯­çš„â€™ å’Œ â€˜è¯´è‹±è¯­çš„â€™ ä¸¤ç§ç”¨æˆ·, å®ƒå¯èƒ½æƒ³ç”¨è¿™ä¸¤ç§è¯­è¨€æä¾›ç½‘ç«™ç«™ç‚¹ä¿¡æ¯; ç†æƒ³æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨åº”å½“å‘è‹±è¯­ç”¨æˆ·å‘é€è‹±æ–‡ç‰ˆï¼Œå‘æ³•è¯­ç”¨æˆ·å‘é€æ³•æ–‡ç‰ˆ; è€Œç”¨æˆ·åªè¦è®¿é—®ç½‘ç«™ä¸»é¡µå°±å¯ä»¥å¾—åˆ°ç›¸åº”è¯­è¨€çš„å†…å®¹ã€‚ HTTPæä¾›äº† å†…å®¹åå•† æ–¹æ³•ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½œè¿™æ ·çš„å†³å®šã€‚ é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå•ä¸€çš„URLå°±å¯ä»¥ä»£è¡¨ä¸åŒçš„èµ„æº(æ¯”å¦‚ï¼ŒåŒä¸€ä¸ªç½‘ç«™é¡µé¢çš„æ³•è¯­ç‰ˆå’Œè‹±è¯­ç‰ˆ)ï¼Œè¿™äº›ä¸åŒçš„ç‰ˆæœ¬ç§°ä¸ºå˜ä½“ã€‚ é™¤äº†æ ¹æ® å†…å®¹åå•† æ¥å†³å®šURLä»£è¡¨çš„æ˜¯é‚£ç§ç‰ˆæœ¬çš„èµ„æºã€‚å¦å¤–, å¯¹äºæœ‰äº›ç‰¹å®šçš„URLæ¥è¯´, æœåŠ¡å™¨è¿˜å¯ä»¥æ ¹æ®ä¸€äº›å…¶ä»–åŸåˆ™æ¥å†³å®šå‘é€ä»€ä¹ˆå†…å®¹ç»™å®¢æˆ·ç«¯æœ€åˆé€‚ã€‚åœ¨æœ‰äº›åœºåˆä¸‹, æœåŠ¡å™¨ç”šè‡³å¯ä»¥è‡ªåŠ¨ç”Ÿæˆå®šåˆ¶çš„é¡µé¢ã€‚æ¯”å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸ºæ‰‹æŒè®¾å¤‡æŠŠHTMLé¡µé¢è½¬æ¢æˆWMLé¡µé¢ï¼Œè¿™ç±»åŠ¨æ€å†…å®¹å˜æ¢è¢«ç§°ä¸ºè½¬ç ã€‚è¿™äº›å˜æ¢åŠ¨ä½œæ˜¯HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå†…å®¹åå•†çš„ç»“æœã€‚ å†…å®¹åå•†æŠ€æœ¯ å…±æœ‰3ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥å†³å®šæœåŠ¡å™¨ä¸Šå“ªä¸ªé¡µé¢æœ€é€‚åˆå®¢æˆ·ç«¯: è®©å®¢æˆ·ç«¯æ¥é€‰æ‹©, æœåŠ¡å™¨è‡ªåŠ¨åˆ¤å®š, æˆ– è®©ä¸­é—´ä»£ç†æ¥é€‰ã€‚è¿™3ç§æŠ€æœ¯åˆ†åˆ«ç§°ä¸ºå®¢æˆ·ç«¯é©±åŠ¨çš„åå•†ã€æœåŠ¡å™¨é©±åŠ¨çš„åå•† ä»¥åŠ é€æ˜åå•† å†…å®¹åå•†æŠ€æœ¯æ‘˜è¦å¦‚ä¸‹: å®¢æˆ·ç«¯é©±åŠ¨ (300)1.å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œæ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶åªæ˜¯å‘å›å“åº”ï¼Œåœ¨å…¶ä¸­åˆ—å‡ºå¯ç”¨çš„é¡µé¢ï¼Œè®©å®¢æˆ·ç«¯å†³å®šè¦çœ‹å“ªä¸ªï¼Œè¿™æ˜¯æœ€å®¹æ˜“çš„äº‹æƒ…ã€‚ å¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯æœåŠ¡å™¨æœ€å®¹æ˜“å®ç°çš„æ–¹å¼ï¼Œè€Œä¸”å®¢æˆ·ç«¯å¾ˆå¯èƒ½é€‰æ‹©åˆ°æœ€ä½³çš„ç‰ˆæœ¬(åªè¦åˆ—è¡¨ä¸­æœ‰è®©å®¢æˆ·ç«¯é€‰æ‹©çš„è¶³å¤Ÿä¿¡æ¯)ã€‚ ä¸åˆ©ä¹‹å¤„æ˜¯æ¯ä¸ªé¡µé¢éƒ½éœ€è¦ä¸¤æ¬¡è¯·æ±‚: ç¬¬ä¸€æ¬¡è·å–åˆ—è¡¨ï¼Œç¬¬äºŒæ¬¡è·å–é€‰æ‹©çš„å‰¯æœ¬ã€‚è¿™ç§æŠ€æœ¯é€Ÿåº¦å¾ˆæ…¢ä¸”è¿‡ç¨‹æ¯ç‡¥ä¹å‘³ï¼Œè®©ç”¨æˆ·åŒçƒ¦ã€‚ 2.ä»å®ç°åŸç†ä¸Šæ¥è¯´ï¼ŒæœåŠ¡å™¨å®é™…ä¸Šæœ‰ä¸¤ç§æ–¹æ³•ä¸ºå®¢æˆ·ç«¯æä¾›é€‰é¡¹: ä¸€æ˜¯å‘é€å›ä¸€ä¸ªHTMLæ–‡æ¡£ï¼Œé‡Œé¢æœ‰åˆ°è¯¥é¡µé¢çš„å„ç§ç‰ˆæœ¬çš„é“¾æ¥å’Œæ¯ä¸ªç‰ˆæœ¬çš„æè¿°ä¿¡æ¯; å¦ä¸€ç§æ–¹æ³•æ˜¯å‘é€å›HTTP/1.1å“åº”æ—¶ï¼Œä½¿ç”¨ 300 Multiple Choices å“åº”ä»£ç ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨æ”¶åˆ°è¿™ç§å“åº”æ—¶ï¼Œåœ¨å‰ä¸€ç§æƒ…å†µä¸‹(å‘å›htmlæ–‡æ¡£çš„æƒ…å†µ)ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰é“¾æ¥çš„é¡µé¢; åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¼¹å‡ºå¯¹è¯çª—å£ï¼Œè®©ç”¨æˆ·åšé€‰æ‹©ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œå†³å®šæ˜¯ç”±å®¢æˆ·ç«¯çš„æµè§ˆå™¨ç”¨æˆ·ä½œå‡ºçš„ 3.é™¤äº†å¢åŠ æ—¶å»¶å¹¶ä¸”å¯¹æ¯ä¸ªé¡µé¢éƒ½è¦è¿›è¡Œç¹ççš„å¤šæ¬¡è¯·æ±‚ä¹‹å¤–, è¿™ç§æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªç¼ºç‚¹: å®ƒéœ€è¦å¤šä¸ªURL, å…¬å…±é¡µé¢è¦ä¸€ä¸ª, å…¶ä»–æ¯ç§ç‰¹æ®Šé¡µé¢ä¹Ÿéƒ½è¦ä¸€ä¸ªã€‚ æœåŠ¡å™¨é©±åŠ¨1.ä¹‹å‰å·²ç»çŸ¥é“äº†å®¢æˆ·ç«¯é©±åŠ¨çš„åå•†å­˜åœ¨çš„è‹¥å¹²ç¼ºç‚¹ã€‚å¤§éƒ¨åˆ†ç¼ºç‚¹éƒ½æ¶‰åŠå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡é‡çš„å¢é•¿, è¿™äº›é€šä¿¡é‡ç”¨æ¥å†³å®šä»€ä¹ˆé¡µé¢æ‰æ˜¯å¯¹è¯·æ±‚çš„æœ€ä½³å“åº”ã€‚ 2.è€Œå‡å°‘é¢å¤–é€šä¿¡é‡çš„ä¸€ç§æ–¹æ³•æ˜¯è®©æœåŠ¡å™¨æ¥å†³å®šå‘é€å“ªä¸ªé¡µé¢å›å»ï¼Œä½†ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯å¿…é¡»å‘é€æœ‰å…³å®¢æˆ·åå¥½çš„è¶³å¤Ÿä¿¡æ¯ï¼Œä»¥ä¾¿æœåŠ¡å™¨èƒ½å¤Ÿä½œå‡ºå‡†ç¡®çš„å†³ç­–ã€‚æœåŠ¡å™¨é€šè¿‡ å®¢æˆ·ç«¯è¯·æ±‚çš„é¦–éƒ¨é›† æ¥è·å¾—è¿™æ–¹é¢çš„ä¿¡æ¯(å®¢æˆ·åå¥½)!! æœ‰ä»¥ä¸‹ä¸¤ç§æœºåˆ¶å¯ä¾›HTTPæœåŠ¡å™¨è¯„ä¼°å‘é€ä»€ä¹ˆå“åº”ç»™å®¢æˆ·ç«¯æ¯”è¾ƒåˆé€‚ï¼š æ£€æŸ» å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„å†…å®¹åå•†é¦–éƒ¨é›†: æœåŠ¡å™¨å¯Ÿçœ‹å®¢æˆ·ç«¯å‘é€çš„ Acceptå†…å®¹åå•†é¦–éƒ¨é›†, è®¾æ³•ç”¨ç›¸åº”çš„å“åº”é¦–éƒ¨ä¸ä¹‹åŒ¹é…; æ ¹æ®å…¶ä»–(éå†…å®¹åå•†)é¦–éƒ¨è¿›è¡Œå˜é€š, ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥æ ¹æ®å®¢æˆ·ç«¯å‘é€çš„ User-Agent é¦–éƒ¨æ¥å‘é€å“åº” å®¢æˆ·ç«¯å†…å®¹åå•†é¦–éƒ¨é›†1.å®¢æˆ·ç«¯å¯ä»¥ç”¨ä¸‹é¢åˆ—å‡ºçš„HTTPé¦–éƒ¨é›†å‘é€ç”¨æˆ·çš„åå¥½ä¿¡æ¯ Accept : å‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§åª’ä½“ç±»å‹Accept-Language : å‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§è¯­è¨€Accept-Charset : å‘ŠçŸ¥æœåŠ¡å™¨å‘é€ä½•ç§å­—ç¬¦é›†Accept-Encoding : å‘ŠçŸ¥æœåŠ¡å™¨é‡‡ç”¨ä½•ç§ç¼–ç  2.å®ä½“é¦–éƒ¨é›† å’Œ å†…å®¹åå•†é¦–éƒ¨é›† æ³¨æ„: å†…å®¹åå•†é¦–éƒ¨é›†ä¸å®ä½“é¦–éƒ¨éå¸¸ç±»ä¼¼(æ¯”å¦‚ Accept-Encoding å’Œ Content-Encoding)ã€‚ä¸è¿‡, è¿™ä¸¤ç§é¦–éƒ¨çš„ç”¨é€”æˆªç„¶ä¸åŒ: å®ä½“é¦–éƒ¨é›†,åƒè¿è¾“æ ‡ç­¾,å®ƒä»¬æè¿°äº†æŠŠæŠ¥æ–‡ä»æœåŠ¡å™¨ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„è¿‡ç¨‹ä¸­å¿…é¡»çš„å„ç§æŠ¥æ–‡ä¸»ä½“å±æ€§; å¦‚ä¸‹åˆ—å‡ºçš„å®ä½“é¦–éƒ¨é›†æ¥åŒ¹é…å®¢æˆ·ç«¯çš„Acceptå†…å®¹åå•†é¦–éƒ¨é›† 12345Acceté¦–éƒ¨ å®ä½“é¦–éƒ¨Accept Content-TypeAccept-Language Content-LanguageAccept-Charset Content-TypeAccept-Encoding Content-Encoding ï¼ˆç”±äºHTTPæ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸ä¼šåœ¨ä¸åŒçš„è¯·æ±‚ä¹‹é—´è¿½è¸ªå®¢æˆ·ç«¯çš„åå¥½ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¿…é¡»åœ¨æ¯ä¸ªè¯·æ±‚ä¸­éƒ½å‘é€å…¶åå¥½ä¿¡æ¯ï¼‰ è€Œå†…å®¹åå•†é¦–éƒ¨é›†æ˜¯ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ç”¨æ¥å‘ŠçŸ¥å…¶åå¥½ä¿¡æ¯çš„, ä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥ä»æ–‡æ¡£çš„ä¸åŒç‰ˆæœ¬ä¸­é€‰æ‹©å‡ºæœ€ç¬¦åˆå®¢æˆ·ç«¯åå¥½çš„é‚£ä¸ªæ¥æä¾›æœåŠ¡; å†…å®¹åå•†é¦–éƒ¨ä¸­çš„è´¨é‡å€¼1.HTTPåè®®ä¸­å®šä¹‰äº†è´¨é‡å€¼ï¼Œå…è®¸å®¢æˆ·ç«¯ä¸ºæ¯ç§åå¥½ç±»åˆ«åˆ—å‡ºå¤šç§é€‰é¡¹ï¼Œå¹¶ä¸ºæ¯ç§åå¥½é€‰é¡¹å…³è”ä¸€ä¸ªä¼˜å…ˆæ¬¡åºã€‚ ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘é€ä¸‹åˆ—å½¢å¼çš„Accept-Languageé¦–éƒ¨ï¼šAccept-Language: en; q=0.5, fr; q=0.0 , nl; q=1.0, tr; q=0.0 å…¶ä¸­qå€¼çš„èŒƒå›´ä»0.0-1.0(0.0æ˜¯ä¼˜å…ˆçº§æœ€ä½çš„ï¼Œè€Œ1.0æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„)ã€‚ ä¸Šé¢åˆ—å‡ºçš„é‚£ä¸ªé¦–éƒ¨ï¼Œè¯´æ˜è¯¥å®¢æˆ·ç«¯æœ€æ„¿æ„æ¥æ”¶è·å…°è¯­(ç¼©å†™ä¸ºnl)æ–‡æ¡£ï¼Œä½†è‹±è¯­(ç¼©å†™ä¸ºen)æ–‡æ¡£ä¹Ÿè¡Œ; æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯éƒ½ä¸æ„¿æ„æ”¶åˆ°æ³•è¯­(ç¼©å†™ä¸ºfr)æˆ–åœŸè€³ å…¶è¯­(ç¼©å†™ä¸ºtr)çš„ç‰ˆæœ¬; 2.æ³¨æ„: åå¥½çš„æ’åˆ—é¡ºåºå¹¶ä¸é‡è¦ï¼Œåªæœ‰ä¸åå¥½ç›¸å…³çš„qå€¼æ‰æ˜¯é‡è¦çš„; å®¢æˆ·ç«¯å…¶å®ƒè¯·æ±‚é¦–éƒ¨é›†1.æœåŠ¡å™¨ä¹Ÿå¯ä»¥æ ¹æ®å®¢æˆ·ç«¯å…¶ä»–è¯·æ±‚é¦–éƒ¨é›†æ¥åŒ¹é…å“åº”, æ¯”å¦‚ User-Agent é¦–éƒ¨ã€‚ä¾‹å¦‚, æœåŠ¡å™¨çŸ¥é“è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸æ”¯æŒJavaScriptè¯­è¨€ï¼Œè¿™æ ·å°±å¯ä»¥å‘å…¶å‘é€ä¸å«æœ‰JavaScriptçš„é¡µé¢ç‰ˆæœ¬ã€‚ 2.ç”±äºç¼“å­˜éœ€è¦å°½åŠ›æä¾›æ‰€ç¼“å­˜æ–‡æ¡£ä¸­æ­£ç¡®çš„â€æœ€ä½³â€ç‰ˆæœ¬ï¼ŒHTTPåè®®å®šä¹‰äº†æœåŠ¡å™¨åœ¨å“åº”ä¸­å‘é€çš„ Vary é¦–éƒ¨ã€‚ è¿™ä¸ªé¦–éƒ¨å‘ŠçŸ¥ç¼“å­˜, å®¢æˆ·ç«¯, å’Œæ‰€æœ‰ä¸‹æ¸¸çš„ä»£ç†, æœåŠ¡å™¨æ ¹æ®å“ªäº›é¦–éƒ¨æ¥å†³å®šå‘é€å“åº”çš„æœ€ä½³ç‰ˆæœ¬ã€‚ é€æ˜åå•†(varyé¦–éƒ¨)1.äº†æ”¯æŒé€æ˜å†…å®¹åå•†ï¼ŒæœåŠ¡å™¨å¿…é¡»æœ‰èƒ½åŠ›å‘ŠçŸ¥ä»£ç†ï¼ŒæœåŠ¡å™¨éœ€è¦æ£€æŸ»å“ªäº›è¯·æ±‚é¦–éƒ¨ï¼Œä»¥ä¾¿å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œæœ€ä½³åŒ¹é…ã€‚ä½†æ˜¯HTTP/1.1è§„èŒƒä¸­æ²¡æœ‰å®šä¹‰ä»»ä½•é€æ˜åå•†æœºåˆ¶, ä¸è¿‡å´å®šä¹‰äº† Vary é¦–éƒ¨ã€‚æœåŠ¡å™¨åœ¨å“åº”ä¸­å‘é€äº†Varyé¦–éƒ¨ï¼Œä»¥å‘ŠçŸ¥ä¸­é—´èŠ‚ç‚¹éœ€è¦ä½¿ç”¨å“ªäº›è¯·æ±‚é¦–éƒ¨è¿›è¡Œå†…å®¹åå•† 2.ä»£ç†ç¼“å­˜å¯ä»¥ä¸ºé€šè¿‡å•ä¸ªURLè®¿é—®çš„æ–‡æ¡£ä¿å­˜ä¸åŒçš„å‰¯æœ¬, å¦‚æœæœåŠ¡å™¨æŠŠå®ƒä»¬çš„å†³ç­–è¿‡ç¨‹ä¼ ç»™ä»£ç†,è¿™äº›ä»£ç†å°±èƒ½ä»£è¡¨æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯è¿›è¡Œåå•†ã€‚ï¼ˆç¼“å­˜åŒæ—¶ä¹Ÿæ˜¯è¿›è¡Œå†…å®¹è½¬ç çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºéƒ¨ç½²åœ¨ç¼“å­˜é‡Œçš„é€šç”¨è½¬ç å™¨èƒ½å¯¹ä»»æ„æœåŠ¡å™¨ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€å°æœåŠ¡å™¨ä¼ æ¥çš„å†…å®¹è¿›è¡Œè½¬ç ï¼‰ 3.å¯¹å†…å®¹è¿›è¡Œç¼“å­˜çš„æ—¶å€™æ˜¯å‡è®¾å†…å®¹ä»¥åè¿˜å¯ä»¥é‡ç”¨ã€‚ç„¶è€Œï¼Œä¸ºäº†ç¡®ä¿å¯¹å®¢æˆ·ç«¯è¯·æ±‚å›é€çš„æ˜¯æ­£ç¡®çš„å·²ç¼“å­˜å“åº”, ç¼“å­˜å¿…é¡»åº”ç”¨æœåŠ¡å™¨åœ¨å›é€å“åº”æ—¶æ‰€ç”¨åˆ°çš„å¤§éƒ¨åˆ†å†³ç­–é€»è¾‘; 4.ä¹‹å‰æˆ‘ä»¬å·²ç»äº†è§£äº†å®¢æˆ·ç«¯å‘é€çš„Acceptå†…å®¹åå•†é¦–éƒ¨é›†; ä¹Ÿäº†è§£åˆ°, ä¸ºäº†ç»™æ¯æ¡è¯·æ±‚é€‰æ‹©æœ€ä½³çš„å“åº”, æœåŠ¡å™¨ä½¿ç”¨äº†å“ªäº›ä¸è¿™äº›é¦–éƒ¨é›†åŒ¹é…çš„ç›¸åº”å®ä½“é¦–éƒ¨é›†ã€‚å…¶å®, ä»£ç†ç¼“å­˜ä¹Ÿå¿…é¡»ä½¿ç”¨ç›¸åŒçš„é¦–éƒ¨é›†æ¥å†³å®šå›é€å“ªä¸ªå·²ç¼“å­˜çš„å“åº”ã€‚ 5.ä¸‹å›¾å±•ç¤ºäº†æ¶‰åŠç¼“å­˜çš„æ­£ç¡®åŠé”™è¯¯çš„æ“ä½œåºåˆ—ã€‚ ç¼“å­˜æŠŠç¬¬ä¸€ä¸ªè¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ï¼Œå¹¶å­˜å‚¨å…¶å“åº”ã€‚ å¯¹äºç¬¬äºŒä¸ªè¯·æ±‚ï¼Œç¼“å­˜æ ¹æ®URLæŸ»æ‰¾åˆ°äº†åŒ¹é…çš„æ–‡æ¡£ã€‚ä½†æ˜¯ï¼Œè¿™ä»½æ–‡æ¡£æ˜¯æ³•è¯­ç‰ˆçš„ï¼Œè€Œè¯·æ±‚è€…æƒ³è¦çš„æ˜¯è¥¿ç­ç‰™è¯­ç‰ˆçš„ã€‚å¦‚æœç¼“å­˜åªæ˜¯æŠŠæ–‡æ¡£çš„æ³•è¯­ç‰ˆæœ¬å‘ç»™è¯·æ±‚è€…çš„è¯ï¼Œå®ƒå°±çŠ¯äº†é”™è¯¯; åƒä¸Šé¢2ä¸­æåˆ°çš„, ä»£ç†ç¼“å­˜ä¹Ÿå¿…é¡»è¦æ ¹æ®å®¢æˆ·ç«¯å‘é€æ¥çš„å†…å®¹åå•†é¦–éƒ¨æ¥ç»™å®¢æˆ·ç«¯è¿”å›æ­£ç¡®çš„å“åº” Varyé¦–éƒ¨1.ä¸‹é¢æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨å‘é€çš„ä¸€äº›å…¸å‹çš„è¯·æ±‚åŠå“åº”é¦–éƒ¨: 2.ç„¶è€Œ, å¦‚æœæœåŠ¡å™¨çš„å†³ç­–ä¸æ˜¯ä¾æ®Accepté¦–éƒ¨é›†ï¼Œè€Œæ˜¯æ¯”å¦‚User-Agenté¦–éƒ¨çš„è¯ï¼Œæƒ…å†µä¼šå¦‚ä½•ï¼Ÿä¾‹å¦‚, æœåŠ¡å™¨å¯èƒ½çŸ¥é“è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸æ”¯æŒJavaScriptè¯­è¨€, å› æ­¤å¯èƒ½ä¼šå›é€ä¸åŒ…å«JavaScriptçš„é¡µé¢ç‰ˆæœ¬ã€‚å¦‚æœæœåŠ¡å™¨æ˜¯æ ¹æ®å…¶ä»–é¦–éƒ¨æ¥å†³å®šå‘é€å“ªä¸ªé¡µé¢çš„è¯, å’ŒAccepté¦–éƒ¨é›†ä¸€æ ·, ç¼“å­˜ä¹Ÿå¿…é¡»çŸ¥é“è¿™äº›é¦–éƒ¨æ˜¯ä»€ä¹ˆ, è¿™æ ·æ‰èƒ½åœ¨é€‰æ‹©å›é€çš„é¡µé¢æ—¶åšå‡ºåŒæ ·çš„é€»è¾‘åˆ¤æ–­ã€‚ 3.HTTPçš„ Vary å“åº”é¦–éƒ¨ä¸­åˆ—å‡ºäº†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚é¦–éƒ¨, æœåŠ¡å™¨å¯ç”¨è¿™äº›é¦–éƒ¨æ¥é€‰æ‹©æ–‡æ¡£æˆ–äº§ç”Ÿå®šåˆ¶çš„å†…å®¹(åœ¨å¸¸è§„çš„å†…å®¹åå•†é¦–éƒ¨é›†ä¹‹å¤–çš„å†…å®¹)ã€‚ä¾‹å¦‚, è‹¥æ‰€æä¾›çš„æ–‡æ¡£å–å†³äºUser-Agenté¦–éƒ¨, Varyé¦–éƒ¨å°±å¿…é¡»åŒ…å«User-Agent; å°ç»“ å½“æ–°çš„è¯·æ±‚åˆ°è¾¾æ—¶, ä»£ç†ç¼“å­˜ä¼šæ ¹æ®å†…å®¹åå•†é¦–éƒ¨é›†æ¥å¯»æ‰¾æœ€ä½³åŒ¹é…ã€‚ä½†åœ¨æŠŠæ–‡æ¡£æä¾›ç»™å®¢æˆ·ç«¯ä¹‹å‰, å®ƒè¿˜å¿…é¡»æ£€æŸ»æœåŠ¡å™¨æœ‰æ²¡æœ‰åœ¨å·²ç¼“å­˜å“åº”ä¸­å‘é€Varyé¦–éƒ¨ã€‚ å¦‚æœæœ‰Varyé¦–éƒ¨, é‚£ä¹ˆæ–°è¯·æ±‚ä¸­é‚£äº›é¦–éƒ¨çš„å€¼å¿…é¡»ä¸æ—§çš„å·²ç¼“å­˜çš„å“åº”çš„è¯·æ±‚é¦–éƒ¨ç›¸åŒã€‚(ä¹Ÿå°±æ˜¯è¯´,ä»£ç†ç¼“å­˜ä¹Ÿä¼šä¿å­˜æ—§çš„è¯·æ±‚çš„è¯·æ±‚é¦–éƒ¨å’Œå“åº”é¦–éƒ¨, ä¸‹é¢ä¸€å¥è¯æ›´åŠ è‚¯å®šè¿™ä¸€ç‚¹) å› ä¸ºæœåŠ¡å™¨å¯èƒ½ä¼šæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„é¦–éƒ¨æ¥æ”¹å˜å“åº”, ä¸ºäº†å®ç°é€æ˜åå•†, ä»£ç†ç¼“å­˜å°±å¿…é¡»ä¸ºæ¯ä¸ªå·²ç¼“å­˜å˜ä½“ä¿å­˜å®¢æˆ·ç«¯è¯·æ±‚é¦–éƒ¨å’Œç›¸åº”çš„æœåŠ¡å™¨å“åº”é¦–éƒ¨) å¦‚æœæŸæœåŠ¡å™¨çš„Varyé¦–éƒ¨çœ‹èµ·æ¥åƒ Vary: User-Agent, Cookie è¿™æ ·ï¼Œå¤§é‡ä¸åŒçš„User-Agentå’ŒCookieå€¼å°†ä¼šäº§ç”Ÿéå¸¸å¤šçš„å˜ä½“, è€Œä»£ç†ç¼“å­˜å¿…é¡»ä¸ºæ¯ä¸ªå˜ä½“ä¿å­˜å…¶ç›¸åº”çš„æ–‡æ¡£ç‰ˆæœ¬ã€‚å½“ç¼“å­˜æ‰§è¡ŒæŸ»æ‰¾æ—¶ï¼Œé¦–å…ˆä¼šå¯¹å†…å®¹åå•†é¦–éƒ¨é›†è¿›è¡Œå†…å®¹åŒ¹é…ï¼Œç„¶åæ¯”è¾ƒè¯·æ±‚çš„å˜ä½“ä¸ç¼“å­˜çš„å˜ä½“ã€‚å¦‚æœæ— æ³•åŒ¹é…ï¼Œç¼“å­˜å°±ä»åŸå§‹æœåŠ¡å™¨è·å–æ–‡æ¡£ è½¬ç  æˆ‘ä»¬å·²ç»è®¨è®ºäº†ä¸€ä¸ªæœºåˆ¶, è¯¥æœºåˆ¶å¯ä»¥è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»æŸä¸ªURLçš„ä¸€ç³»åˆ—æ–‡æ¡£ä¸­æŒ‘é€‰å‡ºæœ€é€‚åˆå®¢æˆ·ç«¯çš„æ–‡æ¡£ã€‚ä½†æ˜¯, å®ç°è¿™äº›æœºåˆ¶çš„å‰ææ˜¯ï¼Œå­˜åœ¨ä¸€äº›æ»¡è¶³å®¢æˆ·ç«¯éœ€æ±‚çš„æ–‡æ¡£â€”ä¸ç®¡æ˜¯å®Œå…¨æ»¡è¶³è¿˜æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ»¡è¶³; ç„¶è€Œ, å¦‚æœæœåŠ¡å™¨æ²¡æœ‰èƒ½æ»¡è¶³å®¢æˆ·ç«¯éœ€æ±‚çš„æ–‡æ¡£ä¼šæ€ä¹ˆæ ·å‘¢ï¼ŸæœåŠ¡å™¨å¯ä»¥ç»™å‡ºä¸€ä¸ªé”™è¯¯å“åº”ã€‚ä½†ç†è®ºä¸Šï¼ŒæœåŠ¡å™¨å¯ä»¥æŠŠç°å­˜çš„æ–‡æ¡£è½¬æ¢æˆæŸç§å®¢æˆ·ç«¯å¯ç”¨çš„æ–‡æ¡£, è¿™ç§é€‰é¡¹ç§°ä¸ºè½¬ç ; ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›å‡è®¾çš„è½¬ç  1234567è½¬æ¢ä¹‹å‰ è½¬æ¢ä¹‹åHTMLæ–‡æ¡£ WMLæ–‡æ¡£é«˜åˆ†è¾¨ç‡å›¾åƒ ä½åˆ†è¾¨ç‡å›¾åƒå½©è‰²å›¾åƒ é»‘ç™½å›¾åƒæœ‰å¤šä¸ªæ¡†æ¶çš„å¤æ‚é¡µé¢ æ²¡æœ‰å¾ˆå¤šæ¡†æ¶æˆ–å›¾åƒçš„ç®€å•æ–‡æœ¬é¡µé¢æœ‰Javaå°åº”ç”¨ç¨‹åºçš„HTMLé¡µé¢ æ²¡æœ‰Javaå°åº”ç”¨ç¨‹åºçš„HTMLé¡µé¢æœ‰å¹¿å‘Šçš„é¡µé¢ å»é™¤å¹¿å‘Šçš„é¡µé¢ æœ‰3ç§ç±»åˆ«çš„è½¬ç : æ ¼å¼è½¬æ¢ã€ä¿¡æ¯ç»¼åˆä»¥åŠå†…å®¹æ³¨å…¥ æ ¼å¼è½¬æ¢ æ ¼å¼è½¬æ¢æ˜¯æŒ‡å°†æ•°æ®ä»ä¸€ç§æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼, ä½¿ä¹‹å¯ä»¥è¢«å®¢æˆ·ç«¯æŸ»çœ‹ã€‚é€šè¿‡HTMLåˆ°WMLçš„è½¬æ¢, æ— çº¿è®¾å¤‡å°±å¯ä»¥è®¿é—®é€šå¸¸ä¾›æ¡Œé¢å®¢æˆ·ç«¯æŸ»çœ‹çš„æ–‡æ¡£äº†ã€‚é€šè¿‡æ…¢é€Ÿè¿æ¥è®¿é—®Webé¡µé¢çš„å®¢æˆ·ç«¯å¹¶ä¸éœ€è¦æ¥æ”¶é«˜åˆ†è¾¨ç‡å›¾åƒ, å¦‚æœé€šè¿‡æ ¼å¼è½¬æ¢é™ä½å›¾åƒåˆ†è¾¨ç‡å’Œé¢œè‰²æ¥å‡å°å›¾åƒæ–‡ä»¶å¤§å°çš„è¯, è¿™ç±»å®¢æˆ·ç«¯å°±èƒ½æ›´å®¹æ˜“åœ°æŸ»çœ‹å›¾åƒæ¯”è¾ƒä¸°å¯Œçš„é¡µé¢äº†ã€‚ æ ¼å¼è½¬æ¢å¯ä»¥ç”±å¦‚ä¸‹å†…å®¹åå•†é¦–éƒ¨é›†æ¥é©±åŠ¨, ä½†ä¹Ÿèƒ½ç”± User-Agent é¦–éƒ¨æ¥é©±åŠ¨ã€‚æ³¨æ„: å†…å®¹è½¬æ¢æˆ–è½¬ç  ä¸ å†…å®¹ç¼–ç  æˆ– ä¼ è¾“ç¼–ç  æ˜¯ä¸åŒçš„, åä¸¤è€…ä¸€èˆ¬ç”¨äºæ›´é«˜æ•ˆæˆ–å®‰å…¨åœ°ä¼ è¾“å†…å®¹, è€Œå‰ä¸¤è€…åˆ™å¯ä½¿è®¿é—®è®¾å¤‡èƒ½å¤ŸæŸ»çœ‹å†…å®¹; Acceté¦–éƒ¨ å®ä½“é¦–éƒ¨ Accept Content-Type Accept-Language Content-Language Accept-Charset Content-Type Accept-Encoding Content-Encoding ä¿¡æ¯ç»¼åˆ ä»æ–‡æ¡£ä¸­æå–å…³é”®çš„ä¿¡æ¯ç‰‡æ®µç§°ä¸ºä¿¡æ¯ç»¼åˆ(information synthesis), è¿™æ˜¯ä¸€ç§æœ‰ç”¨çš„è½¬ç æ“ä½œã€‚è¿™ç§æ“ä½œçš„ä¾‹å­åŒ…æ‹¬æ ¹æ®å°èŠ‚æ ‡é¢˜ç”Ÿæˆæ–‡æ¡£çš„å¤§çº²ï¼Œæˆ–è€…ä»é¡µé¢ä¸­åˆ é™¤å¹¿å‘Šå’Œå•†æ ‡ æ ¹æ®å†…å®¹ä¸­çš„å…³é”®å­—å¯¹é¡µé¢åˆ†ç±»æ˜¯æ›´ç²¾ç»†çš„æŠ€æœ¯, æœ‰åŠ©äºæ€»ç»“æ–‡æ¡£çš„ç²¾é«“ã€‚è¿™ç§æŠ€æœ¯å¸¸ç”¨äºWebé¡µé¢åˆ†ç±»ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚é—¨æˆ·ç½‘ç«™çš„Webé¡µé¢ç›®å½• å†…å®¹æ³¨å…¥å‚è§P423 è½¬ç ä¸é™æ€é¢„ç”Ÿæˆçš„å¯¹æ¯” è½¬ç çš„æ›¿ä»£åšæ³•æ˜¯åœ¨WebæœåŠ¡å™¨ä¸Šå»ºç«‹Webé¡µé¢çš„ä¸åŒå‰¯æœ¬, ä¾‹å¦‚ä¸€ä¸ªæ˜¯HTML, ä¸€ä¸ªæ˜¯WML, ä¸€ä¸ªå›¾åƒåˆ†è¾¨ç‡é«˜ï¼Œä¸€ä¸ªå›¾åƒåˆ†è¾¨ç‡ä½ï¼›ä¸€ä¸ªæœ‰å¤šåª’ä½“å†…å®¹ï¼Œä¸€ä¸ªæ²¡æœ‰ã€‚ ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¸æ˜¯å¾ˆåˆ‡åˆå®é™…ï¼ŒåŸå› å¾ˆå¤šï¼š æŸä¸ªé¡µé¢ä¸­çš„ä»»ä½•å°æ”¹åŠ¨éƒ½ä¼šç‰µæ‰¯å¾ˆå¤šé¡µé¢ï¼Œéœ€è¦å¾ˆå¤šç©ºé—´æ¥å­˜å‚¨å„é¡µé¢çš„ä¸åŒç‰ˆæœ¬ï¼Œè€Œä¸”ä½¿é¡µé¢ç¼–ç›®å’ŒWebæœåŠ¡å™¨ç¼–ç¨‹(ä»¥æä¾›æ­£ç¡®çš„ç‰ˆæœ¬)å˜å¾—æ›´åŠ å›°éš¾ã€‚ æœ‰äº›è½¬ç æ“ä½œï¼Œæ¯”å¦‚å¹¿å‘Šæ’å…¥(å°¤å…¶æ˜¯å®šå‘å¹¿å‘Šæ’å…¥)ï¼Œå°±ä¸èƒ½é™æ€å®ç°, å› ä¸ºæ’å…¥ä»€ä¹ˆå¹¿å‘Šå’Œè¯·æ±‚é¡µé¢çš„ç”¨æˆ·æœ‰å…³ å¯¹å•ä¸€çš„æ ¹é¡µé¢è¿›è¡Œå³æ—¶è½¬æ¢ï¼Œæ˜¯æ¯”é™æ€çš„é¢„ç”Ÿæˆæ›´å®¹æ˜“çš„è§£å†³æ–¹æ¡ˆã€‚ ä½†è¿™æ ·ä¼šåœ¨æä¾›å†…å®¹æ—¶å¢åŠ æ—¶å»¶ã€‚ä¸è¿‡æœ‰æ—¶å€™å…¶ä¸­ä¸€äº›è®¡ç®—å¯ä»¥ç”±ç¬¬ä¸‰æ–¹è¿›è¡Œï¼Œè¿™æ ·å°±å‡å°‘äº†WebæœåŠ¡å™¨ä¸Šçš„è®¡ç®—è´Ÿè·â€”â€”æ¯”å¦‚å¯ä»¥ç”±ä»£ç†æˆ–ç¼“å­˜ä¸­çš„å¤–éƒ¨Agentå®Œæˆè½¬æ¢ ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨ä»£ç†ç¼“å­˜ä¸­è¿›è¡Œçš„è½¬ç  å‚è€ƒ","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"05. ç¼“å­˜","slug":"http/2017-11-30-HTTP-05","date":"2017-11-30T13:27:36.000Z","updated":"2018-05-15T09:20:25.000Z","comments":true,"path":"2017/11/30/http/2017-11-30-HTTP-05/","link":"","permalink":"http://blog.renyimin.com/2017/11/30/http/2017-11-30-HTTP-05/","excerpt":"","text":"ç¼“å­˜å…³äºç¼“å­˜çš„æ¦‚å¿µæœ¬æ–‡å°±ä¸è¯¦ç»†å±•å¼€è¯´æ˜äº†, è¿™é‡Œæ‰€è¯´çš„webç¼“å­˜å…¶å®å°±æ˜¯: ä¸ºäº†é™ä½æœåŠ¡å™¨ç«¯çš„è®¿é—®é¢‘ç‡, å‡å°‘é€šä¿¡æ•°é‡, ä¸€äº›ç¼“å­˜è®¾å¤‡, å¦‚å®¢æˆ·ç«¯æˆ–ä¸€äº›ä¸­ç»§ä»£ç†æœåŠ¡å™¨å°†è·å–çš„æ•°æ®ä¿å­˜ä¸‹æ¥, å½“å†æ¬¡éœ€è¦æ—¶, å°±ä½¿ç”¨æ‰€ä¿å­˜çš„æ•°æ®; (å½“è¯·æ±‚æŠµè¾¾ç¼“å­˜è®¾å¤‡æ—¶, å¦‚æœç¼“å­˜è®¾å¤‡æœ¬åœ°æœ‰â€å·²ç¼“å­˜çš„â€å‰¯æœ¬, å°±å¯ä»¥ä»æœ¬åœ°è®¾å¤‡è€Œä¸æ˜¯åŸå§‹æœåŠ¡å™¨ä¸­æå–è¿™ä¸ªæ–‡æ¡£) ä½¿ç”¨ç¼“å­˜çš„ä¼˜ç‚¹ å‡å°‘äº†æœåŠ¡å™¨ç«¯çš„é€šä¿¡æ•°é‡, å¯ä»¥æå‡ç”¨æˆ·è®¿é—®é€Ÿåº¦ åœ¨ç½‘ç»œæ–­å¼€çš„çŠ¶æ€ä¸‹, ä¹Ÿå¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šç»§ç»­å‘ç”¨æˆ·æä¾›æœåŠ¡ å‡å°‘äº†å†—ä½™çš„æ•°æ®ä¼ è¾“, èŠ‚çœäº†ä½ çš„ç½‘ç»œè´¹ç”¨ ç¼“è§£äº†ç½‘ç»œæœ¬èº«çš„ç“¶é¢ˆé—®é¢˜, ä¸éœ€è¦æ›´å¤šçš„å¸¦å®½å°±èƒ½å¤Ÿæ›´å¿«åœ°åŠ è½½é¡µé¢ é™ä½äº†è·ç¦»æ—¶å»¶, å› ä¸ºä»è¾ƒè¿œçš„åœ°æ–¹åŠ è½½é¡µé¢ä¼šæ›´æ…¢ä¸€äº›(å³ä½¿å¸¦å®½ä¸æ˜¯é—®é¢˜, è·ç¦»ä¹Ÿå¯èƒ½æˆä¸ºé—®é¢˜ã€‚æ¯å°ç½‘ç»œè·¯ç”±å™¨éƒ½ä¼šå¢åŠ å› ç‰¹ç½‘æµé‡çš„æ—¶å»¶ã€‚å³ä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰å¤ªå¤šçš„è·¯ç”±å™¨, å…‰é€Ÿè‡ªèº«ä¹Ÿä¼šé€ æˆæ˜¾è‘—çš„æ—¶å»¶ã€‚) ç»¼ä¸Šæ‰€è¿°, ç¼“å­˜å¯¹ç”¨æˆ·ä½“éªŒå’Œé€šä¿¡æˆæœ¬éƒ½ä¼šé€ æˆå¾ˆå¤§çš„å½±å“, æ‰€ä»¥æˆ‘ä»¬è¦å°½å¯èƒ½åœ°å»çµæ´»ä½¿ç”¨ç¼“å­˜æœºåˆ¶ã€‚ ç¼“å­˜å‘½ä¸­å¦‚æœä¸€äº›è¯·æ±‚åˆ°è¾¾ç¼“å­˜è®¾å¤‡æ—¶, ç¼“å­˜è®¾å¤‡å¯ä»¥ç”¨æœ¬åœ°å·²æœ‰çš„å‰¯æœ¬ä¸ºè¿™äº›è¯·æ±‚æä¾›æœåŠ¡, å°±è¢«ç§°ä¸ºç¼“å­˜å‘½ä¸­; ç¼“å­˜æœªå‘½ä¸­å¦‚æœä¸€äº›è¯·æ±‚åˆ°è¾¾ç¼“å­˜è®¾å¤‡æ—¶, ç¼“å­˜è®¾å¤‡æœ¬åœ°æ²¡æœ‰å‰¯æœ¬æä¾›ç»™è¿™äº›è¯·æ±‚(æˆ–è€…ç”±äºæŸäº›ç­–ç•¥éœ€è¦æ— æ³•å°†å‰¯æœ¬æä¾›ç»™è¯·æ±‚), è€Œå°†è¯·æ±‚è½¬å‘ç»™åŸå§‹æœåŠ¡å™¨, è¿™å°±è¢«ç§°ä¸ºç¼“å­˜æœªå‘½ä¸­; ç¼“å­˜å†éªŒè¯æ–‡æ¡£è¿‡æœŸå, ç¼“å­˜è®¾å¤‡å¹¶ä¸æ˜¯ç›´æ¥å»åŸå§‹æœåŠ¡å™¨é‡æ–°è¯·æ±‚æ–‡æ¡£, è€Œæ˜¯å°½å¯èƒ½å…ˆå»åŸå§‹æœåŠ¡å™¨æŸ¥çœ‹å…¶ç¼“å­˜æ–‡æ¡£æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–, è¿™ç§ æ–°é²œåº¦æ£€æµ‹ è¢«ç§°ä¸º HTTPç¼“å­˜å†éªŒè¯; å†éªŒè¯å‘½ä¸­å‚çœ‹ä¸‹æ–‡ å†éªŒè¯æœªå‘½ä¸­å‚çœ‹ä¸‹æ–‡ å…¬æœ‰ç¼“å­˜å’Œç§æœ‰ç¼“å­˜é€šç”¨é¦–éƒ¨å­—æ®µ(general header fields)Cache-Controlæœ‰ä¸¤ä¸ªç¼“å­˜å“åº”æŒ‡ä»¤: public å’Œ private ç¼“å­˜å¯ä»¥æ˜¯å•ä¸ªç”¨æˆ·ä¸“ç”¨çš„, ä¹Ÿå¯ä»¥æ˜¯æ•°åƒåç”¨æˆ·å…±äº«çš„ ä¸“ç”¨ç¼“å­˜è¢«ç§°ä¸ºç§æœ‰ç¼“å­˜(private cache), ç§æœ‰ç¼“å­˜æ˜¯ä¸ªäººçš„ç¼“å­˜, åŒ…å«äº†å•ä¸ªç”¨æˆ·æœ€å¸¸ç”¨çš„é¡µé¢ ; å…±äº«ç¼“å­˜è¢«ç§°ä¸ºå…¬æœ‰ç¼“å­˜(public cache), å…¬æœ‰ç¼“å­˜åŒ…å«äº†æŸä¸ªç”¨æˆ·å›¢ä½“å¸¸ç”¨é¡µé¢ ; ç§æœ‰ç¼“å­˜ç§æœ‰ç¼“å­˜ä¸éœ€è¦å¾ˆå¤§çš„åŠ¨åŠ›æˆ–å­˜å‚¨ç©ºé—´, è¿™æ ·å°±å¯ä»¥å°†å…¶åšçš„å¾ˆå°, å¾ˆä¾¿å®œ;Webæµè§ˆå™¨ä¸­å°±æœ‰å†…å»ºçš„ç§æœ‰ç¼“å­˜â€”å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šå°†å¸¸ç”¨æ–‡æ¡£ç¼“å­˜åœ¨ä½ ä¸ªäººç”µè„‘çš„ç£ç›˜å’Œå†…å­˜ä¸­, å¹¶ä¸”å…è®¸ç”¨æˆ·å»é…ç½®ç¼“å­˜çš„å¤§å°å’Œå„ç§è®¾ç½®; å…¬æœ‰ç¼“å­˜ å…¬æœ‰ç¼“å­˜æ˜¯ç‰¹æ®Šçš„å…±äº«ä»£ç†æœåŠ¡å™¨, è¢«ç§°ä¸ºç¼“å­˜ä»£ç†æœåŠ¡å™¨(caching proxy server), æˆ–è€…æ›´å¸¸è§åœ°è¢«ç§°ä¸ºä»£ç†ç¼“å­˜(proxy cache); ä»£ç†ç¼“å­˜ä¼šä»è‡ªå·±æœ¬åœ°ç¼“å­˜ä¸­ç»™ç”¨æˆ·æä¾›ç¼“å­˜èµ„æº, æˆ–è€…ä»£è¡¨ç”¨æˆ·ä¸æœåŠ¡å™¨è¿›è¡Œè”ç³»ã€‚å…¬æœ‰ç¼“å­˜ä¼šæ¥å—æ¥è‡ªå¤šä¸ªç”¨æˆ·çš„è®¿é—®, æ‰€ä»¥é€šè¿‡å®ƒå¯ä»¥æ›´å¥½åœ°å‡å°‘å†—ä½™æµé‡ å¦‚ä¸‹å›¾: æ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šé‡å¤åœ°è®¿é—®ä¸€ä¸ª(è¿˜ä¸åœ¨ç§æœ‰ç¼“å­˜ä¸­çš„)æ–°çš„â€çƒ­é—¨â€æ–‡æ¡£ã€‚æ¯ä¸ªç§æœ‰ç¼“å­˜éƒ½è¦è·å–åŒä¸€ä»½æ–‡æ¡£, è¿™æ ·å®ƒå°±ä¼šå¤šæ¬¡ç©¿è¿‡ç½‘ç»œã€‚ è€Œä½¿ç”¨å…±äº«çš„å…¬æœ‰ç¼“å­˜æ—¶, å¯¹äºè¿™ä¸ªæµè¡Œçš„å¯¹è±¡, ç¼“å­˜åªè¦å–ä¸€æ¬¡å°±è¡Œäº†, å®ƒä¼šç”¨å…±äº«çš„å‰¯æœ¬ä¸ºæ‰€æœ‰çš„è¯·æ±‚æœåŠ¡, ä»¥é™ä½ç½‘ç»œæµé‡ã€‚ ç¼“å­˜æ¨¡å‹åŸå§‹æœåŠ¡å™¨çš„å†…å®¹ä¸å¯èƒ½æ˜¯ä¸€æˆä¸å˜çš„, æ‰€ä»¥ç¼“å­˜æœåŠ¡å™¨è¿˜éœ€è¦ä¸æ—¶åœ°å»è¿›è¡Œæ£€æµ‹, çœ‹çœ‹å®ƒä»¬ä¿å­˜çš„å‰¯æœ¬æ˜¯å¦æ˜¯æœåŠ¡å™¨ä¸Šæœ€æ–°çš„å‰¯æœ¬; HTTPçš„ç¼“å­˜æœºåˆ¶åœ¨RFC7234ä¸­è¿›è¡Œäº†è¯¦ç»†çš„å®šä¹‰, åˆ†ä¸ºè¿‡æœŸæ¨¡å‹(Expiration Model) å’Œ éªŒè¯æ¨¡å‹(Validation Model) ä¸¤ç±»; åœ¨HTTPåè®®ä¸­, ç¼“å­˜å¤„äºå¯ç”¨çŠ¶æ€æ—¶ç§°ä¸º fresh(æ–°é²œ) çŠ¶æ€, è€Œå¤„äºä¸å¯ç”¨çš„çŠ¶æ€æ—¶åˆ™ç§°ä¸º stale(ä¸æ–°é²œ) çŠ¶æ€; è¿‡æœŸæ¨¡å‹ è¿‡æœŸæ¨¡å‹æ˜¯æŒ‡é¢„å…ˆå†³å®šå“åº”æ•°æ®çš„ä¿å­˜æœŸé™, å½“åˆ°è¾¾æœŸé™å, å°±ä¼šå†æ¬¡è®¿é—®åŸå§‹æœåŠ¡å™¨ç«¯æ¥é‡æ–°è·å¾—æ‰€éœ€çš„æ•°æ®; è¿‡æœŸæ¨¡å‹å¯ä»¥é€šè¿‡åœ¨æœåŠ¡å™¨çš„å“åº”æ¶ˆæ¯é‡ŒåŒ…å«ä½•æ—¶è¿‡æœŸçš„ä¿¡æ¯æ¥å®ç°, HTTP1.1ä¸­å®šä¹‰äº†ä¸¤ç§å®ç°æ–¹æ³•: Cache-Control:max-age å“åº”æ¶ˆæ¯é¦–éƒ¨ Cache-control è¡¨ç¤ºä»å½“å‰æ—¶åˆ»å¼€å§‹æ‰€ç»è¿‡çš„ç§’æ•°; è¯¥é¦–éƒ¨å¸¸ç”¨äºæ§åˆ¶å„ç±»ç¼“å­˜, é™¤äº† max-age å¤–, è¿˜å¯ä»¥è¿›è¡Œå„ç§æŒ‡å®š; ç¨åä¼šè¿›è¡Œä»‹ç» Expires å“åº”æ¶ˆæ¯é¦–éƒ¨ è€å¼çš„HTTP/1.0çš„å®ä½“é¦–éƒ¨å­—æ®µ, Expires æ˜¯ä½¿ç”¨ç»å¯¹æ—¶é—´, å¹¶ä½¿ç”¨RFC 1123ä¸­å®šä¹‰çš„æ—¶é—´æ ¼å¼, ä¾èµ–äºè®¡ç®—æœºæ—¶é’Ÿçš„æ­£ç¡®è®¾ç½® å®ƒä»¬éƒ½å¯ä»¥ç»™å“åº”å†…å®¹åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´, Cache-Control é¦–éƒ¨èƒ½ä½¿ç”¨ç›¸å¯¹æ—¶é—´, æ‰€ä»¥æ›´å€¾å‘ä¸ä½¿ç”¨æ¯”è¾ƒæ–°çš„ Cache-Control é¦–éƒ¨ å½“ä»¥ä¸Šä¸¤è€…åŒæ—¶ä½¿ç”¨çš„æ—¶å€™, Cache-Control å°†è·å¾—ä¼˜å…ˆ æ³¨æ„: æœ‰äº›æœåŠ¡å™¨ä¼šå›é€ä¸€ä¸ª Expires:0 å“åº”å¤´, è¯•å›¾å°†æ–‡æ¡£ç½®äºæ°¸è¿œè¿‡æœŸçš„çŠ¶æ€, ä½†è¿™ç§è¯­æ³•æ˜¯éæ³•çš„, å¯èƒ½ç»™æŸä¸ªè½¯ä»¶å¸¦æ¥é—®é¢˜, åº”è¯¥è¯•ç€æ”¯æŒè¿™ç§ç»“æ„çš„è¾“å…¥, ä½†æ˜¯ä¸åº”è¯¥äº§ç”Ÿè¿™ç§ç»“æ„çš„è¾“å‡º; è€Œ Cache-Control çš„ max-age åˆ™å¯ä»¥è®¾ç½® Cache-Control: max-age=0; Date é¦–éƒ¨ max-ageçš„è®¡ç®—ä¼šç”¨åˆ°åä¸ºDateçš„é¦–éƒ¨, è¯¥é¦–éƒ¨ç”¨æ¥æ˜¾ç¤ºæœåŠ¡å™¨ç«¯ç”Ÿæˆå“åº”æ¶ˆæ¯çš„æ—¶é—´ä¿¡æ¯, ä»è¯¥æ—¶é—´å¼€å§‹è®¡ç®—, å½“ç»è¿‡çš„æ—¶é—´è¶…è¿‡ max-age å€¼æ—¶, åˆ™å¯ä»¥è®¤ä¸ºç¼“å­˜å·²è¿‡æœŸ; æ–‡æ¡£è¿‡æœŸç®—æ³•ä¸º: expirationTime(è¿‡æœŸæ—¶é—´) = responseTime(Dateå¤´) + freshnessLifetime(max-age/Exprieå€¼) - currentAge(Ageå¤´) éªŒè¯æ¨¡å‹ æ–‡æ¡£è¿‡æœŸå, ç¼“å­˜è®¾å¤‡å¹¶ä¸æ˜¯ç›´æ¥å»æœåŠ¡å™¨é‡æ–°è¯·æ±‚æ–‡æ¡£, è€Œæ˜¯å°½å¯èƒ½å…ˆå»åŸå§‹æœåŠ¡å™¨æŸ¥çœ‹å…¶ç¼“å­˜æ–‡æ¡£æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–, è¿™ç§ æ–°é²œåº¦æ£€æµ‹ è¢«ç§°ä¸º HTTPç¼“å­˜å†éªŒè¯; å½“ç„¶, åœ¨æœåŠ¡å™¨æ²¡æœ‰è¿”å›â€å°†ç¼“å­˜æ•°æ®ä¿å­˜å¤šä¹…â€çš„ä¿¡æ¯, æœåŠ¡å™¨å°±éœ€è¦é€šè¿‡éªŒè¯æ¨¡å‹çš„ä¸¤ä¸ªå“åº”é¦–éƒ¨å­—æ®µ(Last-Modified å’Œ ETag)æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯æ›´æ–°ç›¸å…³çš„ä¿¡æ¯, åŠªåŠ›å‡å°‘å®¢æˆ·ç«¯ä¸å¿…è¦çš„è®¿é—®; æ‰€ä»¥è¯´, ä»…ä»…æ˜¯å·²ç¼“å­˜æ–‡æ¡£è¿‡æœŸäº†, è¿˜ä¸èƒ½è¯´æ˜è¯¥è¿‡æœŸæ–‡æ¡£å’ŒåŸå§‹æœåŠ¡å™¨ä¸Šçš„æ–‡æ¡£æœ‰å®é™…çš„åŒºåˆ«, è¿™åªæ˜¯æ„å‘³ç€ åˆ°æ—¶é—´è¿›è¡Œå†éªŒè¯äº† ; å› ä¸ºå®¢æˆ·ç«¯è¿˜å¯ä»¥è®¾ç½®ä¸€äº›ç¼“å­˜æ§åˆ¶é¡¹æ¥è¿›è¡Œå½±å“; åœ¨ç¼“å­˜æ–‡æ¡£è¿‡æœŸä¹‹å‰, ç¼“å­˜è®¾å¤‡å¯ä»¥éšæ„ä½¿ç”¨è¿™äº›å‰¯æœ¬, è€Œä¸”æ— éœ€ä¸æœåŠ¡å™¨åšä»»ä½•è”ç³», é™¤é å®¢æˆ·ç«¯è¯·æ±‚ä¸­åŒ…å« â€œé˜»æ­¢æä¾›ç¼“å­˜â€ çš„é¦–éƒ¨ Cache-Control:no-store ; æˆ–è€…å®¢æˆ·ç«¯è¯·æ±‚ä¸­åŒ…å« â€œåªæœ‰ç»è¿‡éªŒè¯æ‰èƒ½è¿”å›ç¼“å­˜å‰¯æœ¬â€çš„é¦–éƒ¨ Cache-Control:no-cache ; ä½†æ˜¯ä¸€æ—¦å·²ç¼“å­˜æ–‡æ¡£è¿‡æœŸ, ç¼“å­˜è®¾å¤‡å°±å¿…é¡»ä¸æœåŠ¡å™¨è¿›è¡Œå†éªŒè¯æ ¸å¯¹, é™¤éä½ è®¾ç½®äº† Cache-Control:only-if-cached, è¦æ±‚åªä½¿ç”¨ç¼“å­˜; å†éªŒè¯ä¾æ® ä¸ºäº†æœ‰æ•ˆåœ°è¿›è¡Œå†éªŒè¯, HTTPå®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„è¯·æ±‚, ä¸ç”¨ä»æœåŠ¡å™¨ä¸Šè·å–æ•´ä¸ªå¯¹è±¡, å°±å¯ä»¥å¿«é€Ÿæ£€æµ‹å‡ºå†…å®¹æ˜¯å¦æ˜¯æœ€æ–°çš„, HTTPçš„æ¡ä»¶æ–¹æ³•å¯ä»¥é«˜æ•ˆåœ°å®ç°å†éªŒè¯; HTTPå®šä¹‰äº†5ä¸ªæ¡ä»¶è¯·æ±‚é¦–éƒ¨, å¯¹ ç¼“å­˜å†éªŒè¯ æ¥è¯´æœ‰ç”¨çš„2ä¸ªé¦–éƒ¨æ˜¯ If-Mofified-Since å’Œ If-None-Match, æ‰€æœ‰çš„æ¡ä»¶é¦–éƒ¨éƒ½ä»¥å‰ç¼€If-å¼€å¤´ã€‚ å†éªŒè¯ è¯·æ±‚é¦–éƒ¨å­—æ®µ If-Modified-Since å¦‚æœè‡ªIf-Modified-SinceæŒ‡å®šæ—¥æœŸä¹‹å, æ–‡æ¡£è¢«ä¿®æ”¹äº†, If-Modified-Since æ¡ä»¶å°±ä¸ºçœŸ, é€šå¸¸GETå°±ä¼šæˆåŠŸæ‰§è¡Œ, æºå¸¦æ–°é¦–éƒ¨çš„æ–°æ–‡æ¡£ä¼šè¢«è¿”å›ç»™ç¼“å­˜, æ–°é¦–éƒ¨é™¤äº†å…¶ä»–ä¿¡æ¯ä¹‹å¤–, è¿˜åŒ…å«äº†ä¸€ä¸ªæ–°çš„è¿‡æœŸæ—¥æœŸ; å¦‚æœè‡ªIf-Modified-SinceæŒ‡å®šæ—¥æœŸä¹‹å, æ–‡æ¡£æ²¡è¢«ä¿®æ”¹, If-Modified-Since æ¡ä»¶å°±ä¸ºå‡, ä¼šå‘å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå°çš„ 304 Not Modifiedå“åº”æŠ¥æ–‡, ä¸ºäº†æé«˜æœ‰æ•ˆæ€§, ä¸ä¼šè¿”å›æ–‡æ¡£ä¸»ä½“; å¦åˆ™, å¦‚æœæ–‡æ¡£å‘ç”Ÿäº†å˜åŒ–, å°±è¿”å›å¸¦æœ‰æ–°ä¸»ä½“çš„200å“åº”; è¯·æ±‚é¦–éƒ¨å­—æ®µ If-Modified-Since å’Œ å®ä½“é¦–éƒ¨å­—æ®µ Last-Modified é…åˆå·¥ä½œ; å†éªŒè¯ è¯·æ±‚é¦–éƒ¨å­—æ®µ If-None-Match æœ‰äº›æ–‡æ¡£å¯èƒ½ä¼šè¢«å‘¨æœŸæ€§åœ°é‡å†™, ä½†å®é™…åŒ…å«çš„æ•°æ®å¸¸å¸¸å´æ˜¯ä¸€æ ·çš„ã€‚å°½ç®¡å†…å®¹æ²¡æœ‰å‘ç”Ÿå˜åŒ–, ä½†æ˜¯ä¿®æ”¹æ—¥æœŸä¼šå‘ç”Ÿå˜åŒ–; æœ‰äº›æ–‡æ¡£å¯èƒ½å†…å®¹è¢«ä¿®æ”¹äº†, ä½†æ˜¯æ‰€åšçš„ä¿®æ”¹å¹¶ä¸é‡è¦, ä¸éœ€è¦è®©ä¸–ç•ŒèŒƒå›´å†…çš„ç¼“å­˜éƒ½é‡è£…æ•°æ®(æ¯”å¦‚å¯¹æ‹¼å†™æˆ–æ³¨é‡Šçš„ä¿®æ”¹), æ¶‰åŠåˆ°å¼±éªŒè¯å™¨; æœ‰äº›æœåŠ¡å™¨æ— æ³•å‡†ç¡®åœ°åˆ¤å®šå…¶é¡µé¢çš„æœ€åä¿®æ”¹æ—¥æœŸ; æœ‰äº›æœåŠ¡å™¨æä¾›çš„æ–‡æ¡£ä¼šåœ¨äºšç§’é—´éš™å‘ç”Ÿå˜åŒ–(æ¯”å¦‚,å®æ—¶ç›‘è§†å™¨), å¯¹è¿™äº›æœåŠ¡å™¨æ¥è¯´, ä»¥ç§’ä¸ºç²’åº¦çš„ä¿®æ”¹æ—¥æœŸå¯èƒ½å°±ä¸å¤Ÿç”¨äº†; ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜, HTTPæœ‰ä¸€ä¸ªè¢«ç§°ä¸º å®ä½“æ ‡ç­¾(ETag) çš„ ç‰ˆæœ¬æ ‡è¯†ç¬¦, è¿™ä¸ªå®ä½“æ ‡ç­¾æ˜¯é™„åŠ åˆ°æ–‡æ¡£ä¸Šçš„ä»»æ„æ ‡ç­¾, æ ‡ç­¾å¯èƒ½å¯èƒ½åŒ…å«äº†æ–‡æ¡£åºåˆ—å·æˆ–ç‰ˆæœ¬å, æˆ–æ˜¯æ–‡æ¡£å†…å®¹çš„æ ¡éªŒåŠå…¶ä»–æŒ‡çº¹ä¿¡æ¯ã€‚å½“å¯¹æ–‡æ¡£è¿›è¡Œä¿®æ”¹æ—¶, å¯ä»¥ä¿®æ”¹æ–‡æ¡£çš„å®ä½“æ ‡ç­¾æ¥è¯´æ˜è¿™ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚è¿™æ ·, å¦‚æœå®ä½“æ ‡ç­¾è¢«ä¿®æ”¹äº†, ç¼“å­˜å°±å¯ä»¥ç”¨ If-None-Match æ¡ä»¶é¦–éƒ¨æ¥GETæ–‡æ¡£çš„æ–°å‰¯æœ¬äº†; å¦‚æœIf-None-Match ä¸ If-Modified-Since åŒæ—¶å­˜åœ¨, ä¸¤ä¸ªéƒ½è¦è¿›è¡ŒéªŒè¯; è¯·æ±‚é¦–éƒ¨å­—æ®µ If-None-Match å’Œ å“åº”é¦–éƒ¨å­—æ®µ ETag é…åˆå·¥ä½œ; å†éªŒè¯å‘½ä¸­: ç¼“å­˜åˆ°æœŸå, åœ¨å¯¹å‰¯æœ¬è¿›è¡Œå†éªŒè¯æ—¶, ä¼šå‘åŸå§‹æœåŠ¡å™¨å‘é€ä¸€ä¸ªå°çš„å†éªŒè¯è¯·æ±‚ã€‚å¦‚æœå‘ç°å†…å®¹æ²¡æœ‰å˜åŒ–, æœåŠ¡å™¨ä¼šä»¥ä¸€ä¸ªå°çš„ 304 Not Modified è¿›è¡Œå“åº”; åªè¦ç¼“å­˜è®¾å¤‡çŸ¥é“å‰¯æœ¬ä»ç„¶æœ‰æ•ˆ, å°±ä¼šå†æ¬¡å°†å‰¯æœ¬æ ‡è¯†ä¸ºæš‚æ—¶æ–°é²œçš„, å¹¶å°†å‰¯æœ¬æä¾›ç»™å®¢æˆ·ç«¯, è€Œä¸ç”¨åŸå§‹æœåŠ¡å™¨é‡æ–°è¿”å›æ–‡æ¡£, è¿™è¢«ç§°ä¸ºå†éªŒè¯å‘½ä¸­(revalidate hit) æˆ– ç¼“æ…¢å‘½ä¸­(slow hit); ç¼“å­˜å†éªŒè¯å‘½ä¸­è¿˜æ˜¯éœ€è¦ä¸åŸå§‹æœåŠ¡å™¨è¿›è¡Œæ ¸å¯¹, æ‰€ä»¥ä¼šæ¯”å•çº¯çš„ç¼“å­˜å‘½ä¸­è¦æ…¢, ä½†æ˜¯å®ƒå¹¶æ²¡æœ‰ä»æœåŠ¡å™¨ä¸­è·å–å¯¹è±¡æ•°æ®, æ‰€ä»¥è¦æ¯”ç¼“å­˜æœªå‘½ä¸­è¦å¿«ä¸€äº›ã€‚ å†éªŒè¯æœªå‘½ä¸­: å¦‚æœç¼“å­˜å‘ç°åŸå§‹æœåŠ¡å™¨å¯¹è±¡ä¸å·²ç¼“å­˜å‰¯æœ¬ä¸åŒ, åˆ™æœåŠ¡å™¨ä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ™®é€šçš„, å¸¦æœ‰å®Œæ•´å†…å®¹çš„ HTTP 200 OK å“åº”; è¿™ç§æ–¹å¼ ä¸ä»…éœ€è¦ä¸åŸå§‹æœåŠ¡å™¨è¿›è¡Œæ ¸å¯¹, è€Œä¸”ä¼šä»æœåŠ¡å™¨ä¸­è·å–å¯¹è±¡æ•°æ®, æ‰€ä»¥ç†è®ºä¸Šè²Œä¼¼è¦æ¯”ç¼“å­˜æœªå‘½ä¸­è¦æ…¢ä¸€äº›; å¦‚æœå†éªŒè¯å‘ç°æœåŠ¡å™¨å¯¹è±¡å·²ç»è¢«åˆ é™¤, æœåŠ¡å™¨å°±å›é€ä¸€ä¸ª 404 Not Found å“åº”, ç¼“å­˜ä¹Ÿä¼šå°†å…¶æœ¬åœ°å‰¯æœ¬åˆ é™¤; å¼±éªŒè¯å™¨ åªè¦åŸå§‹æœåŠ¡å™¨å†…å®¹å‘ç”Ÿå˜åŒ–, åˆ™å®ä½“æ ‡ç­¾å°±ä¼šå˜åŒ–, æ­£å¸¸æƒ…å†µä¸‹, å¼ºéªŒè¯å™¨å°±ä¼šå¯¹æ¯”å¤±è´¥, å¯¼è‡´æœåŠ¡å™¨ä¼šåœ¨ä¸€ä¸ª 200 OK å“åº”ä¸­è¿”å›æ–°çš„å†…å®¹ä»¥åŠæ–°çš„Etagæ ‡ç­¾; æœ‰æ—¶, æœåŠ¡å™¨å¸Œæœ›å¯¹æ–‡æ¡£è¿›è¡Œä¸€äº›ä¸é‡è¦çš„ä¿®æ”¹, å¹¶ä¸”ä¸éœ€è¦ä½¿æ‰€æœ‰å·²ç¼“å­˜å‰¯æœ¬éƒ½å¤±æ•ˆHTTP1.1æ”¯æŒçš„â€å¼±éªŒè¯å™¨â€, å°±å…è®¸å¯¹ä¸€äº›å†…å®¹åšä¿®æ”¹, æ­¤æ—¶æœåŠ¡å™¨ä¼šç”¨å‰ç¼€ W/ æ¥æ ‡è¯†å¼±éªŒè¯å™¨ ä¸ç®¡ç›¸å…³çš„å®ä½“å€¼ä»¥ä½•ç§æ–¹å¼å‘ç”Ÿäº†å˜åŒ–, å¼ºå®ä½“æ ‡ç­¾éƒ½è¦å‘ç”Ÿå˜åŒ–, è€Œç›¸å…³å®ä½“åœ¨è¯­ä¹‰ä¸Šå‘ç”Ÿäº†æ¯”è¾ƒé‡è¦çš„å˜åŒ–æ—¶, å¼±å®ä½“æ ‡ç­¾é¡µåº”è¯¥å‘ç”Ÿå˜åŒ– vary//todo å°ç»“å†éªŒè¯å‘½ä¸­ æ¯” ç¼“å­˜æœªå‘½ä¸­ è¦å¿«å†éªŒè¯æœªå‘½ä¸­ å‡ ä¹å’Œ ç¼“å­˜æœªå‘½ä¸­ é€Ÿåº¦ä¸€æ · Cache-Control ç¼“å­˜æ§åˆ¶å­—æ®µè¯¦è§£1.ä¹‹å‰åœ¨å„é€šç”¨é¦–éƒ¨å­—æ®µè¯¦è§£å·²ç»å¯¹å„é€‰é¡¹è¿›è¡Œäº†è¯´æ˜; è¡¥å…… (HTTP Cache-Control: max-ageå’Œmax-stale=sçš„åŒºåˆ«) immutable : å±äºç¼“å­˜æ§åˆ¶çš„ä¸€ä¸ªæ‰©å±•å±æ€§, å‚è€ƒ å½“ä¸€ä¸ªæ”¯æŒimmutableçš„å®¢æˆ·ç«¯æµè§ˆå™¨çœ‹åˆ°è¿™ä¸ªå±æ€§æ—¶, å®ƒåº”è¯¥çŸ¥é“, å¦‚æœæ²¡æœ‰è¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯è¯¥é¡µé¢å†…å®¹å°†ä¸ä¼šæ”¹å˜, è¿™æ ·æµè§ˆå™¨å°±ä¸åº”è¯¥å†å‘é€æœ‰æ¡ä»¶çš„é‡æ–°éªŒè¯è¯·æ±‚(æ¯”å¦‚é€šè¿‡If-None-Match æˆ– If-Modified-Sinceç­‰æ¡ä»¶å†å‘æœåŠ¡å™¨ç«¯å‘å‡ºæ›´æ–°æ£€æŸ¥);ä¹Ÿå°±æ˜¯è¯´, é€šå¸¸è¿‡å»æˆ‘ä»¬ä½¿ç”¨304å›å¤å®¢æˆ·ç«¯è¯¥é¡µé¢å†…å®¹æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·æŒ‰æµè§ˆå™¨çš„åˆ·æ–°æˆ–F5é”®ï¼Œæµè§ˆå™¨ä¼šå†æ¬¡å‘æœåŠ¡å™¨ç«¯å‘å‡ºè¯¥é¡µé¢å†…å®¹è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯å¦‚æœç¡®è®¤è¯¥é¡µé¢æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆå‘å›304ç»™å®¢æˆ·ç«¯ï¼Œä¸å†å‘é€è¯¥é¡µé¢çš„å®ä½“å†…å®¹ï¼Œè™½ç„¶è¿™æ ·èŠ‚çœäº†æ¥å›æµé‡ï¼Œä½†æ˜¯å¦‚æœå¤§å‹ç½‘ç«™çš„å¾ˆå¤šç”¨æˆ·ä¸ºäº†å¾—åˆ°åŠæ—¶ä¿¡æ¯ï¼Œç»å¸¸ä¼šåˆ·æ–°æµè§ˆå™¨ï¼Œè¿™å°±é€ æˆäº†å¤§é‡åˆ·æ–°è¯·æ±‚ï¼Œå‘æœåŠ¡å™¨ç«¯æ±‚è¯è¯¥é¡µé¢æ˜¯å¦æ”¹å˜ï¼Œè¿™ä¼šå½±å“ç½‘ç«™çš„å¸¦å®½ï¼Œä¹Ÿå¢åŠ æœåŠ¡å™¨ç«¯éªŒè¯å‹åŠ›ã€‚è€Œæ–°çš„é€‰é¡¹immutableå¯ä»¥æœç»è¿™ç§ç°è±¡ã€‚immutableå¯ä»¥èŠ‚çœHTTPè¯·æ±‚,ç¼©çŸ­è¯·æ±‚æ—¶é—´,è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨ä¸å¿…å†å¤„ç†304å“åº”äº†ã€‚","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"04. å„é€šç”¨é¦–éƒ¨å­—æ®µè¯¦è§£","slug":"http/2017-11-30-HTTP-04","date":"2017-11-30T11:50:02.000Z","updated":"2018-05-09T06:26:56.000Z","comments":true,"path":"2017/11/30/http/2017-11-30-HTTP-04/","link":"","permalink":"http://blog.renyimin.com/2017/11/30/http/2017-11-30-HTTP-04/","excerpt":"","text":"Cache-Control ç¼“å­˜èƒ½åŠ›æ§åˆ¶1.Cache-Control ç¼“å­˜æŒ‡ä»¤æ˜¯å•å‘çš„, å³è¯·æ±‚ä¸­å­˜åœ¨ä¸€ä¸ªæŒ‡ä»¤å¹¶ä¸æ„å‘³ç€å“åº”ä¸­å°†å­˜åœ¨åŒä¸€ä¸ªæŒ‡ä»¤; è¯¥æŒ‡ä»¤æ˜¯å¯é€‰çš„; æŒ‡ä»¤å¯ä»¥æœ‰å¤šä¸ªé€‰é¡¹, é€‰é¡¹ä¹‹é—´é€šè¿‡ , åˆ†éš”; 2.å¯ä»¥æŒ‰è¯·æ±‚å’Œå“åº”åˆ†ä¸º(P377) ç¼“å­˜è¯·æ±‚æŒ‡ä»¤(é€‰é¡¹å¦‚ä¸‹) ç¼“å­˜å“åº”æŒ‡ä»¤(é€‰é¡¹å¦‚ä¸‹) 3.æ³¨æ„ no-cache å’Œ must-revalidate çš„åŒºåˆ« no-cache: å‘Šè¯‰æµè§ˆå™¨ã€ç¼“å­˜æœåŠ¡å™¨ï¼Œä¸ç®¡æœ¬åœ°å‰¯æœ¬æ˜¯å¦è¿‡æœŸï¼Œä½¿ç”¨èµ„æºå‰¯æœ¬å‰ï¼Œä¸€å®šè¦åˆ°æºæœåŠ¡å™¨è¿›è¡Œå‰¯æœ¬æœ‰æ•ˆæ€§æ ¡éªŒ; must-revalidateï¼šå‘Šè¯‰æµè§ˆå™¨ã€ç¼“å­˜æœåŠ¡å™¨ï¼Œæœ¬åœ°å‰¯æœ¬è¿‡æœŸå‰ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°å‰¯æœ¬ï¼›æœ¬åœ°å‰¯æœ¬ä¸€æ—¦è¿‡æœŸï¼Œå¿…é¡»å»åŸå§‹æœåŠ¡å™¨è¿›è¡Œæœ‰æ•ˆæ€§æ ¡éªŒã€‚(è¿™åº”è¯¥æ˜¯ç¼“å­˜ç³»ç»Ÿçš„é»˜è®¤è¡Œä¸º, ä½†must-revalidateæŒ‡ä»¤ä½¿å¾—è¿™ä¸ªè¦æ±‚æ˜¯æ˜ç¡®çš„å‚è€ƒ; å¯å‚è€ƒ æ›´å¤šå‚è€ƒåé¢çš„åšæ–‡ç¼“å­˜ç›¸å…³ä¸­çš„ä»‹ç» Pragma å…¼å®¹Pragmaæ˜¯HTTP1.1ä¹‹å‰ç‰ˆæœ¬çš„å†å²é—ç•™å­—æ®µ, ä»…ä½œä¸ºä¸HTTP1.0åšå‘åå…¼å®¹;é™¤äº†ä¸åªç†è§£ Pragma:no-cache çš„HTTP/1.0åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’æ—¶ä½¿ç”¨; HTTP/1.1åº”ç”¨ç¨‹åºéƒ½åº”è¯¥ä½¿ç”¨Cache-Control:no-cache; Date å½“å‰æ—¶é—´ç®€å•æ¥è¯´å°±æ˜¯HTTPæŠ¥æ–‡çš„åˆ›å»ºæ—¥æœŸ, å®ƒä¼šå‚ä¸åˆ°ç¼“å­˜çš„è¿‡æœŸæ—¶é—´è¿ç®—ä¸­; å…¬å¼: expirationTime = responseTime(Dateå¤´) + freshnessLifetime(max-age/Exprieå€¼) - currentAge(Ageå¤´) é»˜è®¤æƒ…å†µä¸‹, Date çš„å€¼ä¸ºå½“å‰æ—¶é—´ è€Œå“åº”é¦–éƒ¨å­—æ®µä¸­çš„ Age å¤´å­—æ®µ, æ˜¯å‘Šè¯‰å®¢æˆ·ç«¯, æºæœåŠ¡å™¨åˆ›å»ºçš„ç¼“å­˜åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šå·²ç»ä¿å­˜äº†å¤šä¹…, å­—æ®µçš„å•ä½ä¸ºç§’; ä»£ç†åˆ›å»ºå“åº”æ—¶å¿…é¡»åŠ ä¸Šé¦–éƒ¨å­—æ®µAge; Connection è¯¥é¦–éƒ¨å­—æ®µå…·å¤‡ä¸¤ä¸ªä½œç”¨: æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µ å’Œ ç®¡ç†æŒä¹…è¿æ¥; æ›´å¤šå‚è€ƒHTTP - å¹¶è¡Œè¿æ¥, æŒä¹…è¿æ¥ æœªå®Œå¾…ç»­â€¦ Via ä½¿ç”¨é¦–éƒ¨å­—æ®µVia, æ˜¯ä¸ºäº†è¿½è¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„ä¼ è¾“è·¯å¾„;æŠ¥æ–‡åœ¨ç»è¿‡ä»£ç†æˆ–è€…ç½‘å…³æ—¶, ä¼šå…ˆåœ¨é¦–éƒ¨å­—æ®µViaä¸­é™„åŠ è¯¥æœåŠ¡å™¨çš„ä¿¡æ¯, ç„¶åå†è¿›è¡Œè½¬å‘ã€‚ Viaé¦–éƒ¨æ˜¯ä¸ºäº†è¿½è¸ªä¼ è¾“è·¯å¾„, æ‰€ä»¥ä¹Ÿç»å¸¸ä¼šå’ŒTRACEæ–¹æ³•ä¸€èµ·ä½¿ç”¨, æ¯”å¦‚ä»£ç†æœåŠ¡å™¨å—åˆ°ç”±TRACEæ–¹æ³•å‘é€è¿‡æ¥çš„è¯·æ±‚(å…¶ä¸­Max-Forward:0)æ—¶, ä»£ç†æœåŠ¡å™¨å°±ä¸èƒ½å†è½¬å‘è¯¥è¯·æ±‚äº†,è¿™ç§æƒ…å†µä¸‹, ä»£ç†æœåŠ¡å™¨ä¼šå°†è‡ªèº«çš„ä¿¡æ¯é™„åŠ åˆ°Viaé¦–éƒ¨å, è¿”å›è¯¥è¯·æ±‚çš„å“åº”ã€‚ æœªå®Œå¾…ç»­â€¦ Transfer-Encodingä¼ è¾“ç¼–ç  è¯¥é€šç”¨é¦–éƒ¨å­—æ®µè§„å®šäº†ä¼ è¾“æŠ¥æ–‡ä¸»ä½“æ—¶é‡‡ç”¨çš„ç¼–ç æ–¹å¼; HTTP/1.1çš„ä¼ è¾“ç¼–ç æ–¹å¼ä»…å¯¹åˆ†å—ä¼ è¾“ç¼–ç æœ‰æ•ˆ, å³åªèƒ½è®¾ç½®ä¸º Transfer-Encoding:chunked; å‚è€ƒ MDN Doc; Content-Encoding å’Œ Transfer-Encoding äºŒè€…ç»å¸¸ä¼šç»“åˆæ¥ç”¨, å…¶å®å°±æ˜¯é’ˆå¯¹ Transfer-Encoding çš„åˆ†å—å†è¿›è¡Œ Content-Encoding å‹ç¼©; å¯¹æ¯” è¯·æ±‚é¦–éƒ¨å­—æ®µAccept-encodingå†…å®¹ç¼–ç  (P369) è¯·æ±‚é¦–éƒ¨å­—æ®µ Accept-encoding æ˜¯å°†å®¢æˆ·ç«¯ç”¨æˆ·ä»£ç†(æµè§ˆå™¨)æ‰€æ”¯æŒçš„å†…å®¹ç¼–ç æ–¹å¼(é€šå¸¸æ˜¯æŸç§å‹ç¼©ç®—æ³•) åŠ å†…å®¹ç¼–ç æ–¹å¼çš„ä¼˜å…ˆçº§é¡ºåº, é€šçŸ¥ç»™æœåŠ¡å™¨; é€šè¿‡å†…å®¹åå•†, æœåŠ¡ç«¯ä¼šé€‰æ‹©ä¸€ä¸ªå®¢æˆ·ç«¯æ”¯æŒçš„æ–¹å¼, ä½¿ç”¨å¹¶åœ¨ å“åº”æŠ¥æ–‡çš„å®ä½“é¦–éƒ¨å­—æ®µ Content-Encoding ä¸­é€šçŸ¥å®¢æˆ·ç«¯, æœåŠ¡å™¨é€‰æ‹©äº†å“ªç§å†…å®¹ç¼–ç æ–¹å¼; å¦å¤–, å¯ä»¥ä¸€æ¬¡æ€§æŒ‡å®šå¤šç§å†…å®¹ç¼–ç ! ä¹Ÿå¯ä»¥ä½¿ç”¨æƒé‡qå€¼æ¥è¡¨ç¤ºç›¸å¯¹ä¼˜å…ˆçº§; æ­£å¸¸æƒ…å†µä¸‹, ä¸»è¦é‡‡ç”¨4ç§ç¼–ç æ–¹å¼: gzip, compress, deflate, identity; å³ä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒæŸäº›ç›¸åŒçš„å‹ç¼©ç®—æ³•ï¼Œä½†å¦‚æœAccept-encoding:identity, è¡¨ç¤ºå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å¯¹å“åº”ä¸»ä½“ä¸è¦è¿›è¡Œå‹ç¼©, å‡ºç°çš„ä¸¤ç§æƒ…å†µçš„å¸¸è§æƒ…å½¢æ˜¯ï¼š è¦å‘é€çš„æ•°æ®å·²ç»ç»è¿‡å‹ç¼©, å†æ¬¡è¿›è¡Œå‹ç¼©ä¸ä¼šå¯¼è‡´è¢«ä¼ è¾“çš„æ•°æ®é‡æ›´å°, ä¸€äº›å›¾åƒæ ¼å¼çš„æ–‡ä»¶ä¼šå­˜åœ¨è¿™ç§æƒ…å†µ; æœåŠ¡å™¨è¶…è½½, æ— æ³•æ‰¿å—å‹ç¼©éœ€æ±‚å¯¼è‡´çš„è®¡ç®—å¼€é”€, é€šå¸¸, å¦‚æœæœåŠ¡å™¨ä½¿ç”¨è¶…è¿‡80%çš„è®¡ç®—èƒ½åŠ›, å¾®è½¯å»ºè®®ä¸è¦å‹ç¼©; åªè¦identity(è¡¨ç¤ºä¸éœ€è¦è¿›è¡Œä»»ä½•ç¼–ç )æ²¡æœ‰è¢«æ˜ç¡®ç¦æ­¢ä½¿ç”¨(æ²¡æœ‰æ˜ç¡®é€šè¿‡ identity;q=0 æˆ–æ˜¯ *;q=0 æŒ‡ä»¤æ˜ç¡®è®¾ç½® identity çš„æƒé‡å€¼ä¸º0), ä¸€æ—¦ç¦æ­¢å°±è¡¨ç¤º æœåŠ¡ç«¯å¿…é¡»è¿›è¡Œç¼–ç ; æ²¡æœ‰ç¦æ­¢identity, åˆ™æœåŠ¡å™¨ç¦æ­¢è¿”å›è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯çš„ 406 Not Acceptable å“åº”; ç¦æ­¢identityå, æœåŠ¡å™¨æ‰å¯èƒ½å› ä¸ºå®åœ¨æ²¡æœ‰åˆé€‚çš„å†…å®¹ç¼–ç ç±»å‹è€Œ, è¿”å›è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯çš„406 Not Acceptable å‚è€ƒMDN å¯¹æ¯” å®ä½“é¦–éƒ¨å­—æ®µ Content-encodingå†…å®¹ç¼–ç å®ä½“é¦–éƒ¨å­—æ®µ Content-encoding ä¼šå‘Šè¯‰å®¢æˆ·ç«¯, æœåŠ¡å™¨å¯¹å®ä½“çš„ä¸»ä½“éƒ¨åˆ†é€‰ç”¨çš„å†…å®¹ç¼–ç æ–¹å¼ å¯¹æ¯” è¯·æ±‚é¦–éƒ¨å­—æ®µAccept-charsetè¯·æ±‚é¦–éƒ¨å­—æ®µ Accept-charset ä¼šå‘Šè¯‰æœåŠ¡å™¨, ç”¨æˆ·ä»£ç†(æµè§ˆå™¨)æ‰€æ”¯æŒçš„å­—ç¬¦é›†å’Œå­—ç¬¦é›†çš„ç›¸å¯¹ä¼˜å…ˆé¡ºåºã€‚(P388) å¯ä»¥ä¸€æ¬¡æ€§æŒ‡å®šå¤šç§å­—ç¬¦é›†; ä¹Ÿå¯ä»¥ä½¿ç”¨æƒé‡qå€¼æ¥è¡¨ç¤ºç›¸å¯¹ä¼˜å…ˆçº§; å¯¹æ¯” è¯·æ±‚é¦–éƒ¨å­—æ®µAccept-Languageè¯·æ±‚é¦–éƒ¨å­—æ®µ Accept-charset ä¼šå‘Šè¯‰æœåŠ¡å™¨, ç”¨æˆ·ä»£ç†(æµè§ˆå™¨)æ‰€æ”¯æŒçš„è¯­è¨€å’Œè¯­è¨€çš„ç›¸å¯¹ä¼˜å…ˆé¡ºåºã€‚ å¯ä»¥ä¸€æ¬¡æ€§æŒ‡å®šå¤šç§å­—ç¬¦é›†; ä¹Ÿå¯ä»¥ä½¿ç”¨æƒé‡qå€¼æ¥è¡¨ç¤ºç›¸å¯¹ä¼˜å…ˆçº§; å°ç»“ è¯·æ±‚é¦–éƒ¨å­—æ®µAccept-encoding å’Œ å®ä½“é¦–éƒ¨å­—æ®µContent-encodingæ¥å†³å®šå†…å®¹å‹ç¼©æ–¹å¼; é€šç”¨é¦–éƒ¨å­—æ®µTransfer-Encodingç”¨æ¥å†³å®šå“åº”å®ä½“æ˜¯å¦åˆ†å—; è¯·æ±‚é¦–éƒ¨å­—æ®µAccept-charset, Accept-Language æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±èƒ½æ”¯æŒçš„å­—ç¬¦ç¼–ç å’Œè¯­è¨€åŠå…¶ä¸­çš„ä¼˜å…ˆé¡ºåº; TrailerUpgradeWarning~~æœªå®Œå¾…ç»­","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"03. HTTPçŠ¶æ€ç è¯¦è§£","slug":"http/2017-11-30-HTTP-03","date":"2017-11-30T06:30:12.000Z","updated":"2018-05-23T01:36:32.000Z","comments":true,"path":"2017/11/30/http/2017-11-30-HTTP-03/","link":"","permalink":"http://blog.renyimin.com/2017/11/30/http/2017-11-30-HTTP-03/","excerpt":"","text":"1xx 101: å‚è€ƒåšæ–‡WebSocketç®€å•ç¤ºä¾‹åˆ†æ (åšåè®®å‡çº§, è¿˜ä¼šå“åº”: Connection: Upgrade)~~æœªå®Œå¾…ç»­ 2xx Web APIçš„è®¾è®¡ä¸å¼€å‘ P109 200 OK : 200ç éå¸¸å‡ºå, ä¼¼ä¹æ²¡æœ‰å¯¹å®ƒè¿›ä¸€æ­¥è¯´æ˜çš„å¿…è¦; 201 Created : å½“åœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºæ•°æ®æˆåŠŸæ—¶, ä¼šè¿”å›201çŠ¶æ€ç ; ä¹Ÿå°±æ˜¯ä½¿ç”¨ POST è¯·æ±‚æ–¹æ³•çš„åœºæ™¯ (å¦‚:ç”¨æˆ·ç™»å½•åæ·»åŠ äº†æ–°ç”¨æˆ·, ä¸Šä¼ äº†å›¾ç‰‡ç­‰æ–°åˆ›å»ºæ•°æ®çš„åœºæ™¯) 202 Accepted : åœ¨å¼‚æ­¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶, å®ƒç”¨æ¥è¡¨ç¤ºæœåŠ¡å™¨ç«¯å·²ç»æ¥å—äº†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚, ä½†å¤„ç†å°šæœªç»“æŸ; åœ¨æ–‡ä»¶æ ¼å¼è½¬æ¢, å¤„ç†è¿œç¨‹é€šçŸ¥(Apple Push Notificationç­‰)è¿™ç±»å¾ˆè€—æ—¶çš„åœºæ™¯ä¸­, å¦‚æœç­‰åˆ°æ‰€æœ‰å¤„ç†éƒ½ç»“æŸåæ‰å‘å®¢æˆ·ç«¯è¿”å›å“åº”æ¶ˆæ¯, å°±ä¼šèŠ±è´¹ç›¸å½“é•¿çš„æ—¶é—´, é€ æˆåº”ç”¨å¯ç”¨æ€§ä¸é«˜; è¿™æ—¶é‡‡ç”¨çš„æ–¹æ³•æ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›ä¸€æ¬¡å“åº”æ¶ˆæ¯, ç„¶åç«‹åˆ»å¼€å§‹å¼‚æ­¥å¤„ç†ã€‚ 202çŠ¶æ€ç å°±è¢«ç”¨äºå‘ŠçŸ¥å®¢æˆ·ç«¯æœåŠ¡å™¨ç«¯å·²ç»å¼€å§‹å¤„ç†è¯·æ±‚, ä½†æ•´ä¸ªå¤„ç†è¿‡ç¨‹å°šæœªç»“æŸ; æ¯”å¦‚: ä»¥LinkedInçš„å‚ä¸è®¨è®ºçš„APIä¸ºä¾‹å¦‚æœæˆåŠŸå‚ä¸è®¨è®ºå¹¶å‘è¡¨æ„è§, æœåŠ¡å™¨ç«¯é€šå¸¸ä¼šè¿”å›201çŠ¶æ€ç ;ä½†å¦‚æœéœ€è¦å¾—åˆ°ç¾¤ä¸»çš„ç¡®è®¤, é‚£ä¹ˆæ‰€å‘è¡¨çš„æ„è§å°±æ— æ³•ç«‹å³åœ¨é¡µé¢æ˜¾ç¤ºå‡ºæ¥, è¿™æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦è¿”å›202çŠ¶æ€ç ; ä»å¹¿ä¹‰ä¸Šæ¥çœ‹, è¯¥åœºæ™¯ä¹Ÿå±äºå¼‚æ­¥å¤„ç†, ä½†å’Œç¨‹åºè®¾è®¡é‡Œçš„å¼‚æ­¥æ‰§è¡Œå½“ç„¶ä¸åŒ; 204 No Content : æ­£å¦‚å…¶å­—é¢æ„æ€, å½“å“åº”æ¶ˆæ¯ä¸ºç©ºæ—¶ä¼šè¿”å›è¯¥çŠ¶æ€ç ã€‚ å…¶å®å°±æ˜¯å‘Šè¯‰æµè§ˆå™¨, æœåŠ¡ç«¯æ‰§è¡ŒæˆåŠŸäº†, ä½†æ˜¯æ²¡ä»€ä¹ˆæ•°æ®è¿”å›ç»™ä½ , æ‰€ä»¥ä½ ä¸ç”¨åˆ·æ–°é¡µé¢, ä¹Ÿä¸ç”¨å¯¼å‘æ–°çš„é¡µé¢; åœ¨ç”¨DELETEæ–¹æ³•åˆ é™¤æ•°æ®æ—¶, æœåŠ¡å™¨ç«¯é€šå¸¸ä¼šè¿”å›204çŠ¶æ€ç (é˜®ä¸€å³°åšæ–‡ä¹Ÿæåˆ°è¿‡, å¯¹DELETEé€‚ç”¨); é™¤æ­¤ä¹‹å¤–, ä¹Ÿæœ‰äººè®¤ä¸ºåœ¨ä½¿ç”¨ PATCH æ–¹æ³•æ›´æ–°æ•°æ®æ—¶, å› ä¸ºåªæ˜¯æ›´æ–°å·²æœ‰æ•°æ®, æ‰€ä»¥è¿”å›204çŠ¶æ€ç æ›´åŠ è‡ªç„¶; å…³äº204çŠ¶æ€ç çš„è®¨è®ºå¯ä»¥å‚è€ƒ p111; 205 Reset Content : å‘Šè¯‰æµè§ˆå™¨, é¡µé¢è¡¨å•éœ€è¦è¢«é‡ç½®; 205çš„æ„æ€æ˜¯æœåŠ¡ç«¯åœ¨æ¥æ”¶äº†æµè§ˆå™¨POSTè¯·æ±‚ä»¥å, å¤„ç†æˆåŠŸä»¥å, å‘Šè¯‰æµè§ˆå™¨, æ‰§è¡ŒæˆåŠŸäº†, è¯·æ¸…ç©ºç”¨æˆ·å¡«å†™çš„Formè¡¨å•, æ–¹ä¾¿ç”¨æˆ·å†æ¬¡å¡«å†™; 206 Partial Content : æˆåŠŸæ‰§è¡Œäº†ä¸€ä¸ªéƒ¨åˆ†æˆ–Range(èŒƒå›´)çš„è¯·æ±‚; 206å“åº”ä¸­, å¿…é¡»åŒ…å« Content-Range, Date ä»¥åŠ ETagæˆ–Content-Locationé¦–éƒ¨; 3xx300 Multiple Choices : å®¢æˆ·ç«¯é©±åŠ¨æ–¹å¼è¿›è¡Œå†…å®¹åå•†æ—¶, æœåŠ¡å™¨å¯èƒ½è¿”å›å¤šä¸ªè¿æ¥ä¾›å®¢æˆ·ç«¯è¿›è¡Œé€‰æ‹© (æ¯”å¦‚å¤šè¯­è¨€ç½‘ç«™å¯èƒ½ä¼šå‡ºç°); 301 Moved Permanently : åœ¨è¯·æ±‚çš„URLå·²ç»è¢«ç§»é™¤æ—¶ä½¿ç”¨, å“åº”çš„Locationé¦–éƒ¨ä¸­åº”è¯¥åŒ…å«èµ„æºç°åœ¨æ‰€å¤„çš„URL; (æ¯”è¾ƒé€‚åˆæ°¸ä¹…é‡å®šå‘) æ¯”å¦‚ä½ ä» www.test.com/location.php ä¸­locationè·³è½¬åˆ° www.test.com/index.html æ—¶, å¦‚æœå“åº”çš„æ˜¯301; åˆ™å³ä¾¿ç¨åå–æ¶ˆäº†location.phpä¸­çš„è·³è½¬(æˆ–è€…ä¿®æ”¹äº†è·³è½¬åœ°å€), ç”±äºæµè§ˆå™¨è¿˜æ˜¯ä¼šè®¤ä¸ºä½ ä¹‹å‰çš„è·³è½¬æ˜¯æ°¸ä¹…æ€§çš„, å†æ¬¡è®¿é—®www.test.com/location.phpä»ç„¶ä¼šè·³è½¬åˆ°ä¹‹å‰çš„è·³è½¬é“¾æ¥(é™¤éæ¸…æµè§ˆå™¨ç¼“å­˜); å¦å¤–, å‡è®¾ä½ ä¹‹å‰æ˜¯å…ˆè®¿é—®www.test.com/test.html, ç„¶åé€šè¿‡postæäº¤åˆ°www.test.com/location.php, æœ€åç”±location.phpå†è¿›è¡Œè·³è½¬çš„è¯, ä¼šè½¬æˆGET; 302 Found: ä¸301ç±»ä¼¼, ä½†æ˜¯å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨Locationé¦–éƒ¨ç»™å‡ºçš„URLæ¥è¿›è¡Œä¸´æ—¶å®šä½èµ„æº, å°†æ¥çš„è¯·æ±‚ä»åº”è¯¥ä½¿ç”¨è€çš„URL; æ¯”å¦‚ä½ ä» www.test.com/location.php ä¸­locationè·³è½¬åˆ° www.test.com/index.html æ—¶, å¦‚æœå“åº”çš„æ˜¯302; å¦‚æœç¨åå–æ¶ˆäº†location.phpä¸­çš„è·³è½¬, å†æ¬¡è®¿é—®www.test.com/location.php, ä¼šå‘ç°ä¸ä¼šè¿›è¡Œè·³è½¬, è€Œæ˜¯è®¿é—®åˆ° location.php ä¿®æ”¹åçš„ä»£ç  (ä¸ç”¨æ¸…æµè§ˆå™¨ç¼“å­˜); å¦å¤–, å‡è®¾ä½ ä¹‹å‰æ˜¯å…ˆè®¿é—®www.test.com/test.html, ç„¶åé€šè¿‡postæäº¤åˆ°www.test.com/location.php, æœ€åç”±location.phpå†è¿›è¡Œè·³è½¬çš„è¯, ä¼šè½¬æˆGET; 303 See Other : HTTP/1.1ä½¿ç”¨303æ¥å®ç°å’Œ302ä¸€æ ·çš„ä¸´æ—¶é‡å®šå‘; 307 Temporary Redirect HTTP/1.1è§„èŒƒè¦æ±‚ç”¨307æ¥å–ä»£302è¿›è¡Œä¸´æ—¶é‡å®šå‘; (302ä¸´æ—¶é‡å®šå‘ç•™ç»™HTTP/1.0) æ‰€ä»¥ä»–ä¹Ÿå…·å¤‡302ä¸´æ—¶é‡å®šå‘çš„ç‰¹ç‚¹; ä½†æ˜¯, ä¸ 302, 303 ä¸åŒ, å®ƒä¼šå°†å®¢æˆ·ç«¯çš„POSTè¯·æ±‚, å‘é€ç»™locationçš„ç›®æ ‡é¡µ; å‡è®¾ä½ ä¹‹å‰æ˜¯å…ˆè®¿é—®www.test.com/test.html, ç„¶åé€šè¿‡postæäº¤åˆ°www.test.com/location.php, æœ€åç”±location.phpå†è¿›è¡Œè·³è½¬çš„è¯, ä»ç„¶æ˜¯POST; 308 Permanent Redirect è²Œä¼¼ä¸æ˜¯rfc2616çš„æ ‡å‡† å…·å¤‡å’Œ301æ°¸ä¹…é‡å®šå‘çš„ç‰¹ç‚¹, éœ€è¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æ‰è¡Œ; ä½†æ˜¯, ä¸ 301 ä¸åŒ, å®ƒä¼šå°†å®¢æˆ·ç«¯çš„POSTè¯·æ±‚, å‘é€ç»™locationçš„ç›®æ ‡é¡µ; å‡è®¾ä½ ä¹‹å‰æ˜¯å…ˆè®¿é—®www.test.com/test.html, ç„¶åé€šè¿‡postæäº¤åˆ°www.test.com/location.php, æœ€åç”±location.phpå†è¿›è¡Œè·³è½¬çš„è¯, ä»ç„¶æ˜¯POST; 304 Not Modified : å‚è€ƒåšæ–‡ç¼“å­˜ç›¸å…³ 4xx Web APIçš„è®¾è®¡ä¸å¼€å‘ P1134å­—å¤´çŠ¶æ€ç ä¸»è¦ç”¨äºæè¿°å› å®¢æˆ·ç«¯è¯·æ±‚çš„é—®é¢˜è€Œå¼•å‘çš„é”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´, æœåŠ¡å™¨ç«¯ä¸å­˜åœ¨é—®é¢˜, ä½†æœåŠ¡å™¨ç«¯æ— æ³•ç†è§£å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚, æˆ–è™½ç„¶æœåŠ¡å™¨ç«¯èƒ½å¤Ÿç†è§£ä½†è¯·æ±‚å´æ²¡æœ‰è¢«æ‰§è¡Œ, å½“é‡åˆ°è¿™äº›æƒ…å†µå¼•å‘çš„é”™è¯¯æ—¶, æœåŠ¡å™¨ç«¯ä¾¿ä¼šå‘å®¢æˆ·ç«¯è¿”å›è¿™ä¸€ç±»åˆ«çš„çŠ¶æ€ç ã€‚å› æ­¤, å½“æœåŠ¡å™¨ç«¯è¿”å›4å­—å¤´çš„çŠ¶æ€ç æ—¶, å°±è¡¨ç¤ºå®¢æˆ·ç«¯çš„è®¿é—®æ–¹å¼å‘ç”Ÿäº†é—®é¢˜, ç”¨æˆ·éœ€è¦æ£€æŸ¥ä¸€ä¸‹å®¢æˆ·ç«¯çš„è®¿é—®æ–¹å¼æˆ–è®¿é—®çš„ç›®æ ‡èµ„æºç­‰ã€‚ 400 Bad Request : è¡¨ç¤ºå…¶ä»–é”™è¯¯çš„æ„æ€, å³å…¶ä»–4å­—å¤´çŠ¶æ€ç éƒ½æ— æ³•æè¿°çš„é”™è¯¯ç±»å‹; 401 Unauthorized : è¡¨ç¤ºè®¤è¯(Authentication)ç±»å‹çš„é”™è¯¯ æ¯”å¦‚å½“éœ€è¦å…ˆè¿›è¡Œç™»å½•æ“ä½œ, è€Œå´æ²¡æœ‰å‘Šè¯‰æœåŠ¡å™¨ç«¯æ‰€éœ€çš„ä¼šè¯ä¿¡æ¯(æ¯”å¦‚token..), æœåŠ¡å™¨ç«¯å°±ä¼šè¿”å›401çŠ¶æ€ç , å‘ŠçŸ¥å®¢æˆ·ç«¯å‡ºé”™çš„å¤§è‡´åŸå› ; 403 Forbidden : å’Œ401çŠ¶æ€ç æ¯”è¾ƒç›¸ä¼¼, æ‰€ä»¥ä¹Ÿç»å¸¸è¢«æ··æ·†; å…¶å®403è¡¨ç¤ºçš„æ˜¯æˆæƒ(Authotization)ç±»å‹çš„é”™è¯¯, æˆæƒå’Œè®¤è¯çš„ä¸åŒä¹‹å¤„æ˜¯: è®¤è¯è¡¨ç¤ºâ€è¯†åˆ«å‰æ¥è®¿é—®çš„æ˜¯è°â€, è€Œæˆæƒåˆ™è¡¨ç¤ºâ€èµ‹äºˆç‰¹å®šç”¨æˆ·æ‰§è¡Œç‰¹å®šæ“ä½œçš„æƒé™â€ é€šä¿—åœ°è¯´: 401çŠ¶æ€ç è¡¨ç¤ºâ€æˆ‘ä¸çŸ¥é“ä½ æ˜¯è°â€, 403çŠ¶æ€ç è¡¨ç¤ºâ€è™½ç„¶çŸ¥é“ä½ æ˜¯è°, ä½†ä½ æ²¡æœ‰æ‰§è¡Œè¯¥æ“ä½œçš„æƒé™â€ 404 Not Found : è¡¨ç¤ºè®¿é—®çš„æ•°æ®ä¸å­˜åœ¨, ä½†æ˜¯ ä¾‹å¦‚å½“å®¢æˆ·ç«¯æ¹¿åº¦è·å–ä¸å­˜åœ¨çš„ç”¨æˆ·ä¿¡æ¯æ—¶, æˆ–è€…è¯•å›¾è®¿é—®åŸæœ¬å°±ä¸å­˜åœ¨çš„ç«¯ç‚¹æ—¶, æœåŠ¡å™¨å°±ä¼šè¿”å›404çŠ¶æ€ç ; æ‰€ä»¥, å¦‚æœå®¢æˆ·ç«¯æƒ³è¦è·å–ç”¨æˆ·ä¿¡æ¯, å´å¾—åˆ°æœåŠ¡å™¨ç«¯è¿”å›çš„404çŠ¶æ€ç , å®¢æˆ·ç«¯ä»…å‡­â€404 Not Foundâ€å°†éš¾ä»¥åŒºåˆ†ç©¶ç«Ÿæ˜¯ç”¨æˆ·ä¸å­˜åœ¨, è¿˜æ˜¯ç«¯ç‚¹URIé”™è¯¯å¯¼è‡´è®¿é—®äº†åŸæœ¬ä¸å­˜åœ¨çš„URI; 405 Method Not Allowed : è¡¨ç¤ºè™½ç„¶è®¿é—®çš„ç«¯ç‚¹å­˜åœ¨, ä½†å®¢æˆ·ç«¯ä½¿ç”¨çš„HTTPæ–¹æ³•ä¸è¢«æœåŠ¡å™¨ç«¯å…è®¸; æ¯”å¦‚å®¢æˆ·ç«¯ä½¿ç”¨äº†POSTæ–¹æ³•æ¥è®¿é—®åªæ”¯æŒGETæ–¹æ³•çš„ä¿¡æ¯æ£€ç´¢ä¸“ç”¨çš„API; åˆæ¯”å¦‚å®¢æˆ·ç«¯ç”¨äº†GETæ–¹æ³•æ¥è®¿é—®æ›´æ–°æ•°æ®ä¸“ç”¨çš„APIç­‰; 406 Not Acceptable : æœåŠ¡å™¨ç«¯APIä¸æ”¯æŒå®¢æˆ·ç«¯æŒ‡å®šçš„æ•°æ®æ ¼å¼æ—¶, æœåŠ¡å™¨ç«¯æ‰€è¿”å›çš„çŠ¶æ€ç ; æ¯”å¦‚, æœåŠ¡å™¨ç«¯åªæ”¯æŒJSONå’ŒXMLè¾“å‡ºçš„APIè¢«å®¢æˆ·ç«¯æŒ‡å®šè¿”å›YAMLçš„æ•°æ®æ ¼å¼æ—¶, æœåŠ¡å™¨ç«¯å°±ä¼šè¿”å›406çŠ¶æ€ç ; 408 Request Timeout : å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚è‡³æœåŠ¡å™¨ç«¯æ‰€éœ€çš„æ—¶é—´è¿‡é•¿æ—¶, å°±ä¼šè§¦å‘æœåŠ¡å™¨ç«¯çš„è¶…æ—¶å¤„ç†, ä»è€Œä½¿æœåŠ¡å™¨ç«¯è¿”å›è¯¥çŠ¶æ€ç ; 409 Conflict: ç”¨äºè¡¨ç¤ºèµ„æºå‘ç”Ÿå†²çªæ—¶çš„é”™è¯¯ (estä¸­å°±ä¼šæœ‰è¯¥é”™è¯¯ç ) æ¯”å¦‚é€šè¿‡æŒ‡å®šIDç­‰å”¯ä¸€é”®å€¼ä¿¡æ¯æ¥è°ƒç”¨æ³¨å†ŒåŠŸèƒ½çš„APIæ—¶, å€˜è‹¥å·²æœ‰ç›¸åŒIDçš„æ•°æ®å­˜åœ¨, å°±ä¼šå¯¼è‡´æœåŠ¡å™¨ç«¯è¿”å›409çŠ¶æ€ç ; åœ¨ä½¿ç”¨é‚®ç®±åœ°å€åŠFacebook IDç­‰ä¿¡æ¯è¿›è¡Œæ–°ç”¨æˆ·æ³¨å†Œæ—¶, å¦‚æœè¯¥é‚®ç®±åœ°å€æˆ–è€…IDå·²ç»è¢«å…¶ä»–ç”¨æˆ·æ³¨å†Œ, å°±ä¼šå¼•èµ·å†²çª, è¿™æ—¶æœåŠ¡å™¨ç«¯å°±ä¼šè¿”å›409çŠ¶æ€ç å‘ŠçŸ¥å®¢æˆ·ç«¯è¯¥é‚®ç®±åœ°å€æˆ–IDå·²è¢«ä½¿ç”¨; 410 Gone : å’Œ 404çŠ¶æ€ç  ç›¸åŒ, éƒ½è¡¨ç¤ºè®¿é—®èµ„æºä¸å­˜åœ¨, åªæ˜¯410çŠ¶æ€ç ä¸å•è¡¨ç¤ºèµ„æºä¸å­˜åœ¨, è¿˜è¿›ä¸€æ­¥å‘ŠçŸ¥èµ„æºæ›¾ç»å­˜åœ¨, åªæ˜¯ç›®å‰å·²ç»æ¶ˆå¤±äº†; å› æ­¤æœåŠ¡å™¨ç«¯å¸¸åœ¨è®¿é—®è¢«åˆ é™¤çš„æ•°æ®æ—¶è¿”å›è¯¥çŠ¶æ€ç , ä½†æ˜¯ä¸ºäº†è¿”å›è¯¥çŠ¶æ€ç , æœåŠ¡å™¨å¿…é¡»ä¿å­˜è¯¥æ•°æ®å·²è¢«åˆ é™¤çš„ä¿¡æ¯, è€Œä¸”å®¢æˆ·ç«¯ä¹Ÿåº”è¯¥çŸ¥æ™“æœåŠ¡å™¨ç«¯ä¿å­˜äº†è¿™æ ·çš„ä¿¡æ¯; ä½†æ˜¯åœ¨é€šè¿‡é‚®ç®±åœ°å€æœç´¢ç”¨æˆ·ä¿¡æ¯çš„APIä¸­, ä»ä¿æŠ¤ä¸ªäººä¿¡æ¯çš„è§’åº¦æ¥è¯´, è¿”å›410çŠ¶æ€ç çš„åšæ³•ä¹Ÿä¼šå—åˆ°è´¨ç–‘; (æ‰€ä»¥åœ¨æ­¤ç§èµ„æºä¸å­˜åœ¨çš„æƒ…å†µä¸‹, ä¸ºäº†ç¨å¾®å®‰å…¨ä¸€äº›, è¿”å›410çŠ¶æ€ç éœ€è¦æ…é‡) 413 Request Entity Too Large : 413ä¹Ÿæ˜¯æ¯”è¾ƒå®¹æ˜“å‡ºç°çš„ä¸€ç§çŠ¶æ€ç , è¡¨ç¤ºè¯·æ±‚å®ä½“è¿‡å¤§è€Œå¼•å‘çš„é”™è¯¯ è¯·æ±‚æ¶ˆæ¯ä½“è¿‡é•¿æ˜¯æŒ‡, æ¯”å¦‚åœ¨ä¸Šä¼ æ–‡ä»¶è¿™æ ·çš„APIä¸­, å¦‚æœå‘é€çš„æ•°æ®è¶…è¿‡äº†æ‰€å…è®¸çš„æœ€å¤§å€¼, å°±ä¼šå¼•å‘è¿™æ ·çš„é”™è¯¯; 414 Request-URI Too Large : 414æ˜¯è¡¨ç¤ºè¯·æ±‚é¦–éƒ¨è¿‡é•¿è€Œå¼•å‘çš„é”™è¯¯ å¦‚æœåœ¨è¿›è¡ŒGETè¯·æ±‚æ—¶, æŸ¥è¯¢å‚æ•°è¢«æŒ‡å®šäº†è¿‡é•¿çš„æ•°æ®, å°±ä¼šå¯¼è‡´æœåŠ¡å™¨ç«¯è¿”å›414çŠ¶æ€ç  415 Unsupported Media Type : å’Œ406æ¯”è¾ƒç›¸ä¼¼ 406æˆ‘ä»¬çŸ¥é“æ˜¯è¡¨ç¤ºæœåŠ¡å™¨ç«¯ä¸æ”¯æŒå®¢æˆ·ç«¯æƒ³è¦æ¥æ”¶çš„æ•°æ®æ ¼å¼ è€Œ415è¡¨ç¤ºçš„æ˜¯æœåŠ¡å™¨ç«¯ä¸æ”¯æŒå®¢æˆ·ç«¯è¯·æ±‚é¦–éƒ¨ Content-Type é‡ŒæŒ‡å®šçš„æ•°æ®æ ¼å¼, ä¹Ÿå°±æ˜¯è¯´, å½“å®¢æˆ·ç«¯é€šè¿‡POST,PUT,PATCHç­‰æ–¹æ³•å‘é€çš„è¯·æ±‚æ¶ˆæ¯ä½“çš„æ•°æ®æ ¼å¼ä¸è¢«æœåŠ¡å™¨æ”¯æŒæ—¶, æœåŠ¡å™¨ç«¯å°±ä¼šè¿”å›415çŠ¶æ€ç ; ä¾‹å¦‚åœ¨åªæ¥æ”¶JSONæ ¼å¼çš„APIé‡Œ, å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚æ—¶å‘é€çš„æ˜¯XMLæ ¼å¼çš„æ•°æ®å»è¯·æ±‚æœåŠ¡å™¨ç«¯, æˆ–è€…åœ¨ Content-Type é¦–éƒ¨æŒ‡å®š application/xml, éƒ½ä¼šå¯¼è‡´è¯¥ç±»å‹é”™è¯¯; 429 Too Many Requests : æ˜¯2012å¹´RFC6585æ–‡æ¡£ä¸­æ–°å®šä¹‰çš„çŠ¶æ€ç , è¡¨ç¤ºè®¿é—®æ¬¡æ•°è¶…è¿‡äº†æ‰€å…è®¸çš„èŒƒå›´; ä¾‹å¦‚æŸAPIå­˜åœ¨ä¸€å°æ—¶å†…åªå…è®¸è®¿é—®100æ¬¡çš„è®¿é—®é™åˆ¶, è¿™ç§æƒ…å†µä¸‹å…¥è‚¡å“¦å®¢æˆ·ç«¯è§†å›¾è¿›è¡Œç¬¬101æ¬¡è®¿é—®, æœåŠ¡å™¨ä¾¿ä¼šè¿”å›è¯¥çŠ¶æ€ç ; è¡¨ç¤ºåœ¨ä¸€å®šçš„æ—¶é—´å†…ç”¨æˆ·å‘é€äº†å¤ªå¤šçš„è¯·æ±‚, å³è¶…å‡ºäº†â€é¢‘æ¬¡é™åˆ¶â€, åœ¨å“åº”ä¸­ï¼Œå¯ä»¥æä¾›ä¸€ä¸ª Retry-After é¦–éƒ¨æ¥æç¤ºç”¨æˆ·éœ€è¦ç­‰å¾…å¤šé•¿æ—¶é—´ä¹‹åå†å‘é€æ–°çš„è¯·æ±‚; 5xx 5å­—å¤´çŠ¶æ€ç è¡¨ç¤ºé”™è¯¯ä¸å‘ç”Ÿåœ¨å®¢æˆ·ç«¯, è€Œæ˜¯ç”±æœåŠ¡å™¨è‡ªèº«é—®é¢˜å¼•å‘çš„ã€‚ 500 Internal Server Error : æ˜¯webåº”ç”¨ç¨‹åºå¼€å‘é‡Œéå¸¸å¸¸è§çš„é”™è¯¯, å½“æœåŠ¡å™¨ä»£ç é‡Œå­˜åœ¨bug, è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶åœæ­¢è¿è¡Œç­‰æƒ…å†µä¸‹, å°±ä¼šè¿”å›è¯¥ç±»å‹çš„é”™è¯¯; å› æ­¤, ä¸ä»…é™äºAPI, å¯¹äº5å­—å¤´çŠ¶æ€ç çš„é”™è¯¯, éƒ½è¦è®¤çœŸç›‘è§†é”™è¯¯æ—¥å¿—, ä½¿ç³»ç»Ÿåœ¨å‡ºé”™æ—¶åŠæ—¶å‘ŠçŸ¥ç®¡ç†å‘˜, ä»¥ä¾¿åœ¨é”™è¯¯å‘ç”Ÿæ—¶åšå¥½åº”å¯¹æªæ–½, é˜²æ­¢å†æ¬¡å‘ç”Ÿã€‚ 501 Not Implemented : ??? 502 Bad GateWay : ??? 503 Service Unavaliable : ç”¨æ¥è¡¨ç¤ºæœåŠ¡å™¨å½“å‰å¤„äºæš‚ä¸å¯ç”¨çŠ¶æ€ å¯ä»¥å›é€:å“åº”é¦–éƒ¨ Retry-After è¡¨ç¤ºå¤šä¹…æ¢å¤; ä¸åŒçš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯åº”ç”¨å¯¹äº Retry-After é¦–éƒ¨çš„æ”¯æŒä¾ç„¶ä¸å¤ªä¸€è‡´; ä¸è¿‡ï¼Œä¸€äº›çˆ¬è™«ç¨‹åºï¼Œæ¯”å¦‚è°·æ­Œçš„çˆ¬è™«ç¨‹åºGooglebot, ä¼šéµå¾ªRetry-Afterå“åº”é¦–éƒ¨çš„è§„åˆ™, å°†å…¶ä¸503(Service Unavailable,å½“å‰æœåŠ¡ä¸å­˜åœ¨)å“åº”ä¸€èµ·å‘é€æœ‰åŠ©äºäº’è”ç½‘å¼•æ“åšå‡ºåˆ¤æ–­,åœ¨å®•æœºç»“æŸä¹‹åç»§ç»­å¯¹ç½‘ç«™æ„å»ºç´¢å¼•ã€‚ å‚è€ƒ:https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Retry-After 504 Gateway Time-out: å¤ç°è¿™ä¸ªé”™è¯¯ç æ¯”è¾ƒç®€å•, è®©ä½ çš„phpç¨‹åºæ¨¡æ‹Ÿè€—æ—¶è¯·æ±‚, å¦‚ä¸‹ä»£ç  123&lt;?phpsleep(70);//æ¨¡æ‹Ÿè€—æ—¶ï¼Œç¡70ç§’echo &quot;ç¡é†’äº†&quot;; å°±ä¼šè¿”å› ``` 504 Gateway Time-out nginx/1.11.4 ``` 505 HTTP Version Not Supported: æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚, ä½¿ç”¨çš„æ˜¯å®ƒæ— æ³•æ”¯æŒçš„HTTPåè®®ç‰ˆæœ¬; å‚è€ƒ:ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ã€ã€ŠWeb APIçš„è®¾è®¡ä¸å¼€å‘ã€‹","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"02. HTTPå„è¯·æ±‚æ–¹æ³•è¯¦è§£","slug":"http/2017-11-30-HTTP-02","date":"2017-11-30T03:29:12.000Z","updated":"2018-05-09T06:27:03.000Z","comments":true,"path":"2017/11/30/http/2017-11-30-HTTP-02/","link":"","permalink":"http://blog.renyimin.com/2017/11/30/http/2017-11-30-HTTP-02/","excerpt":"","text":"å‰è¨€ HTTP/1.1 ä¸­å®ç°çš„method, å‚è€ƒRFC2616, å¯ä»¥çœ‹åˆ°æœ‰: OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT RFC2616ä¸­æåˆ°: PATCHï¼ŒLINKï¼ŒUNLINKæ–¹æ³•è¢«å®šä¹‰ï¼Œä½†å¹¶ä¸å¸¸è§;(&lt;å›¾è§£httpåè®®&gt;ä¸­ä¹Ÿæåˆ° LINK, UNLINKå·²ç»è¢«http1.1åºŸå¼ƒ); ä¸åŒåº”ç”¨å„è‡ªçš„å®ç°ä¸åŒ, æœ‰äº›åº”ç”¨ä¼šå®Œæ•´å®ç°, æœ‰äº›è¿˜ä¼šæ‰©å±•, æœ‰äº›å¯èƒ½ä¼šå®ç°ä¸€éƒ¨åˆ†; PUT(å¯¹æ¯”POST) PUT: å¯¹å·²æœ‰èµ„æºè¿›è¡Œæ›´æ–°æ“ä½œ, æ‰€ä»¥æ˜¯ update æ“ä½œ; putå’Œpostçš„åŒºåˆ« åœ¨HTTPä¸­, PUTè¢«å®šä¹‰ä¸º idempotent(å¹‚ç­‰æ€§) çš„æ–¹æ³•ï¼ŒPOSTåˆ™ä¸æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ« åº”è¯¥ç”¨PUTè¿˜æ˜¯POST ï¼Ÿ å–å†³äºè¿™ä¸ªRESTæœåŠ¡çš„è¡Œä¸ºæ˜¯å¦æ˜¯idempotent(å¹‚ç­‰)çš„ å‡å¦‚å‘é€ä¸¤ä¸ªè¯·æ±‚, å¸Œæœ›æœåŠ¡å™¨ç«¯æ˜¯äº§ç”Ÿä¸¤ä¸ªæ–°æ•°æ®ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªæœåŠ¡ä¸æ˜¯idempotentçš„, å› ä¸ºå¤šæ¬¡ä½¿ç”¨äº§ç”Ÿäº†å‰¯ä½œç”¨äº†, é‚£å°±åº”è¯¥ä½¿ç”¨POSTæ–¹æ³•; ä½†å¦‚æœæ˜¯å¸Œæœ›åä¸€ä¸ªè¯·æ±‚æŠŠç¬¬ä¸€ä¸ªè¯·æ±‚è¦†ç›–æ‰(è¿™ä¸æ­£æ˜¯ä¿®æ”¹ä¹ˆ), é‚£è¿™ä¸ªæœåŠ¡å°±æ˜¯idempotentçš„, é‚£å°±åº”è¯¥ä½¿ç”¨PUTæ–¹æ³•; è™½ç„¶POSTå’ŒPUTå·®åˆ«ä¸å¤§, ç”¨é”™äº†ä¹Ÿæ²¡å…³ç³», ä½†æ˜¯ä½ çš„æœåŠ¡ä¸€æ”¾åˆ°internetä¸Šï¼Œå¦‚æœä¸éµä»HTTPåè®®çš„è§„èŒƒï¼Œå°±å¯èƒ½ç»™è‡ªå·±å¸¦æ¥éº»çƒ¦ POST POST: ä¸Šé¢å·²ç»æè¿‡äº†, POSTæ˜¯éå¹‚ç­‰çš„; POSTå’ŒPUTéƒ½å¯ä»¥ä¸Šä¼ æ–‡ä»¶æˆ–è€…åˆ›å»ºæ–°ä¿¡æ¯, ä½†ä¸»è¦çœ‹ä½ çš„RESTæœåŠ¡è¡Œä¸ºæ˜¯å¦æ˜¯å¹‚ç­‰çš„; PATCH(å¯¹æ¯”PUT)PATCHä¸æ˜¯HTTPæ ‡å‡†æ–¹æ³•çš„ï¼ŒæœåŠ¡ç«¯éœ€è¦è€ƒè™‘å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤Ÿæ”¯æŒçš„é—®é¢˜ å¯¹å·²æœ‰èµ„æºçš„æ“ä½œ ç”¨äºèµ„æºçš„éƒ¨åˆ†å†…å®¹è¿›è¡Œæ›´æ–° (ä¾‹å¦‚æ›´æ–°æŸä¸€ä¸ªå­—æ®µ, å…·ä½“æ¯”å¦‚è¯´åªæ›´æ–°ç”¨æˆ·ä¿¡æ¯çš„ç”µè¯å·ç å­—æ®µ); è€ŒPUTåˆ™ç”¨äºæ›´æ–°æŸä¸ªèµ„æºè¾ƒå®Œæ•´çš„å†…å®¹, æ¯”å¦‚è¯´ç”¨æˆ·è¦é‡å¡«å®Œæ•´è¡¨å•æ›´æ–°æ‰€æœ‰ä¿¡æ¯, åå°å¤„ç†æ›´æ–°æ—¶å¯èƒ½åªæ˜¯ä¿ç•™å†…éƒ¨è®°å½•IDä¸å˜; å½“èµ„æºä¸å­˜åœ¨æ—¶: PATCH å¯èƒ½ä¼šå»åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æº, è¿™ä¸ªæ„ä¹‰ä¸Šåƒæ˜¯ saveOrUpdate æ“ä½œã€‚ å‚è€ƒ: https://segmentfault.com/q/1010000005685904/ https://unmi.cc/restful-http-patch-method/ http://restcookbook.com/HTTP%20Methods/patch/ https://tools.ietf.org/html/rfc5789 HEADHEADå’Œ GET æœ¬è´¨æ˜¯ä¸€æ ·çš„, åŒºåˆ«åœ¨äºå¦‚æœä½¿ç”¨HEAD, å“åº”ä½“å°†ä¸ä¼šè¢«è¿”å›ï¼Œè€Œä»…ä»…è¿”å›HTTPå¤´ä¿¡æ¯;æ¯”å¦‚: æ¬²åˆ¤æ–­æŸä¸ªèµ„æºæ˜¯å¦å­˜åœ¨, æˆ‘ä»¬é€šå¸¸ä½¿ç”¨GET, ä½†è¿™é‡Œç”¨HEADåˆ™æ„ä¹‰æ›´åŠ æ˜ç¡®ã€‚ GETæ¯”è¾ƒç®€å•, ç›´æ¥è·å–èµ„æº; OPTIONSè¿™ä¸ªæ–¹æ³•ä½¿ç”¨æ¯”è¾ƒå°‘, å®ƒç”¨äºè·å–å½“å‰URLæ‰€æ”¯æŒçš„æ–¹æ³•;è‹¥è¯·æ±‚æˆåŠŸ, åˆ™å®ƒä¼šåœ¨HTTPå¤´ä¸­åŒ…å«ä¸€ä¸ªåä¸º Allow çš„å¤´, å€¼æ˜¯æœåŠ¡å™¨æ‰€æ”¯æŒçš„æ–¹æ³•, å¦‚ GET, POST;ä¹‹å‰è·¨åŸŸç›¸å…³åšæ–‡ CORSæ–¹æ¡ˆ not-so-simple request ä¸­çš„â€é¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•å°±æ˜¯ OPTIONS; CONNECTè¦æ±‚ç”¨éš§é“åè®®è¿æ¥ä»£ç†, å¦‚ä½¿ç”¨SSL TRACE~~æœªå®Œå¾…ç»­ DELETEå‚è€ƒ PURGEéè§„èŒƒä¸­å®šä¹‰çš„æ–¹æ³•","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"01. HTTPåè®®é¢„è§ˆ","slug":"http/2017-11-30-HTTP-01","date":"2017-11-30T03:25:12.000Z","updated":"2018-05-09T06:27:09.000Z","comments":true,"path":"2017/11/30/http/2017-11-30-HTTP-01/","link":"","permalink":"http://blog.renyimin.com/2017/11/30/http/2017-11-30-HTTP-01/","excerpt":"","text":"ç®€ä»‹ HTTP(Hypertext Transfer Protocol è¶…æ–‡æœ¬ä¼ è¾“åè®®), æ˜¯åœ¨ä¸‡ç»´ç½‘ä¸Šè¿›è¡Œé€šä¿¡æ—¶æ‰€ä½¿ç”¨çš„åè®®; åè®®ç‰ˆæœ¬ HTTP/0.9 æœ‰å¾ˆå¤šè®¾è®¡ç¼º, å¾ˆå¿«å°±è¢«HTTP/1.0æ‰€å–ä»£äº†;(â€¦åªæ”¯æŒGETæ–¹æ³•â€¦) HTTP/1.0 ç¬¬ä¸€ä¸ªå¾—åˆ°å¹¿æ³›åº”ç”¨çš„HTTPç‰ˆæœ¬; HTTP/1.O+ åœ¨HTTP/1.0ä¸Šæ‰©å±•äº†å¾ˆå¤šéå®˜æ–¹çš„ç‰¹æ€§, æ˜¯éæ­£å¼çš„HTTPæ‰©å±•ç‰ˆæœ¬;(æ”¯æŒæŒä¹…çš„keep-alivelè¿æ¥) HTTP/1.1 æ˜¯å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬ HTTP-NG(HTTP/2.0) å…³æ³¨çš„æ˜¯æ€§èƒ½æå‡, ç›®å‰è¿˜æœªæ™®åŠ ç”¨äºHTTPåè®®äº¤äº’çš„ä¿¡æ¯è¢«ç§°ä¸ºHTTPæŠ¥æ–‡ è¯·æ±‚ç«¯(å®¢æˆ·ç«¯)çš„æŠ¥æ–‡å« è¯·æ±‚æŠ¥æ–‡; å“åº”ç«¯(æœåŠ¡å™¨ç«¯)çš„å« å“åº”æŠ¥æ–‡; è¯·æ±‚æŠ¥æ–‡ç»“æ„æŠ¥æ–‡é¦–éƒ¨ è¯·æ±‚è¡Œ : åŒ…å«äº† è¯·æ±‚æ–¹æ³•, è¯·æ±‚URL, å®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡ä½¿ç”¨çš„HTTPåè®®ç‰ˆæœ¬ (å¦‚: GET / HTTP/1.1) é¦–éƒ¨å— è¯·æ±‚é¦–éƒ¨å­—æ®µ é€šç”¨é¦–éƒ¨å­—æ®µ å®ä½“é¦–éƒ¨å­—æ®µ å…¶ä»– ç©ºè¡Œ(CRLF)æŠ¥æ–‡ä¸»ä½“å“åº”æŠ¥æ–‡ç»“æ„æŠ¥æ–‡é¦–éƒ¨ çŠ¶æ€è¡Œ : åŒ…å«äº† æœåŠ¡ç«¯å“åº”æŠ¥æ–‡ä½¿ç”¨çš„HTTPåè®®ç‰ˆæœ¬, çŠ¶æ€ç , åŸå› çŸ­è¯­ (å¦‚: HTTP/1.1 200 OK) é¦–éƒ¨å— å“åº”é¦–éƒ¨å­—æ®µ é€šç”¨é¦–éƒ¨å­—æ®µ å®ä½“é¦–éƒ¨å­—æ®µ å…¶ä»– ç©ºè¡Œ(CRLF)æŠ¥æ–‡ä¸»ä½“è¯·æ±‚æ–¹æ³•ä¸Šé¢å·²ç»äº†è§£åˆ°, åœ¨ â€œè¯·æ±‚æŠ¥æ–‡â€ -&gt; â€œæŠ¥æ–‡é¦–éƒ¨â€ -&gt; â€œè¯·æ±‚è¡Œâ€ ä¸­, åŒ…å«äº† è¯·æ±‚æ–¹æ³•, å…·ä½“å¯å‚è€ƒ å„è¯·æ±‚æ–¹æ³•è¯¦è§£ é¦–éƒ¨å­—æ®µä»ä¸Šé¢è¿˜å¯ä»¥çœ‹åˆ°, æŠ¥æ–‡ä¸­çš„é¦–éƒ¨å—æœ‰å¦‚ä¸‹å‡ ç§é¦–éƒ¨å­—æ®µ è¯·æ±‚é¦–éƒ¨å­—æ®µå“åº”é¦–éƒ¨å­—æ®µé€šç”¨é¦–éƒ¨å­—æ®µCache-Control ç¼“å­˜èƒ½åŠ›æ§åˆ¶Pragma å…¼å®¹Cache-controlDate å½“å‰æ—¶é—´Transfer-Encoding ä¼ è¾“ç¼–ç Accept-encoding å†…å®¹ç¼–ç  (è¯·æ±‚é¦–éƒ¨å­—æ®µ) (å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨è¿”å› 406 Not Acceptable)Content-encoding å†…å®¹ç¼–ç  (å®ä½“é¦–éƒ¨å­—æ®µ)Accept-charset è¯·æ±‚é¦–éƒ¨å­—æ®µå¯å‚è€ƒåšæ–‡ï¼šå„é€šç”¨é¦–éƒ¨å­—æ®µè¯¦è§£ å®ä½“é¦–éƒ¨å­—æ®µçŠ¶æ€ç è¯¦è§£å¯å‚è€ƒåšæ–‡ï¼šHTTPçŠ¶æ€ç è¯¦è§£ ~~æœªå®Œå¾…ç»­","categories":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/categories/HTTP/"}],"tags":[{"name":"HTTP","slug":"HTTP","permalink":"http://blog.renyimin.com/tags/HTTP/"}]},{"title":"05.WebSocket - å®æˆ˜","slug":"WebSocket/2017-10-29-websocket-05","date":"2017-10-29T14:09:10.000Z","updated":"2018-05-15T03:04:55.000Z","comments":true,"path":"2017/10/29/WebSocket/2017-10-29-websocket-05/","link":"","permalink":"http://blog.renyimin.com/2017/10/29/WebSocket/2017-10-29-websocket-05/","excerpt":"","text":"ThinkPHP + WorkerMan + WebSocket å®ç°èŠ‚æœ¬èŠå¤©å®¤åŠŸèƒ½gitä»“åº“åœ°å€~~æœªå®Œå¾…ç»­","categories":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/categories/WebSocket/"}],"tags":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/tags/WebSocket/"}]},{"title":"04.WebSocket - å®¢æˆ·ç«¯API","slug":"WebSocket/2017-10-28-websocket-04","date":"2017-10-28T12:50:52.000Z","updated":"2018-05-15T03:04:51.000Z","comments":true,"path":"2017/10/28/WebSocket/2017-10-28-websocket-04/","link":"","permalink":"http://blog.renyimin.com/2017/10/28/WebSocket/2017-10-28-websocket-04/","excerpt":"","text":"WebSocketå®¢æˆ·ç«¯APIå¦‚ä¸‹WebSocket æ„é€ å‡½æ•° WebSocketå¯¹è±¡ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°, ç”¨äºæ–°å»º WebSocket å®ä¾‹, æ‰§è¡Œ var ws = new WebSocket(&#39;ws://localhost:8080&#39;); ä¹‹å, å®¢æˆ·ç«¯å°±ä¼šä¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥ã€‚ ws.readyState: readyStateå±æ€§è¿”å›å®ä¾‹å¯¹è±¡çš„å½“å‰çŠ¶æ€,å…±æœ‰å››ç§: CONNECTING: å€¼ä¸º0ï¼Œè¡¨ç¤ºæ­£åœ¨è¿æ¥ã€‚ OPEN: å€¼ä¸º1ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸï¼Œå¯ä»¥é€šä¿¡äº†ã€‚ CLOSING: å€¼ä¸º2ï¼Œè¡¨ç¤ºè¿æ¥æ­£åœ¨å…³é—­ã€‚ CLOSED: å€¼ä¸º3ï¼Œè¡¨ç¤ºè¿æ¥å·²ç»å…³é—­ï¼Œæˆ–è€…æ‰“å¼€è¿æ¥å¤±è´¥ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹:1234567891011121314151617switch (ws.readyState) &#123; case WebSocket.CONNECTING: // do something break; case WebSocket.OPEN: // do something break; case WebSocket.CLOSING: // do something break; case WebSocket.CLOSED: // do something break; default: // this never happens break;&#125; ws.onopen: å®ä¾‹å¯¹è±¡çš„onopenå±æ€§ ç”¨äºæŒ‡å®šè¿æ¥æˆåŠŸåçš„å›è°ƒå‡½æ•°: 123ws.onopen = function () &#123; ws.send(&apos;Hello Server!&apos;);&#125; - å¦‚æœè¦æŒ‡å®šå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨addEventListeneræ–¹æ³•ã€‚ 123456 ws.addEventListener(&apos;open&apos;, function (event) &#123; ws.send(&apos;Hello Server!&apos;); &#125;); ``` 4. ws.onclose - å®ä¾‹å¯¹è±¡çš„oncloseå±æ€§ï¼Œç”¨äºæŒ‡å®šè¿æ¥å…³é—­åçš„å›è°ƒå‡½æ•° ws.onclose = function(event) { var code = event.code; var reason = event.reason; var wasClean = event.wasClean; // handle close event }; ws.addEventListener(&quot;close&quot;, function(event) { var code = event.code; var reason = event.reason; var wasClean = event.wasClean; // handle close event }); 125. ws.onmessage - å®ä¾‹å¯¹è±¡çš„onmessageå±æ€§ï¼Œç”¨äºæŒ‡å®šæ”¶åˆ°æœåŠ¡å™¨æ•°æ®åçš„å›è°ƒå‡½æ•° ws.onmessage = function(event) { var data = event.data; // å¤„ç†æ•°æ® }; ws.addEventListener(&quot;message&quot;, function(event) { var data = event.data; // å¤„ç†æ•°æ® }); 1- æ³¨æ„, æœåŠ¡å™¨æ•°æ®å¯èƒ½æ˜¯æ–‡æœ¬, ä¹Ÿå¯èƒ½æ˜¯äºŒè¿›åˆ¶æ•°æ®(`blob`å¯¹è±¡æˆ–`Arraybuffer`å¯¹è±¡) ws.onmessage = function(event){ if(typeof event.data === String) { console.log(&quot;Received data string&quot;); } if(event.data instanceof ArrayBuffer){ var buffer = event.data; console.log(&quot;Received arraybuffer&quot;); } } 1- é™¤äº†åŠ¨æ€åˆ¤æ–­æ”¶åˆ°çš„æ•°æ®ç±»å‹, ä¹Ÿå¯ä»¥ä½¿ç”¨`binaryType`å±æ€§, æ˜¾å¼æŒ‡å®šæ”¶åˆ°çš„äºŒè¿›åˆ¶æ•°æ®ç±»å‹ // æ”¶åˆ°çš„æ˜¯ blob æ•°æ® ws.binaryType = &quot;blob&quot;; ws.onmessage = function(e) { console.log(e.data.size); }; // æ”¶åˆ°çš„æ˜¯ ArrayBuffer æ•°æ® ws.binaryType = &quot;arraybuffer&quot;; ws.onmessage = function(e) { console.log(e.data.byteLength); }; 12346. webSocket.send(): å®ä¾‹å¯¹è±¡çš„send()æ–¹æ³•ç”¨äºå‘æœåŠ¡å™¨å‘é€æ•°æ®ã€‚ - å‘é€æ–‡æœ¬çš„ `ws.send(&apos;your message&apos;);` - å‘é€ `Blob` å¯¹è±¡çš„ä¾‹å­ var file = document .querySelector(&apos;input[type=&quot;file&quot;]&apos;) .files[0]; ws.send(file); 1- å‘é€ `ArrayBuffer` å¯¹è±¡çš„ä¾‹å­ // Sending canvas ImageData as ArrayBuffer var img = canvas_context.getImageData(0, 0, 400, 320); var binary = new Uint8Array(img.data.length); for (var i = 0; i &lt; img.data.length; i++) { binary[i] = img.data[i]; } ws.send(binary.buffer); 127. webSocket.bufferedAmount - å®ä¾‹å¯¹è±¡çš„ `bufferedAmount`å±æ€§, è¡¨ç¤ºè¿˜æœ‰å¤šå°‘å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®æ²¡æœ‰å‘é€å‡ºå», å®ƒå¯ä»¥ç”¨æ¥åˆ¤æ–­å‘é€æ˜¯å¦ç»“æŸ var data = new ArrayBuffer(10000000); ws.send(data); if (ws.bufferedAmount === 0) { // å‘é€å®Œæ¯• } else { // å‘é€è¿˜æ²¡ç»“æŸ } 128. webSocket.onerror - å®ä¾‹å¯¹è±¡çš„onerrorå±æ€§, ç”¨äºæŒ‡å®šæŠ¥é”™æ—¶çš„å›è°ƒå‡½æ•° socket.onerror = function(event) { // handle error event }; socket.addEventListener(&quot;error&quot;, function(event) { // handle error event }); ``` å…³é—­è¿æ¥: ws.close()","categories":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/categories/WebSocket/"}],"tags":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/tags/WebSocket/"}]},{"title":"03.è·¨ç«™ç‚¹WebSocketåŠ«æŒæ¼æ´","slug":"WebSocket/2017-10-28-websocket-03","date":"2017-10-28T09:30:42.000Z","updated":"2018-05-15T03:04:48.000Z","comments":true,"path":"2017/10/28/WebSocket/2017-10-28-websocket-03/","link":"","permalink":"http://blog.renyimin.com/2017/10/28/WebSocket/2017-10-28-websocket-03/","excerpt":"","text":"è·¨ç«™ç‚¹WebSocketåŠ«æŒæ¼æ´åŸç†æ˜¯åŠ«æŒè€Œéç®€å•çš„ä¼ªé€  ä¸ºäº†åˆ›å»ºå…¨åŒå·¥é€šä¿¡, å®¢æˆ·ç«¯éœ€è¦åŸºäºHTTPè¿›è¡Œæ¡æ‰‹åˆ‡æ¢åˆ°WebSocketåè®®, æ­£æ˜¯è¿™ä¸ªå‡çº§åè®®çš„æ¡æ‰‹è¿‡ç¨‹å­˜åœ¨ç€æ½œåœ¨çš„é—®é¢˜ã€‚ ç¤ºä¾‹: å®¢æˆ·ç«¯ä¼ªé€  ä¸æœåŠ¡ç«¯åŒé¡¶çº§åŸŸå çš„è·¨å­åŸŸcookie 12345678910111213&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;ws&lt;/title&gt; &lt;script&gt; document.cookie = &quot;name=renyimin; domain=websocket.org&quot;; &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; å®¢æˆ·ç«¯ä¸websocket.orgç½‘ç«™çš„Echoæµ‹è¯•æœåŠ¡å»ºç«‹è¿æ¥ 1234567891011121314151617181920212223242526&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;ws&lt;/title&gt; &lt;script&gt; var ws = new WebSocket(&quot;ws://echo.websocket.org&quot;); ws.onopen = function(evt) &#123; console.log(&quot;Connection open ...&quot;); ws.send(&quot;Hello WebSockets!&quot;); &#125;; ws.onmessage = function(evt) &#123; console.log( &quot;Received Message: &quot; + evt.data); ws.close(); &#125;; ws.onclose = function(evt) &#123; console.log(&quot;Connection closed.&quot;); &#125;; &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; æ­¤æ—¶, æ¡æ‰‹(å‡çº§åè®®)é˜¶æ®µçš„è¯·æ±‚å¤´ä¸­å°±æºå¸¦äº†ä¼ªé€ çš„cookie ä¸Šé¢æ¡æ‰‹é˜¶æ®µGetè¯·æ±‚å¤´ä¸­å¯ä»¥çœ‹åˆ°, Cookieå¤´éƒ¨æŠŠåŒé¡¶çº§åŸŸåä¸‹çš„Cookieä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚ WebSocketåè®®æ²¡æœ‰è§„å®šæœåŠ¡å™¨åœ¨æ¡æ‰‹é˜¶æ®µåº”è¯¥å¦‚ä½•è®¤è¯å®¢æˆ·ç«¯èº«ä»½ã€‚æœåŠ¡å™¨å¯ä»¥é‡‡ç”¨ä»»ä½•HTTPæœåŠ¡å™¨çš„å®¢æˆ·ç«¯èº«ä»½è®¤è¯æœºåˆ¶, è­¬å¦‚cookie, HTTPåŸºç¡€è®¤è¯, TLSèº«ä»½è®¤è¯ç­‰ã€‚ è€Œå¯¹äºç»å¤§å¤šæ•°Webåº”ç”¨æ¥è¯´, å®¢æˆ·ç«¯èº«ä»½è®¤è¯åº”è¯¥éƒ½æ˜¯ SessionID ç­‰ Cookie æˆ–è€… HTTP Auth å¤´éƒ¨å‚æ•°ç­‰ã€‚ æ‰€æœ‰çš„æµè§ˆå™¨éƒ½ä¼šå‘é€ Origin è¯·æ±‚å¤´, å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰é’ˆå¯¹Originå¤´éƒ¨è¿›è¡ŒéªŒè¯å¯èƒ½ä¼šå¯¼è‡´è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ”»å‡»ã€‚ å‡è®¾æŸä¸ªç”¨æˆ·å·²ç»åœ¨æµè§ˆå™¨ç™»å½•è¿‡ä¸€ä¸ªç›®æ ‡ç«™ç‚¹, æ¥ä¸‹æ¥å‡è®¾ä»–è¢«è¯±éª—è®¿é—®æŸä¸ªæ¶æ„ç½‘ç«™, ä¸€æ—¦ç‚¹å‡»æŸä¸ªè¯±å¯¼æ€§çš„æŒ‰é’®, æ¶æ„ç½‘é¡µåœ¨è¿™ä¸ªæ“ä½œä¸­æ¤å…¥ä¸€ä¸ªWebSocketæ¡æ‰‹è¯·æ±‚ç”³è¯·è·Ÿç›®æ ‡åº”ç”¨å»ºç«‹WebSocketè¿æ¥ æ­¤æ—¶, è¿™ä¸ªwebsocketæ¡æ‰‹è¯·æ±‚å°†ä¼šæºå¸¦æµè§ˆå™¨cookieç½ä¸­ä¹‹å‰å­˜å‚¨çš„ç›®æ ‡ç«™ç‚¹cookie; è¯·æ³¨æ„, Origin å’Œ Sec-WebSocket-Key éƒ½æ˜¯ç”±æµè§ˆå™¨è‡ªåŠ¨ç”Ÿæˆ, Cookieç­‰èº«ä»½è®¤è¯å‚æ•°ä¹Ÿéƒ½æ˜¯ç”±æµè§ˆå™¨è‡ªåŠ¨ä¸Šä¼ åˆ°ç›®æ ‡åº”ç”¨æœåŠ¡å™¨ç«¯ã€‚å¦‚æœæœåŠ¡å™¨ç«¯ç–äºæ£€æŸ¥Origin, è¯¥è¯·æ±‚ä¼ªé€ çš„cookieå¯èƒ½å°±ä¼šæˆåŠŸæ¡æ‰‹åˆ‡æ¢åˆ° WebSocket åè®®ï¼Œæ¶æ„ç½‘é¡µå°±å¯ä»¥æˆåŠŸç»•è¿‡èº«ä»½è®¤è¯è¿æ¥åˆ° WebSocket æœåŠ¡å™¨ï¼Œè¿›è€Œçªƒå–åˆ°æœåŠ¡å™¨ç«¯å‘æ¥çš„ä¿¡æ¯ï¼ŒæŠ‘æˆ–å‘é€ä¼ªé€ ä¿¡æ¯åˆ°æœåŠ¡å™¨ç«¯ç¯¡æ”¹æœåŠ¡å™¨ç«¯æ•°æ®ã€‚ æ­¤æ—¶, ç†Ÿæ‚‰corsè·¨åŸŸçš„ä½ , å¯èƒ½ä¼šè®¤ä¸ºæœåŠ¡å™¨ç«¯æ²¡æœ‰æŒ‡å®šAccess-Control-Allow-Originçš„è¯ï¼Œ æµè§ˆå™¨ç«¯çš„è„šæœ¬æ˜¯æ— æ³•è®¿é—®è·¨åŸŸèµ„æºçš„, è¿™ç¡®å®ä¹Ÿæ˜¯ HTML5 å¸¦æ¥çš„æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚ä½†æ˜¯å¾ˆä¸å¹¸ï¼ŒCORSä¸é€‚åº”äº WebSocket, WebSocket æ²¡æœ‰æ˜ç¡®è§„å®šè·¨åŸŸå¤„ç†çš„æ–¹æ³•ã€‚ CSRFä¸»è¦æ˜¯é€šè¿‡æ¶æ„ç½‘é¡µæ‚„æ‚„å‘èµ·æ•°æ®ä¿®æ”¹è¯·æ±‚, è€Œè·¨ç«™ç‚¹WebSocketä¼ªé€ æ”»å‡»ä¸ä»…å¯ä»¥ä¿®æ”¹æœåŠ¡å™¨æ•°æ®, è¿˜å¯ä»¥æ§åˆ¶æ•´ä¸ªè¯»å–/ä¿®æ”¹åŒå‘æ²Ÿé€šé€šé“ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› , Christian å°†è¿™ä¸ªæ¼æ´å‘½åä¸ºåŠ«æŒ(Hijacking), è€Œä¸æ˜¯è¯·æ±‚ä¼ªé€ (Request Forgery)ã€‚ æ£€æµ‹è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´ æ˜ç™½è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´åŸç†å, æ£€æµ‹è¯¥æ¼æ´ä¹Ÿå°±å®¹æ˜“äº†, å…ˆæ’‡å¼€cookieä¼ªé€ , é¦–å…ˆæ£€æµ‹æœåŠ¡ç«¯æ˜¯å¦èƒ½æ‹’ç»ä¸åŒæºorigin ç®€å•æ¥è¯´å°±æ˜¯é’ˆå¯¹WebSocketæ¡æ‰‹è¯·æ±‚åœ°å€, ä¿®æ”¹è¯·æ±‚ä¸­çš„ Origin ä¸ºå…¶ä»–æ¥æº(æœ¬åœ°å¯ä»¥éšæ„é…ç½®è™šæ‹ŸåŸŸåçš„), ç„¶åå‘é€è¿™ä¸ªè¯·æ±‚, çœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦èƒ½å¤ŸæˆåŠŸè¿”å›101å“åº”ã€‚ å¦‚æœè¿æ¥å¤±è´¥, é‚£ä¹ˆè¯´æ˜è¿™ä¸ª WebSocket æ˜¯å®‰å…¨çš„, å› ä¸ºå®ƒå¯ä»¥æ­£ç¡®æ‹’ç»æ¥è‡ªä¸åŒæº(Origin)çš„è¿æ¥è¯·æ±‚ã€‚ å¦‚æœè¿æ¥æˆåŠŸ, å°±è¯´æ˜æœåŠ¡å™¨ç«¯æ²¡æœ‰æ‰§è¡Œæºæ£€æŸ¥, ä¸ºäº†ä¸¥è°¨èµ·è§, æœ€å¥½è¿›ä¸€æ­¥æµ‹è¯•æ˜¯å¦å¯ä»¥å‘é€ WebSocket æ¶ˆæ¯, å¦‚æœè¿™ä¸ª WebSocket è¿æ¥èƒ½å¤Ÿå‘é€/æ¥å—æ¶ˆæ¯çš„è¯, åˆ™å®Œå…¨è¯æ˜è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´çš„å­˜åœ¨ã€‚ é˜²èŒƒè·¨ç«™ç‚¹WebSocketåŠ«æŒæ”»å‡»æœåŠ¡ç«¯Originæ£€æŸ¥ å‰æ–‡ä»‹ç»äº†è·¨ç«™ç‚¹ WebSocket åŠ«æŒæ¼æ´åŸç†å’Œæ£€æµ‹, å¦‚ä½•é˜²èŒƒè¿™ä¸ªæ¼æ´? è¿™ä¸ªæ¼æ´çš„åŸç†å¬èµ·æ¥ç•¥å¾®å¤æ‚, ä½†å¹¸è¿çš„æ˜¯æµ‹è¯•èµ·æ¥ç›¸å¯¹æ¯”è¾ƒç®€å•, é‚£ä¹ˆä¿®å¤ä¼šä¸ä¼šä¹Ÿå¾ˆç®€å•? å¾ˆå¤šè¯»è€…ä¼šæƒ³åˆ°, ä¸å°±æ˜¯åœ¨æœåŠ¡å™¨ä»£ç ä¸­æ£€æŸ¥ Origin å‚æ•°å˜›, æ˜¯çš„, æ£€æŸ¥Originå¾ˆæœ‰å¿…è¦ï¼Œä½†ä¸å……åˆ†ã€‚ æ¨èåœ¨æœåŠ¡å™¨ç«¯çš„ä»£ç ä¸­å¢åŠ Originæ£€æŸ¥, å¦‚æœå®¢æˆ·ç«¯å‘æ¥çš„ Origin ä¿¡æ¯æ¥è‡ªä¸åŒåŸŸ, å»ºè®®æœåŠ¡å™¨ç«¯æ‹’ç»è¿™ä¸ªè¯·æ±‚, å‘å› 403 é”™è¯¯å“åº”æ‹’ç»è¿æ¥ã€‚ WebSocketä»¤ç‰Œæœºåˆ¶ ä»…ä»…æ£€æŸ¥ Origin è¿œè¿œä¸å¤Ÿ, åˆ«å¿˜è®°äº†, å¦‚æœ WebSocket çš„å®¢æˆ·ç«¯ä¸æ˜¯æµè§ˆå™¨, éæµè§ˆå™¨çš„å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ä¸ä¼šé¡¹æµè§ˆå™¨é‚£æ ·è‡ªåŠ¨è®¾ç½®Origin, æ¶æ„å®¢æˆ·ç«¯ä¹Ÿå°±å¯èƒ½ä¼ªé€  Origin å¤´ä¿¡æ¯ã€‚ æ‰€ä»¥æ›´å½»åº•çš„è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è¦å€Ÿé‰´CSRFçš„è§£å†³æ–¹æ¡ˆ â€“ ä»¤ç‰Œæœºåˆ¶ æœåŠ¡å™¨ç«¯ä¸ºæ¯ä¸ª WebSocket å®¢æˆ·ç«¯ç”Ÿæˆå”¯ä¸€çš„ä¸€æ¬¡æ€§ Token; å®¢æˆ·ç«¯å°†Tokenä½œä¸º WebSocket è¿æ¥ URL çš„å‚æ•°(è­¬å¦‚ ws://echo.websocket.org/?tokenï¼randomOneTimeToken), å‘é€åˆ°æœåŠ¡å™¨ç«¯è¿›è¡Œ WebSocket æ¡æ‰‹è¿æ¥; æœåŠ¡å™¨ç«¯éªŒè¯ Token æ˜¯å¦æ­£ç¡®, ä¸€æ—¦æ­£ç¡®åˆ™å°†è¿™ä¸ª Token æ ‡ç¤ºä¸ºåºŸå¼ƒä¸å†é‡ç”¨, åŒæ—¶ç¡®è®¤ WebSocket æ¡æ‰‹è¿æ¥æˆåŠŸ; å¦‚æœ Token éªŒè¯å¤±è´¥æˆ–è€…èº«ä»½è®¤è¯å¤±è´¥, åˆ™è¿”å› 403 é”™è¯¯; è¿™ä¸ªæ–¹æ¡ˆé‡Œçš„ Token è®¾è®¡æ˜¯å…³é”® æ¨èçš„æ–¹æ¡ˆæ˜¯ä¸ºç™»å½•ç”¨æˆ·ç”Ÿæˆä¸€ä¸ª Secure Random å­˜å‚¨åœ¨ Session ä¸­ï¼Œç„¶ååˆ©ç”¨å¯¹ç§°åŠ å¯†(è­¬å¦‚ AES GCM)åŠ å¯†è¿™ä¸ªSecure Randomå€¼ä½œä¸ºä»¤ç‰Œ, å°†åŠ å¯†åçš„ä»¤ç‰Œå‘é€ç»™å®¢æˆ·ç«¯ç”¨æ¥è¿›è¡Œè¿æ¥ã€‚ è¿™æ ·æ¯ä¸ª Session æœ‰ä¸€ä¸ªå”¯ä¸€çš„éšæœºæ•°, æ¯ä¸ªéšæœºæ•°å¯ä»¥é€šè¿‡å¯¹ç§°åŠ å¯†ç”Ÿæˆè‹¥å¹²ä»½ä¸€æ¬¡æ€§ä»¤ç‰Œã€‚ç”¨æˆ·å³ä¾¿é€šè¿‡ä¸åŒç»ˆç«¯é€šè¿‡ WebSocket è¿æ¥åˆ°æœåŠ¡å™¨, æœåŠ¡å™¨å¯ä»¥åœ¨ä¿éšœä»¤ç‰Œå”¯ä¸€ä¸”ä¸€æ¬¡æ€§ä½¿ç”¨çš„å‰æä¸‹, ä¾ç„¶èƒ½å°†ä¸åŒé€šé“ä¸­çš„ä¿¡æ¯å…³è”åˆ°åŒä¸€ç”¨æˆ·ä¸­ã€‚ å‚è€ƒ","categories":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/categories/WebSocket/"}],"tags":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/tags/WebSocket/"}]},{"title":"02.WebSocketç®€å•ç¤ºä¾‹åˆ†æ","slug":"WebSocket/2017-10-28-websocket-02","date":"2017-10-28T05:57:08.000Z","updated":"2018-05-15T03:04:44.000Z","comments":true,"path":"2017/10/28/WebSocket/2017-10-28-websocket-02/","link":"","permalink":"http://blog.renyimin.com/2017/10/28/WebSocket/2017-10-28-websocket-02/","excerpt":"","text":"å®¢æˆ·ç«¯ç®€å•ç¤ºä¾‹1.ä¸‹é¢é€šè¿‡ å®¢æˆ·ç«¯ä¸websocket.orgç½‘ç«™çš„Echoæµ‹è¯•æœåŠ¡å»ºç«‹è¿æ¥ æ¥è¿›è¡Œå­¦ä¹  1234567891011121314151617181920212223242526&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;ws&lt;/title&gt; &lt;script&gt; var ws = new WebSocket(&quot;wss://echo.websocket.org&quot;); ws.onopen = function(evt) &#123; console.log(&quot;Connection open ...&quot;); ws.send(&quot;Hello WebSockets!&quot;); &#125;; ws.onmessage = function(evt) &#123; console.log( &quot;Received Message: &quot; + evt.data); ws.close(); &#125;; ws.onclose = function(evt) &#123; console.log(&quot;Connection closed.&quot;); &#125;; &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; 2.chromeæŠ“åŒ…å‘ç°, å®é™…å‘é€äº†ä¸¤æ¬¡è¯·æ±‚, å› ä¸ºWebSocketåè®®ç”±ä¸¤é˜¶æ®µç»„æˆ: æ¡æ‰‹é˜¶æ®µ å’Œ æ•°æ®ä¼ è¾“é˜¶æ®µ æ¡æ‰‹(handshake)é˜¶æ®µ è¯·æ±‚å¤´ä¿¡æ¯ 12345678910111213GET wss://echo.websocket.org/ HTTP/1.1Host: echo.websocket.orgConnection: UpgradePragma: no-cacheCache-Control: no-cacheUpgrade: websocketOrigin: http://www.js.comSec-WebSocket-Version: 13User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36Accept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9Sec-WebSocket-Key: VxdjZ3Z53lPcCrB3OiVwJQ==Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits ä¸ºäº†å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥, åœ¨æ¡æ‰‹é˜¶æ®µ, å®¢æˆ·ç«¯æµè§ˆå™¨é¦–å…ˆè¦å‘æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚, è¿™ä¸ªè¯·æ±‚å’Œé€šå¸¸çš„HTTPè¯·æ±‚ä¸åŒ, åŒ…å«äº†ä¸€äº›é™„åŠ å¤´ä¿¡æ¯, å…¶ä¸­é™„åŠ å¤´ä¿¡æ¯ Upgrade: WebSocket è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªç”³è¯·åè®®å‡çº§çš„ HTTP è¯·æ±‚, æœåŠ¡å™¨ç«¯è§£æè¿™äº›é™„åŠ çš„å¤´ä¿¡æ¯ç„¶åäº§ç”Ÿåº”ç­”ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯, å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„WebSocketè¿æ¥å°±å»ºç«‹èµ·æ¥äº†, åŒæ–¹å°±å¯ä»¥é€šè¿‡è¿™ä¸ªè¿æ¥é€šé“è‡ªç”±çš„ä¼ é€’ä¿¡æ¯, å¹¶ä¸”è¿™ä¸ªè¿æ¥ä¼šæŒç»­å­˜åœ¨ç›´åˆ°å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡å™¨ç«¯çš„æŸä¸€æ–¹ä¸»åŠ¨çš„å…³é—­è¿æ¥ã€‚ é¦–éƒ¨å­—æ®µçš„æ ¸å¿ƒæ˜¯ Connection:Upgrade å’Œ Upgrade:websocketè¿™ä¸¤ä¸ªé¦–éƒ¨å­—æ®µ, ç›¸å½“äºå‘Šè¯‰æœåŠ¡å™¨ç«¯:æˆ‘è¦ç”³è¯·åˆ‡æ¢åˆ° WebSocket åè®®ã€‚ å“åº”å¤´ä¿¡æ¯ 12345678910111213HTTP/1.1 101 Web Socket Protocol HandshakeAccess-Control-Allow-Credentials: trueAccess-Control-Allow-Headers: content-typeAccess-Control-Allow-Headers: authorizationAccess-Control-Allow-Headers: x-websocket-extensionsAccess-Control-Allow-Headers: x-websocket-versionAccess-Control-Allow-Headers: x-websocket-protocolAccess-Control-Allow-Origin: http://www.js.comConnection: UpgradeDate: Fri, 02 Mar 2018 03:01:59 GMTSec-WebSocket-Accept: GAz+a+FeezkKAeHM/HK/fgFI9Wo=Server: Kaazing GatewayUpgrade: websocket ä¸€æ—¦æœåŠ¡å™¨ç«¯è¿”å›101å“åº”, å³å¯å®ŒæˆWebSocketåè®®åˆ‡æ¢ã€‚æœåŠ¡å™¨ç«¯å³å¯ä»¥åŸºäºç›¸åŒç«¯å£, å°†é€šä¿¡åè®®ä» http:// æˆ– https:// åˆ‡æ¢åˆ° ws://æˆ– wss://ã€‚ åè®®åˆ‡æ¢å®Œæˆå, æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯å³å¯ä»¥ä½¿ç”¨ WebSocket API äº’ç›¸å‘é€å’Œæ”¶å–æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ¶ˆæ¯ã€‚ è¿™é‡Œè¦è§£é‡Šä¸€äº›æ¶‰åŠ WebSocket å®‰å…¨ç›¸å…³çš„é‡è¦å¤´éƒ¨å‚æ•°: Sec-WebSocket-Key , Sec-WebSocket-Accept: å®¢æˆ·ç«¯è´Ÿè´£ç”Ÿæˆä¸€ä¸ªBase64ç¼–ç è¿‡çš„éšæœºæ•°å­—ä½œä¸ºSec-WebSocket-Key, æœåŠ¡å™¨åˆ™ä¼šå°†ä¸€ä¸ªGUIDå’Œè¿™ä¸ªå®¢æˆ·ç«¯çš„éšæœºæ•°ä¸€èµ·ç”Ÿæˆä¸€ä¸ªæ•£åˆ—Keyä½œä¸º Sec-WebSocket-Accept è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªå·¥ä½œæœºåˆ¶å¯ä»¥ç”¨æ¥é¿å…ç¼“å­˜ä»£ç†(caching proxy), ä¹Ÿå¯ä»¥ç”¨æ¥é¿å…è¯·æ±‚é‡æ’­(request replay)ã€‚ å…¶ä»–Secï¼å¼€å¤´çš„WebSocketç›¸å…³Headerå…¶å®ä¹Ÿæ˜¯WebSocketè®¾è®¡è€…ä¸ºäº†å®‰å…¨çš„ç‰¹æ„è®¾è®¡, ä»¥Sec-å¼€å¤´çš„Headerå¯ä»¥é¿å…è¢«æµè§ˆå™¨è„šæœ¬è¯»å–åˆ°,è¿™æ ·æ”»å‡»è€…å°±ä¸èƒ½åˆ©ç”¨ XMLHttpRequest ä¼ªé€  WebSocket è¯·æ±‚æ¥æ‰§è¡Œè·¨åè®®æ”»å‡»ï¼Œå› ä¸º XMLHttpRequest æ¥å£ä¸å…è®¸è®¾ç½® Sec- å¼€å¤´çš„ Headerã€‚ Origin: ä½œå®‰å…¨ä½¿ç”¨, é˜²æ­¢è·¨ç«™æ”», æµè§ˆå™¨ä¸€èˆ¬ä¼šä½¿ç”¨è¿™ä¸ªæ¥æ ‡è¯†åŸå§‹åŸŸ å°ç»“ æµè§ˆå™¨é€šè¿‡JavaScriptå‘æœåŠ¡å™¨å‘å‡ºå»ºç«‹WebSocketè¿æ¥çš„è¯·æ±‚, è¿æ¥å»ºç«‹ä»¥å, å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å°±å¯ä»¥é€šè¿‡ TCP è¿æ¥ç›´æ¥äº¤æ¢æ•°æ®, æ­¤åæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯é€šè¿‡æ­¤TCPè¿æ¥è¿›è¡Œå®æ—¶é€šä¿¡, ä¸å†éœ€è¦åŸHTTPåè®®çš„å‚ä¸äº†; å› ä¸º WebSocket è¿æ¥æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªTCPè¿æ¥, æ‰€ä»¥åœ¨æ•°æ®ä¼ è¾“çš„ç¨³å®šæ€§å’Œæ•°æ®ä¼ è¾“é‡çš„å¤§å°æ–¹é¢, å’Œè½®è¯¢ä»¥åŠ Comet æŠ€æœ¯æ¯”è¾ƒ, å…·æœ‰å¾ˆå¤§çš„æ€§èƒ½ä¼˜åŠ¿; Websocket.org ç½‘ç«™å¯¹ä¼ ç»Ÿçš„è½®è¯¢æ–¹å¼å’Œ WebSocket è°ƒç”¨æ–¹å¼ä½œäº†ä¸€ä¸ªè¯¦ç»†çš„æµ‹è¯•å’Œæ¯”è¾ƒï¼Œå°†ä¸€ä¸ªç®€å•çš„ Web åº”ç”¨åˆ†åˆ«ç”¨è½®è¯¢æ–¹å¼å’Œ WebSocket æ–¹å¼æ¥å®ç°ï¼Œåœ¨è¿™é‡Œå¼•ç”¨ä¸€ä¸‹ä»–ä»¬çš„æµ‹è¯•ç»“æœå›¾ï¼š","categories":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/categories/WebSocket/"}],"tags":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/tags/WebSocket/"}]},{"title":"01.å¼•å‡ºWebSocket","slug":"WebSocket/2017-10-28-websocket-01","date":"2017-10-28T02:40:16.000Z","updated":"2018-05-15T03:04:41.000Z","comments":true,"path":"2017/10/28/WebSocket/2017-10-28-websocket-01/","link":"","permalink":"http://blog.renyimin.com/2017/10/28/WebSocket/2017-10-28-websocket-01/","excerpt":"","text":"å‰è¨€ ä¼ ç»Ÿæ¨¡å¼çš„ Web ç³»ç»Ÿä½¿ç”¨httpåè®®åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´è¿›è¡Œé€šä¿¡, æ˜¯ä»¥å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚,æœåŠ¡å™¨ç«¯å“åº”çš„æ–¹å¼è¿›è¡Œå·¥ä½œçš„, æœåŠ¡å™¨æ˜¯æ— æ³•ä¸»åŠ¨çš„æ¨é€æ•°æ®ç»™å®¢æˆ·ç«¯çš„, è¿™ä¹Ÿæ˜¯ä¸ºäº†å®‰å…¨èµ·è§; æ—¢ç„¶å·²ç»æœ‰äº†HTTPåè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®? ç­”æ¡ˆå¾ˆç®€å•, å› ä¸ºHTTPåè®®æœ‰ä¸€ä¸ªç¼ºé™·: é€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚ ç”±äºHTTPåè®®åšä¸åˆ°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯, è¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹å°±æ³¨å®šäº†, å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­é¢‘ç¹çš„çŠ¶æ€å˜åŒ–, å®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚(æˆ‘ä»¬åªèƒ½ä½¿ç”¨â€è½®è¯¢â€ï¼šæ¯éš”ä¸€æ®µæ—¶å€™ï¼Œå°±å‘å‡ºä¸€ä¸ªè¯¢é—®ï¼Œäº†è§£æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯ã€‚æœ€å…¸å‹çš„åœºæ™¯å°±æ˜¯èŠå¤©å®¤) è€Œç°ä»£webå¼€å‘ä¸­, ç»å¸¸ä¼šé¢å¯¹ä¸€äº›å¯¹å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„å®æ—¶Webåº”ç”¨, æ¯”å¦‚: å³æ—¶é€šä¿¡ç³»ç»Ÿ, å³æ—¶æŠ¥ä»·ç³»ç»Ÿ, åœ¨çº¿æ¸¸æˆ, åœ¨çº¿è¯åˆ¸, è®¾å¤‡ç›‘æ§ç­‰, ä¿æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä¿¡æ¯åŒæ­¥æ˜¯ å®æ—¶Webåº”ç”¨ çš„å…³é”®è¦ç´ ã€‚ ä¼ ç»Ÿçª˜å¢ƒç®€ä»‹åœ¨ WebSocket è§„èŒƒå‡ºæ¥ä¹‹å‰, å¼€å‘äººå‘˜æƒ³å®ç°è¿™äº›å®æ—¶çš„Webåº”ç”¨, ä¸å¾—ä¸é‡‡ç”¨ä¸€äº›æŠ˜è¡·çš„æ–¹æ¡ˆ, å…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯ è½®è¯¢ (Polling), åŸºäºå®¢æˆ·ç«¯å¥—æ¥å£çš„&quot;æœåŠ¡å™¨æ¨&quot;æŠ€æœ¯, Comet æŠ€æœ¯, è€ŒCometæŠ€æœ¯å®é™…ä¸Šæ˜¯è½®è¯¢æŠ€æœ¯çš„æ”¹è¿›, åˆå¯ç»†åˆ†ä¸ºä¸¤ç§å®ç°æ–¹å¼: ä¸€ç§æ˜¯é•¿è½®è¯¢æœºåˆ¶, ä¸€ç§ç§°ä¸ºæµæŠ€æœ¯ã€‚ ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ ajaxçŸ­è½®è¯¢(Polling) å’Œ Cometé•¿è½®è¯¢, å…¶ä»–è¯·è‡ªè¡Œæœç´¢èµ„æ–™~~ ä¼ ç»ŸAjaxçŸ­è½®è®­(Polling) è¿™æ˜¯æœ€æ—©çš„ä¸€ç§å®ç°å®æ—¶ Web åº”ç”¨çš„æ–¹æ¡ˆ, ä¸»è¦å°±æ˜¯å®¢æˆ·ç«¯(æµè§ˆå™¨), ä»¥ä¸€å®šçš„æ—¶é—´é—´éš”å‘æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚httpè¯·æ±‚, ä»¥é¢‘ç¹è¯·æ±‚çš„æ–¹å¼æ¥ä¿æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„åŒæ­¥ ; è¿™ç§æ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜å°±æ˜¯: ä½ æ— æ³•ç»™å‡ºå®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„é€‚å½“æ—¶é—´é—´éš” å¦‚æœå®¢æˆ·ç«¯(æµè§ˆå™¨)å‘é€è¯·æ±‚çš„é—´éš”æ—¶é—´è¿‡å°, æœåŠ¡å™¨ç«¯çš„æ•°æ®å¯èƒ½å¹¶æ²¡æœ‰æ›´æ–°, è¿™æ ·ä¼šå¸¦æ¥å¾ˆå¤šæ— è°“çš„ç½‘ç»œä¼ è¾“, è¿™æ ·æ—¢æµªè´¹äº†ç½‘ç»œå¸¦å®½, åˆæµªè´¹äº†CPUçš„åˆ©ç”¨ç‡ ; å¦‚æœå®¢æˆ·ç«¯(æµè§ˆå™¨)å‘é€è¯·æ±‚çš„é—´éš”æ—¶é—´è¿‡å¤§, åœ¨æœåŠ¡å™¨ç«¯çš„æ•°æ®æ›´æ–°å¾ˆå¿«æ—¶, åˆä¸èƒ½ä¿è¯å®¢æˆ·ç«¯è·å–æ•°æ®çš„å®æ—¶æ€§ ; Cometæœ€è¿‘å‡ å¹´,å› ä¸º AJAX æŠ€æœ¯çš„æ™®åŠ,ä»¥åŠæŠŠ IFrame åµŒåœ¨â€htmlfileâ€çš„ ActiveX ç»„ä»¶ä¸­å¯ä»¥è§£å†³ IE çš„åŠ è½½æ˜¾ç¤ºé—®é¢˜, ä¸€äº›å—æ¬¢è¿çš„åº”ç”¨å¦‚ meeboï¼Œgmail+gtalk åœ¨å®ç°ä¸­ä½¿ç”¨äº†è¿™äº›æ–°æŠ€æœ¯, åŒæ—¶â€æœåŠ¡å™¨æ¨â€åœ¨ç°å®åº”ç”¨ä¸­ç¡®å®å­˜åœ¨å¾ˆå¤šéœ€æ±‚ã€‚å› ä¸ºè¿™äº›åŸå› , åŸºäºçº¯æµè§ˆå™¨çš„â€æœåŠ¡å™¨æ¨â€æŠ€æœ¯å¼€å§‹å—åˆ°è¾ƒå¤šå…³æ³¨, Alex Russell(Dojo Toolkit çš„é¡¹ç›® Lead)ç§°è¿™ç§åŸºäº HTTP é•¿è¿æ¥ã€æ— é¡»åœ¨æµè§ˆå™¨ç«¯å®‰è£…æ’ä»¶çš„â€æœåŠ¡å™¨æ¨â€æŠ€æœ¯ä¸ºCometã€‚ åŸºäº AJAX çš„é•¿è½®è¯¢long-polling åŸºäºå®¢æˆ·ç«¯å¥—æ¥å£çš„â€æœåŠ¡å™¨æ¨â€æŠ€æœ¯, éœ€è¦åœ¨æµè§ˆå™¨ç«¯å®‰è£…æ’ä»¶, åŸºäºå¥—æ¥å£ä¼ é€ä¿¡æ¯, æˆ–æ˜¯ä½¿ç”¨ RMIã€CORBA è¿›è¡Œè¿œç¨‹è°ƒç”¨ ; ä½¿ç”¨ AJAX å®ç°â€æœåŠ¡å™¨æ¨â€ ä¸ ä¼ ç»Ÿçš„ AJAX åº”ç”¨ä¸åŒä¹‹å¤„åœ¨äº: æœåŠ¡å™¨ç«¯ä¼šé˜»å¡è¯·æ±‚ç›´åˆ°æœ‰æ•°æ®ä¼ é€’æˆ–è¶…æ—¶æ‰è¿”å›; å®¢æˆ·ç«¯ JavaScript å“åº”å¤„ç†å‡½æ•°ä¼šåœ¨å¤„ç†å®ŒæœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯å,å†æ¬¡å‘å‡ºè¯·æ±‚,é‡æ–°å»ºç«‹è¿æ¥; å½“å®¢æˆ·ç«¯å¤„ç†æ¥æ”¶çš„æ•°æ®ã€é‡æ–°å»ºç«‹è¿æ¥æ—¶, æœåŠ¡å™¨ç«¯å¯èƒ½æœ‰æ–°çš„æ•°æ®åˆ°è¾¾, è¿™äº›ä¿¡æ¯ä¼šè¢«æœåŠ¡å™¨ç«¯ä¿å­˜ç›´åˆ°å®¢æˆ·ç«¯é‡æ–°å»ºç«‹è¿æ¥, å®¢æˆ·ç«¯ä¼šä¸€æ¬¡æŠŠå½“å‰æœåŠ¡å™¨ç«¯æ‰€æœ‰çš„ä¿¡æ¯å–å›; åŸºäºé•¿è½®è¯¢çš„æœåŠ¡å™¨æ¨æ¨¡å‹å¦‚ä¸‹: ç›¸å¯¹äºâ€çŸ­è½®è¯¢â€(poll), è¿™ç§é•¿è½®è¯¢æ–¹å¼ä¹Ÿå¯ä»¥ç§°ä¸ºâ€æ‹‰â€(pull), è¿™ç§æ–¹æ¡ˆåŸºäº AJAXï¼Œå…·æœ‰ä»¥ä¸‹ä¸€äº›ä¼˜ç‚¹: è¯·æ±‚å¼‚æ­¥å‘å‡º; æ— é¡»å®‰è£…æ’ä»¶; IEã€Mozilla FireFox éƒ½æ”¯æŒ AJAX; ç»¼åˆè¿™å‡ ç§æ–¹æ¡ˆ, å¯ä»¥å‘ç°è¿™äº›æ‰€è°“çš„å®æ—¶æŠ€æœ¯å¹¶ä¸æ˜¯çœŸæ­£çš„å®æ—¶æŠ€æœ¯, å®ƒä»¬åªæ˜¯åœ¨ç”¨ Ajax æ–¹å¼æ¥æ¨¡æ‹Ÿå®æ—¶çš„æ•ˆæœ, åœ¨æ¯æ¬¡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯äº¤äº’çš„æ—¶å€™éƒ½æ˜¯ä¸€æ¬¡HTTPçš„è¯·æ±‚å’Œåº”ç­”çš„è¿‡ç¨‹, è€Œæ¯ä¸€æ¬¡çš„ HTTP è¯·æ±‚å’Œåº”ç­”éƒ½å¸¦æœ‰å®Œæ•´çš„ HTTP å¤´ä¿¡æ¯, è¿™å°±å¢åŠ äº†æ¯æ¬¡ä¼ è¾“çš„æ•°æ®é‡, è€Œä¸”è¿™äº›æ–¹æ¡ˆä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ç¼–ç¨‹å®ç°éƒ½æ¯”è¾ƒå¤æ‚, åœ¨å®é™…çš„åº”ç”¨ä¸­, ä¸ºäº†æ¨¡æ‹Ÿæ¯”è¾ƒçœŸå®çš„å®æ—¶æ•ˆæœ, å¼€å‘äººå‘˜å¾€å¾€éœ€è¦æ„é€ ä¸¤ä¸ª HTTP è¿æ¥æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒå‘é€šè®¯, ä¸€ä¸ªè¿æ¥ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„æ•°æ®ä¼ è¾“, ä¸€ä¸ªè¿æ¥ç”¨æ¥å¤„ç†æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ä¼ è¾“, è¿™ä¸å¯é¿å…åœ°å¢åŠ äº†ç¼–ç¨‹å®ç°çš„å¤æ‚åº¦, ä¹Ÿå¢åŠ äº†æœåŠ¡å™¨ç«¯çš„è´Ÿè½½, åˆ¶çº¦äº†åº”ç”¨ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚ WebSocketç®€ä»‹ WebSocket åè®®åœ¨2008å¹´è¯ç”Ÿï¼Œ2011å¹´æˆä¸ºå›½é™…æ ‡å‡†ã€‚æ‰€æœ‰æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒäº†ã€‚å®ƒçš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œå°±åƒSocketä¸€æ ·ã€‚ WebSocket æ˜¯HTML5ä¸­å®šä¹‰çš„æ–°åè®®, å®ƒå®ç°äº†çœŸæ­£çš„é•¿è¿æ¥, å®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„å…¨åŒå·¥é€šä¿¡; HTML5 WebSocketè®¾è®¡å‡ºæ¥çš„ç›®çš„å°±æ˜¯è¦å–ä»£ è½®è¯¢ å’Œ Comet æŠ€æœ¯, ä½¿å®¢æˆ·ç«¯æµè§ˆå™¨å…·å¤‡åƒ C/S æ¶æ„ä¸‹æ¡Œé¢ç³»ç»Ÿçš„å®æ—¶é€šè®¯èƒ½åŠ›ã€‚ ç‰¹ç‚¹: å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼ŒæœåŠ¡å™¨ç«¯çš„å®ç°æ¯”è¾ƒå®¹æ˜“ã€‚ ä¸ HTTP åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ã€‚é»˜è®¤ç«¯å£ä¹Ÿæ˜¯80å’Œ443ï¼Œå¹¶ä¸”æ¡æ‰‹é˜¶æ®µé‡‡ç”¨HTTPåè®®ï¼Œå› æ­¤æ¡æ‰‹æ—¶ä¸å®¹æ˜“å±è”½ï¼Œèƒ½é€šè¿‡å„ç§HTTPä»£ç†æœåŠ¡å™¨ æ•°æ®æ ¼å¼æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡é«˜æ•ˆ å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ® æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡ åè®®æ ‡è¯†ç¬¦æ˜¯ws(å¦‚æœåŠ å¯†ï¼Œåˆ™ä¸ºwss),æœåŠ¡å™¨ç½‘å€å°±æ˜¯ URL åè®®ç”±ä¸¤é˜¶æ®µç»„æˆ: æ¡æ‰‹é˜¶æ®µ(handshake) å’Œ æ•°æ®ä¼ è¾“é˜¶æ®µ","categories":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/categories/WebSocket/"}],"tags":[{"name":"WebSocket","slug":"WebSocket","permalink":"http://blog.renyimin.com/tags/WebSocket/"}]},{"title":"70. æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–","slug":"mysql/2017-09-27-mysql-70","date":"2017-09-27T12:50:37.000Z","updated":"2018-03-08T06:03:46.000Z","comments":true,"path":"2017/09/27/mysql/2017-09-27-mysql-70/","link":"","permalink":"http://blog.renyimin.com/2017/09/27/mysql/2017-09-27-mysql-70/","excerpt":"","text":"å‰è¨€ä¹‹å‰å·²ç»äº†è§£äº†ç´¢å¼•ä¼˜åŒ–çš„ç›¸å…³å†…å®¹, å®ƒå¯¹äºé«˜æ€§èƒ½æ˜¯å¿…ä¸å¯å°‘çš„, ä½†è¿˜ä¸å¤Ÿ, è¿˜éœ€è¦åˆç†è®¾è®¡æŸ¥è¯¢; å¦‚æœæŸ¥è¯¢å†™çš„å¾ˆç³Ÿç³•, å³ä½¿åº“è¡¨ç»“æ„å†åˆç†, ç´¢å¼•å†åˆé€‚, ä¹Ÿæ— æ³•å®ç°é«˜æ€§èƒ½; æŸ¥è¯¢ä¼˜åŒ–, åº“è¡¨ç»“æ„ä¼˜åŒ–, ç´¢å¼•ä¼˜åŒ–éœ€è¦é½å¤´å¹¶è¿›, ä¸€ä¸ªä¸è½; æ…¢æŸ¥è¯¢åŸºç¡€ä¼˜åŒ–æ•°æ®è®¿é—® ç¡®è®¤åº”ç”¨ç¨‹åºæ˜¯å¦åœ¨æ£€ç´¢å¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®, ä½ å¯èƒ½è®¿é—®äº†å¤ªå¤šçš„è¡Œ, ä¹Ÿå¯èƒ½æ˜¯å¤ªå¤šçš„åˆ—;æ¯”å¦‚: æ€»æ˜¯è¿”å›å…¨éƒ¨çš„åˆ—; åªå±•ç¤º5æ¡æ•°æ®,ä½ å´æŸ¥å‡º100æ¡; ç¡®è®¤MySQLæœåŠ¡å™¨å±‚æ˜¯å¦åœ¨åˆ†æå¤§é‡è¶…è¿‡éœ€è¦çš„æ•°æ®è¡Œ; (æ³¨æ„: ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚, ä¸€æ—¦æœåŠ¡å™¨å±‚åˆ†æçš„æ•°æ®è¿‡å¤š, å¯èƒ½ä½ çš„ç´¢å¼•ä¸å¤ªåˆé€‚, æ²¡æœ‰åœ¨å­˜å‚¨å¼•æ“å±‚è¿‡æ»¤æ‰æ•°æ®) æœªå®Œå¾…ç»­~~","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–","slug":"æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–","permalink":"http://blog.renyimin.com/tags/æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–/"}]},{"title":"50. EXPLAIN åˆ†æ","slug":"mysql/2017-09-25-mysql-50","date":"2017-09-25T13:23:08.000Z","updated":"2018-03-16T06:30:27.000Z","comments":true,"path":"2017/09/25/mysql/2017-09-25-mysql-50/","link":"","permalink":"http://blog.renyimin.com/2017/09/25/mysql/2017-09-25-mysql-50/","excerpt":"","text":"å‡†å¤‡ç¯å¢ƒ1234567891011121314151617181920212223242526272829303132333435363738CREATE TABLE `user_info` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT, `name` VARCHAR(50) NOT NULL DEFAULT &apos;&apos;, `age` INT(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `name_index` (`name`)) ENGINE = InnoDB, DEFAULT CHARSET = utf8;INSERT INTO user_info (name, age) VALUES (&apos;xys&apos;, 20);INSERT INTO user_info (name, age) VALUES (&apos;a&apos;, 21);INSERT INTO user_info (name, age) VALUES (&apos;b&apos;, 23);INSERT INTO user_info (name, age) VALUES (&apos;c&apos;, 50);INSERT INTO user_info (name, age) VALUES (&apos;d&apos;, 15);INSERT INTO user_info (name, age) VALUES (&apos;e&apos;, 20);INSERT INTO user_info (name, age) VALUES (&apos;f&apos;, 21);INSERT INTO user_info (name, age) VALUES (&apos;g&apos;, 23);INSERT INTO user_info (name, age) VALUES (&apos;h&apos;, 50);INSERT INTO user_info (name, age) VALUES (&apos;i&apos;, 15);CREATE TABLE `order_info` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT, `user_id` BIGINT(20) DEFAULT NULL, `product_name` VARCHAR(50) NOT NULL DEFAULT &apos;&apos;, `productor` VARCHAR(30) DEFAULT NULL, PRIMARY KEY (`id`), KEY `user_product_detail_index` (`user_id`, `product_name`, `productor`))ENGINE = InnoDB,DEFAULT CHARSET = utf8;INSERT INTO order_info (user_id, product_name, productor) VALUES (1, &apos;p1&apos;, &apos;WHH&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (1, &apos;p2&apos;, &apos;WL&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (1, &apos;p1&apos;, &apos;DX&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (2, &apos;p1&apos;, &apos;WHH&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (2, &apos;p5&apos;, &apos;WL&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (3, &apos;p3&apos;, &apos;MA&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (4, &apos;p1&apos;, &apos;WHH&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (6, &apos;p1&apos;, &apos;WHH&apos;);INSERT INTO order_info (user_id, product_name, productor) VALUES (9, &apos;p8&apos;, &apos;TE&apos;); EXPLAIN è¾“å‡º1234567mysql&gt; explain select * from user_info where id = 2;+----+-------------+-----------+-------+---------------+---------+---------+-------+------+-------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+---------+---------+-------+------+-------+| 1 | SIMPLE | user_info | const | PRIMARY | PRIMARY | 8 | const | 1 | NULL |+----+-------------+-----------+-------+---------------+---------+---------+-------+------+-------+1 row in set (0.00 sec) select_type select_type è¡¨ç¤ºäº†æŸ¥è¯¢çš„ç±»å‹, å®ƒçš„å¸¸ç”¨å–å€¼æœ‰: SIMPLE, è¡¨ç¤ºæ­¤æŸ¥è¯¢ä¸åŒ…å« UNION æŸ¥è¯¢æˆ–å­æŸ¥è¯¢ (æœ€å¸¸è§çš„æŸ¥è¯¢ç±»åˆ«å°±æ˜¯ SIMPLE äº†) PRIMARY, è¡¨ç¤ºæ­¤æŸ¥è¯¢æ˜¯æœ€å¤–å±‚çš„æŸ¥è¯¢ UNION, è¡¨ç¤ºæ­¤æŸ¥è¯¢æ˜¯ UNION çš„ç¬¬äºŒæˆ–éšåçš„æŸ¥è¯¢ DEPENDENT UNION, UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„æŸ¥è¯¢è¯­å¥, å–å†³äºå¤–é¢çš„æŸ¥è¯¢ UNION RESULT, UNION çš„ç»“æœ SUBQUERY, å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT DEPENDENT SUBQUERY: å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT, å–å†³äºå¤–é¢çš„æŸ¥è¯¢. å³å­æŸ¥è¯¢ä¾èµ–äºå¤–å±‚æŸ¥è¯¢çš„ç»“æœ. å¦‚æœä½¿ç”¨äº†UNIONæŸ¥è¯¢, é‚£ä¹ˆEXPLAIN è¾“å‡ºç»“æœç±»ä¼¼å¦‚ä¸‹: 123456789101112mysql&gt; EXPLAIN ( SELECT * FROM user_info WHERE id IN ( 1, 2, 3 ) ) UNION( SELECT * FROM user_info WHERE id IN ( 3, 4, 5 ) );+------+--------------+------------+-------+---------------+---------+---------+------+------+-----------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+------+--------------+------------+-------+---------------+---------+---------+------+------+-----------------+| 1 | PRIMARY | user_info | range | PRIMARY | PRIMARY | 8 | NULL | 3 | Using where || 2 | UNION | user_info | range | PRIMARY | PRIMARY | 8 | NULL | 3 | Using where || NULL | UNION RESULT | &lt;union1,2&gt; | ALL | NULL | NULL | NULL | NULL | NULL | Using temporary |+------+--------------+------------+-------+---------------+---------+---------+------+------+-----------------+3 rows in set (0.00 sec) mysql&gt; type type å­—æ®µæ¯”è¾ƒé‡è¦, å®ƒæä¾›äº†åˆ¤æ–­æŸ¥è¯¢æ˜¯å¦é«˜æ•ˆçš„é‡è¦ä¾æ®ä¾æ®; é€šè¿‡ type å­—æ®µ, æˆ‘ä»¬åˆ¤æ–­æ­¤æ¬¡æŸ¥è¯¢æ˜¯ å…¨è¡¨æ‰«æ è¿˜æ˜¯ ç´¢å¼•æ‰«æ ç­‰; type å¸¸ç”¨çš„å–å€¼æœ‰: system: è¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®, è¿™ä¸ªç±»å‹æ˜¯ç‰¹æ®Šçš„ const ç±»å‹; ?? const: é’ˆå¯¹ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢æ‰«æ, æœ€å¤šåªè¿”å›ä¸€è¡Œæ•°æ®(const æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«, å› ä¸ºå®ƒä»…ä»…è¯»å–ä¸€æ¬¡å³å¯) eq_ref: æ­¤ç±»å‹é€šå¸¸å‡ºç°åœ¨å¤šè¡¨çš„joinæŸ¥è¯¢, è¡¨ç¤ºå¯¹äºå‰è¡¨çš„æ¯ä¸€ä¸ªç»“æœ, éƒ½åªèƒ½åŒ¹é…åˆ°åè¡¨çš„ä¸€è¡Œç»“æœ, å¹¶ä¸”æŸ¥è¯¢çš„æ¯”è¾ƒæ“ä½œé€šå¸¸æ˜¯ =, æŸ¥è¯¢æ•ˆç‡è¾ƒé«˜, ä¾‹å¦‚: 12345678mysql&gt; EXPLAIN SELECT * FROM user_info, order_info WHERE user_info.id = order_info.user_id;+----+-------------+------------+--------+---------------------------+---------------------------+---------+-------------------------+------+--------------------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+------------+--------+---------------------------+---------------------------+---------+-------------------------+------+--------------------------+| 1 | SIMPLE | order_info | index | user_product_detail_index | user_product_detail_index | 254 | NULL | 9 | Using where; Using index || 1 | SIMPLE | user_info | eq_ref | PRIMARY | PRIMARY | 8 | test.order_info.user_id | 1 | NULL |+----+-------------+------------+--------+---------------------------+---------------------------+---------+-------------------------+------+--------------------------+2 rows in set (0.00 sec) ref: æ­¤ç±»å‹é€šå¸¸å‡ºç°åœ¨å¤šè¡¨çš„ join æŸ¥è¯¢, é’ˆå¯¹äºéå”¯ä¸€æˆ–éä¸»é”®ç´¢å¼•, æˆ–è€…æ˜¯ä½¿ç”¨äº† æœ€å·¦å‰ç¼€ è§„åˆ™ç´¢å¼•çš„æŸ¥è¯¢, ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­, å°±ä½¿ç”¨åˆ°äº† ref ç±»å‹çš„æŸ¥è¯¢: 12345678mysql&gt; EXPLAIN SELECT * FROM user_info, order_info WHERE user_info.id = order_info.user_id AND order_info.user_id = 5;+----+-------------+------------+-------+---------------------------+---------------------------+---------+-------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+------------+-------+---------------------------+---------------------------+---------+-------+------+-------------+| 1 | SIMPLE | user_info | const | PRIMARY | PRIMARY | 8 | const | 1 | NULL || 1 | SIMPLE | order_info | ref | user_product_detail_index | user_product_detail_index | 9 | const | 1 | Using index |+----+-------------+------------+-------+---------------------------+---------------------------+---------+-------+------+-------------+2 rows in set (0.00 sec) range: è¡¨ç¤ºä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥è¯¢, é€šè¿‡ç´¢å¼•å­—æ®µèŒƒå›´è·å–è¡¨ä¸­éƒ¨åˆ†æ•°æ®è®°å½•; è¿™ä¸ªç±»å‹é€šå¸¸å‡ºç°åœ¨ =, &lt;&gt;, &gt;, &gt;=, &lt;, &lt;=, IS NULL, &lt;=&gt;, BETWEEN, IN() æ“ä½œä¸­.å½“ type æ˜¯ range æ—¶, é‚£ä¹ˆ EXPLAIN è¾“å‡ºçš„ ref å­—æ®µä¸º NULL (æ²¡ç”¨åˆ°ç´¢å¼•), å¹¶ä¸” key_len å­—æ®µæ˜¯æ­¤æ¬¡æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°çš„ç´¢å¼•çš„æœ€é•¿çš„é‚£ä¸ª 1234567mysql&gt; EXPLAIN SELECT * FROM user_info WHERE id BETWEEN 2 AND 8;+----+-------------+-----------+-------+---------------+---------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+---------+---------+------+------+-------------+| 1 | SIMPLE | user_info | range | PRIMARY | PRIMARY | 8 | NULL | 7 | Using where |+----+-------------+-----------+-------+---------------+---------+---------+------+------+-------------+1 row in set (0.00 sec) ä¸‹é¢å¯¹æ¯”, éƒ½ä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢, ä½†æ˜¯ä¸€ä¸ªå¯ä»¥ä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥è¯¢, å¦ä¸€ä¸ªä¸èƒ½ä½¿ç”¨ç´¢å¼• 123456789101112131415mysql&gt; EXPLAIN SELECT name FROM user_info where name&gt;&apos;nihao&apos;;+----+-------------+-----------+-------+---------------+------------+---------+------+------+--------------------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+------------+---------+------+------+--------------------------+| 1 | SIMPLE | user_info | range | name_index | name_index | 152 | NULL | 1 | Using where; Using index |+----+-------------+-----------+-------+---------------+------------+---------+------+------+--------------------------+1 row in set (0.00 sec) mysql&gt; EXPLAIN SELECT name FROM user_info where age&gt;10;+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| 1 | SIMPLE | user_info | ALL | NULL | NULL | NULL | NULL | 10 | Using where |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+1 row in set (0.00 sec) å¦å¤–, å¯å‚è€ƒ P185: inè¯­å¥è™½ç„¶æœ‰æ—¶å€™ typeç»“æœä¹Ÿæ˜¯range (ä¸è¿‡, å¯¹äºçœŸæ­£çš„èŒƒå›´æŸ¥è¯¢, ç¡®å®æ˜¯æ— æ³•ä½¿ç”¨èŒƒå›´åˆ—åé¢çš„å…¶ä»–ç´¢å¼•äº†, ä½†æ˜¯å¯¹äºâ€å¤šä¸ªç­‰å€¼æ¡ä»¶æŸ¥è¯¢â€åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶) index: è¡¨ç¤ºå…¨ç´¢å¼•æ‰«æ(full index scan), å’Œ ALL ç±»å‹ç±»ä¼¼, åªä¸è¿‡ALLç±»å‹æ˜¯å…¨è¡¨æ‰«æ, è€Œ index ç±»å‹åˆ™ä»…ä»…æ‰«ææ‰€æœ‰çš„ç´¢å¼•, è€Œä¸æ‰«ææ•°æ®index ç±»å‹é€šå¸¸å‡ºç°åœ¨: æ‰€è¦æŸ¥è¯¢çš„æ•°æ®ç›´æ¥åœ¨ç´¢å¼•æ ‘ä¸­å°±å¯ä»¥è·å–åˆ°, è€Œä¸éœ€è¦æ‰«ææ•°æ®, å³ åšçš„æ˜¯è¦†ç›–ç´¢å¼•, å½“æ˜¯è¿™ç§æƒ…å†µæ—¶, Extra å­—æ®µä¼šæ˜¾ç¤º Using index ä¸‹é¢çš„ä¾‹å­ä¸­, æŸ¥è¯¢çš„ name å­—æ®µæ°å¥½æ˜¯ä¸€ä¸ªç´¢å¼•(åšåˆ°äº†è¦†ç›–ç´¢å¼•), å› æ­¤æˆ‘ä»¬ç›´æ¥ä»ç´¢å¼•ä¸­è·å–æ•°æ®å°±å¯ä»¥æ»¡è¶³æŸ¥è¯¢çš„éœ€æ±‚äº†, è€Œä¸éœ€è¦æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®;å› æ­¤è¿™æ ·çš„æƒ…å†µä¸‹, type çš„å€¼æ˜¯ index, å¹¶ä¸” Extra çš„å€¼æ˜¯ Using index; 1234567mysql&gt; EXPLAIN SELECT name FROM user_info;+----+-------------+-----------+-------+---------------+------------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+------------+---------+------+------+-------------+| 1 | SIMPLE | user_info | index | NULL | name_index | 152 | NULL | 10 | Using index |+----+-------------+-----------+-------+---------------+------------+---------+------+------+-------------+1 row in set (0.00 sec) ä¸‹é¢ä¸ä½†ä½¿ç”¨äº†å…¨ç´¢å¼•æ‰«æ, è€Œä¸”ä½¿ç”¨äº†whereæ¡ä»¶ 1234567mysql&gt; EXPLAIN SELECT name FROM user_info where name=&apos;nihao&apos;;+----+-------------+-----------+------+---------------+------------+---------+-------+------+--------------------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------------+---------+-------+------+--------------------------+| 1 | SIMPLE | user_info | ref | name_index | name_index | 152 | const | 1 | Using where; Using index |+----+-------------+-----------+------+---------------+------------+---------+-------+------+--------------------------+1 row in set (0.00 sec) ä½†æ˜¯, å¦‚æœä¸ä½¿ç”¨ç´¢å¼•çš„è¯, ä¸‹é¢typeå°±æ˜¯ALL, è¡¨ç¤ºä½¿ç”¨äº†å…¨è¡¨æ‰«æ, å¹¶ä¸”ä½¿ç”¨äº†whereæ¡ä»¶ 1234567mysql&gt; EXPLAIN SELECT name FROM user_info where age=10;+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| 1 | SIMPLE | user_info | ALL | NULL | NULL | NULL | NULL | 10 | Using where |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+1 row in set (0.00 sec) 1234567mysql&gt; EXPLAIN SELECT name FROM user_info where age&gt;10;+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+| 1 | SIMPLE | user_info | ALL | NULL | NULL | NULL | NULL | 10 | Using where |+----+-------------+-----------+------+---------------+------+---------+------+------+-------------+1 row in set (0.00 sec) ä¸‹é¢ 1234567mysql&gt; EXPLAIN SELECT name FROM user_info where name&gt;&apos;nihao&apos;;+----+-------------+-----------+-------+---------------+------------+---------+------+------+--------------------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+------------+---------+------+------+--------------------------+| 1 | SIMPLE | user_info | range | name_index | name_index | 152 | NULL | 1 | Using where; Using index |+----+-------------+-----------+-------+---------------+------------+---------+------+------+--------------------------+1 row in set (0.00 sec) ALL: è¡¨ç¤ºå…¨è¡¨æ‰«æ, è¿™ä¸ªç±»å‹çš„æŸ¥è¯¢æ˜¯æ€§èƒ½æœ€å·®çš„æŸ¥è¯¢ä¹‹ä¸€, é€šå¸¸æ¥è¯´, æˆ‘ä»¬çš„æŸ¥è¯¢ä¸åº”è¯¥å‡ºç° ALL ç±»å‹çš„æŸ¥è¯¢, å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹, å¯¹æ•°æ®åº“çš„æ€§èƒ½æ˜¯å·¨å¤§çš„ç¾éš¾å¦‚ä¸€ä¸ªæŸ¥è¯¢æ˜¯ ALL ç±»å‹æŸ¥è¯¢, é‚£ä¹ˆä¸€èˆ¬æ¥è¯´å¯ä»¥å¯¹ç›¸åº”çš„å­—æ®µæ·»åŠ ç´¢å¼•æ¥é¿å…. typeå°ç»“type ç±»å‹çš„æ€§èƒ½æ¯”è¾ƒ : é€šå¸¸æ¥è¯´, ä¸åŒçš„ type ç±»å‹çš„æ€§èƒ½å…³ç³»å¦‚: ALL &lt; index &lt; range ~ index_merge &lt; ref &lt; eq_ref &lt; const &lt; system ALL ç±»å‹å› ä¸ºæ˜¯å…¨è¡¨æ‰«æ, å› æ­¤åœ¨ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶ä¸‹, å®ƒæ˜¯é€Ÿåº¦æœ€æ…¢çš„; è€Œ index ç±»å‹çš„æŸ¥è¯¢è™½ç„¶ä¸æ˜¯å…¨è¡¨æ‰«æ, ä½†æ˜¯å®ƒæ‰«æäº†æ‰€æœ‰çš„ç´¢å¼•, å› æ­¤æ¯” ALL ç±»å‹çš„ç¨å¿«; åé¢çš„å‡ ç§ç±»å‹éƒ½æ˜¯åˆ©ç”¨äº†ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®, å› æ­¤å¯ä»¥è¿‡æ»¤éƒ¨åˆ†æˆ–å¤§éƒ¨åˆ†æ•°æ®, å› æ­¤æŸ¥è¯¢æ•ˆç‡å°±æ¯”è¾ƒé«˜äº†; possible_keyspossible_keys è¡¨ç¤º MySQL åœ¨æŸ¥è¯¢æ—¶, èƒ½å¤Ÿä½¿ç”¨åˆ°çš„ç´¢å¼•;æ³¨æ„: å³ä½¿æœ‰äº›ç´¢å¼•åœ¨ possible_keys ä¸­å‡ºç°, ä½†æ˜¯å¹¶ä¸è¡¨ç¤ºæ­¤ç´¢å¼•ä¼šçœŸæ­£åœ°è¢« MySQL ä½¿ç”¨åˆ°;(MySQL åœ¨æŸ¥è¯¢æ—¶å…·ä½“ä½¿ç”¨äº†å“ªäº›ç´¢å¼•, ç”± key å­—æ®µå†³å®š) keyæ­¤å­—æ®µæ˜¯ MySQL åœ¨å½“å‰æŸ¥è¯¢æ—¶æ‰€çœŸæ­£ä½¿ç”¨åˆ°çš„ç´¢å¼• rowsrows ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„å­—æ®µ, MySQL æŸ¥è¯¢ä¼˜åŒ–å™¨æ ¹æ®ç»Ÿè®¡ä¿¡æ¯, ä¼°ç®—SQLè¦æŸ¥æ‰¾åˆ°ç»“æœé›†éœ€è¦åˆ°è¡¨ä¸­æ‰«æè¯»å–çš„æ•°æ®è¡Œæ•°(ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°, åŸºæœ¬ä¸Šä½¿ç”¨åˆ°äº†ç´¢å¼•çš„è¯, çœŸæ­£æ‰«æçš„è¡Œæ•°éƒ½å¾ˆå°‘); è¿™ä¸ªå€¼éå¸¸ç›´è§‚æ˜¾ç¤º SQL çš„æ•ˆç‡å¥½å, åŸåˆ™ä¸Š rows è¶Šå°‘è¶Šå¥½ ExtraExplain ä¸­çš„å¾ˆå¤šé¢å¤–çš„ä¿¡æ¯ä¼šåœ¨ Extra å­—æ®µæ˜¾ç¤º, å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§å†…å®¹: Using filesort: å½“ Extra ä¸­æœ‰ Using filesort æ—¶, è¡¨ç¤º MySQL éœ€é¢å¤–çš„æ’åºæ“ä½œ, ä¸èƒ½é€šè¿‡ç´¢å¼•é¡ºåºè¾¾åˆ°æ’åºæ•ˆæœ. ä¸€èˆ¬æœ‰ Using filesort, éƒ½å»ºè®®ä¼˜åŒ–å»æ‰, å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢ CPU èµ„æºæ¶ˆè€—å¤§. æ¯”å¦‚ä¸‹é¢, ä½¿ç”¨ç´¢å¼•æ‰«æåšæ’åº å’Œ ä¸ä½¿ç”¨ç´¢å¼•æ‰«æåšæ’åº çš„æ•ˆæœ: 123456789101112131415mysql&gt; EXPLAIN SELECT name FROM user_info ORDER BY name;+----+-------------+-----------+-------+---------------+------------+---------+------+------+-------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+-------+---------------+------------+---------+------+------+-------------+| 1 | SIMPLE | user_info | index | NULL | name_index | 152 | NULL | 10 | Using index |+----+-------------+-----------+-------+---------------+------------+---------+------+------+-------------+1 row in set (0.00 sec) mysql&gt; EXPLAIN SELECT name FROM user_info ORDER BY age;+----+-------------+-----------+------+---------------+------+---------+------+------+----------------+| id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra |+----+-------------+-----------+------+---------------+------+---------+------+------+----------------+| 1 | SIMPLE | user_info | ALL | NULL | NULL | NULL | NULL | 10 | Using filesort |+----+-------------+-----------+------+---------------+------+---------+------+------+----------------+1 row in set (0.00 sec) Using index ä¸ Using index condition â€œè¦†ç›–ç´¢å¼•æ‰«æâ€, è¡¨ç¤ºæŸ¥è¯¢åœ¨ç´¢å¼•æ ‘ä¸­å°±å¯æŸ¥æ‰¾æ‰€éœ€æ•°æ®, ä¸ç”¨æ‰«æè¡¨æ•°æ®æ–‡ä»¶, å¾€å¾€è¯´æ˜æ€§èƒ½ä¸é”™ æ¯”å¦‚ä¸‹é¢, ç¬¬ä¸€ä¸ªåšåˆ°äº†è¦†ç›–ç´¢å¼•æ‰«æ, åé¢ä¸¤ä¸ªéƒ½æ²¡åšåˆ° mysql&gt; EXPLAIN SELECT name FROM user_info where name=&apos;haha&apos;; +----+-------------+-----------+------+---------------+------------+---------+-------+------+--------------------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+-------------+-----------+------+---------------+------------+---------+-------+------+--------------------------+ | 1 | SIMPLE | user_info | ref | name_index | name_index | 152 | const | 1 | Using where; Using index | +----+-------------+-----------+------+---------------+------------+---------+-------+------+--------------------------+ 1 row in set (0.00 sec) mysql&gt; EXPLAIN SELECT name,age FROM user_info where name=&apos;haha&apos;; +----+-------------+-----------+------+---------------+------------+---------+-------+------+-----------------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+-------------+-----------+------+---------------+------------+---------+-------+------+-----------------------+ | 1 | SIMPLE | user_info | ref | name_index | name_index | 152 | const | 1 | Using index condition | +----+-------------+-----------+------+---------------+------------+---------+-------+------+-----------------------+ 1 row in set (0.00 sec) mysql&gt; EXPLAIN SELECT * FROM user_info where name=&apos;haha&apos;; +----+-------------+-----------+------+---------------+------------+---------+-------+------+-----------------------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+-------------+-----------+------+---------------+------------+---------+-------+------+-----------------------+ | 1 | SIMPLE | user_info | ref | name_index | name_index | 152 | const | 1 | Using index condition | +----+-------------+-----------+------+---------------+------------+---------+-------+------+-----------------------+ 1 row in set (0.00 sec) Using temporaryæŸ¥è¯¢æœ‰ä½¿ç”¨ä¸´æ—¶è¡¨, ä¸€èˆ¬å‡ºç°äºæ’åº, åˆ†ç»„å’Œå¤šè¡¨ join çš„æƒ…å†µ, æŸ¥è¯¢æ•ˆç‡ä¸é«˜, å»ºè®®ä¼˜åŒ–.","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"49. ç´¢å¼•å’Œé”","slug":"mysql/2017-09-25-mysql-49","date":"2017-09-25T13:10:40.000Z","updated":"2018-03-08T02:57:03.000Z","comments":true,"path":"2017/09/25/mysql/2017-09-25-mysql-49/","link":"","permalink":"http://blog.renyimin.com/2017/09/25/mysql/2017-09-25-mysql-49/","excerpt":"","text":"ç´¢å¼•å¯ä»¥è®©æŸ¥è¯¢é”å®šæ›´å°‘çš„è¡Œ å› ä¸ºInnoDBåªæœ‰åœ¨è®¿é—®è¡Œçš„æ—¶å€™æ‰ä¼šå¯¹å…¶åŠ é”, è€Œç´¢å¼•èƒ½å¤Ÿå‡å°‘InnoDBè®¿é—®çš„è¡Œæ•°, ä»è€Œå‡å°‘é”çš„æ•°é‡;ä½†è¿™åªæœ‰å½“InnoDBåœ¨å­˜å‚¨å¼•æ“å±‚å°±èƒ½è¿‡æ»¤æ‰æ‰€æœ‰ä¸éœ€è¦çš„è¡Œæ—¶æ‰è¡Œ, å¦‚æœç´¢å¼•(å¤„åœ¨å­˜å‚¨å¼•æ“å±‚)æ— æ³•è¿‡æ»¤æ‰æ— æ•ˆçš„è¡Œ, é‚£ä¹ˆåœ¨InnoDBæ£€ç´¢åˆ°æ•°æ®å¹¶å‘é€ç»™æœåŠ¡å™¨å±‚ä»¥å, æœåŠ¡å™¨å±‚æ‰èƒ½åº”ç”¨whereå­å¥, è¿™æ—¶å·²ç»æ— æ³•é¿å…é”å®šè¡Œäº†;è™½ç„¶InnoDBçš„è¡Œé”æ•ˆç‡å¾ˆé«˜, å†…å­˜ä½¿ç”¨ä¹Ÿå¾ˆå°‘, ä½†æ˜¯é”å®šè¡Œçš„æ—¶å€™ä»ç„¶ä¼šå¸¦æ¥é¢å¤–å¼€é”€;é”å®šè¶…è¿‡éœ€è¦çš„è¡Œä¼šå¢åŠ é”äº‰ç”¨å¹¶å‡å°‘å¹¶å‘æ€§;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"48. å†—ä½™å’Œé‡å¤ç´¢å¼•","slug":"mysql/2017-09-25-mysql-48","date":"2017-09-25T10:27:40.000Z","updated":"2018-03-08T02:39:49.000Z","comments":true,"path":"2017/09/25/mysql/2017-09-25-mysql-48/","link":"","permalink":"http://blog.renyimin.com/2017/09/25/mysql/2017-09-25-mysql-48/","excerpt":"","text":"é‡å¤ç´¢å¼• æ˜¯æŒ‡åœ¨ç›¸åŒçš„åˆ—ä¸ŠæŒ‰ç…§ç›¸åŒçš„é¡ºåºåˆ›å»ºçš„ç›¸åŒç±»å‹çš„ç´¢å¼•; åº”è¯¥é¿å…è¿™æ ·çš„é‡å¤ç´¢å¼•, å‘ç°åä¹Ÿåº”è¯¥ç«‹å³åˆ é™¤; MySQLå…è®¸åœ¨ç›¸åŒçš„åˆ—ä¸Šåˆ›å»ºå¤šä¸ªç´¢å¼•, ä½†æ˜¯MySQLéœ€è¦å•ç‹¬ç»´æŠ¤é‡å¤çš„ç´¢å¼•, å¹¶ä¸”ä¼˜åŒ–å™¨åœ¨ä¼˜åŒ–æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿéœ€è¦é€ä¸ªåœ°è¿›è¡Œè€ƒè™‘, è¿™ä¼šå½±å“æ€§èƒ½; å†—ä½™ç´¢å¼• å’Œ é‡å¤ç´¢å¼• ä¸åŒ, å¦‚æœåˆ›å»ºäº†ç´¢å¼•(A,B), åœ¨åˆ›å»ºç´¢å¼•(A)å°±æ˜¯å†—ä½™ç´¢å¼•, å› ä¸ºè¿™åªæ˜¯(A,B)ç´¢å¼•çš„å‰ç¼€ç´¢å¼•; å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¸éœ€è¦å†—ä½™ç´¢å¼•; å› æ­¤ç´¢å¼•(A,B)ä¹Ÿå¯ä»¥å½“åšç´¢å¼•(A)æ¥ä½¿ç”¨ ä½†æ˜¯å¦‚æœå†åˆ›å»ºç´¢å¼•(B,A), (B) åˆ™éƒ½ä¸æ˜¯å†—ä½™ç´¢å¼• æœ‰æ—¶å€™ä¸ºäº†è®©ä¸¤ä¸ªæŸ¥è¯¢éƒ½å˜å¿«, ä¹Ÿä¼šéœ€è¦å†—ä½™ç´¢å¼• (P179) åº”è¯¥å°½é‡æ‰©å±•å·²æœ‰çš„ç´¢å¼•è€Œä¸æ˜¯åˆ›å»ºæ–°çš„ç´¢å¼•","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"47. ä½¿ç”¨ç´¢å¼•æ‰«ææ¥åšæ’åº","slug":"mysql/2017-09-25-mysql-47","date":"2017-09-25T10:25:11.000Z","updated":"2018-03-08T05:38:13.000Z","comments":true,"path":"2017/09/25/mysql/2017-09-25-mysql-47/","link":"","permalink":"http://blog.renyimin.com/2017/09/25/mysql/2017-09-25-mysql-47/","excerpt":"","text":"ç®€ä»‹ åªæœ‰å½“ç´¢å¼•çš„åˆ—é¡ºåº å’Œ ORDER BY å­å¥çš„é¡ºåºå®Œå…¨ä¸€è‡´, å¹¶ä¸”æ‰€æœ‰åˆ—çš„æ’åºæ–¹å‘éƒ½ä¸€æ ·æ—¶(è¦ä¹ˆéƒ½æ˜¯æ­£åº, è¦ä¹ˆéƒ½æ˜¯å€’åº), MySQLæ‰èƒ½å¤Ÿä½¿ç”¨ç´¢å¼•æ¥å¯¹ç»“æœåšæ’åº; å¦‚æœæŸ¥è¯¢éœ€è¦å…³è”å¤šå¼ è¡¨, åˆ™åªæœ‰å½“ ORDER BY å­å¥å¼•ç”¨çš„å­—æ®µå…¨éƒ¨ä¸ºç¬¬ä¸€ä¸ªè¡¨æ—¶, æ‰èƒ½ä½¿ç”¨ç´¢å¼•åšæ’åº; ORDER BY å­å¥ å’Œ æŸ¥æ‰¾å‹æŸ¥è¯¢çš„é™åˆ¶æ˜¯ä¸€æ ·çš„, éœ€è¦æ»¡è¶³ç´¢å¼•çš„æœ€å·¦å‰ç¼€çš„è¦æ±‚, å¦åˆ™, MySQLéƒ½éœ€è¦äº²è‡ªå»æ‰§è¡Œæ’åºæ“ä½œ, è€Œæ— æ³•åˆ©ç”¨ç´¢å¼•æ’åº; æœ‰ä¸€ç§æƒ…å†µä¸‹, ORDER BY å­å¥å¯ä»¥ä¸ç”¨æ»¡è¶³æœ€å·¦å‰ç¼€çš„è¦æ±‚, é‚£å°±æ˜¯å‰å¯¼åˆ—ä¸ºå¸¸é‡çš„æ—¶å€™; æ¯”å¦‚ä¸€å¼ è¡¨çš„ç´¢å¼•æ˜¯ key(a,b,c) , è€Œ æŸ¥è¯¢è¯­å¥æ˜¯ ... where a=100 order by b,c, å³ä½¿ order by ä¸æ»¡è¶³æœ€å·¦å‰ç¼€çš„è¦æ±‚, ä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•åšæ’åº; P177 åˆ—å‡ºäº†å¾ˆå¤šä¸å¯ä»¥ä½¿ç”¨ç´¢å¼•åšæ’åºçš„æŸ¥è¯¢; å½“æŸ¥è¯¢åŒæ—¶æœ‰ ORDER BY å’Œ LIMIT å­å¥çš„æ—¶å€™ åƒselect &lt;col...&gt; from profiles where sex=&#39;m&#39; order by rating limit 10;è¿™ç§æŸ¥è¯¢è¯­å¥, åŒæ—¶ä½¿ç”¨äº†order byå’Œlimit, å¦‚æœæ²¡æœ‰ç´¢å¼•å°±ä¼šå¾ˆæ…¢; å³ä½¿æœ‰ç´¢å¼•, å¦‚æœç”¨æˆ·ç•Œé¢æœ‰ç¿»é¡µ, ç¿»é¡µæ¯”è¾ƒé åæ—¶, ä¹Ÿä¼šéå¸¸æ…¢, å› ä¸ºéšç€åç§»é‡çš„å¢åŠ , MySQLéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´æ¥æ‰«æéœ€è¦ä¸¢å¼ƒçš„æ•°æ®; ä½†æ˜¯sexçš„é€‰æ‹©æ€§åˆå¾ˆä½, å¦‚ä½•ä¼˜åŒ–å‘¢? å¯¹äºé€‰æ‹©æ€§éå¸¸ä½çš„åˆ—, å¦‚æœè¦åšæ’åºçš„è¯, å¯ä»¥å¢åŠ ä¸€äº›ç‰¹æ®Šçš„ç´¢å¼•æ¥åšæ’åº, ä¾‹å¦‚, å¯ä»¥åˆ›å»º (sex, rating)ç´¢å¼• ç„¶åé‡‡ç”¨ å»¶è¿Ÿå…³è” , é€šè¿‡è¦†ç›–ç´¢å¼•å…ˆæŸ¥è¯¢è¿”å›éœ€è¦çš„ä¸»é”®, åœ¨æ ¹æ®è¿™äº›ä¸»é”®å…³è”åŸè¡¨è·å¾—éœ€è¦çš„è¡Œ;select &lt;col...&gt; from profiles INNER JOIN (select &lt;primart key&gt; from profiles where x.sex=&#39;m&#39; order by rating limit 100000, 10) as x using(primary key)","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"46. è¦†ç›–ç´¢å¼•","slug":"mysql/2017-09-25-mysql-46","date":"2017-09-25T09:30:26.000Z","updated":"2018-03-08T02:29:53.000Z","comments":true,"path":"2017/09/25/mysql/2017-09-25-mysql-46/","link":"","permalink":"http://blog.renyimin.com/2017/09/25/mysql/2017-09-25-mysql-46/","excerpt":"","text":"ä»‹ç» é€šå¸¸, å¤§å®¶éƒ½ä¼šæ ¹æ®æŸ¥è¯¢çš„WHEREæ¡ä»¶æ¥åˆ›å»ºåˆé€‚çš„ç´¢å¼•, ä¸è¿‡è¿™åªæ˜¯ç´¢å¼•ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹é¢, è®¾è®¡ä¼˜ç§€çš„ç´¢å¼•åº”è¯¥è€ƒè™‘åˆ°æ•´ä¸ªæŸ¥è¯¢, è€Œä¸å•å•æ˜¯whereæ¡ä»¶éƒ¨åˆ†ã€‚ è¦†ç›–ç´¢å¼• ç´¢å¼•ç¡®å®æ˜¯ä¸€ç§æŸ¥æ‰¾æ•°æ®çš„é«˜æ•ˆæ–¹å¼, ä½†æ˜¯MySQLä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•å°±èƒ½ç›´æ¥è·å–åˆ—çš„æ•°æ®, è¿™æ ·å°±ä¸éœ€è¦å†å»è¯»å–æ•°æ®è¡Œ; å¦‚æœå¶å­èŠ‚ç‚¹ä¸­å·²ç»åŒ…å«äº†è¦æŸ¥è¯¢çš„æ•°æ®, é‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å†å›è¡¨æŸ¥è¯¢äº†; å³, å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«(æˆ–è€…è¯´è¦†ç›–)æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µå€¼, æˆ‘ä»¬å°±ç§°ä¹‹ä¸º è¦†ç›–ç´¢å¼•; è¦†ç›–ç´¢å¼•æ˜¯éå¸¸æœ‰ç”¨çš„å·¥å…·, èƒ½å¤Ÿæå¤§åœ°æé«˜æ€§èƒ½; æ‹¿InnoDBæ¥è¯´, è¦†ç›–ç´¢å¼•å°±éå¸¸æœ‰ç”¨, å¦‚æœä½ çš„æŸ¥è¯¢èƒ½å¤Ÿåšåˆ°è¦†ç›–ä½ çš„äºŒçº§ç´¢å¼•åˆ—, é‚£ä¹ˆåªéœ€è¦éå†ä¸€æ¬¡B-Tree(å¯ä»¥ç›´æ¥åœ¨äºŒçº§ç´¢å¼•ä¸­æ‰¾åˆ°æ•°æ®), å¯ä»¥é¿å…å¯¹èšç°‡ç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢; å…¶ä»–æ›´å¤šå‚è€ƒ P171 æ³¨æ„: è¦†ç›–ç´¢å¼•å¿…é¡»è¦ä¿å­˜ç´¢å¼•åˆ—çš„å€¼, è€Œ å“ˆå¸Œç´¢å¼•, ç©ºé—´ç´¢å¼• å’Œ å…¨æ–‡ç´¢å¼• ç­‰éƒ½ä¸å­˜å‚¨ç´¢å¼•åˆ—çš„å€¼; æ‰€ä»¥MySQLåªèƒ½ä½¿ç”¨B-Treeç´¢å¼•åšè¦†ç›–ç´¢å¼•; å¦‚æœç´¢å¼•ä¸èƒ½è¦†ç›–æŸ¥è¯¢æ‰€éœ€çš„å…¨éƒ¨åˆ—, é‚£å°±ä¸å¾—ä¸æ¯æ‰«æä¸€æ¬¡ç´¢å¼•è®°å½•, å°±å›è¡¨æŸ¥è¯¢ä¸€æ¬¡å¯¹åº”çš„è¡Œ, ä¼˜åŒ–å°æ¡ˆä¾‹ select * .... : å› ä¸ºæŸ¥è¯¢ä»è¡¨ä¸­é€‰æ‹©äº†æ‰€æœ‰çš„åˆ—, è€Œä¸€èˆ¬ä½ ä¸ä¼šåˆ›å»ºè¦†ç›–äº†æ‰€æœ‰åˆ—çš„äºŒçº§ç´¢å¼•, æ‰€ä»¥è¿™ç§å±€åŸŸè‚¯å®šä¸ä¼šç”¨åˆ°è¦†ç›–ç´¢å¼•; .... where title LIKE &#39;%ren&#39;: Mysqlåªèƒ½åœ¨whereæ¡ä»¶ä¸­åšç´¢å¼•çš„ æœ€å·¦å‰ç¼€åŒ¹é…çš„LIKEæ¯”è¾ƒ, è€Œè¿™é‡Œçš„whereæ¡ä»¶æ˜¯ä»¥é€šé…ç¬¦å¼€å¤´çš„LIKEæŸ¥è¯¢; æŸ¥çœ‹ (P171) çš„ä¼˜åŒ–æ¡ˆä¾‹ (åšè¡¨çš„è‡ªå…³è”, å­å¥ä½¿ç”¨è¦†ç›–ç´¢å¼•, å¤–éƒ¨ä¸ç”¨) è¿™æ ·è™½ç„¶æ— æ³•ä½¿ç”¨ç´¢å¼•è¦†ç›–æ•´ä¸ªæŸ¥è¯¢, ä½†æ€»ç®—æ¯”å®Œå…¨æ— æ³•åˆ©ç”¨è¦†ç›–ç´¢å¼•è¦å¥½","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"45. èšç°‡ç´¢å¼•","slug":"mysql/2017-09-24-mysql-45","date":"2017-09-24T12:10:31.000Z","updated":"2018-03-07T13:32:55.000Z","comments":true,"path":"2017/09/24/mysql/2017-09-24-mysql-45/","link":"","permalink":"http://blog.renyimin.com/2017/09/24/mysql/2017-09-24-mysql-45/","excerpt":"","text":"ç®€ä»‹ èšç°‡ç´¢å¼•å¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹, è€Œæ˜¯ä¸€ç§ æ•°æ®å­˜å‚¨æ–¹å¼; å› ä¸ºæ˜¯å­˜å‚¨å¼•æ“è´Ÿè´£å®ç°ç´¢å¼•, æ‰€ä»¥ä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒèšç°‡ç´¢å¼•, è¿™é‡Œä¸»è¦è®¨è®ºçš„æ˜¯ InnoDBå¼•æ“çš„èšç°‡ç´¢å¼•; InnoDBçš„ èšç°‡ç´¢å¼• å®é™…ä¸Šåœ¨åŒä¸€ä¸ªç»“æ„ä¸­ä¿å­˜äº† B-Treeç´¢å¼• å’Œ æ•°æ®è¡Œ å½“è¡¨æœ‰èšç°‡ç´¢å¼•æ—¶, å®ƒçš„æ•°æ®è¡Œå®é™…ä¸Šå­˜æ”¾åœ¨ç´¢å¼•çš„å¶å­é¡µä¸­(å¶å­é¡µåŒ…å«äº†æ•°æ®è¡Œçš„ å…¨éƒ¨åˆ—æ•°æ®) å› ä¸ºæ— æ³•åŒæ—¶æŠŠæ•°æ®è¡Œå­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹, æ‰€ä»¥ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼• ä¸è¿‡è¦†ç›–ç´¢å¼•, å¯ä»¥æ¨¡æ‹Ÿå¤šä¸ªèšç°‡ç´¢å¼•çš„æƒ…å†µ InnoDBé»˜è®¤ä¼šåˆ›å»ºèšç°‡ç´¢å¼•: InnoDBé€šè¿‡ä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•, å¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®, åˆ™ä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€çš„éç©ºç´¢å¼•ä»£æ›¿, å¦‚æœè¿éç©ºç´¢å¼•éƒ½æ²¡æœ‰, InnoDBä¼šéšå¼å®šä¹‰ä¸€ä¸ªä¸»é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•; å°†ä¸»é”®ç»„ç»‡åˆ°ä¸€æ£µB+æ ‘ä¸­, è€Œè¡Œæ•°æ®å°±å‚¨å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œè‹¥ä½¿ç”¨where id = 14è¿™æ ·çš„æ¡ä»¶æŸ¥æ‰¾æ•°æ®; åˆ™æŒ‰ç…§B+æ ‘çš„æ£€ç´¢ç®—æ³•å³å¯æŸ¥æ‰¾åˆ°å¯¹åº”çš„å¶èŠ‚ç‚¹ï¼Œä¹‹åè·å¾—è¡Œæ•°æ®; InnoDBåªèšé›† åœ¨åŒä¸€ä¸ªç£ç›˜é¡µé¢ä¸­çš„è®°å½•, å› æ­¤, å¦‚æœæ•°æ®åœ¨ç‰©ç†ä¸Šæ˜¯ç›¸é‚»çš„, é‚£ä¹ˆåœ¨ç´¢å¼•ä¸Šå°±ä¹Ÿæ˜¯ç›¸é‚»çš„; èšç°‡ç´¢å¼•çš„æ•°æ®çš„ç‰©ç†å­˜æ”¾é¡ºåºä¸ç´¢å¼•é¡ºåºæ˜¯ä¸€è‡´çš„ï¼Œå³ï¼šåªè¦ç´¢å¼•æ˜¯ç›¸é‚»çš„ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°æ®ä¸€å®šä¹Ÿæ˜¯ç›¸é‚»åœ°å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„; ä½†æ˜¯åŒ…å«ç›¸é‚»é”®å€¼çš„é¡µé¢å¯èƒ½ç‰©ç†ä¸Šä¼šç›¸è·ç”šè¿œ; èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹ è®¿é—®é€Ÿåº¦æ›´å¿«: èšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªB-Treeä¸­, å› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®é€šå¸¸æ¯”åœ¨éèšç°‡ç´¢å¼•ä¸­æŸ¥è¯¢è¦å¿«; ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æŸ¥è¯¢, å¯ä»¥ç›´æ¥ä½¿ç”¨é¡µèŠ‚ç‚¹ä¸­çš„ä¸»é”®å€¼; èšç°‡ç´¢å¼•ç¼ºç‚¹ èšç°‡ç´¢å¼•æœ€å¤§é™åº¦åœ°æé«˜äº†I/Oå¯†é›†å‹åº”ç”¨çš„æ€§èƒ½, ä½†å¦‚æœæ•°æ®å…¨éƒ¨éƒ½æ”¾åœ¨å†…å­˜ä¸­, åˆ™è®¿é—®é¡ºåºå°±æ²¡é‚£ä¹ˆé‡è¦äº†, èšç°‡ç´¢å¼•ä¹Ÿå°±æ²¡ä»€ä¹ˆä¼˜åŠ¿äº†; æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåº, æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’å…¥æ˜¯é€Ÿåº¦æœ€å¿«çš„æ–¹å¼, ä½†å¦‚æœä¸æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåº, åœ¨å®Œæˆæ“ä½œåæœ€å¥½æ‰§è¡Œ OPTIMIZE TABLE å‘½ä»¤é‡æ–°ç»„ç»‡ä¸€ä¸‹è¡¨; æ›´æ–°èšç°‡ç´¢å¼•çš„ä»£ä»·å¾ˆé«˜, å› ä¸ºä¼šå¼ºåˆ¶InnoDBå°†æ¯ä¸ªè¢«æ›´æ–°çš„è¡Œç§»åŠ¨åˆ°æ–°çš„ä½ç½®; åŸºäºèšç°‡ç´¢å¼•çš„è¡¨åœ¨æ’å…¥æ–°è¡Œ, æˆ–è€…ä¸»é”®è¢«æ›´æ–°å¯¼è‡´éœ€è¦ç§»åŠ¨è¡Œçš„æ—¶å€™, å¯èƒ½é¢ä¸´ â€œé¡µåˆ†è£‚â€ é—®é¢˜; å½“å‰ä¸»é”®å€¼è¦æ±‚å¿…é¡»å°†è¿™ä¸€è¡Œæ’å…¥åˆ°æŸä¸ªå·²æ»¡çš„é¡µä¸­æ—¶, å­˜å‚¨å¼•æ“ä¼šå°†è¯¥é¡µåˆ†è£‚æˆä¸¤ä¸ªé¡µé¢æ¥å®¹çº³è¯¥è¡Œ, è¿™å°±æ˜¯ä¸€æ¬¡é¡µåˆ†è£‚æ“ä½œã€‚ é¡µåˆ†è£‚æ“ä½œä¼šå¯¼è‡´è¡¨å ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ èšç°‡ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æå˜æ…¢, å°¤å…¶æ˜¯è¡Œæ¯”è¾ƒç¨€ç–, æˆ–è€…ç”±äºé¡µåˆ†è£‚å¯¼è‡´æ•°æ®å­˜å‚¨ä¸è¿ç»­çš„æ—¶å€™; äºŒçº§ç´¢å¼•(éèšç°‡ç´¢å¼•)å¯èƒ½æ¯”æƒ³è±¡çš„è¦æ›´å¤§, å› ä¸ºåœ¨äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹åŒ…å«äº†å¼•ç”¨è¡Œçš„ä¸»é”®åˆ—; äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾, è€Œä¸æ˜¯ä¸€æ¬¡ äºŒçº§ç´¢å¼•å¶å­å‡ ç‚¹ä¿å­˜çš„ â€œè¡ŒæŒ‡é’ˆâ€ æ˜¯è¡Œçš„ä¸»é”®; è¿™æ„å‘³ç€é€šè¿‡äºŒçº§ç´¢å¼•æŸ¥æ‰¾è¡Œ, å­˜å‚¨å¼•æ“éœ€è¦æ‰¾åˆ°äºŒçº§ç´¢å¼•å¶å­èŠ‚ç‚¹è·å¾—å¯¹åº”çš„ä¸»é”®å€¼; ç„¶åæ ¹æ®è¿™ä¸ªä¸»é”®å€¼å»èšç°‡ç´¢å¼•ä¸­æŸ¥æ‰¾å¯¹åº”çš„è¡Œæ•°æ®; è¿™é‡Œåšäº†é‡å¤å·¥ä½œ, ä¸¤æ¬¡ B-Tree æŸ¥æ‰¾, è€Œä¸æ˜¯ä¸€æ¬¡ã€‚ InnoDB å’Œ MyISAM ç´¢å¼•å¯¹æ¯” InnoDBæ”¯æŒèšç°‡ç´¢å¼•, è€ŒMyISAMä¸æ”¯æŒ; MyISAMä¸­ä¸»é”®ç´¢å¼•å’Œå…¶ä»–ç´¢å¼•åœ¨ç´¢å¼•ç»“æ„ä¸Šæ²¡æœ‰åŒºåˆ«; è€ŒInnoDBä¸­ (ä¸»é”®)èšç°‡ç´¢å¼• å’Œ äºŒçº§ç´¢å¼•(æ™®é€šç´¢å¼•) æ˜¯æœ‰åŒºåˆ«çš„;(P167) ä¸Šå›¾æ€»ç»“","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"44. é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥ -- å¤šåˆ—ç´¢å¼•","slug":"mysql/2017-09-24-mysql-44","date":"2017-09-24T09:25:31.000Z","updated":"2018-03-07T12:23:09.000Z","comments":true,"path":"2017/09/24/mysql/2017-09-24-mysql-44/","link":"","permalink":"http://blog.renyimin.com/2017/09/24/mysql/2017-09-24-mysql-44/","excerpt":"","text":"å‰è¨€ åœ¨å¤šä¸ªåˆ—ä¸Šå»ºç«‹ç‹¬ç«‹çš„å•åˆ—ç´¢å¼•, åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸èƒ½æé«˜MySQLçš„æŸ¥è¯¢æ€§èƒ½; ä¾‹å¦‚: film_actor è¡¨åœ¨ film_id å’Œ actor_id ä¸Šå„æœ‰ä¸€ä¸ªå•åˆ—ç´¢å¼•, ä½†æ˜¯å¯¹äºä¸‹é¢è¿™ä¸ªæŸ¥è¯¢WHEREæ¡ä»¶, è¿™ä¸¤ä¸ªå•åˆ—ç´¢å¼•éƒ½ä¸æ˜¯å¥½çš„é€‰æ‹© select film_id, actor_id from actor where actor_id=1 OR film_id=1; å¯¹äºä¸Šé¢çš„æŸ¥è¯¢ è€ç‰ˆæœ¬çš„MySQLä¼šä½¿ç”¨å…¨è¡¨æ‰«æ; è€Œæ–°ç‰ˆæœ¬ä¼šä½¿ç”¨ ç´¢å¼•åˆå¹¶ç­–ç•¥(å‚è€ƒP158) æ¥è¿›è¡Œä¼˜åŒ–, ä½†è¿™æ›´è¯´æ˜äº†è¡¨ä¸Šçš„ç´¢å¼•å»ºçš„å¾ˆç³Ÿç³• æ¥ä¸‹æ¥é™¤äº† ä¹‹å‰å·²ç»åœ¨åšæ–‡: B-Treeç´¢å¼•ä¸­ä»‹ç»è¿‡çš„å¤šåˆ—ç´¢å¼•çš„ å·¦å‰ç¼€ç­–ç•¥; ä½ è¿˜éœ€è¦å…³æ³¨çš„æ˜¯åˆ›å»ºç´¢å¼•æ—¶, ç´¢å¼•åˆ—çš„é¡ºåº é€‰æ‹©åˆé€‚çš„ç´¢å¼•åˆ—é¡ºåº åœ¨ä¸€ä¸ªå¤šåˆ—ç´¢å¼•ä¸­, ç´¢å¼•åˆ—çš„é¡ºåºé¦–å…ˆå†³å®šäº†æœ€å·¦å‰ç¼€ç­–ç•¥åœ¨æŸ¥è¯¢æ—¶æ˜¯å¦‚ä½•è¿›è¡Œçš„; å…¶æ¬¡è¿˜æ„å‘³ç€ç´¢å¼•é¦–å…ˆæŒ‰ç…§æœ€å·¦åˆ—è¿›è¡Œæ’åº, å…¶æ¬¡æ˜¯ç¬¬äºŒåˆ—, ç­‰ç­‰; æ‰€ä»¥å¤šåˆ—ç´¢å¼•çš„åˆ—é¡ºåºè‡³å…³é‡è¦; åœ¨ä¸éœ€è¦è€ƒè™‘æ’åºå’Œåˆ†ç»„çš„æ—¶å€™, å°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åœ¨å‰é¢é€šå¸¸æ˜¯å¾ˆå¥½çš„, è¿™æ—¶å€™ç´¢å¼•çš„ä½œç”¨åªæ˜¯ç”¨äºä¼˜åŒ–whereæ¡ä»¶çš„æŸ¥æ‰¾ã€‚ ç„¶è€Œ, æ€§èƒ½ä¸çŸ¥æ˜¯ä¾èµ–äºæ‰€æœ‰ç´¢å¼•åˆ—çš„é€‰æ‹©æ€§(æ•´ä½“åŸºæ•°), ä¹Ÿå’ŒæŸ¥è¯¢æ¡ä»¶çš„å…·ä½“å€¼æœ‰å…³, ä¹Ÿå°±æ˜¯å’Œå€¼çš„åˆ†å¸ƒæœ‰å…³; ~~æœªå®Œå¾…ç»­","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"43. é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥ - ç‹¬ç«‹çš„åˆ—, å‰ç¼€ç´¢å¼•","slug":"mysql/2017-09-24-mysql-43","date":"2017-09-24T09:20:31.000Z","updated":"2018-03-08T05:22:03.000Z","comments":true,"path":"2017/09/24/mysql/2017-09-24-mysql-43/","link":"","permalink":"http://blog.renyimin.com/2017/09/24/mysql/2017-09-24-mysql-43/","excerpt":"","text":"å‰è¨€å‰é¢å·²ç»å¯¹å¸¸è§çš„ç´¢å¼•ç±»å‹åŠå…¶å¯¹åº”çš„ä¼˜ç¼ºç‚¹æœ‰äº†ä¸€å®šçš„äº†è§£, æ¥ä¸‹æ¥è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½• é«˜æ•ˆæ­£ç¡®åœ°é€‰æ‹©å¹¶ä½¿ç”¨ç´¢å¼• ç‹¬ç«‹çš„åˆ—ç‹¬ç«‹çš„åˆ—æ˜¯æŒ‡: åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­, ç´¢å¼•åˆ— ä¸èƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†, ä¹Ÿä¸èƒ½æ˜¯å‡½æ•°çš„å‚æ•°; (å¦‚: select actor_id from actor where actor_id+1=5; å°±æ— æ³•ä½¿ç”¨ç´¢å¼•, åº”è¯¥å§‹ç»ˆå°†ç´¢å¼•åˆ—å•ç‹¬æ”¾åœ¨æ¯”è¾ƒç¬¦å·çš„ä¸€ä¾§, select actor_id from actor where actor_id=4;); å‰ç¼€ç´¢å¼• å› ä¸ºB-Treeç´¢å¼•ä¸­å­˜å‚¨äº†å®é™…çš„åˆ—å€¼, æ‰€ä»¥å¦‚æœä½ éœ€è¦ç´¢å¼•çš„åˆ—çš„å†…å®¹å¾ˆé•¿, å°±ä¼šå¯¼è‡´ ç´¢å¼•å˜å¾—å¤§ä¸”æ…¢; å¯¹äºBLOB, TEXT æˆ–è€…å¾ˆé•¿çš„ VARCHAR ç±»å‹çš„åˆ—, å¿…é¡»ä½¿ç”¨å‰ç¼€ç´¢å¼•, å› ä¸ºMySQLä¸å…è®¸ç´¢å¼•è¿™äº›åˆ—çš„å®Œæ•´é•¿åº¦; æ­£å¸¸æƒ…å†µä¸‹, ä¸è®ºæ˜¯åˆ›å»º å•åˆ—ç´¢å¼• è¿˜æ˜¯ å¤šåˆ—ç´¢å¼•, åˆ›å»ºçš„ç´¢å¼•éƒ½æ˜¯ä»¥ æŸä¸ªåˆ—å®Œæ•´çš„å€¼ æ¥åˆ›å»ºç´¢å¼•, è€Œ å‰ç¼€ç´¢å¼•åˆ™æ˜¯ä»¥ åˆ—å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ æ¥åˆ›å»ºç´¢å¼•, ä»è€Œå¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´, æé«˜ç´¢å¼•æ•ˆç‡, ä½†æ˜¯è¿™æ ·ä¼šé™ä½ç´¢å¼•çš„é€‰æ‹©æ€§; ç´¢å¼•é€‰æ‹©æ€§ ç´¢å¼•é€‰æ‹©æ€§: æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼(åŸºæ•°) å’Œ æ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼(å½“ç„¶, å”¯ä¸€ç´¢å¼•çš„æ‰€æœ‰ç´¢å¼•å€¼éƒ½ä¸åŒ, é€‰æ‹©æ€§æ˜¯1, è¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§, æ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„); å‡è®¾ä¸€å¼ è®¢å•è¡¨, æŒ‰ç…§ city(åŸå¸‚å…¨å) æ¥åˆ† å’Œ æŒ‰ç…§ city(ç¬¬ä¸€ä¸ªå­—)æ¥åˆ†ç»„ , é‚£è‚¯å®šå‰ä¸€ç§æƒ…å†µåˆ†å‡ºæ¥çš„ç»„æ¯”è¾ƒå¤š, ä¹Ÿå°±æ˜¯ä¸é‡å¤çš„ç´¢å¼•å€¼å¤š; å¦‚æœæŒ‰ç…§ city å­—æ®µçš„å‰3ä¸ªå­—ç¬¦æ¥åˆ†ç»„çš„è¯, æ•ˆæœå¦‚ä¸‹ å¦‚æœæŒ‰ç…§ city å­—æ®µçš„å‰7ä¸ªå­—ç¬¦æ¥åˆ†ç»„çš„è¯, å¯ä»¥æƒ³åˆ°, è‡ªç„¶å¯èƒ½ä¼šæ˜¯ åˆ†ç»„ä¼šæ›´å¤š, æ¯ç»„çš„æ•°æ®ä¼šæ›´å°‘ åˆ†çš„ç»„è¶Šå¤š, ä¹Ÿå°±æ˜¯å¦‚æœä»¥æ­¤é•¿åº¦çš„å‰ç¼€åˆ›å»ºç´¢å¼•çš„è¯, ä¸é‡å¤çš„ç´¢å¼•å€¼ä¹Ÿå°±è¶Šå¤š, é‚£ä¹ˆé€‰æ‹©æ€§å°±è¶Šé«˜; é€‰æ‹©æ€§è¶Šé«˜, åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜, å› ä¸ºMySQLåœ¨æŸ¥æ‰¾æ—¶èƒ½å¤Ÿé€šè¿‡ç´¢å¼•å°±è¿‡æ»¤æ‰æ›´å¤šçš„è¡Œ, å¦åˆ™ä¸€ä¸ªç´¢å¼•è¿˜æ˜¯å¯¹åº”äº†å¾ˆå¤šçš„æ•°æ®è¡Œ, é‚£æ•ˆç‡è¿˜æ˜¯å¾ˆä½; è€Œæˆ‘ä»¬è¦åšçš„å…¶å®å°±æ˜¯è®©æˆ‘ä»¬çš„ å‰ç¼€é€‰æ‹©æ€§ æ¥è¿‘ å®Œæ•´åˆ—çš„é€‰æ‹©æ€§ ç®€å•ç‚¹è¯´, è®© city(n) æ¥è¿‘ city çš„é€‰æ‹©æ€§; è®¡ç®—å®Œæ•´åˆ—çš„é€‰æ‹©æ€§ ä¸‹é¢ç»™å‡ºäº†åŒä¸€ä¸ªæŸ¥è¯¢ä¸­è®¡ç®—ä¸åŒå‰ç¼€é•¿åº¦çš„é€‰æ‹©æ€§ å‰ç¼€ç´¢å¼•æ˜¯ä¸€ç§èƒ½ä½¿ç´¢å¼•æ›´å°, æ›´å¿«çš„æœ‰æ•ˆåŠæ³•, ä½†ä¹Ÿæœ‰å…¶ç¼ºç‚¹: MySQLæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åš ORDER BY å’Œ GROUP BY æœ‰æ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšè¦†ç›–æ‰«æ åˆ›å»ºå‰ç¼€ç´¢å¼•: alter table city add key(city(7)), è¡¨ç¤ºä»¥ city å­—æ®µçš„å‰7ä¸ªå­—ç¬¦ æ¥åˆ›å»ºç´¢å¼•; å‚è€ƒp189: æ ¹æ®ä¼ ç»Ÿç»éªŒ, ä¸åº”è¯¥åœ¨é€‰æ‹©æ€§ä½çš„è£‚ä¼¤åˆ›å»ºç´¢å¼•, ä½†æ˜¯å¦‚æœå¾ˆè¿‡æŸ¥è¯¢éƒ½ç”¨åˆ°è¯¥åˆ—, æ¯”å¦‚ä¸€ä¸ªè¡¨ä¸­çš„ gender åˆ—, è€ƒè™‘åˆ°ä½¿ç”¨çš„é¢‘ç‡, è¿˜æ˜¯å»ºè®®åœ¨åˆ›å»ºä¸åŒç»„åˆçš„ç´¢å¼•æ—¶, å°† (sex) ä½œä¸ºå‰ç¼€!","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"},{"name":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","slug":"é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥","permalink":"http://blog.renyimin.com/tags/é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥/"}]},{"title":"42. å“ˆå¸Œç´¢å¼•","slug":"mysql/2017-09-24-mysql-42","date":"2017-09-24T07:01:31.000Z","updated":"2018-03-07T10:04:36.000Z","comments":true,"path":"2017/09/24/mysql/2017-09-24-mysql-42/","link":"","permalink":"http://blog.renyimin.com/2017/09/24/mysql/2017-09-24-mysql-42/","excerpt":"","text":"ç®€ä»‹ å“ˆå¸Œç´¢å¼•(hash index)åŸºäºå“ˆå¸Œè¡¨å®ç°, åªæœ‰ç²¾ç¡®åŒ¹é…ç´¢å¼•ä¸­æ‰€æœ‰åˆ—çš„æŸ¥è¯¢æ‰æœ‰æ•ˆ; å¯¹äºæ¯ä¸€è¡Œæ•°æ®, å­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰çš„ç´¢å¼•åˆ—è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç (hash code): å“ˆå¸Œç´¢å¼•å°†æ‰€æœ‰çš„å“ˆå¸Œç å­˜å‚¨åœ¨ç´¢å¼•ä¸­ åŒæ—¶åœ¨å“ˆå¸Œè¡¨ä¸­ä¿å­˜æŒ‡å‘æ¯ä¸ªæ•°æ®è¡Œçš„æŒ‡é’ˆ åœ¨MySQLä¸­, åªæœ‰Memoryå¼•æ“æ˜¾ç¤ºæ”¯æŒå“ˆå¸Œç´¢å¼•, è¿™ä¹Ÿæ˜¯Memoryå¼•æ“è¡¨çš„é»˜è®¤ç´¢å¼•ç±»å‹, Memoryå¼•æ“ä¹Ÿæ”¯æŒB-Treeç´¢å¼•ã€‚ Memoryå¼•æ“æ”¯æŒ éå”¯ä¸€å“ˆå¸Œç´¢å¼•, ä¹Ÿå°±æ˜¯åŒæ ·çš„ç´¢å¼•, ä¸åŒçš„æ•°æ®å¯èƒ½äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œç , å¦‚æœå‡ºç°è¿™ç§æƒ…å†µ, ç´¢å¼•ä¼šä»¥é“¾è¡¨çš„æ–¹å¼å­˜æ”¾å¤šä¸ªè¡ŒæŒ‡é’ˆåˆ°åŒä¸€ä¸ªå“ˆå¸Œæ¡ç›®ä¸­ æŸ¥æ‰¾æ—¶, ä¼š1. å…ˆåœ¨ç´¢å¼•ä¸­æŒ‰ç…§å“ˆå¸Œç æ¥æ‰¾åˆ°æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆ, 2. ç„¶åæ¯”è¾ƒæ•°æ®è¡Œçš„å€¼æ˜¯å¦æ˜¯ä½ æŸ¥æ‰¾çš„è¡Œ å“ˆå¸Œç´¢å¼•çš„é™åˆ¶å› ä¸ºç´¢å¼•è‡ªèº«åªè¦å­˜å‚¨å¯¹åº”çš„å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆ, æ‰€ä»¥ç´¢å¼•çš„ç»“æ„ååˆ†ç´§å‡‘, è¿™ä¹Ÿè®©å“ˆå¸Œç´¢å¼•çš„æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«, ç„¶è€Œå“ˆå¸Œç´¢å¼•ä¹Ÿæœ‰å®ƒçš„é™åˆ¶: å“ˆå¸Œç´¢å¼•åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆ, è€Œä¸å­˜å‚¨å­—æ®µå€¼, æ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­çš„å€¼æ¥é¿å…è¯»å–è¡Œ, ä¸è¿‡, è®¿é—®å†…å­˜ä¸­çš„è¡Œçš„é€Ÿåº¦å¾ˆå¿«; å“ˆå¸Œç´¢å¼•æ•°æ®å¹¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºæ’åºçš„, æ‰€ä»¥æ— æ³•ç”¨äºæ’åº; ä¸æ”¯æŒ éƒ¨åˆ†ç´¢å¼•åˆ—åŒ¹é…æŸ¥æ‰¾ , å› ä¸ºå“ˆå¸Œç´¢å¼•å§‹ç»ˆæ˜¯ä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹æ¥è®¡ç®—å“ˆå¸Œå€¼çš„; ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ (åªæ”¯æŒå¦‚ =, &lt;&gt;, in ç­‰ä¸€äº› ç­‰å€¼æ¯”è¾ƒ) å“ˆå¸Œç´¢å¼•æ•°æ®éå¸¸å¿«, é™¤éæœ‰å¾ˆå¤šå“ˆå¸Œå†²çª (å› ä¸ºmemoryå¼•æ“æ”¯æŒéå”¯ä¸€ç´¢å¼•, ä¹Ÿå°±æ˜¯åŒæ ·çš„ç´¢å¼•, ä¸åŒçš„æ•°æ®å¯èƒ½äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œç )å½“å‡ºç°å“ˆå¸Œå†²çªæ—¶, å­˜å‚¨å¼•æ“å¿…é¡»éå† å†²çªçš„å“ˆå¸Œå€¼ æ‰€å¯¹åº”çš„ é“¾è¡¨ ä¸­æ‰€æœ‰çš„è¡ŒæŒ‡é’ˆ, é€è¡Œåˆ°è¡¨ä¸­è¿›è¡Œæ¯”è¾ƒ, ç›´åˆ°æ‰¾åˆ°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¡Œ; å“ˆå¸Œå†²çªå¦‚æœå“ˆå¸Œå†²çªå¾ˆå¤šçš„è¯, ä¸€äº›ç´¢å¼•ç»´æŠ¤æ“ä½œçš„ä»£ä»·ä¹Ÿä¸ºå¾ˆé«˜, å¦‚æœè¡¨ä¸­åˆ é™¤ä¸€è¡Œæ•°æ®, å­˜å‚¨å¼•æ“éœ€è¦éå†å¯¹åº”å“ˆå¸Œå€¼çš„é“¾è¡¨ä¸­çš„æ¯ä¸€è¡Œ, æ‰¾åˆ°å¹¶åˆ é™¤å¯¹åº”è¡Œçš„æŒ‡é’ˆ, å†²çªè¶Šå¤šä»£ä»·è¶Šå¤§;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"}]},{"title":"41. B-Treeç´¢å¼•","slug":"mysql/2017-09-24-mysql-41","date":"2017-09-24T06:50:19.000Z","updated":"2018-03-07T11:41:40.000Z","comments":true,"path":"2017/09/24/mysql/2017-09-24-mysql-41/","link":"","permalink":"http://blog.renyimin.com/2017/09/24/mysql/2017-09-24-mysql-41/","excerpt":"","text":"ç®€ä»‹ å½“äººä»¬è°ˆè®ºç´¢å¼•æ—¶, å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ç´¢å¼•ç±»å‹, å¤šåŠè¯´çš„å°±æ˜¯ B-Tree ç´¢å¼•, å®ƒä½¿ç”¨ B-Tree æ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ®; MySQLçš„å¤§å¤šæ•°å­˜å‚¨å¼•æ“éƒ½æ”¯æŒè¿™ç§ç´¢å¼• (Archiveå¼•æ“ä¸æ”¯æŒ) å­˜å‚¨å¼•æ“ä»¥ä¸åŒçš„æ–¹å¼ä½¿ç”¨ B-Tree ç´¢å¼•, æ€§èƒ½ä¹Ÿå„æœ‰ä¼˜åŠ£: MyISAMä½¿ç”¨ å‰ç¼€å‹ç¼©æŠ€æœ¯ ä½¿å¾—ç´¢å¼•æ›´å° InnoDBåˆ™æŒ‰ç…§åŸæ•°æ®æ ¼å¼è¿›è¡Œå­˜å‚¨ MyISAMçš„ç´¢å¼•æ˜¯é€šè¿‡ æ•°æ®çš„ç‰©ç†ä½ç½® å¼•ç”¨è¢«ç´¢å¼•çš„è¡Œå¶å­é¡µä¸­çš„å€¼æŒ‡å‘è¢«ç´¢å¼•çš„è¡Œçš„ç‰©ç†åœ°å€ InnoDBçš„ç´¢å¼•åˆ™æ˜¯é€šè¿‡ ä¸»é”® å¼•ç”¨è¢«ç´¢å¼•çš„è¡Œå¶å­é¡µä¸­çš„å€¼æŒ‡å‘è¢«ç´¢å¼•çš„è¡Œçš„ä¸»é”® å»ºç«‹åœ¨B-Treeç»“æ„(ä»æŠ€æœ¯ä¸Šæ¥è¯´æ˜¯B+Tree)ä¸Šçš„ç´¢å¼• æ³¨æ„: B-Treeç´¢å¼•ä¸­å­˜å‚¨äº† è¢«ç´¢å¼•çš„åˆ—å®é™…çš„åˆ—å€¼, æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆ (ä¸Šé¢çš„å›¾å¯èƒ½æ²¡ä½“ç°å‡ºæ¥, ç»“åˆä¸‹é¢å¤šåˆ—ç´¢å¼•çš„å›¾æ‰¾æ‰¾æ„Ÿè§‰~~) B-Tree é€šå¸¸æ„å‘³ç€: æ‰€æœ‰çš„å€¼éƒ½æ˜¯ æŒ‰é¡ºåº å­˜å‚¨çš„;B-Treeå¯¹ç´¢å¼•åˆ—æ˜¯é¡ºåºç»„ç»‡å­˜å‚¨çš„, æ‰€ä»¥å¾ˆé€‚åˆæŸ¥æ‰¾èŒƒå›´æ•°æ®; æ¯ä¸€ä¸ªå¶å­é¡µåˆ°æ ¹çš„è·ç¦»éƒ½æ˜¯ç›¸åŒçš„ï¼› å¶å­é¡µæ¯”è¾ƒç‰¹åˆ«, ä»–ä»¬çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯è¢«ç´¢å¼•çš„æ•°æ®, è€Œä¸æ˜¯å…¶ä»–çš„èŠ‚ç‚¹é¡µ(ä¸åŒå¼•æ“çš„â€æŒ‡é’ˆâ€ç±»å‹ä¸åŒ) ä¸‹å›¾æ˜¾ç¤ºäº†å¤šåˆ—ç´¢å¼•æ˜¯å¦‚ä½•ç»„ç»‡æ•°æ®å­˜å‚¨çš„ å¯¹äºä¸‹è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®, ç´¢å¼•ä¸­åŒ…å«äº† last_name, first_name, dob(date of birth, å³å‡ºç”Ÿæ—¥æœŸ) åˆ—çš„å€¼ 1234567CREATE TABLE People last_name varchar(50) not null, first_name varchar(50) not null, dob date not null, gender enum(&apos;m&apos;, &apos;f&apos;) not null, key(last_name, first_name, dob)); æ³¨æ„: ç´¢å¼•å¯¹å¤šä¸ªåˆ—çš„å€¼è¿›è¡Œæ’åºçš„ä¾æ®æ˜¯å®šä¹‰ç´¢å¼•æ—¶åˆ—çš„é¡ºåº (å¦‚ä¸Šå›¾ä¸­, æœ€åä¸¤ä¸ªæ¡ç›®, ä¸¤ä¸ªäººçš„å§“å’Œåéƒ½ä¸€æ ·, åˆ™æ ¹æ®ä»–ä»¬çš„å‡ºç”Ÿæ—¥æœŸæ¥è¿›è¡Œæ’åˆ—é¡ºåº) æœ€å·¦å‰ç¼€æ•ˆåº”ä¹‹å‰æåˆ°è¿‡ â€œç´¢å¼•å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—çš„å€¼ã€‚å¦‚æœåŒ…å«å¤šä¸ªåˆ—, é‚£ä¹ˆåˆ—çš„é¡ºåºä¹Ÿååˆ†é‡è¦, å› ä¸ºMySQLåªèƒ½é«˜æ•ˆåœ°ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€åˆ—â€œ æ‹¿ä¹‹å‰çš„ People è¡¨æ¥åšå‚è€ƒ(å…¶åˆ›å»ºçš„ç´¢å¼•æ˜¯ key(last_name, first_name, dob)) å…¨å€¼åŒ¹é… : æŒ‡çš„æ˜¯å¦‚æœæŸ¥è¯¢æ¡ä»¶å’ŒæŸä¸ªç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—å€¼è¿›è¡ŒåŒ¹é…, è¿™æ ·å°±å¯ä»¥åˆ©ç”¨åˆ°ä¸Šé¢åˆ›å»ºçš„ç´¢å¼•; æ¯”å¦‚, æŸ¥æ‰¾ â€˜å§“ä¸ºAllen,åä¸ºCuba,å‡ºç”Ÿæ—¥æœŸä¸º1960-01-01â€™ çš„äººæ—¶ å¹¶ä¸”æŒ‡çš„æ³¨æ„çš„æ˜¯, å¦‚æœä½ çš„æŸ¥è¯¢æ¡ä»¶åšåˆ°äº†å…¨å€¼åŒ¹é…, é‚£ä¹ˆå³ä½¿ä½ æŸ¥è¯¢æ¡ä»¶çš„é¡ºåºä¸æ˜¯ä¾ç…§å·¦å‰ç¼€åŸåˆ™, MySQLä¹Ÿä¼šåšä¼˜åŒ–; åŒ¹é…æœ€å·¦å‰ç¼€: æ¯”å¦‚, æŸ¥æ‰¾ â€˜å§“ä¸ºAllenâ€™ çš„äºº, å³ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ—, è¿™æ ·å°±å¯ä»¥åˆ©ç”¨åˆ°ä¸Šé¢åˆ›å»ºçš„ç´¢å¼•; åŒ¹é…æœ€å·¦å‰ç¼€åˆ—çš„å‰ç¼€: å¯ä»¥ç”¨æ¥åŒ¹é…ç´¢å¼•ä¸­ç¬¬ä¸€åˆ—çš„å€¼çš„å¼€å¤´éƒ¨åˆ†, æ¯”å¦‚, æŸ¥æ‰¾ å§“ä»¥â€™Jâ€™å¼€å¤´ çš„äºº, è¿™æ ·å°±å¯ä»¥åˆ©ç”¨åˆ°ä¸Šé¢åˆ›å»ºçš„ç´¢å¼•; åŒ¹é…æœ€å·¦å‰ç¼€èŒƒå›´å€¼: æŸ¥æ‰¾ â€˜å§“åœ¨Allenå’ŒBarrymoreâ€™ ä¹‹é—´çš„äºº, è¿™æ ·å°±å¯ä»¥åˆ©ç”¨åˆ°ä¸Šé¢åˆ›å»ºçš„ç´¢å¼• ç²¾ç¡®åŒ¹é…ç¬¬ä¸€åˆ— å¹¶ èŒƒå›´åŒ¹é…ç¬¬äºŒåˆ—: æŸ¥æ‰¾ â€˜å§“ä¸ºAllenå¹¶ä¸”åå­—ä»¥Kå¼€å¤´â€™ çš„äºº, è¿™æ ·å°±å¯ä»¥åˆ©ç”¨åˆ°ä¸Šé¢åˆ›å»ºçš„ç´¢å¼• åªç”¨è®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ : è¿™ç§æŸ¥è¯¢åªéœ€è¦è®¿é—®ç´¢å¼•, è€Œæ— éœ€è®¿é—®æ•°æ®è¡Œ; åé¢ä¼šå•ç‹¬è®¨è®ºè¿™ç§ è¦†ç›–ç´¢å¼• çš„ä¼˜åŒ–ã€‚ B-Treeç´¢å¼•ä¸­å­˜å‚¨äº†å®é™…çš„åˆ—å€¼, æ‰€ä»¥æŸäº›æŸ¥è¯¢(è¯´çš„æ˜¯è¦†ç›–ç´¢å¼•)å¯èƒ½åªä½¿ç”¨ç´¢å¼•å°±èƒ½å¤Ÿå®ŒæˆæŸ¥è¯¢å·¥ä½œäº† B-treeç´¢å¼•çš„é™åˆ¶ å¦‚æœæŸ¥è¯¢æ—¶, æŸ¥è¯¢æ¡ä»¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹å†™, åˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•; ä¸Šé¢ä¾‹å­ä¸­, ç´¢å¼•å°±æ— æ³•ç”¨äº â€˜æŸ¥æ‰¾åå­—ä¸ºBillçš„äººâ€™, ä¹Ÿæ— æ³•æŸ¥æ‰¾ â€˜ç”Ÿæ—¥ä¸º1960-01-01çš„äººâ€™, å› ä¸ºè¿™ä¸¤åˆ—éƒ½ä¸æ˜¯æœ€å·¦æ•°æ®åˆ—ã€‚ ä¹Ÿæ— æ³•ç”¨äºæŸ¥æ‰¾ â€˜å§“ä»¥æŸä¸ªå­—æ¯ç»“å°¾çš„äººâ€™ (ä½ å»ºç´¢å¼•æ—¶æŒ‡å®šçš„åˆ—é¡ºåº, åˆ—çš„å€¼å†…å®¹ éƒ½è¦ç¬¦åˆæœ€å·¦å‰ç¼€æ‰èƒ½åˆ©ç”¨åˆ°ç´¢å¼•) æŸ¥è¯¢æ¡ä»¶ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ— æ¯”å¦‚, æŸ¥è¯¢ â€˜å§“ä¸ºSmith å¹¶ä¸” ç”Ÿæ—¥ä¸º1960-01-01â€™ å°±æ— æ³•ä½¿ç”¨åˆ°ç´¢å¼• å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æœ‰æŸä¸ªåˆ—æ˜¯èŒƒå›´æŸ¥è¯¢, åˆ™å…¶å³è¾¹çš„æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–æŸ¥æ‰¾ æ¯”å¦‚, where last_name=&#39;Smith&#39; and first_name LIKE &#39;J%&#39; AND dob=&#39;1976-12-23&#39; è¿™ä¸ªæŸ¥è¯¢åªèƒ½ä½¿ç”¨ç´¢å¼•çš„å‰ä¸¤åˆ— å¦‚æœèŒƒå›´æŸ¥è¯¢çš„åˆ—çš„å€¼ç»“æœæœ‰é™, æ¯”å¦‚æ•°æ®è¡¨ä¸­åªæœ‰2ä¸ªäººæ˜¯ â€˜åå­—ä»¥Jå¼€å¤´â€™ çš„, é‚£ä½ ä¹Ÿåˆ«ç”¨èŒƒå›´æŸ¥æ‰¾äº†, ç›´æ¥ç”¨å¤šä¸ªç­‰äºæ¡ä»¶æ¥ä»£æ›¿å°±è¡Œæ¯”å¦‚: where last_name=&#39;Smith&#39; and (first_name=&#39;Jack&#39; or first_name=&#39;Jieke&#39; ) AND dob=&#39;1976-12-23&#39; åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°: ç´¢å¼•åˆ—çš„é¡ºåºæ˜¯éå¸¸é‡è¦çš„! åœ¨ä¼˜åŒ–æ€§èƒ½çš„æ—¶å€™, å¯èƒ½éœ€è¦ä½¿ç”¨ç›¸åŒçš„åˆ—ä½†é¡ºåºä¸åŒçš„ç´¢å¼•æ¥æ»¡è¶³ä¸åŒç±»å‹çš„æŸ¥è¯¢éœ€æ±‚;","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"}]},{"title":"40. ç´¢å¼•åŸºç¡€","slug":"mysql/2017-09-24-mysql-40","date":"2017-09-24T06:30:25.000Z","updated":"2018-03-07T11:37:16.000Z","comments":true,"path":"2017/09/24/mysql/2017-09-24-mysql-40/","link":"","permalink":"http://blog.renyimin.com/2017/09/24/mysql/2017-09-24-mysql-40/","excerpt":"","text":"ç´¢å¼•åŸºç¡€ ç´¢å¼•æ˜¯å­˜å‚¨å¼•æ“ç”¨äºå¿«é€Ÿæ‰¾åˆ°è®°å½•çš„ä¸€ç§æ•°æ®ç»“æ„; ç´¢å¼•ä¼˜åŒ–æ˜¯å¯¹æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–æœ€æœ‰æ•ˆçš„æ‰‹æ®µäº†; ç´¢å¼•å¯ä»¥åŒ…å« ä¸€ä¸ª æˆ– å¤šä¸ªåˆ— çš„å€¼; å¦‚æœå¦‚æœç´¢å¼•åŒ…å«å¤šä¸ªåˆ—, ç´¢å¼•ä¸­åˆ—çš„é¡ºåºä¹Ÿéå¸¸é‡è¦, å› ä¸ºMySQLåªèƒ½é«˜æ•ˆåœ°ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€åˆ—; åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤ä¸ªåˆ—çš„ç´¢å¼• å’Œ åˆ›å»ºä¸¤ä¸ªåªåŒ…å«ä¸€ä¸ªåˆ—çš„ç´¢å¼• æ˜¯å¤§ä¸ç›¸åŒçš„; åœ¨MySQLä¸­, ç´¢å¼•æ˜¯åœ¨ å­˜å‚¨å¼•æ“å±‚å®ç°, è€Œä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°: ç´¢å¼•æœ‰å¾ˆå¤šç§ç±»å‹, å¯ä»¥ä¸ºä¸åŒåœºæ™¯æä¾›æ›´å¥½çš„æ€§èƒ½; ä½†å¹¶ä¸æ˜¯æ¯ä¸ªå­˜å‚¨å¼•æ“éƒ½æ”¯æŒæ‰€æœ‰çš„ç´¢å¼•ç±»å‹; ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•, å…¶å·¥ä½œæ–¹å¼å’Œåº•å±‚å®ç°ä¹Ÿå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„; MySQLæ”¯æŒçš„ç´¢å¼•ç±»å‹B-Treeç´¢å¼•å“ˆå¸Œç´¢å¼•æ•°æ®ç©ºé—´ç´¢å¼•å…¨æ–‡ç´¢å¼•å…¶ä»–ç´¢å¼•ç±»åˆ«ç´¢å¼•ä¼˜ç‚¹ç´¢å¼•å¯ä»¥è®©æœåŠ¡å™¨å¿«é€Ÿåœ°å®šä½åˆ°è¡¨çš„æŒ‡å®šä½ç½®; ä½†è¿™å¹¶ä¸æ˜¯ç´¢å¼•çš„å”¯ä¸€ä½œç”¨, åˆ°ç°åœ¨å¯ä»¥çœ‹åˆ°, æ ¹æ®åˆ›å»ºç´¢å¼•çš„æ•°æ®ç»“æ„ä¸åŒ, ç´¢å¼•ä¹Ÿæœ‰ä¸€äº›å…¶ä»–çš„é™„åŠ ç»„ä½œç”¨ æœ€å¸¸è§çš„B-Treeç´¢å¼•, æŒ‰ç…§é¡ºåºå­˜å‚¨æ•°æ®, æ‰€ä»¥MySQLå¯ä»¥ç”¨æ¥åš ORDER BY å’Œ GROUP BY æ“ä½œ; å› ä¸ºæ•°æ®æ˜¯æœ‰åºçš„, æ‰€ä»¥B-Treeä¹Ÿå°±ä¼šå°†ç›¸å…³çš„åˆ—å€¼éƒ½å­˜å‚¨åœ¨ä¸€èµ· å› ä¸ºB-Treeç´¢å¼•ä¸­å­˜å‚¨äº†å®é™…çš„åˆ—å€¼, æ‰€ä»¥æŸäº›æŸ¥è¯¢(è¯´çš„æ˜¯è¦†ç›–ç´¢å¼•)å¯èƒ½åªä½¿ç”¨ç´¢å¼•å°±èƒ½å¤Ÿå®ŒæˆæŸ¥è¯¢å·¥ä½œäº†","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"ç´¢å¼•","slug":"ç´¢å¼•","permalink":"http://blog.renyimin.com/tags/ç´¢å¼•/"}]},{"title":"08.","slug":"composer/2017-09-22-composer-08","date":"2017-09-22T13:20:17.000Z","updated":"2018-02-03T07:34:43.000Z","comments":true,"path":"2017/09/22/composer/2017-09-22-composer-08/","link":"","permalink":"http://blog.renyimin.com/2017/09/22/composer/2017-09-22-composer-08/","excerpt":"","text":"","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"07. autoloadä¹‹psr-4, psr-0, classmap, files","slug":"composer/2017-09-22-composer-07","date":"2017-09-22T05:10:30.000Z","updated":"2018-02-28T08:31:04.000Z","comments":true,"path":"2017/09/22/composer/2017-09-22-composer-07/","link":"","permalink":"http://blog.renyimin.com/2017/09/22/composer/2017-09-22-composer-07/","excerpt":"","text":"è‡ªåŠ¨åŠ è½½ vendor/ åº“ å¯¹äºcomposerå®‰è£…åˆ°vendor/ç›®å½•ä¸‹çš„åº“ å¦‚ä½•åœ¨é¡¹ç›®ä¸­è‡ªåŠ¨åŠ è½½åˆ°? composerå®‰è£…å®Œåº“ä¹‹å, ä¼šç”Ÿæˆä¸€ä¸ª vendor/autoload.php æ–‡ä»¶, ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­ç®€å•çš„å¼•å…¥è¿™ä¸ªæ–‡ä»¶, è¿™æ ·å°±å¯ä»¥è‡ªåŠ¨åŠ è½½composerç®¡ç†çš„vendor/ä¸‹çš„è¿™äº›åº“; require â€˜vendor/autoload.phpâ€™; å½“ç„¶, ä½ è‡ªå·±å‘å¸ƒçš„packagiståŒ…ä¸€å®šè¦æ³¨æ„å…¶ä¸­ä¹Ÿéœ€è¦è®¾ç½®è‡ªåŠ¨åŠ è½½è§„åˆ™(å‘½åç©ºé—´å’Œç›®å½•å¯¹åº”å…³ç³») composer è‡ªåŠ¨åŠ è½½ç±»å‹psr-4 å¦‚æœä½ çš„é¡¹ç›®ä¸­è¿˜æ²¡æœ‰å‡†å¤‡å¥½è‡ªåŠ¨åŠ è½½åŠŸèƒ½(æ¥å®ç°å¯¹ä½ é¡¹ç›®å„ä¸ªç›®å½•ä¸­ç±»çš„è‡ªåŠ¨åŠ è½½),ç°åœ¨ä½ å·²ç»ä¸éœ€è¦è‡ªå·±å»å‡†å¤‡äº†, å› ä¸ºä¸€æ—¦ä½ å¼•å…¥äº†composer, å®ƒå°±å·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†è¿™ä¸€åŠŸèƒ½!!(å½“ç„¶, å¼•å…¥composerå¾ˆç®€å•, æ— è®ºä½ æ˜¯è‡ªå·± composer initåˆå§‹åŒ–composer.jsonæ–‡ä»¶è¿˜æ˜¯é€šè¿‡composer requireå®‰è£…ä¸€ä¸ªåŒ…æ¥ç”Ÿæˆ composer.jsonæ–‡ä»¶éƒ½å¯ä»¥) å®ƒä¸ä»…èƒ½åƒä¸Šé¢è¯´çš„é‚£æ ·å¸®ä½ å®ç°è‡ªåŠ¨åŠ è½½composerå¸®ä½ ç®¡ç†çš„åŒ…, ä¹Ÿå¯ä»¥å¸®ä½ åœ¨é¡¹ç›®ä¸­åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨åŠ è½½!! ä½ å¯ä»¥åœ¨ composer.json çš„ autoload å­—æ®µä¸­å¢åŠ è‡ªå·±çš„ autoloader 12345&#123; &quot;autoload&quot;: &#123; &quot;psr-4&quot;: &#123;&quot;Acme\\\\&quot;: &quot;src/&quot;&#125; &#125;&#125; åƒä¸Šé¢é‚£æ ·, ä½ å°±å®šä¹‰ä¸€ä¸ªä» å‘½åç©ºé—´ åˆ° ç›®å½• çš„æ˜ å°„å…³ç³», æ­¤æ—¶ src åº”è¯¥å’Œvendorç›®å½•åŒçº§, éƒ½åœ¨ä½ é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹; æœ€å, ä½ åœ¨srcç›®å½•ä¸‹å†™çš„ç±»å°±åº”è¯¥æ˜¯Acmeå‘½åç©ºé—´; å¦‚æœæŒ‡å®šçš„ Acme æ˜¯ä¸ªé¡¶çº§å‘½åç©ºé—´, é‚£srcä¸‹ä¸ç®¡ç›®å½•å¤šæ·±, éƒ½å¯ä»¥ä»è¿™ä¸ªé¡¶çº§å¼€å§‹æ‰¾åˆ°, ä¸ç”¨å†ä¸€ä¸€é…ç½®å­å‘½åç©ºé—´ä¸ç›®å½•çš„å¯¹åº”å…³ç³»äº†; å¦‚æœ Acme ä¸æ˜¯ä¸ªé¡¶çº§å‘½åç©ºé—´, é‚£ä¹ˆå’ŒsrcåŒçº§çš„ç›®å½•ä¹Ÿå¾—é…ç½®å…¶å‘½åç©ºé—´å’Œå¯¹åº”å…³ç³» åƒä¸Šé¢é‚£æ ·é…ç½®å¥½ä¹‹å, composer å°†æ³¨å†Œä¸€ä¸ª PSR-4 autoloader åˆ° Acme å‘½åç©ºé—´ æ·»åŠ å®Œ autoload å­—æ®µåï¼Œä½ åº”è¯¥å†æ¬¡è¿è¡Œ install å‘½ä»¤æ¥ç”Ÿæˆ vendor/autoload.php æ–‡ä»¶ æ³¨æ„: æ­¤æ—¶è™½ç„¶ä¿®æ”¹äº† composer.json æ–‡ä»¶, ä½†æ˜¯ç”±äºå¹¶æ²¡æœ‰æ¶‰åŠåˆ°åŒ…ä¿¡æ¯(æ¯”å¦‚ç‰ˆæœ¬ä¿¡æ¯)çš„ä¿®æ”¹, æ‰€ä»¥installå’Œupdateéƒ½ä¸€æ ·; å¼•ç”¨è¿™ä¸ªæ–‡ä»¶ä¹Ÿå°†è¿”å› autoloader çš„å®ä¾‹ï¼Œä½ å¯ä»¥å°†åŒ…å«è°ƒç”¨çš„è¿”å›å€¼å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œå¹¶æ·»åŠ æ›´å¤šçš„å‘½åç©ºé—´ã€‚è¿™å¯¹äºåœ¨ä¸€ä¸ªæµ‹è¯•å¥—ä»¶ä¸­è‡ªåŠ¨åŠ è½½ç±»æ–‡ä»¶æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ å¯å‚è€ƒ: http://docs.phpcomposer.com/01-basic-usage.html#Autoloading psr-0ä¸æ¨èâ€¦. è¿™é‡Œå°±ä¸æ‰¯äº† classmap classmap éœ€è¦å†™åœ¨autoloadå†…; classmap æ‰€é…ç½®çš„ç›®å½•ä¸‹çš„æ‰€æœ‰ .php å’Œ .inc æ–‡ä»¶é‡Œçš„ç±», éƒ½ä¼šåœ¨ install/update è¿‡ç¨‹ä¸­å­˜å‚¨åˆ° vendor/composer/autoload_classmap.php æ–‡ä»¶ä¸­çš„mapæ•°ç»„ä¸­; vendor/composer/autoload_classmap.phpæ–‡ä»¶ä¸­çš„æ˜ å°„å…³ç³», keyæ˜¯æ‰«æåˆ°çš„ç±»çš„namespace\\ç±»å æˆ–è€… ç±»å(æ²¡æœ‰å‘½åç©ºé—´çš„), valueæ˜¯ç±»æ–‡ä»¶çš„è·¯å¾„ æ ¼å¼ 12345&#123; &quot;autoload&quot;: &#123; &quot;classmap&quot;: [&quot;src/&quot;, &quot;lib/&quot;, &quot;test/Something.php&quot;] // å¯ä»¥çœ‹åˆ°ä¸ä»…å¯ä»¥æŒ‡å®šç›®å½•, ä¹Ÿå¯ä»¥æŒ‡å®šæ–‡ä»¶ &#125;&#125; files ä¹Ÿéœ€è¦å†™åœ¨autoloadå†…; Filesæ–¹å¼å°±æ˜¯æ‰‹åŠ¨æŒ‡å®šä¾›ç›´æ¥åŠ è½½çš„æ–‡ä»¶, æ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸€ç³»åˆ—å…¨å±€çš„helper functionsï¼Œå¯ä»¥æ”¾åˆ°ä¸€ä¸ªhelperæ–‡ä»¶é‡Œç„¶åç›´æ¥è¿›è¡ŒåŠ è½½;&quot;autoload&quot;: { &quot;psr-4&quot;: { //ä¸€äº›è‡ªå·±å†™çš„ç±»åº“ &quot;Test\\\\&quot;: &quot;src/&quot;, &quot;Test1\\\\&quot;: &quot;src1/&quot;, &quot;Test2\\\\&quot;: &quot;src2/&quot; }, &quot;classmap&quot;: [&quot;src/&quot;, &quot;src1/hehe.php&quot;], // ä¸€äº›ç±» &quot;files&quot;: [&quot;common/functions.php&quot;] // ä¸€äº›å…¬å…±å‡½æ•° }","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"06. å‘å¸ƒè‡ªå·±çš„åŒ…","slug":"composer/2017-09-20-composer-06","date":"2017-09-20T10:40:17.000Z","updated":"2018-03-01T02:20:43.000Z","comments":true,"path":"2017/09/20/composer/2017-09-20-composer-06/","link":"","permalink":"http://blog.renyimin.com/2017/09/20/composer/2017-09-20-composer-06/","excerpt":"","text":"å‰è¨€ GitHubå®˜æ–¹æä¾›äº†å’ŒPackagistç›¸å…³çš„é’©å­æœåŠ¡; Packagistä¸»è¦æä¾›ComposeråŒ…å‘å¸ƒå’Œç´¢å¼•, é»˜è®¤Composerä»Packagistè·å–èµ„æºã€‚(å¯ä»¥ä½¿ç”¨ä½ çš„GitHubå¸å·ç™»å½•Packagist) ä¹Ÿå¯ä»¥ç†è§£ä¸ºä½ çœŸæ­£çš„é¡¹ç›®ä»£ç æ˜¯åœ¨Gihubä»“åº“ä¸­, è€Œç›¸å…³ä»‹ç»åŠç´¢å¼•ä¿¡æ¯æ˜¯åœ¨Packagistå¹³å° å‘å¸ƒæ­¥éª¤githubä»“åº“éƒ¨åˆ† githubåˆ›å»ºä»“åº“ å°†æœ¬åœ°ç›®å½•ä¸githubä¸­ä»“åº“å…³è” åœ¨æœ¬åœ°é¡¹ç›®ä¸­åˆå§‹åŒ– composer.json æ–‡ä»¶ composer init(ä½¿ç”¨composerè‡ªå¸¦çš„åˆå§‹åŒ–å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªcomposer.jsonæè¿°æ–‡ä»¶)ã€‚ å¦‚æœæƒ³æ‰‹åŠ¨ç¼–è¾‘ï¼Œå¯ä»¥å»composerå®˜ç½‘é˜…è¯»ç›¸å…³æ–‡æ¡£è·å¾—å¸®åŠ©ã€‚ åœ¨æœ¬åœ°å¼€å‘ä¸€ä¸ªåŠŸèƒ½åŒ…, å¹¶ä¸Šä¼ åˆ°githubä»“åº“ä¸­ å¼€å‘åŠŸèƒ½åŒ…çš„æ³¨æ„äº‹é¡¹: éœ€è¦åœ¨composer.jsonæ–‡ä»¶ä¸­é…ç½®å¥½åŒ…å†…éƒ¨çš„è‡ªåŠ¨åŠ è½½è§„åˆ™, æ¯”å¦‚: 12345\"autoload\": &#123; \"psr-4\": &#123; \"Lant\\\\\": \"./\" &#125; &#125; å¦åˆ™, å³ä½¿ä½ ä¸‹è½½ä¸‹æ¥ä½ çš„åŒ…, å¹¶ä¸”ä½ å¼•å…¥äº† vendor/autoload.php æ–‡ä»¶, ä¹Ÿæ— æ³•æ­£å¸¸è‡ªåŠ¨åŠ è½½åˆ°ä½ çš„åŒ…ä»£ç  å¦‚æœä½ çš„åŒ…composer.jsonæ–‡ä»¶ä¸­æŒ‡å®šäº† é¡¶çº§å‘½åç©ºé—´å ä¸ ç›®å½• çš„å…³ç³», å­å‘½åç©ºé—´å’Œç›®å½•å°±ä¸ç”¨è®¾ç½®äº† åªç”¨åœ¨å­ç›®å½•çš„ç±»æ–‡ä»¶ä¸­å£°æ˜ namespace é¡¶çº§å‘½åç©ºé—´/æœ¬å‘½åç©ºé—´ å³å¯! å¦‚æœä½ åŒ…ä¸­çš„æ˜¯å‡ ä¸ªåŒçº§ç›®å½•, é‚£ä½ å¯èƒ½å°±éœ€è¦ä¸ºæ¯ä¸ªç›®å½•è®¾ç½® å‘½åç©ºé—´ å’Œ ç›®å½•çš„å¯¹åº”å…³ç³»! Packagistéƒ¨åˆ† è®¿é—®Packagistä¸»é¡µï¼Œç¡®è®¤è‡ªå·±å·²ç»ç™»å½•ï¼Œç„¶åç‚¹å‡»å³ä¸Šè§’å¤§å¤§çš„Submit Packageï¼Œç„¶åå¡«å…¥æˆ‘ä»¬åˆ›å»ºçš„ä»“åº“çš„åœ°å€ï¼Œç‚¹å‡»Checkï¼Œç„¶åæ²¡é—®é¢˜ï¼Œå†ç‚¹å‡»Submitã€‚ ä¸ºäº†è®©Packagistå¹³å°å¯ä»¥è‡ªåŠ¨æ›´æ–°githubä»“åº“ä¸­çš„ä¿¡æ¯, éœ€è¦æˆ‘ä»¬é…ç½®Githubä»“åº“çš„é’©å­æœåŠ¡ è¿›å…¥ä»“åº“, ç‚¹å‡» â€œsettingâ€ ç‚¹å‡»å·¦ä¾§ â€œIntegrations &amp; servicesâ€ ç„¶å â€œAdd serviceâ€ - é€‰æ‹© â€œPackagistâ€ ç„¶åå¡«å†™è¡¨å•, usernameä¸ºä½ çš„packagistè´¦æˆ·å(å¦‚æœä½¿ç”¨githubè´¦æˆ·ç™»å½•, åˆ™ä¸ºgithubè´¦æˆ·å), Tokenæ˜¯packagistä¸­çš„Token; æ³¨æ„æœ‰æ—¶å€™ä½ çš„åŒ…ä¿®æ”¹å®Œä¹‹å, å‘ç°githubä»“åº“ä¸­æœ‰äº†, packagistä¸­çš„åŒæ­¥æ—¶é—´ä¹Ÿæœ‰äº†, é‚£ä½ å¾—çœ‹ä¸€ä¸‹ä¸­å›½å…¨é‡é•œåƒç«™ç‚¹çš„åŒæ­¥æ—¶é—´æ˜¯å¦æ­£ç¡® (è¯´å¥½çš„ä¸€åˆ†é’ŸåŒæ­¥ä¸€æ¬¡, ä½†..ä¸å°½ç„¶, è¢«å‘è¿‡); å‚è€ƒhttp://note.youdao.com/noteshare?id=8265aa9789dba4451ada428a95048f33","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"05. require å’Œ create-project","slug":"composer/2017-09-20-composer-05","date":"2017-09-20T10:21:46.000Z","updated":"2018-02-03T07:27:07.000Z","comments":true,"path":"2017/09/20/composer/2017-09-20-composer-05/","link":"","permalink":"http://blog.renyimin.com/2017/09/20/composer/2017-09-20-composer-05/","excerpt":"","text":"requireæ˜¯åœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹è¿›è¡ŒåŒ…å®‰è£…, ä¸€èˆ¬å®‰è£…åˆ°vendor/ä¸‹; create-project æ˜¯æŒ‡æŠŠåŒ…å½“æˆä¸€ä¸ªé¡¹ç›®æ¥å®‰è£…, ä¹Ÿå°±æ˜¯å¦‚æœä½ åˆ›å»ºçš„è¿™ä¸ªåŒ…æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®, ä½ å°±å¯ä»¥æ¥ç›´æ¥æŠŠè¿™ä¸ªåŒ…å½“æˆé¡¹ç›®æ¥åˆ›å»º composer create-project lant/packagist_test é¡¹ç›®åœ¨æœ¬åœ°çš„ç›®å½•å é¡¹ç›®ç‰ˆæœ¬(å¦‚:dev-master)","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"04.æ›´æ–°åŒ…çš„æ–¹å¼(require, install, update)å¯¹æ¯”","slug":"composer/2017-09-18-composer-04","date":"2017-09-18T14:23:17.000Z","updated":"2018-03-01T09:52:19.000Z","comments":true,"path":"2017/09/18/composer/2017-09-18-composer-04/","link":"","permalink":"http://blog.renyimin.com/2017/09/18/composer/2017-09-18-composer-04/","excerpt":"","text":"requireè™½ç„¶æ˜¯å®‰è£…, ä½†ä¹Ÿå¯ä»¥ç”¨æ¥æ›´æ–°åŒ…åˆ°æŒ‡å®šç‰ˆæœ¬, å¹¶åŒæ—¶æ›´æ–°composer.jsonå’Œcomposer.lockæ–‡ä»¶, å¦‚æœæ²¡æœ‰åˆ™ä¼šåˆ›å»º! composer require åŒ…å æ–°ç‰ˆæœ¬ å½“ä½ æ‰‹åŠ¨ä¿®æ”¹äº†composer.jsonæ–‡ä»¶ä¸­åŒ…çš„ç‰ˆæœ¬ä¹‹å, å¯ä»¥æ‰§è¡Œ composer update æ¥é‡æ–°å®‰è£…è¯¥åŒ…, å¹¶æ›´æ–°composer.lockæ–‡ä»¶, å¦‚æœæ²¡æœ‰åˆ™ä¼šåˆ›å»º! å½“ç„¶, ä½ å¯ä»¥æŒ‡å®šä½ éœ€è¦æ›´æ–°çš„åŒ… composer update åŒ…å, åŒ…å... å¦å¤–, è¿˜åº”è¯¥æ³¨æ„ä¸€ä¸‹ install å’Œ update çš„ä¸€ä¸ªå°ç»†èŠ‚:å½“ä½ ä¿®æ”¹äº†composer.jsonæ–‡ä»¶, å¦‚æœä¸æ˜¯å¯¹åŒ…åšå¢åˆ æ”¹(æ¯”å¦‚å¢åŠ ä¸€ä¸ªåŒ…, åˆ é™¤ä¸€ä¸ªåŒ…, æˆ–è€…ä¿®æ”¹åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯), è€Œæ˜¯å¢åˆ æ”¹å…¶ä»–ä¿¡æ¯(æ¯”å¦‚é…ç½®è‡ªåŠ¨åŠ è½½ä¹‹ç±»çš„ä¿¡æ¯), é‚£ä¹ˆä½ ä½¿ç”¨ install å’Œ update æ˜¯æ²¡æœ‰åŒºåˆ«çš„! å°ç»“ install, require, updateéƒ½å¯ä»¥åšåŒ…å®‰è£… (å¦‚æœåœ¨composer.jsonä¸­åšäº†åƒè‡ªåŠ¨åŠ è½½çš„ä¿¡æ¯çš„é…ç½®, installå’Œupdateä¼šé‡æ–°è¿›è¡Œç±»å…³ç³»æ˜ å°„) require å’Œ update éƒ½å¯ä»¥åšåŒ…æ›´æ–° (å¦‚æœåœ¨composer.jsonæ–‡ä»¶ä¸­åšäº†åŒ…ç‰ˆæœ¬çš„å¢åˆ æ”¹æŸ¥, installæ— æ³•è¿›è¡Œæ›´æ–°) å¦å¤–: install: ä¸»è¦æ˜¯åœ¨éƒ¨ç½²é˜¶æ®µä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒä½¿ç”¨çš„éƒ½æ˜¯composer.lockæ–‡ä»¶ä¸­ç›¸åŒçš„ä¾èµ–é¡¹ï¼Œä¿è¯çº¿ä¸Šéƒ¨ç½²ç¯å¢ƒä¸æœ¬åœ°å¼€å‘ç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚ update: ä¸»è¦æ˜¯åœ¨å¼€å‘é˜¶æ®µä½¿ç”¨ï¼Œæ ¹æ®æˆ‘ä»¬åœ¨composer.jsonæ–‡ä»¶ä¸­æŒ‡å®šçš„å†…å®¹å‡çº§é¡¹ç›®çš„ä¾èµ–åŒ…ã€‚ æ­¤æ›´æ–°éå½¼æ›´æ–°æ¯”å¦‚packagistä¸­çš„åŒ…ç°åœ¨æ˜¯v2.0, ä½ æœ¬åœ°çš„æ˜¯v1.0, ä½ ç›´æ¥æ‰§è¡Œ composer update, ä¸è¦æŒ‡æœ›composerä¼šè‡ªåŠ¨å¸®ä½ æ›´æ–°åˆ°v2.0, è¦æ›´æ–°ä½ å¾—åœ¨composer.jsonä¸­æŒ‡æ˜ç‰ˆæœ¬å·, ç„¶åcomposer updateæ‰ä¼šæ ¹æ®composer.jsonæ–‡ä»¶å»æ›´æ–°!è¿™æ ·, è‡³äºä½ çš„æ›´æ–°æ˜¯å‡çº§è¿˜æ˜¯é™çº§å°±çœ‹ä½ åœ¨composer.jsonæ–‡ä»¶ä¸­å¦‚ä½•æŒ‡å®šçš„äº†!","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"03.å®‰è£…åŒ…çš„æ–¹å¼(require, install, update)å¯¹æ¯”","slug":"composer/2017-09-18-composer-03","date":"2017-09-18T13:20:31.000Z","updated":"2018-03-01T09:50:48.000Z","comments":true,"path":"2017/09/18/composer/2017-09-18-composer-03/","link":"","permalink":"http://blog.renyimin.com/2017/09/18/composer/2017-09-18-composer-03/","excerpt":"","text":"åˆæ¬¡åšåŒ…å®‰è£… å¦‚æœä½ çš„é¡¹ç›®åˆšå¼•å…¥composer (composer init), ç°åœ¨æ˜¯ç¬¬ä¸€æ¬¡è¿›è¡ŒåŒ…çš„å®‰è£…, ä¹Ÿå°±æ˜¯åªæœ‰composer.jsonæ–‡ä»¶, å¹¶æ²¡æœ‰composer.lockæ–‡ä»¶, å¯ä»¥, ç›´æ¥æ‰§è¡Œ composer require åŒ…å åŒ…ç‰ˆæœ¬ è¯¥å‘½ä»¤ä¼šå¸®ä½ å®‰è£…æ‰€éœ€çš„åŒ…åˆ° vendor/ ç›®å½•ä¸‹ ç”Ÿæˆ composer.json æ–‡ä»¶, å¹¶å°†ä¾èµ–ä¿¡æ¯å†™å…¥æ–‡ä»¶ä¸­ ç”Ÿæˆ composer.lock æ–‡ä»¶ composerå°†ä¼šé€šè¿‡composer.jsonæ¥è¯»å–éœ€è¦çš„åŒ…å’Œç›¸å¯¹çš„ç‰ˆæœ¬, ç„¶ååˆ›å»ºcomposer.lockæ–‡ä»¶ æ‰€ä»¥ï¼Œå¯¹äºé™¤äº†åŒ…ç‰ˆæœ¬ä¹‹å¤–çš„å…¶ä»–é…ç½®, å¦‚è‡ªåŠ¨åŠ è½½â€¦ç­‰, composer.lock æ–‡ä»¶ä¸ä¼šåŒ…å«! (æ‰€ä»¥å½“æ”¹å˜è¿™äº›ä¿¡æ¯ä¹‹å, install å’Œ updateçš„æ•ˆæœä¸€æ ·) éåˆæ¬¡å®‰è£… å¦‚æœä½ çš„é¡¹ç›®å·²ç»å®‰è£…è¿‡ä¸€äº›åŒ…äº†, å³å·²ç»æœ‰ composer.json, composer.lock æ–‡ä»¶; æ­¤æ—¶, ä½ æœ‰ä¸¤ç§æ–¹å¼: å’Œåˆæ¬¡å®‰è£…ä¸€æ ·, ä½¿ç”¨ composer require åŒ…å åŒ…ç‰ˆæœ¬ è¿›è¡Œå®‰è£… æ‰‹åŠ¨åœ¨composer.jsonæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®, ç„¶åè¿è¡Œ composer updateæ³¨æ„, æ­¤æ—¶ä¸èƒ½ä½¿ç”¨ composer install, å› ä¸ºè¯¥å‘½ä»¤æ˜¯ä¾æ® composer.lock æ–‡ä»¶æ¥è¿›è¡Œå®‰è£…çš„, è€Œcomposer.lockæ–‡ä»¶åˆæ˜¯ä¾æ®composer.jsonæ–‡ä»¶ä¸­çš„åŒ…åŠåŒ…ç‰ˆæœ¬ä¿¡æ¯ç”Ÿæˆçš„,è€Œæ­¤æ—¶ä½ æ”¹å˜äº† composer.json æ–‡ä»¶, å¹¶ä¸”æ˜¯æ–°å¢äº†ä¸€ä¸ªåŒ…(åŠç‰ˆæœ¬å¯¹åº”å…³ç³»), æ‰€ä»¥ä½ éœ€è¦æ›´æ–° composer.lock æ–‡ä»¶! å¦‚æœä½ æ‰§è¡Œçš„æ˜¯ composer install, åˆ™ä¼šè­¦å‘Š: Warning: The lock file is not up to date with the latest changes in composer.json. You may be getting outdated dependencies. Run update to update them. å½“ç„¶, ä½ ä¹Ÿå¯ä»¥åˆ é™¤ composer.lock æ–‡ä»¶, ç„¶åæ‰‹åŠ¨åœ¨composer.jsonæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®, æœ€åæ‰§è¡Œ composer install install, require, updateéƒ½å¯ä»¥åšåŒ…å®‰è£…","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"02. è®¾ç½®ä¸­å›½å…¨é‡é•œåƒ","slug":"composer/2017-09-18-composer-02","date":"2017-09-18T09:40:11.000Z","updated":"2018-03-01T09:54:16.000Z","comments":true,"path":"2017/09/18/composer/2017-09-18-composer-02/","link":"","permalink":"http://blog.renyimin.com/2017/09/18/composer/2017-09-18-composer-02/","excerpt":"","text":"å‰è¨€ ä¸€èˆ¬æƒ…å†µä¸‹,å®‰è£…åŒ…çš„æ•°æ®(ä¸»è¦æ˜¯ zip æ–‡ä»¶) ä¸€èˆ¬æ˜¯ä» github.com ä¸Šä¸‹è½½çš„, å®‰è£…åŒ…çš„å…ƒæ•°æ®æ˜¯ä» packagist.org ä¸Šä¸‹è½½çš„ã€‚ç„¶è€Œï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å¤–çš„ç½‘ç«™è¿æ¥é€Ÿåº¦å¾ˆæ…¢ï¼Œå¹¶ä¸”éšæ—¶å¯èƒ½è¢«â€œå¢™â€ç”šè‡³â€œä¸å­˜åœ¨â€ã€‚â€œPackagist ä¸­å›½å…¨é‡é•œåƒâ€æ‰€åšçš„å°±æ˜¯ç¼“å­˜æ‰€æœ‰å®‰è£…åŒ…å’Œå…ƒæ•°æ®åˆ°å›½å†…çš„æœºæˆ¿å¹¶é€šè¿‡å›½å†…çš„ CDN è¿›è¡ŒåŠ é€Ÿï¼Œè¿™æ ·å°±ä¸å¿…å†å»å‘å›½å¤–çš„ç½‘ç«™å‘èµ·è¯·æ±‚, ä»è€Œè¾¾åˆ°åŠ é€Ÿ composer installä»¥åŠ composer update çš„è¿‡ç¨‹, å¹¶ä¸”æ›´åŠ å¿«é€Ÿã€ç¨³å®šã€‚å› æ­¤, å³ä½¿ packagist.orgã€github.com å‘ç”Ÿæ•…éšœ(ä¸»è¦æ˜¯è¿æ¥é€Ÿåº¦å¤ªæ…¢å’Œè¢«å¢™), ä½ ä»ç„¶å¯ä»¥ä¸‹è½½ã€æ›´æ–°å®‰è£…åŒ…ã€‚ åŸç†å›¾ä¸‹é¢æ˜¯ä¸€å¼ ä»ç½‘ä¸Šæ‰¾çš„å›¾ é…ç½®æ–¹æ³•1.ä¿®æ”¹ composer çš„å…¨å±€é…ç½®æ–‡ä»¶æ‰“å¼€å‘½ä»¤è¡Œçª—å£ï¼ˆwindowsç”¨æˆ·ï¼‰æˆ–æ§åˆ¶å°ï¼ˆLinuxã€Mac ç”¨æˆ·ï¼‰å¹¶æ‰§è¡Œå‘½ä»¤: composer config -g repo.packagist composer https://packagist.phpcomposer.com 2.ä¿®æ”¹å½“å‰é¡¹ç›®çš„ composer.json é…ç½®æ–‡ä»¶ æ‰“å¼€å‘½ä»¤è¡Œçª—å£ï¼ˆwindowsç”¨æˆ·ï¼‰æˆ–æ§åˆ¶å°ï¼ˆLinuxã€Mac ç”¨æˆ·ï¼‰, è¿›å…¥ä½ çš„é¡¹ç›®çš„æ ¹ç›®å½•ï¼ˆä¹Ÿå°±æ˜¯ composer.json æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼‰ï¼Œæ‰§è¡Œå‘½ä»¤: composer config repo.packagist composer https://packagist.phpcomposer.com ä¸Šè¿°æ“ä½œå°†ä¼šåœ¨ å½“å‰é¡¹ç›®çš„ composer.json æ–‡ä»¶çš„æœ«å°¾è‡ªåŠ¨æ·»åŠ é•œåƒçš„é…ç½®ä¿¡æ¯ï¼ˆä½ ä¹Ÿå¯ä»¥è‡ªå·±æ‰‹å·¥æ·»åŠ ï¼‰ï¼š 123456\"repositories\": &#123; \"packagist\": &#123; \"type\": \"composer\", \"url\": \"https://packagist.phpcomposer.com\" &#125; &#125; å‚è€ƒ: https://pkg.phpcomposer.com/","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"01.å®‰è£…","slug":"composer/2017-09-18-composer-01","date":"2017-09-18T09:10:11.000Z","updated":"2018-02-28T08:16:31.000Z","comments":true,"path":"2017/09/18/composer/2017-09-18-composer-01/","link":"","permalink":"http://blog.renyimin.com/2017/09/18/composer/2017-09-18-composer-01/","excerpt":"","text":"composer.pharæ–‡ä»¶ä¸‹è½½å…ˆä¸‹è½½composer.pharæ–‡ä»¶, 3ç§æ–¹å¼: curl -sS https://getcomposer.org/installer | php php -r &quot;readfile(&#39;https://getcomposer.org/installer&#39;);&quot; | php æ‰‹åŠ¨ä¸‹è½½Composer, åœ°å€ Linux/Unix/OS å…¨å±€å®‰è£… : mv composer.phar /usr/local/bin/composer å±€éƒ¨å®‰è£… : mv composer.phar /å±€éƒ¨ç›®å½•/composer windows å…¨å±€å®‰è£… : é…ç½®composer.pharæ–‡ä»¶è·¯å¾„(D:\\WWW\\composer)åˆ°ç¯å¢ƒå˜é‡ä¸­ ; æ¥ä¸‹æ¥éœ€è¦åœ¨composer.pharåŒçº§ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶composer.bat : echo @php &quot;%~dp0composer.phar&quot; %*&gt;composer.bat è¿™å°±å®‰è£…å¥½äº† å±€éƒ¨å®‰è£… : ç›´æ¥æŠŠä¸‹è½½çš„composer.pharæ–‡ä»¶æ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹; è¿è¡Œå‘½ä»¤ : php composer.phar install ç„¶åå°±å®‰è£…æˆåŠŸäº†(æ¯ä¸ªå±€éƒ¨ç›®å½•éƒ½éœ€è¦è¿™ä¹ˆå®‰è£…, æ¯”è¾ƒéº»çƒ¦) æ¨èå…¨å±€å®‰è£…å³å¯. composerè‡ªæˆ‘æ›´æ–° self-update å°† Composer è‡ªèº«å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬, åªéœ€è¦è¿è¡Œ composer self-update å‘½ä»¤ã€‚å®ƒå°†æ›¿æ¢ä½ çš„ composer.phar æ–‡ä»¶åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ å¦‚æœä½ æƒ³è¦å‡çº§åˆ°ä¸€ä¸ªç‰¹å®šçš„ç‰ˆæœ¬ï¼Œå¯ä»¥ composer self-update 1.0.0-alpha7 è‡ªæˆ‘æ›´æ–°è¿˜å¯ä»¥è·Ÿå‚æ•° --rollback (-r): å›æ»šåˆ°ä½ å·²ç»å®‰è£…çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚ --clean-backups: åœ¨æ›´æ–°è¿‡ç¨‹ä¸­åˆ é™¤æ—§çš„å¤‡ä»½ï¼Œè¿™ä½¿å¾—æ›´æ–°è¿‡åçš„å½“å‰ç‰ˆæœ¬æ˜¯å”¯ä¸€å¯ç”¨çš„å¤‡ä»½ã€‚","categories":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/categories/Composer/"}],"tags":[{"name":"Composer","slug":"Composer","permalink":"http://blog.renyimin.com/tags/Composer/"}]},{"title":"27. REPEATABLE READ å¯é‡å¤è¯»","slug":"mysql/2017-09-17-mysql-27","date":"2017-09-17T14:10:52.000Z","updated":"2018-03-07T09:19:48.000Z","comments":true,"path":"2017/09/17/mysql/2017-09-17-mysql-27/","link":"","permalink":"http://blog.renyimin.com/2017/09/17/mysql/2017-09-17-mysql-27/","excerpt":"","text":"å‰è¨€ è¯¥éš”ç¦»çº§åˆ«å¯ä»¥è§£å†³ä¸å¯é‡å¤è¯»é—®é¢˜, è„è¯»é—®é¢˜; ä¹Ÿå°±æ˜¯å®ƒæ—¢å¯ä»¥è®©äº‹åŠ¡åªèƒ½è¯»å…¶ä»–äº‹åŠ¡å·²æäº¤çš„çš„è®°å½•, åˆèƒ½åœ¨åŒä¸€äº‹åŠ¡ä¸­ä¿è¯å¤šæ¬¡è¯»å–çš„æ•°æ®å³ä½¿è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹,è¯»åˆ°çš„æ•°æ®ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚ å¦‚æœè®©ä½ ç”¨ é” æ¥è®¾è®¡è¯¥éš”ç¦»çº§åˆ« ? å‡è®¾, åœ¨äº‹åŠ¡Aä¸­è¯»å–æ•°æ®å‰, äº‹åŠ¡Bå¯¹åŒä¸€æ•°æ®åšäº†ä¿®æ”¹å¹¶ä¸”è¿˜æ²¡æœ‰å®Œæˆ(commit/rollback), é‚£å¦‚ä½•è®©äº‹åŠ¡Aæ— æ³•è¯»å–äº‹åŠ¡Bä¸­ å°šæœªè½åœ°çš„è„æ•°æ® å‘¢? å½“äº‹åŠ¡Båœ¨å¯¹æ•°æ®åšå†™æ“ä½œçš„æ—¶å€™, ç»™æ•°æ®åŠ ä¸Šè¡Œçº§çš„æ’ä»–é”(X lock)(è¯»å–çš„æ—¶å€™ä¹Ÿåˆ«å¿˜äº†åŠ ä¸Šå…±äº«é”(S lock)), æ³¨æ„ä¸¤ç§é”éƒ½è¦ä½¿ç”¨; é‚£äº‹åŠ¡Aç”±äºåŠ ä¸ä¸Šå…±äº«é”/æ’ä»–é”, è‡ªç„¶åªèƒ½é˜»å¡ç­‰äº‹åŠ¡Aå®Œæˆåæ‰èƒ½è¯»å–/ä¿®æ”¹æ•°æ®äº† è¿™æ ·åšçš„è¯ç¡®å®å®ç°äº†æ•ˆæœ, ä¹Ÿå°±é¿å…äº†è„è¯», äº‹å®ä¸Š, ä¹Ÿè§£å†³å¯äº† ä¸å¯é‡å¤è¯»(å› ä¸ºä¸€æ—¦åŠ äº†å…±äº«é”, å…¶ä»–äº‹åŠ¡ä¹Ÿæ— æ³•åŠ æ’ä»–é”è¿›è¡Œä¿®æ”¹), ä½†é—®é¢˜æ˜¯è¿™æ˜¯ä¸€ç§å¾ˆä½æ•ˆçš„ä¼ ç»Ÿæ€è·¯, å› ä¸ºå¯¹äºå¤§éƒ¨åˆ†åº”ç”¨æ¥è¯´, è¯»æ“ä½œæ˜¯å¤šäºå†™æ“ä½œçš„, å½“å†™æ“ä½œåŠ é”æ—¶, é‚£ä¹ˆè¯»æ“ä½œå…¨éƒ¨è¢«é˜»å¡, è¿™æ ·åœ¨å¤§ç”¨æˆ·é‡é«˜å¹¶å‘çš„æƒ…å†µä¸‹, ä¼šç›´æ¥é™ä½æ•°æ®åº“çš„è¯»æ•ˆç‡ã€‚ æ‰€ä»¥, ä¸ºäº†æé«˜å¹¶å‘æ€§, MySQLæ˜¯è‡ªç„¶ä¸ä¼šç®€å•åœ°ä½¿ç”¨ä¼ ç»Ÿæ€è·¯(ç›´æ¥åŠ é”)æ¥è§£å†³çš„é—®é¢˜ æ³¨æ„: å¦‚æœåªæ˜¯ å†™æ“ä½œåŠ æ’ä»–é”çš„è¯ æ˜¯æ— æ³•é¿å… è„è¯», ä¸å¯é‡å¤è¯» è¿™ä¸¤ä¸ªé—®é¢˜çš„; äº‹å®ä¸Š, MySQLæ˜¯ä½¿ç”¨ å†™æ“ä½œåŠ æ’ä»–é”(è¯»æ“ä½œä¸åŠ é”), ç»“åˆMVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ æ¥å®ç°è¯¥éš”ç¦»çº§åˆ«; æ–¹æ¡ˆMySQL åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«Read committed ã€Repeatable Readä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ éé”å®š çš„ ä¸€è‡´æ€§è¯»ï¼ï¼å³è¯»å–æ•°æ®ä¸ç”¨åŠ é”ï¼Œè€Œæ˜¯é‡‡ç”¨çš„æ˜¯MVCCä¸­ä¸€è‡´æ€§éé”å®šè¯»æ¨¡å¼; ä»è€Œåšåˆ°: å†™ä¸å½±å“è¯»ï¼Œè¯»ä¸å½±å“å†™ï¼Œå†™åªå½±å“å†™, åªæœ‰å†™å†™ä¼šé˜»å¡!!! è¯»ä¸å½±å“å†™: å½“äº‹åŠ¡Aä¸­æ­£åœ¨æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œäº‹åŠ¡Bçš„å†™æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…å½“å‰äº‹åŠ¡Aä¸ŠSé”çš„é‡Šæ”¾(å› ä¸ºäº‹åŠ¡Aè¯»å–å‹æ ¹å°±æ²¡åŠ é”)ï¼Œè€Œæ˜¯ç›´æ¥å¯ä»¥å¯¹æ•°æ®åŠ Xé”è¿›è¡Œæ“ä½œã€‚ å†™ä¸å½±å“è¯»: å½“äº‹åŠ¡Aä¸­æ­£åœ¨æ‰§è¡Œå†™æ“ä½œæ—¶, è™½ç„¶å¯¹æ•°æ®åŠ äº†Xé”, ä½†æ˜¯äº‹åŠ¡Bçš„è¯»æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…å½“å‰äº‹åŠ¡è¡Œä¸ŠXé”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šå»è¯»å–å¿«ç…§æ•°æ® (RCå’ŒRRå› å¿«ç…§äº§ç”Ÿæ—¶æœºä¸åŒ, å¯¼è‡´äº†éš”ç¦»çº§åˆ«ä¸ä¸€æ ·, è¯»å–çš„è½åœ°æ•°æ®ä¹Ÿä¸ç›¸åŒ)ã€‚ æ‰€ä»¥æ€»ç»“æ¥çœ‹, READ UNCOMMITTED å’Œ REPEATABLE READ è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«éƒ½æ˜¯ä½¿ç”¨ å†™ç”¨æ’ä»–é” + è¯»ç”¨MVCC, åŒºåˆ«å¯ä»¥å‚è€ƒ MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"26. MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶","slug":"mysql/2017-09-17-mysql-26","date":"2017-09-17T10:10:21.000Z","updated":"2018-03-07T09:19:44.000Z","comments":true,"path":"2017/09/17/mysql/2017-09-17-mysql-26/","link":"","permalink":"http://blog.renyimin.com/2017/09/17/mysql/2017-09-17-mysql-26/","excerpt":"","text":"ç®€ä»‹Multiversion Concurrency Control é˜¿é‡Œæ•°æ®åº“å†…æ ¸â€™2017/12â€™æœˆæŠ¥ä¸­å¯¹MVCCçš„è§£é‡Šæ˜¯: å¤šç‰ˆæœ¬æ§åˆ¶: æŒ‡çš„æ˜¯ä¸€ç§ æé«˜å¹¶å‘ çš„æŠ€æœ¯ã€‚æœ€æ—©çš„æ•°æ®åº“ç³»ç»Ÿ, åªæœ‰è¯»è¯»ä¹‹é—´å¯ä»¥å¹¶å‘ï¼Œè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™éƒ½è¦é˜»å¡ã€‚å¼•å…¥å¤šç‰ˆæœ¬ä¹‹åï¼Œåªæœ‰å†™å†™ä¹‹é—´ç›¸äº’é˜»å¡ï¼Œå…¶ä»–ä¸‰ç§æ“ä½œéƒ½å¯ä»¥å¹¶è¡Œï¼Œè¿™æ ·å¤§å¹…åº¦æé«˜äº†InnoDBçš„å¹¶å‘åº¦ã€‚ &lt;é«˜æ€§èƒ½MySQL&gt;ä¸­å¯¹MVCCçš„éƒ¨åˆ†ä»‹ç» MySQLçš„å¤§å¤šæ•°äº‹åŠ¡å‹å­˜å‚¨å¼•æ“å®ç°çš„å…¶å®éƒ½ä¸æ˜¯ç®€å•çš„è¡Œçº§é”ã€‚åŸºäºæå‡å¹¶å‘æ€§èƒ½çš„è€ƒè™‘, å®ƒä»¬ä¸€èˆ¬éƒ½åŒæ—¶å®ç°äº†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)ã€‚ä¸ä»…æ˜¯MySQL, åŒ…æ‹¬Oracle,PostgreSQLç­‰å…¶ä»–æ•°æ®åº“ç³»ç»Ÿä¹Ÿéƒ½å®ç°äº†MVCC, ä½†å„è‡ªçš„å®ç°æœºåˆ¶ä¸å°½ç›¸åŒ, å› ä¸ºMVCCæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å®ç°æ ‡å‡†ã€‚å¯ä»¥è®¤ä¸ºMVCCæ˜¯è¡Œçº§é”çš„ä¸€ä¸ªå˜ç§, ä½†æ˜¯å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹é¿å…äº†åŠ é”æ“ä½œ, å› æ­¤å¼€é”€æ›´ä½ã€‚è™½ç„¶å®ç°æœºåˆ¶æœ‰æ‰€ä¸åŒ, ä½†å¤§éƒ½å®ç°äº†éé˜»å¡çš„è¯»æ“ä½œï¼Œå†™æ“ä½œä¹Ÿåªé”å®šå¿…è¦çš„è¡Œã€‚MVCCåªåœ¨ READ COMMITTED å’Œ REPEATABLE READ ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œã€‚å…¶ä»–ä¸¤ä¸ªéš”ç¦»çº§åˆ«å¤Ÿå’ŒMVCCä¸å…¼å®¹, å› ä¸º READ UNCOMMITTED æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œ, è€Œä¸æ˜¯ç¬¦åˆå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œã€‚è€Œ SERIALIZABLE åˆ™ä¼šå¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½åŠ é”ã€‚ ç›¸å…³æ¦‚å¿µ read view ä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­çš„, æ¯”è¾ƒæ™®éçš„è§£é‡Šä¾¿æ˜¯â€æœ¬äº‹åŠ¡ä¸å¯è§çš„å½“å‰å…¶ä»–æ´»è·ƒäº‹åŠ¡â€, ä½†æ­£æ˜¯è¯¥è§£é‡Š, å¯èƒ½ä¼šé€ æˆä¸€èŠ‚ç†è§£ä¸Šçš„è¯¯åŒº, æ‰€ä»¥æ­¤å¤„æä¾›ä¸¤ä¸ªå‚è€ƒ, ç”¨æ¥é¿å¼€ç†è§£è¯¯åŒº:read viewä¸­çš„é«˜æ°´ä½low_limit_idå¯ä»¥å‚è€ƒ å¯¹äºread viewå¿«ç…§çš„ç”Ÿæˆæ—¶æœº, ä¹Ÿéå¸¸å…³é”®, ä¹Ÿæ­£æ˜¯å› ä¸ºç”Ÿæˆæ—¶æœºçš„ä¸åŒ, é€ æˆäº†RC, RRä¸¤ç§éš”ç¦»çº§åˆ«çš„ä¸åŒå¯è§æ€§ å¯ä»¥å‚è€ƒ; åœ¨innodb(é»˜è®¤repeatable readçº§åˆ«), äº‹åŠ¡åœ¨begin/start transactionä¹‹åçš„ç¬¬ä¸€æ¡selectè¯»æ“ä½œå, ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§(read view), å°†å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„å…¶ä»–äº‹åŠ¡è®°å½•è®°å½•èµ·æ¥; åœ¨innodb(é»˜è®¤repeatable committedçº§åˆ«), äº‹åŠ¡ä¸­æ¯æ¡selectè¯­å¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§(read view); å‚è€ƒ1234With REPEATABLE READ isolation level, the snapshot is based on the time when the first read operation is performed.ä½¿ç”¨REPEATABLE READéš”ç¦»çº§åˆ«ï¼Œå¿«ç…§æ˜¯åŸºäºæ‰§è¡Œç¬¬ä¸€ä¸ªè¯»æ“ä½œçš„æ—¶é—´ã€‚With READ COMMITTED isolation level, the snapshot is reset to the time of each consistent read operation.ä½¿ç”¨READ COMMITTEDéš”ç¦»çº§åˆ«ï¼Œå¿«ç…§è¢«é‡ç½®ä¸ºæ¯ä¸ªä¸€è‡´çš„è¯»å–æ“ä½œçš„æ—¶é—´ã€‚ undo-log å¯ä»¥å‚è€ƒæ•°æ®åº“å†…æ ¸æœˆæŠ¥2015/04/01 å‰è¨€Undo logæ˜¯InnoDB MVCCäº‹åŠ¡ç‰¹æ€§çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å½“æˆ‘ä»¬å¯¹è®°å½•åšäº†å˜æ›´æ“ä½œæ—¶å°±ä¼šäº§ç”Ÿundoè®°å½•ï¼ŒUndoè®°å½•é»˜è®¤è¢«è®°å½•åˆ°ç³»ç»Ÿè¡¨ç©ºé—´(ibdata)ä¸­, ä½†ä»5.6å¼€å§‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç‹¬ç«‹çš„Undoè¡¨ç©ºé—´ã€‚Undoè®°å½•ä¸­å­˜å‚¨çš„æ˜¯è€ç‰ˆæœ¬æ•°æ®ï¼Œå½“ä¸€ä¸ªæ—§çš„äº‹åŠ¡éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œä¸ºäº†èƒ½è¯»å–åˆ°è€ç‰ˆæœ¬çš„æ•°æ®ï¼Œéœ€è¦é¡ºç€undoé“¾æ‰¾åˆ°æ»¡è¶³å…¶å¯è§æ€§çš„è®°å½•ã€‚å½“ç‰ˆæœ¬é“¾å¾ˆé•¿æ—¶ï¼Œé€šå¸¸å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œã€‚å¤§å¤šæ•°å¯¹æ•°æ®çš„å˜æ›´æ“ä½œåŒ…æ‹¬INSERT/DELETE/UPDATEï¼Œå…¶ä¸­INSERTæ“ä½œåœ¨äº‹åŠ¡æäº¤å‰åªå¯¹å½“å‰äº‹åŠ¡å¯è§ï¼Œå› æ­¤äº§ç”Ÿçš„Undoæ—¥å¿—å¯ä»¥åœ¨äº‹åŠ¡æäº¤åç›´æ¥åˆ é™¤, è€Œå¯¹äºUPDATE/DELETEåˆ™éœ€è¦ç»´æŠ¤å¤šç‰ˆæœ¬ä¿¡æ¯ï¼Œåœ¨InnoDBé‡Œï¼ŒUPDATEå’ŒDELETEæ“ä½œäº§ç”Ÿçš„Undoæ—¥å¿—è¢«å½’æˆä¸€ç±»ï¼Œå³update_undo; åœ¨å›æ»šæ®µä¸­çš„undo logsåˆ†ä¸º: insert undo log å’Œ update undo loginsert undo log : äº‹åŠ¡å¯¹insertæ–°è®°å½•æ—¶äº§ç”Ÿçš„undolog, åªåœ¨æœ¬äº‹åŠ¡å›æ»šæ—¶éœ€è¦, å¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå°±å¯ä»¥ç«‹å³ä¸¢å¼ƒ;update undo log : äº‹åŠ¡å¯¹è®°å½•è¿›è¡Œdeleteå’Œupdateæ“ä½œæ—¶äº§ç”Ÿçš„undo log, ä¸ä»…åœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦, ä¸€è‡´æ€§è¯»ä¹Ÿéœ€è¦ï¼Œæ‰€ä»¥ä¸èƒ½éšä¾¿åˆ é™¤ï¼Œåªæœ‰å½“æ•°æ®åº“æ‰€ä½¿ç”¨çš„å¿«ç…§ä¸­ä¸æ¶‰åŠè¯¥æ—¥å¿—è®°å½•ï¼Œå¯¹åº”çš„å›æ»šæ—¥å¿—æ‰ä¼šè¢«purgeçº¿ç¨‹åˆ é™¤ã€‚ InnoDBå­˜å‚¨å¼•æ“åœ¨æ•°æ®åº“æ¯è¡Œæ•°æ®çš„åé¢æ·»åŠ äº†ä¸‰ä¸ªå­—æ®µ 6å­—èŠ‚çš„äº‹åŠ¡ID(DB_TRX_ID)å­—æ®µ: ç”¨æ¥æ ‡è¯†æœ€è¿‘ä¸€æ¬¡å¯¹æœ¬è¡Œè®°å½•åšä¿®æ”¹(insert|update)çš„äº‹åŠ¡çš„æ ‡è¯†ç¬¦, å³æœ€åä¸€æ¬¡ä¿®æ”¹(insert|update)æœ¬è¡Œè®°å½•çš„äº‹åŠ¡idã€‚è‡³äºdeleteæ“ä½œï¼Œåœ¨innodbçœ‹æ¥ä¹Ÿä¸è¿‡æ˜¯ä¸€æ¬¡updateæ“ä½œï¼Œæ›´æ–°è¡Œä¸­çš„ä¸€ä¸ªç‰¹æ®Šä½å°†è¡Œè¡¨ç¤ºä¸ºdeleted, å¹¶éçœŸæ­£åˆ é™¤ã€‚ 7å­—èŠ‚çš„å›æ»šæŒ‡é’ˆ(DB_ROLL_PTR)å­—æ®µ: æŒ‡å†™å…¥å›æ»šæ®µ(rollback segment)çš„ undo log record (æ’¤é”€æ—¥å¿—è®°å½•)ã€‚å¦‚æœä¸€è¡Œè®°å½•è¢«æ›´æ–°, åˆ™ undo log record åŒ…å« â€˜é‡å»ºè¯¥è¡Œè®°å½•è¢«æ›´æ–°ä¹‹å‰å†…å®¹â€™ æ‰€å¿…é¡»çš„ä¿¡æ¯ã€‚ 6å­—èŠ‚çš„DB_ROW_IDå­—æ®µ: åŒ…å«ä¸€ä¸ªéšç€æ–°è¡Œæ’å…¥è€Œå•è°ƒé€’å¢çš„è¡ŒID, å½“ç”±innodbè‡ªåŠ¨äº§ç”Ÿèšç°‡ç´¢å¼•æ—¶, èšç°‡ç´¢å¼•ä¼šåŒ…æ‹¬è¿™ä¸ªè¡ŒIDçš„å€¼, å¦åˆ™è¿™ä¸ªè¡ŒIDä¸ä¼šå‡ºç°åœ¨ä»»ä½•ç´¢å¼•ä¸­ã€‚ç»“åˆèšç°‡ç´¢å¼•çš„ç›¸å…³çŸ¥è¯†ç‚¹, å¤§æ¦‚å¯ä»¥ç†è§£ä¸º: å¦‚æœæˆ‘ä»¬çš„è¡¨ä¸­æ²¡æœ‰ä¸»é”®æˆ–åˆé€‚çš„å”¯ä¸€ç´¢å¼•, ä¹Ÿå°±æ˜¯æ— æ³•ç”Ÿæˆèšç°‡ç´¢å¼•çš„æ—¶å€™, InnoDBä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆèšé›†ç´¢å¼•, ä½†èšç°‡ç´¢å¼•ä¼šä½¿ç”¨DB_ROW_IDçš„å€¼æ¥ä½œä¸ºä¸»é”®; å¦‚æœæˆ‘ä»¬æœ‰è‡ªå·±çš„ä¸»é”®æˆ–è€…åˆé€‚çš„å”¯ä¸€ç´¢å¼•, é‚£ä¹ˆèšç°‡ç´¢å¼•ä¸­ä¹Ÿå°±ä¸ä¼šåŒ…å« DB_ROW_ID äº† , å¦‚æœæœ‰è¯¯, å¸Œæœ›æŒ‡æ­£, è°¢è°¢ã€‚ å¯è§æ€§æ¯”è¾ƒç®—æ³• å‡è®¾è¦è¯»å–çš„æ•°æ®è¡Œ, æœ€åå®Œæˆäº‹åŠ¡æäº¤çš„äº‹åŠ¡id(å³, è®©å½“å‰æ•°æ®è¡Œæœ€åè½åœ°çš„äº‹åŠ¡id)ä¸º trx_id_current ; å½“å‰æ–°å¼€äº‹åŠ¡idä¸º new_id å½“å‰æ–°å¼€äº‹åŠ¡åˆ›å»ºçš„å¿«ç…§ read view ä¸­æœ€æ—©çš„äº‹åŠ¡idä¸º up_limit_id, æœ€è¿Ÿçš„äº‹åŠ¡idä¸º low_limit_id(æ³¨æ„ low_limit_id=æœªå¼€å¯çš„äº‹åŠ¡id=å½“å‰æœ€å¤§äº‹åŠ¡id+1) æ¯”è¾ƒ: 1.trx_id_current &lt; up_limit_id, è¿™ç§æƒ…å†µæ¯”è¾ƒå¥½ç†è§£, è¡¨ç¤º, æ–°äº‹åŠ¡åœ¨è¯»å–è¯¥è¡Œè®°å½•æ—¶, è¯¥è¡Œè®°å½•çš„æœ€åç¨³å®šäº‹åŠ¡IDå°äºç³»ç»Ÿå½“å‰æ‰€æœ‰æ´»è·ƒçš„äº‹åŠ¡ID, æ‰€ä»¥å½“å‰è¡Œç¨³å®šæ•°æ®å¯¹æ–°äº‹åŠ¡å¯è§, è·³åˆ°æ­¥éª¤5; 2.trx_id_current &gt;= trx_id_last, è¿™ç§æƒ…å†µä¹Ÿæ¯”è¾ƒå¥½ç†è§£, è¡¨ç¤º, è¯¥è¡Œè®°å½•çš„ æœ€åç¨³å®šäº‹åŠ¡ID æ˜¯åœ¨ æœ¬æ¬¡æ–°äº‹åŠ¡ åˆ›å»ºä¹‹åæ‰å¼€å¯çš„,ä½†æ˜¯å´åœ¨æœ¬æ¬¡æ–°äº‹åŠ¡æ‰§è¡Œç¬¬äºŒä¸ªselectå‰å°±commitäº†, æ‰€ä»¥è¯¥è¡Œè®°å½•çš„å½“å‰å€¼å¯¹æœ¬æ¬¡æ–°äº‹åŠ¡ä¸å¯è§(RRçº§åˆ«), è·³åˆ°æ­¥éª¤4; 3.trx_id_current &lt;= trx_id_current &lt;= trx_id_last, è¡¨ç¤º: è¯¥è¡Œè®°å½•æ‰€åœ¨äº‹åŠ¡åœ¨æœ¬æ¬¡æ–°äº‹åŠ¡åˆ›å»ºçš„æ—¶å€™å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä»up_limit_idåˆ°low_limit_idè¿›è¡Œéå†ï¼Œå¦‚æœtrx_id_currentç­‰äºä»–ä»¬ä¹‹ä¸­çš„æŸä¸ªäº‹åŠ¡idçš„è¯ï¼Œé‚£ä¹ˆä¸å¯è§, è°ƒåˆ°æ­¥éª¤4,å¦åˆ™è¡¨ç¤ºå¯è§ã€‚ 4.ä»è¯¥è¡Œè®°å½•çš„ DB_ROLL_PTR æŒ‡é’ˆæ‰€æŒ‡å‘çš„å›æ»šæ®µä¸­å–å‡ºæœ€æ–°çš„undo-logçš„ç‰ˆæœ¬å·, å°†å®ƒèµ‹å€¼è¯¥ trx_id_currentï¼Œç„¶åè·³åˆ°æ­¥éª¤1é‡æ–°å¼€å§‹åˆ¤æ–­; 5.å°†è¯¥å¯è§è¡Œçš„å€¼è¿”å›ã€‚ æ¡ˆä¾‹åˆ†æ1.ä¸‹é¢æ˜¯ä¸€ä¸ªéå¸¸ç®€ç‰ˆçš„æ¼”ç¤ºäº‹åŠ¡å¯¹æŸè¡Œè®°å½•çš„æ›´æ–°è¿‡ç¨‹, å½“ç„¶, InnoDBå¼•æ“åœ¨å†…éƒ¨è¦åšçš„å·¥ä½œéå¸¸å¤š: 2.ä¸‹é¢æ˜¯ä¸€å¥—æ¯”è¾ƒç®—æ³•çš„åº”ç”¨è¿‡ç¨‹ä¹Ÿå¯å‚è€ƒhttps://github.com/zhangyachen/zhangyachen.github.io/issues/68ä¸­çš„æ¡ˆä¾‹ å½“å‰è¯»å’Œå¿«ç…§è¯» MySQLçš„InnoDBå­˜å‚¨å¼•æ“é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯RR(å¯é‡å¤è¯»), æ˜¯é€šè¿‡ â€œè¡Œæ’ä»–é”+MVCCâ€ ä¸€èµ·å®ç°çš„, ä¸ä»…å¯ä»¥ä¿è¯å¯é‡å¤è¯», è¿˜å¯ä»¥éƒ¨åˆ†é˜²æ­¢å¹»è¯»; ä¸ºä»€ä¹ˆæ˜¯éƒ¨åˆ†é˜²æ­¢å¹»è¯», è€Œä¸æ˜¯å®Œå…¨é˜²æ­¢? æ•ˆæœ: åœ¨å¦‚æœäº‹åŠ¡Båœ¨äº‹åŠ¡Aæ‰§è¡Œä¸­, insertäº†ä¸€æ¡æ•°æ®å¹¶æäº¤, äº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢, è™½ç„¶è¯»å–çš„æ˜¯undoä¸­çš„æ—§ç‰ˆæœ¬æ•°æ®(é˜²æ­¢äº†éƒ¨åˆ†å¹»è¯»), ä½†æ˜¯äº‹åŠ¡Aä¸­æ‰§è¡Œupdateæˆ–è€…deleteéƒ½æ˜¯å¯ä»¥æˆåŠŸçš„!! å› ä¸ºåœ¨innodbä¸­çš„æ“ä½œå¯ä»¥åˆ†ä¸ºå½“å‰è¯»(current read)å’Œå¿«ç…§è¯»(snapshot read): å¿«ç…§è¯» å’Œ å½“å‰è¯» å¯å‚è€ƒä¹‹å‰çš„åšæ–‡å¹»è¯»çš„å»¶ä¼¸ - å¿«ç…§è¯» (snapshot read) ä¸ å½“å‰è¯» (current read) å°ç»“ InnoDBæ‰€è°“çš„MVCC ä¸€èˆ¬æˆ‘ä»¬è®¤ä¸ºMVCCæœ‰ä¸‹é¢å‡ ä¸ªç‰¹ç‚¹ï¼š æ¯è¡Œæ•°æ®éƒ½å­˜åœ¨ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ¯æ¬¡æ•°æ®æ›´æ–°æ—¶éƒ½æ›´æ–°è¯¥ç‰ˆæœ¬ ä¿®æ”¹æ—¶Copyå‡ºå½“å‰ç‰ˆæœ¬, ç„¶åéšæ„ä¿®æ”¹ï¼Œå„ä¸ªäº‹åŠ¡ä¹‹é—´æ— å¹²æ‰° ä¿å­˜æ—¶æ¯”è¾ƒç‰ˆæœ¬å·ï¼Œå¦‚æœæˆåŠŸ(commit)ï¼Œåˆ™è¦†ç›–åŸè®°å½•, å¤±è´¥åˆ™æ”¾å¼ƒcopy(rollback) å°±æ˜¯æ¯è¡Œéƒ½æœ‰ç‰ˆæœ¬å·ï¼Œä¿å­˜æ—¶æ ¹æ®ç‰ˆæœ¬å·å†³å®šæ˜¯å¦æˆåŠŸï¼Œå¬èµ·æ¥å«æœ‰ä¹è§‚é”çš„å‘³é“, å› ä¸ºè¿™çœ‹èµ·æ¥æ­£æ˜¯ï¼Œåœ¨æäº¤çš„æ—¶å€™æ‰èƒ½çŸ¥é“åˆ°åº•èƒ½å¦æäº¤æˆåŠŸ è€ŒInnoDBå®ç°MVCCçš„æ–¹å¼æ˜¯: äº‹åŠ¡ä»¥æ’ä»–é”çš„å½¢å¼ä¿®æ”¹åŸå§‹æ•°æ® æŠŠä¿®æ”¹å‰çš„æ•°æ®å­˜æ”¾äºundo logï¼Œé€šè¿‡å›æ»šæŒ‡é’ˆä¸ä¸»æ•°æ®å…³è” ä¿®æ”¹æˆåŠŸï¼ˆcommitï¼‰å•¥éƒ½ä¸åšï¼Œå¤±è´¥åˆ™æ¢å¤undo logä¸­çš„æ•°æ®ï¼ˆrollbackï¼‰ äºŒè€…æœ€æœ¬è´¨çš„åŒºåˆ«æ˜¯: å½“ä¿®æ”¹æ•°æ®æ—¶æ˜¯å¦è¦æ’ä»–é”å®šï¼Œå¦‚æœé”å®šäº†è¿˜ç®—ä¸ç®—æ˜¯MVCCï¼Ÿ Innodbçš„å®ç°çœŸç®—ä¸ä¸ŠMVCC, å› ä¸ºå¹¶æ²¡æœ‰å®ç°æ ¸å¿ƒçš„å¤šç‰ˆæœ¬å…±å­˜, undo log ä¸­çš„å†…å®¹åªæ˜¯ä¸²è¡ŒåŒ–çš„ç»“æœ, è®°å½•äº†å¤šä¸ªäº‹åŠ¡çš„è¿‡ç¨‹, ä¸å±äºå¤šç‰ˆæœ¬å…±å­˜ã€‚ä½†ç†æƒ³çš„MVCCæ˜¯éš¾ä»¥å®ç°çš„, å½“äº‹åŠ¡ä»…ä¿®æ”¹ä¸€è¡Œè®°å½•ä½¿ç”¨ç†æƒ³çš„MVCCæ¨¡å¼æ˜¯æ²¡æœ‰é—®é¢˜çš„, å¯ä»¥é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·è¿›è¡Œå›æ»š, ä½†å½“äº‹åŠ¡å½±å“åˆ°å¤šè¡Œæ•°æ®æ—¶, ç†æƒ³çš„MVCCå°±æ— èƒ½ä¸ºåŠ›äº†ã€‚ æ¯”å¦‚, å¦‚æœäº‹åŠ¡Aæ‰§è¡Œç†æƒ³çš„MVCC, ä¿®æ”¹Row1æˆåŠŸ, è€Œä¿®æ”¹Row2å¤±è´¥, æ­¤æ—¶éœ€è¦å›æ»šRow1, ä½†å› ä¸ºRow1æ²¡æœ‰è¢«é”å®š, å…¶æ•°æ®å¯èƒ½åˆè¢«äº‹åŠ¡Bæ‰€ä¿®æ”¹, å¦‚æœæ­¤æ—¶å›æ»šRow1çš„å†…å®¹ï¼Œåˆ™ä¼šç ´åäº‹åŠ¡Bçš„ä¿®æ”¹ç»“æœï¼Œå¯¼è‡´äº‹åŠ¡Bè¿åACIDã€‚ è¿™ä¹Ÿæ­£æ˜¯æ‰€è°“çš„ ç¬¬ä¸€ç±»æ›´æ–°ä¸¢å¤± çš„æƒ…å†µã€‚ ä¹Ÿæ­£æ˜¯å› ä¸ºInnoDBä½¿ç”¨çš„MVCCä¸­ç»“åˆäº†æ’ä»–é”, ä¸æ˜¯çº¯çš„MVCC, æ‰€ä»¥ç¬¬ä¸€ç±»æ›´æ–°ä¸¢å¤±æ˜¯ä¸ä¼šå‡ºç°äº†, ä¸€èˆ¬è¯´æ›´æ–°ä¸¢å¤±éƒ½æ˜¯æŒ‡ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°ã€‚ MVCC é«˜å¹¶å‘ç‰¹ç‚¹å†™ä¸å½±å“è¯»ï¼Œè¯»ä¸å½±å“å†™ï¼Œå†™åªå½±å“å†™åªæœ‰å†™å†™ä¼šé˜»å¡!!! å‚è€ƒ å…³äºread viewåˆ›å»ºæ—¶æœº: http://www.sohu.com/a/194511597_610509 https://www.cnblogs.com/digdeep/p/4947694.html https://www.zhihu.com/question/265280455/answer/292022808 å…³äºæ¯”è¾ƒç®—æ³• low_limit_id é«˜æ°´ä½äº‹åŠ¡: https://github.com/zhangyachen/zhangyachen.github.io/issues/68 https://www.zhihu.com/question/66320138 https://www.zhihu.com/question/265280455/answer/292022808 å¤§å’–é—®ç­”: https://www.zhihu.com/inbox/4577674200 æ›´å¤šå¯ä»¥å‚è€ƒæ•°æ®åº“å†…æ ¸æœˆæŠ¥: https://yq.aliyun.com/articles/303200?spm=5176.100240.searchblog.9.271fd153pQ9FgV å®˜æ–¹æ–‡æ¡£","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"MVCC","slug":"MVCC","permalink":"http://blog.renyimin.com/tags/MVCC/"}]},{"title":"25. READ COMMITTED","slug":"mysql/2017-09-17-mysql-25","date":"2017-09-17T06:50:52.000Z","updated":"2018-03-07T09:19:39.000Z","comments":true,"path":"2017/09/17/mysql/2017-09-17-mysql-25/","link":"","permalink":"http://blog.renyimin.com/2017/09/17/mysql/2017-09-17-mysql-25/","excerpt":"","text":"å‰è¨€ READ COMMITTED éš”ç¦»çº§åˆ«å¯ä»¥è§£å†³é«˜å¹¶å‘åœºæ™¯ä¸‹, äº‹åŠ¡ è„è¯» çš„é—®é¢˜; ä¹Ÿå°±æ˜¯å¯ä»¥è®©äº‹åŠ¡åªèƒ½è¯»å…¶ä»–äº‹åŠ¡å·²å®Œæˆ(æäº¤/å›æ»š)çš„è½åœ°æ•°æ®; å¦‚æœè®©ä½ ç”¨ é” æ¥è®¾è®¡è¯¥éš”ç¦»çº§åˆ« ? å‡è®¾, åœ¨äº‹åŠ¡Aä¸­è¯»å–æ•°æ®å‰, äº‹åŠ¡Bå¯¹åŒä¸€æ•°æ®åšäº†ä¿®æ”¹å¹¶ä¸”è¿˜æ²¡æœ‰å®Œæˆ(commit/rollback), é‚£å¦‚ä½•è®©äº‹åŠ¡Aæ— æ³•è¯»å–äº‹åŠ¡Bä¸­ å°šæœªè½åœ°çš„è„æ•°æ® å‘¢? å½“äº‹åŠ¡Båœ¨å¯¹æ•°æ®åšå†™æ“ä½œçš„æ—¶å€™, ç»™æ•°æ®åŠ ä¸Šè¡Œçº§çš„æ’ä»–é”(X lock)(è¯»å–çš„æ—¶å€™ä¹Ÿåˆ«å¿˜äº†åŠ ä¸Šå…±äº«é”(S lock)), æ³¨æ„ä¸¤ç§é”éƒ½è¦ä½¿ç”¨; é‚£äº‹åŠ¡Aç”±äºåŠ ä¸ä¸Šå…±äº«é”/æ’ä»–é”, è‡ªç„¶åªèƒ½é˜»å¡ç­‰äº‹åŠ¡Aå®Œæˆåæ‰èƒ½è¯»å–/ä¿®æ”¹æ•°æ®äº† è¿™æ ·åšçš„è¯ç¡®å®å®ç°äº†æ•ˆæœ, ä¹Ÿå°±é¿å…äº†è„è¯», äº‹å®ä¸Š, ä¹Ÿè§£å†³å¯äº† ä¸å¯é‡å¤è¯»(å› ä¸ºä¸€æ—¦åŠ äº†å…±äº«é”, å…¶ä»–äº‹åŠ¡ä¹Ÿæ— æ³•åŠ æ’ä»–é”è¿›è¡Œä¿®æ”¹), ä½†é—®é¢˜æ˜¯è¿™æ˜¯ä¸€ç§å¾ˆä½æ•ˆçš„ä¼ ç»Ÿæ€è·¯, å› ä¸ºå¯¹äºå¤§éƒ¨åˆ†åº”ç”¨æ¥è¯´, è¯»æ“ä½œæ˜¯å¤šäºå†™æ“ä½œçš„, å½“å†™æ“ä½œåŠ é”æ—¶, é‚£ä¹ˆè¯»æ“ä½œå…¨éƒ¨è¢«é˜»å¡, è¿™æ ·åœ¨å¤§ç”¨æˆ·é‡é«˜å¹¶å‘çš„æƒ…å†µä¸‹, ä¼šç›´æ¥é™ä½æ•°æ®åº“çš„è¯»æ•ˆç‡ã€‚ æ‰€ä»¥, ä¸ºäº†æé«˜å¹¶å‘æ€§, MySQLæ˜¯è‡ªç„¶ä¸ä¼šç®€å•åœ°ä½¿ç”¨ä¼ ç»Ÿæ€è·¯(ç›´æ¥åŠ é”)æ¥è§£å†³çš„é—®é¢˜ æ³¨æ„: å¦‚æœåªæ˜¯ å†™æ“ä½œåŠ æ’ä»–é”çš„è¯ æ˜¯æ— æ³•é¿å…è„è¯»çš„; äº‹å®ä¸Š, MySQLæ˜¯ä½¿ç”¨ å†™æ“ä½œåŠ æ’ä»–é”(è¯»æ“ä½œä¸åŠ é”), ç»“åˆMVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ æ¥å®ç°è¯¥éš”ç¦»çº§åˆ«; æ–¹æ¡ˆMySQL åœ¨äº‹åŠ¡éš”ç¦»çº§åˆ«Read committed ã€Repeatable Readä¸‹ï¼ŒInnoDB å­˜å‚¨å¼•æ“é‡‡ç”¨ éé”å®š çš„ ä¸€è‡´æ€§è¯»ï¼ï¼å³è¯»å–æ•°æ®ä¸ç”¨åŠ é”ï¼Œè€Œæ˜¯é‡‡ç”¨çš„æ˜¯MVCCä¸­ä¸€è‡´æ€§éé”å®šè¯»æ¨¡å¼; ä»è€Œåšåˆ°: å†™ä¸å½±å“è¯»ï¼Œè¯»ä¸å½±å“å†™ï¼Œå†™åªå½±å“å†™, åªæœ‰å†™å†™ä¼šé˜»å¡!!! è¯»ä¸å½±å“å†™: å½“äº‹åŠ¡Aä¸­æ­£åœ¨æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œäº‹åŠ¡Bçš„å†™æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…å½“å‰äº‹åŠ¡Aä¸ŠSé”çš„é‡Šæ”¾(å› ä¸ºäº‹åŠ¡Aè¯»å–å‹æ ¹å°±æ²¡åŠ é”)ï¼Œè€Œæ˜¯ç›´æ¥å¯ä»¥å¯¹æ•°æ®åŠ Xé”è¿›è¡Œæ“ä½œã€‚ å†™ä¸å½±å“è¯»: å½“äº‹åŠ¡Aä¸­æ­£åœ¨æ‰§è¡Œå†™æ“ä½œæ—¶, è™½ç„¶å¯¹æ•°æ®åŠ äº†Xé”, ä½†æ˜¯äº‹åŠ¡Bçš„è¯»æ“ä½œä¸ä¼šå› æ­¤å»ç­‰å¾…å½“å‰äº‹åŠ¡è¡Œä¸ŠXé”çš„é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šå»è¯»å–å¿«ç…§æ•°æ® (RCå’ŒRRå› å¿«ç…§äº§ç”Ÿæ—¶æœºä¸åŒ, å¯¼è‡´äº†éš”ç¦»çº§åˆ«ä¸ä¸€æ ·, è¯»å–çš„è½åœ°æ•°æ®ä¹Ÿä¸ç›¸åŒ)ã€‚ æ‰€ä»¥æ€»ç»“æ¥çœ‹, READ UNCOMMITTED å’Œ REPEATABLE READ è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«éƒ½æ˜¯ä½¿ç”¨ å†™ç”¨æ’ä»–é” + è¯»ç”¨MVCC, åŒºåˆ«å¯ä»¥å‚è€ƒ MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"24. READ UNCOMMITTED æœªæäº¤è¯»","slug":"mysql/2017-09-17-mysql-24","date":"2017-09-17T06:40:04.000Z","updated":"2018-03-07T09:19:35.000Z","comments":true,"path":"2017/09/17/mysql/2017-09-17-mysql-24/","link":"","permalink":"http://blog.renyimin.com/2017/09/17/mysql/2017-09-17-mysql-24/","excerpt":"","text":"ç®€ä»‹ READ UNCOMMITTED éš”ç¦»çº§åˆ«ä¼šé€ æˆ è„è¯»(Dirty Read) ç°è±¡çš„å‡ºç°:ä¹Ÿå°±æ˜¯è¯´, äº‹åŠ¡ å¯ä»¥è¯»å– å…¶ä»–äº‹åŠ¡ æœªæäº¤çš„æ•°æ®(äº‹åŠ¡Aä¸­å¯¹æ•°æ®æ‰€åšçš„ä¿®æ”¹, å³ä½¿è¿˜æ²¡æœ‰è¢«æäº¤, å¯¹å…¶ä»–äº‹åŠ¡ä¹Ÿéƒ½æ˜¯å¯è§çš„); è¿™ä¸ªçº§åˆ«ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜, è€Œä¸”ä»æ€§èƒ½ä¸Šæ¥è¯´, READ COMMITTED å¹¶ä¸ä¼šæ¯”å…¶ä»–çš„çº§åˆ«å¥½å¤ªå¤š, å´ç¼ºä¹å…¶ä»–çº§åˆ«çš„å¾ˆå¤šå¥½å¤„, åœ¨å®é™…åº”ç”¨ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚ è™½ç„¶è¯¥éš”ç¦»çº§åˆ«å¾ˆå°‘ä½¿ç”¨, ä½†è¿˜æ˜¯æœ‰å¿…è¦äº†è§£ä¸€ä¸‹, å®ƒè¿™ä¸ªéš”ç¦»çº§åˆ«ç©¶ç«Ÿæ˜¯å¦‚ä½•è¿›è¡Œéš”ç¦»çš„, ç«Ÿè¿˜èƒ½å®¹è®¸å¾ˆå¤šé—®é¢˜çš„å­˜åœ¨? æµ‹è¯•å‡†å¤‡ç¯å¢ƒ å…ˆå‡†å¤‡ä¸€å¼ æµ‹è¯•è¡¨test_transaction: 1234567891011121314DROP TABLE IF EXISTS `test_transaction`;CREATE TABLE `test_transaction` ( `id` int(10) NOT NULL AUTO_INCREMENT COMMENT &apos;ä¸»é”®&apos;, `user_name` char(20) NOT NULL COMMENT &apos;å§“å&apos;, `age` tinyint(3) NOT NULL COMMENT &apos;å¹´é¾„&apos;, `gender` tinyint(1) NOT NULL COMMENT &apos;1:ç”·, 2:å¥³&apos;, `desctiption` text NOT NULL COMMENT &apos;ç®€ä»‹&apos;, PRIMARY KEY (`id`), KEY `name_age_gender_index` (`user_name`,`age`,`gender`)) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;INSERT INTO `test_transaction` VALUES (1, &apos;é‡‘åˆšç‹¼&apos;, 127, 1, &apos;æˆ‘æœ‰ä¸€åŒé“çˆª&apos;);INSERT INTO `test_transaction` VALUES (2, &apos;é’¢é“ä¾ &apos;, 120, 1, &apos;æˆ‘æœ‰ä¸€èº«é“ç”²&apos;);INSERT INTO `test_transaction` VALUES (3, &apos;ç»¿å·¨äºº&apos;, 0, 2, &apos;æˆ‘æœ‰ä¸€èº«è‚‰&apos;); å¦‚ä¸‹: 123456789mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 2 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ |+----+-----------+-----+--------+--------------------+3 rows in set (0.00 sec) è„è¯»æ•ˆæœ å…ˆæŸ¥çœ‹ å®¢æˆ·ç«¯1 äº‹åŠ¡çš„éš”ç¦»çº§åˆ«: SELECT @@SESSION.tx_isolation;; å¯ä»¥çœ‹åˆ°, InnoDBé»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º REPEATABLE READ 123456789mysql&gt; SELECT @@SESSION.tx_isolation;+------------------------+| @@SESSION.tx_isolation |+------------------------+| REPEATABLE-READ |+------------------------+1 row in set (0.00 sec) mysql&gt; é‡æ–°è®¾ç½® ä¼šè¯ç«¯1 çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º read uncommitted: SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; æ³¨æ„, æ­¤æ—¶åªæ˜¯å½“å‰ä¼šè¯ç«¯çš„éš”ç¦»çº§åˆ«è¢«æ”¹, å…¶ä½™ ä¼šè¯ç«¯ è¿˜æ˜¯é»˜è®¤çš„ REPEATABLE READ éš”ç¦»çº§åˆ« æ¥ä¸‹æ¥å°† ä¼šè¯ç«¯2 çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¹Ÿè®¾ç½®ä¸ºread uncommitted; å®¢æˆ·ç«¯1 å¼€å¯äº‹åŠ¡, å¹¶æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ â€˜è¯»å–æ•°æ®â€™, æ³¨æ„, å®¢æˆ·ç«¯1 çš„äº‹åŠ¡å¹¶æœªæäº¤ 1234567891011121314151617181920mysql&gt; SELECT @@SESSION.tx_isolation;+------------------------+| @@SESSION.tx_isolation |+------------------------+| READ-UNCOMMITTED |+------------------------+1 row in set (0.00 sec) mysql&gt; begin;Query OK, 0 rows affected (0.00 sec) mysql&gt; select * from test_transaction where id=2;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² |+----+-----------+-----+--------+--------------------+1 row in set (0.00 sec) mysql&gt; å®¢æˆ·ç«¯2 å¼€å¯äº‹åŠ¡, å¹¶ä¿®æ”¹å®¢æˆ·ç«¯1æŸ¥è¯¢çš„æ•°æ® 123456789101112131415mysql&gt; SELECT @@SESSION.tx_isolation;+------------------------+| @@SESSION.tx_isolation |+------------------------+| READ-UNCOMMITTED |+------------------------+1 row in set (0.00 sec) mysql&gt; begin;Query OK, 0 rows affected (0.00 sec) mysql&gt; update test_transaction set user_name=&apos;é’¢é“ä¾ -æ‰˜å°¼&apos; where id=2;Query OK, 1 row affected (0.00 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; æ­¤æ—¶å‘ç°, å®¢æˆ·ç«¯2 å¯ä»¥å¯¹ å®¢æˆ·ç«¯1 æ­£åœ¨è¯»å–çš„è®°å½•è¿›è¡Œä¿®æ”¹ æ³¨æ„, å®¢æˆ·ç«¯2æ­¤æ—¶çš„äº‹åŠ¡ä¹Ÿå¹¶æœªæäº¤ å›åˆ° å®¢æˆ·ç«¯1, å†æ¬¡æŸ¥è¯¢æ•°æ®, å‘ç°æ•°æ®å·²ç»å˜æˆäº†â€™é’¢é“ä¾ -æ‰˜å°¼â€™; ç„¶åå®¢æˆ·ç«¯2 rollback äº‹åŠ¡, å†åˆ°å®¢æˆ·ç«¯1ä¸­æŸ¥è¯¢, å‘ç°user_nameåˆå˜æˆäº†â€™é’¢é“ä¾ â€™, é‚£ä¹‹å‰è¯»åˆ° â€˜é’¢é“ä¾ -æ‰˜å°¼â€™ å°±æ˜¯è„æ•°æ®äº†, è¿™å°±æ˜¯ä¸€æ¬¡ è„è¯» å°ç»“: å¯ä»¥ç”¨ä¸€å¼ å›¾æ¥æ¼”ç¤ºæ•´ä¸ªå®éªŒè¿‡ç¨‹ åˆ†æè¯¥éš”ç¦»çº§åˆ«å¦‚ä½•åŠ é”é‡æ–°æ„é€ æµ‹è¯•æ¡ä»¶ å®¢æˆ·ç«¯1å¼€å¯äº‹åŠ¡, ç„¶åå¯¹æ•°æ®åšä¿®æ”¹ 1234567mysql&gt; begin;Query OK, 0 rows affected (0.00 sec) mysql&gt; update test_transaction set user_name=&apos;é’¢é“ä¾ -rymuscle&apos; where id=2;Query OK, 1 row affected (0.00 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; æ³¨æ„, å®¢æˆ·ç«¯1æ­¤æ—¶çš„äº‹åŠ¡å¹¶æœªæäº¤ å®¢æˆ·ç«¯2å¼€å¯äº‹åŠ¡, å¯¹ç›¸åŒçš„æ•°æ®è¡Œåšä¿®æ”¹ 12345mysql&gt; begin;Query OK, 0 rows affected (0.00 sec) mysql&gt; update test_transaction set user_name=&apos;é’¢é“ä¾ -rym&apos; where id=2;....é˜»å¡ç­‰å¾…äº† æœ€ç»ˆä¼šå¦‚ä¸‹: æ³¨æ„: åœ¨ä¸Šé¢çš„è¿‡ç¨‹, åœ¨å®¢æˆ·ç«¯2é˜»å¡é˜¶æ®µ, ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯æ¥åˆ†æ, å®¢æˆ·ç«¯2 åœ¨é”ç­‰å¾…çš„æƒ…å†µä¸‹çš„ åŠ é”æƒ…å†µ å’Œ äº‹åŠ¡çŠ¶æ€: æŸ¥çœ‹è¡¨çš„åŠ é”æƒ…å†µ: select * from information_schema.INNODB_LOCKS; äº‹åŠ¡çŠ¶æ€ select * from information_schema.INNODB_TRX; å°ç»“ æ‰€ä»¥: READ UNCOMMITTED éš”ç¦»çº§åˆ«ä¸‹, å†™æ“ä½œæ˜¯ä¼šåŠ é”çš„, è€Œä¸”æ˜¯Xæ’ä»–é”, ç›´åˆ°å®¢æˆ·ç«¯1äº‹åŠ¡å®Œæˆ, é”æ‰é‡Šæ”¾, å®¢æˆ·ç«¯2æ‰èƒ½è¿›è¡Œå†™æ“ä½œ æ¥ä¸‹æ¥ä½ è‚¯å®šä¼šçº³é—· â€œæ—¢ç„¶è¯¥éš”ç¦»çº§åˆ«ä¸‹äº‹åŠ¡åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™åŠ çš„æ˜¯xé”, å¹¶ä¸”æ˜¯äº‹åŠ¡å®Œæˆåæ‰é‡Šæ”¾, é‚£ä¸€æ¬¡åœºæµ‹è¯•ä¸­, å®¢æˆ·ç«¯2 åœ¨äº‹åŠ¡ä¸­ä¿®æ”¹å®Œæ•°æ®ä¹‹å, ä¸ºä»€ä¹ˆè¿˜æ²¡æäº¤äº‹åŠ¡, ä¹Ÿå°±æ˜¯xé”è¿˜åœ¨, ç»“æœå®¢æˆ·ç«¯1å´èƒ½è¯»å–åˆ°å®¢æˆ·ç«¯2ä¿®æ”¹çš„æ•°æ®â€ï¼Ÿ è¿™å®Œå…¨ä¸ç¬¦åˆæ’ä»–é”çš„ç‰¹æ€§å•Š(æ’ä»–é”ä¼šé˜»å¡é™¤å½“å‰äº‹åŠ¡ä¹‹å¤–çš„å…¶ä»–äº‹åŠ¡çš„è¯»,å†™æ“ä½œ) å…¶å®ç½‘ä¸Šå·²ç»æœ‰äººåœ¨sqlserverçš„å®˜ç½‘ä¸Šæ‰¾åˆ°äº†ç›¸å…³èµ„æ–™: 12345ansactions running at the READ UNCOMMITTED level do not issue shared locks to prevent other transactions from modifying data read by the current transaction. READ UNCOMMITTED transactions are also not blocked by exclusive locks that would prevent the current transaction from reading rows that have been modified but not committed by other transactions. When this option is set, it is possible to read uncommitted modifications, which are called dirty reads. Values in the data can be changed and rows can appear or disappear in the data set before the end of the transaction. This option has the same effect as setting NOLOCK on all tables in all SELECT statements in a transaction. This is the least restrictive of the isolation levels. ç¿»è¯‘ç¿»è¯‘, åœ¨æ€è€ƒæ€è€ƒ, å¤§æ¦‚è¯´çš„æ˜¯åœ¨ READ UNCOMMITTED çº§åˆ«è¿è¡Œçš„äº‹åŠ¡ä¸ä¼šå‘å‡ºå…±äº«é”: ä¹Ÿå°±æ˜¯äº‹åŠ¡Aåœ¨è¯»å–æ•°æ®æ—¶, ä»€ä¹ˆé”éƒ½ä¸åŠ ; è¿™æ ·çš„è¯, äº‹åŠ¡Bå°±å¯ä»¥å¯¹åŒæ ·çš„æ•°æ®è¿›è¡Œä¿®æ”¹(åŒæ—¶ä¼šåŠ ä¸Šæ’ä»–é”);è€Œäº‹åŠ¡Aè¦è¯»å–äº‹åŠ¡Bæœªæäº¤çš„ä¿®æ”¹, ä¹Ÿä¸ä¼šè¢«äº‹åŠ¡Bæ‰€åŠ çš„æ’ä»–é”é˜»æ­¢, å› ä¸ºæ’ä»–é”ä¼šé˜»æ­¢å…¶ä»–äº‹åŠ¡å†å¯¹å…¶é”å®šçš„æ•°æ®åŠ è¯»å†™é”, ä½†æ˜¯å¯ç¬‘çš„æ˜¯, äº‹åŠ¡åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹å»è¯»æ•°æ®çš„è¯æ ¹æœ¬ä»€ä¹ˆé”éƒ½ä¸åŠ , è¿™å°±è®©æ’ä»–é”æ— æ³•æ’å®ƒäº†; æ‰€ä»¥å¯ä»¥å¾—å‡º: READ UNCOMMITTEDéš”ç¦»çº§åˆ«ä¸‹, è¯»ä¸ä¼šåŠ ä»»ä½•é”ã€‚è€Œå†™ä¼šåŠ æ’ä»–é”ï¼Œå¹¶åˆ°äº‹åŠ¡ç»“æŸä¹‹åé‡Šæ”¾ã€‚(è¯»å†™ä¸é˜»å¡, å†™å†™é˜»å¡ (ä½†ä¼šè¯»åˆ°è„æ•°æ®))","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"23. äº‹åŠ¡éš”ç¦»çº§åˆ«(READ UNCOMMITTED) ä¸ é”","slug":"mysql/2017-09-17-mysql-23","date":"2017-09-17T06:20:52.000Z","updated":"2018-03-07T09:19:29.000Z","comments":true,"path":"2017/09/17/mysql/2017-09-17-mysql-23/","link":"","permalink":"http://blog.renyimin.com/2017/09/17/mysql/2017-09-17-mysql-23/","excerpt":"","text":"å‰è¨€ ä¹‹å‰å‡ ç¯‡åšæ–‡å·²ç»ä»‹ç»äº† Mysqläº‹åŠ¡, é«˜å¹¶å‘ä¸‹äº‹åŠ¡å°†ä¼šé¢å¯¹çš„é—®é¢˜ åŠ è§£å†³æ–¹æ¡ˆ;ä»ä¹‹å‰çš„åšæ–‡ä¸­å¯ä»¥äº†è§£åˆ°: MySQLåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹, ä¸»è¦é‡‡ç”¨ äº‹åŠ¡éš”ç¦»æ€§ä¸­çš„4ç§éš”ç¦»çº§åˆ« åŠ MVCCæœºåˆ¶ æ¥è§£å†³äº‹åŠ¡å¯èƒ½ä¼šé¢ä¸´çš„ä¸€äº›é—®é¢˜; æ¥ä¸‹æ¥ä¸»è¦æ¢è®¨ä¸€ä¸‹, åœ¨MySQLä¸­, äº‹åŠ¡çš„å„éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°çš„, å¦‚ä½•è§£å†³é—®é¢˜çš„, éš”ç¦»çº§åˆ«å’Œé”ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»? éš”ç¦»çº§åˆ« å’Œ é”çš„å…³ç³» å¯¹äºäº‹åŠ¡ä¸­å„éš”ç¦»çº§åˆ«ä¸é”çš„å…³ç³», å…ˆçœ‹ä¸‹ä¸€å‚è€ƒç¾å›¢æŠ€æœ¯åšå®¢ä¸­å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ä»‹ç»: åœ¨æ•°æ®åº“æ“ä½œä¸­ï¼Œä¸ºäº†æœ‰æ•ˆä¿è¯å¹¶å‘è¯»å–æ•°æ®çš„æ­£ç¡®æ€§ï¼Œæå‡ºçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ã€‚æˆ‘ä»¬çš„æ•°æ®åº“é”ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ„å»ºè¿™äº›éš”ç¦»çº§åˆ«å­˜åœ¨çš„ã€‚ ä»ä¸Šé¢çš„åšæ–‡å¤§æ¦‚å¯ä»¥äº†è§£åˆ°: äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ ¸å¿ƒå°±æ˜¯é”, å„éš”ç¦»çº§åˆ«ä½¿ç”¨äº†ä¸åŒçš„åŠ é”ç­–ç•¥ã€‚ æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å„éš”ç¦»çº§åˆ«æ˜¯å¦‚ä½•å®ç°åŠå¦‚ä½•è§£å†³é«˜å¹¶å‘äº‹åŠ¡é—®é¢˜çš„ã€‚ READ UNCOMMITTED æœªæäº¤è¯»READ UNCOMMITTED æäº¤è¯»MVCC å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶REPEATABLE READ å¯é‡å¤è¯»å‚è€ƒèµ„æ–™:-ã€Šé«˜æ€§èƒ½MySQLã€‹ MySQLå®˜æ–¹æ–‡æ¡£ æ…•è¯¾mark_rockåŒå­¦æ‰‹è®° ç¾å›¢æŠ€æœ¯åšå®¢","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"22. å¹»è¯»çš„å»¶ä¼¸ - å¿«ç…§è¯» (snapshot read) ä¸ å½“å‰è¯» (current read)","slug":"mysql/2017-09-16-mysql-22","date":"2017-09-16T06:10:07.000Z","updated":"2018-03-07T09:19:20.000Z","comments":true,"path":"2017/09/16/mysql/2017-09-16-mysql-22/","link":"","permalink":"http://blog.renyimin.com/2017/09/16/mysql/2017-09-16-mysql-22/","excerpt":"","text":"å‰è¨€RR + MVCC è™½ç„¶è§£å†³äº† å¹»è¯» é—®é¢˜, ä½†ä¸¥æ ¼æ¥è¯´, åªæ˜¯éƒ¨åˆ†è§£å†³å¹»è¯»é—®é¢˜ æ¼”ç¤º æ‰“å¼€ å®¢æˆ·ç«¯1 æŸ¥çœ‹éš”ç¦»çº§åˆ«åŠåˆå§‹æ•°æ® 12345678910111213141516171819mysql&gt; SELECT @@SESSION.tx_isolation;+------------------------+| @@SESSION.tx_isolation |+------------------------+| REPEATABLE-READ |+------------------------+1 row in set (0.00 sec) mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 1 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ |+----+-----------+-----+--------+--------------------+3 rows in set (0.00 sec) mysql&gt; æ‰“å¼€ å®¢æˆ·ç«¯2 æŸ¥çœ‹éš”ç¦»çº§åˆ«åŠåˆå§‹æ•°æ® 12345678910111213141516171819mysql&gt; SELECT @@SESSION.tx_isolation;+------------------------+| @@SESSION.tx_isolation |+------------------------+| REPEATABLE-READ |+------------------------+1 row in set (0.00 sec) mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 1 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ |+----+-----------+-----+--------+--------------------+3 rows in set (0.00 sec) mysql&gt; åœ¨å®¢æˆ·ç«¯2ä¸­ å¼€å¯äº‹åŠ¡, ç„¶åæŸ¥è¯¢æ•°æ® 1234567891011121314mysql&gt; begin;Query OK, 0 rows affected (0.00 sec) mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 1 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ |+----+-----------+-----+--------+--------------------+3 rows in set (0.00 sec) mysql&gt; åœ¨å®¢æˆ·ç«¯1ä¸­æ’å…¥ä¸€æ¡idä¸º4çš„æ–°æ•°æ® (æœªå¼€å¯äº‹åŠ¡, æ‰€ä»¥ä¼šè‡ªåŠ¨æäº¤) 1234567891011121314mysql&gt; insert into test_transaction (`id`,`user_name`,`age`,`gender`,`desctiption`) values (4, &apos;æ­»ä¾&apos;, 18, 0, &apos;A bad boy&apos;);Query OK, 1 row affected (0.00 sec)mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 1 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ || 4 | æ­»ä¾ | 18 | 0 | A bad boy |+----+-----------+-----+--------+--------------------+4 rows in set (0.00 sec) mysql&gt; åœ¨ å®¢æˆ·ç«¯2 ä¹‹å‰å¼€å¯çš„äº‹åŠ¡ä¸­å†æ¬¡æŸ¥è¯¢æ•°æ®, å‘ç°æ•°æ®æ²¡æœ‰å˜åŒ–(è¡¨ç¤ºå¯ä»¥é‡å¤è¯», å¹¶ä¸”å…‹æœäº†selectå¹»è¯»)!! 12345678910111213141516171819202122232425262728mysql&gt; begin;Query OK, 0 rows affected (0.00 sec) mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 1 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ |+----+-----------+-----+--------+--------------------+3 rows in set (0.00 sec)mysql&gt; select * from test_transaction;+----+-----------+-----+--------+--------------------+| id | user_name | age | gender | desctiption |+----+-----------+-----+--------+--------------------+| 1 | é‡‘åˆšç‹¼ | 127 | 1 | æˆ‘æœ‰ä¸€åŒé“çˆª || 2 | é’¢é“ä¾  | 120 | 1 | æˆ‘æœ‰ä¸€èº«é“ç”² || 3 | ç»¿å·¨äºº | 0 | 2 | æˆ‘æœ‰ä¸€èº«è‚‰ |+----+-----------+-----+--------+--------------------+3 rows in set (0.00 sec)mysql&gt; insert into test_transaction (`id`,`user_name`,`age`,`gender`,`desctiption`) values (4, &apos;æ­»ä¾&apos;, 18, 0, &apos;A bad boy&apos;);1062 - Duplicate entry &apos;4&apos; for key &apos;PRIMARY&apos; //( åé¢ä¼šçœ‹åˆ°: å…¶å®æ˜¯å› ä¸ºinsertæ˜¯å½“å‰è¯»)mysql&gt; //å¹¶ä¸”, æ­¤æ—¶`update/delete`ä¹Ÿæ˜¯å¯ä»¥æ“ä½œè¿™æ¡åœ¨äº‹åŠ¡ä¸­çœ‹ä¸åˆ°çš„è®°å½•çš„! //( åé¢ä¼šçœ‹åˆ°: updateï¼Œdeleteä¹Ÿéƒ½æ˜¯å½“å‰è¯») é—®é¢˜çš„å‡ºç° è™½ç„¶å¤šæ¬¡selectè¯»å–,å‘ç°å·²ç»å…‹æœäº†å¹»è¯»é—®é¢˜ ä½†å½“ åœ¨å®¢æˆ·ç«¯2äº‹åŠ¡ä¸­ insertæ’å…¥ä¸€æ¡idä¸º4çš„æ–°æ•°æ®, å‘ç°æç¤ºæ•°æ®å·²ç»å­˜åœ¨, é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆé—®é¢˜å‘¢? å¯ä»¥å‚è€ƒMySQLå®˜æ–¹æ–‡æ¡£ â€“ ä¸€è‡´æ€§éé˜»å¡è¯» The snapshot of the database state applies to SELECT statements within a transaction, not necessarily to DML statements. If you insert or modify some rows and then commit that transaction, a DELETE or UPDATE statement issued from another concurrent REPEATABLE READ transaction could affect those just-committed rows, even though the session could not query them. If a transaction does update or delete rows committed by a different transaction, those changes do become visible to the current transaction.ä¸ªäººè®¤ä¸ºåº”è¯¥ç¿»è¯‘ä¸º: æ•°æ®åº“çŠ¶æ€çš„å¿«ç…§é€‚ç”¨äºäº‹åŠ¡ä¸­çš„SELECTè¯­å¥, è€Œä¸ä¸€å®šé€‚ç”¨äºæ‰€æœ‰DMLè¯­å¥ã€‚ å¦‚æœæ‚¨æ’å…¥æˆ–ä¿®æ”¹æŸäº›è¡Œ, ç„¶åæäº¤è¯¥äº‹åŠ¡, åˆ™ä»å¦ä¸€ä¸ªå¹¶å‘REPEATABLE READäº‹åŠ¡å‘å‡ºçš„DELETEæˆ–UPDATEè¯­å¥å°±å¯èƒ½ä¼šå½±å“é‚£äº›åˆšåˆšæäº¤çš„è¡Œ, å³ä½¿è¯¥äº‹åŠ¡æ— æ³•æŸ¥è¯¢åˆ°å®ƒä»¬ã€‚ å¦‚æœäº‹åŠ¡æ›´æ–°æˆ–åˆ é™¤ç”±ä¸åŒäº‹åŠ¡æäº¤çš„è¡Œ, åˆ™é‚£äº›æ›´æ”¹å¯¹å½“å‰äº‹åŠ¡å°±å˜å¾—å¯è§ã€‚ ä½†æ˜¯å¦‚æœäº‹åŠ¡selectç”±ä¸åŒäº‹åŠ¡æäº¤çš„è¡Œ, åˆ™é‚£äº›æ›´æ”¹å¯¹å½“å‰äº‹åŠ¡å°±ä¸å¯è§(æ­¤æ—¶ç®—æ˜¯rrçš„å¯é‡å¤è¯»); å°ç»“ ä¹Ÿå°±æ˜¯RRéš”ç¦»çº§åˆ«, åœ¨åŒä¸€äº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–çš„è¯, åªæ˜¯å¯¹ select å…‹æœäº†å¹»è¯»; ä½†æ˜¯å¯¹å…¶ä»–DMLå¹¶æ²¡æœ‰åšåˆ°(å…¶ä»–DMLèƒ½å¯Ÿè§‰åˆ°æ•°æ®è¢«åˆ«çš„äº‹åŠ¡æäº¤è¿‡äº†)! è¿™å°±å¼•å‡ºäº†æ–°çš„ä¸¤ä¸ªæ¦‚å¿µ å½“å‰è¯» å’Œ å¿«ç…§è¯»é€šå¸¸åœ¨RC,RRéš”ç¦»çº§åˆ«ä¸‹, ä¸åšç‰¹æ®Šå¤„ç†, ä½¿ç”¨çš„selectéƒ½æ˜¯å¿«ç…§è¯», å…¶ä»–dmlå°±ç®—æ˜¯å½“å‰è¯»; (MVCCå†™é˜»å¡å†™) å…¶å®, MVCCå¹¶å‘æ§åˆ¶ä¸­çš„è¯»æ“ä½œåˆ†ä¸ºä¸¤ç±»: å¿«ç…§è¯» (snapshot read) ä¸ å½“å‰è¯» (current read); å‚è€ƒ åœ¨RRçº§åˆ«ä¸‹ å¿«ç…§è¯» æ˜¯é€šè¿‡MVVC(å¤šç‰ˆæœ¬æ§åˆ¶)å’Œundo logæ¥å®ç°çš„ è€Œå½“å‰è¯» æ˜¯éœ€è¦åŠ  record lock(è®°å½•é”) å’Œ gap lock(é—´éš™é”) æ¥å®ç°çš„, å¦‚æœéœ€è¦å®æ—¶æ˜¾ç¤ºæ•°æ®ï¼Œè¿˜æ˜¯éœ€è¦é€šè¿‡åŠ é”æ¥å®ç°, è¿™ä¸ªæ—¶å€™ä¼šä½¿ç”¨next-keyæŠ€æœ¯æ¥å®ç°ã€‚ å¿«ç…§è¯», è¯»å–ä¸“é—¨çš„å¿«ç…§(å¯¹äºRCï¼Œå¿«ç…§(ReadView)ä¼šåœ¨æ¯ä¸ªè¯­å¥ä¸­åˆ›å»º, å¯¹äºRR, å¿«ç…§æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„), å¿«ç…§è¯»çš„æ“ä½œå¦‚ä¸‹: 1ç®€å•çš„selectæ“ä½œ (ä¸åŒ…æ‹¬: select ... lock in share mode, select ... for update) å½“å‰è¯», è¯»å–æœ€æ–°ç‰ˆæœ¬çš„è®°å½•, æ²¡æœ‰å¿«ç…§, åœ¨InnoDBä¸­, å½“å‰è¯»å–æ ¹æœ¬ä¸ä¼šåˆ›å»ºä»»ä½•å¿«ç…§ã€‚å½“å‰è¯»çš„æ“ä½œå¦‚ä¸‹, å¯ä»¥çœ‹åˆ° insert, update, deleteéƒ½æ˜¯å¿«ç…§è¯», æ‰€ä»¥è¿™å‡ ä¸ªæ“ä½œä¼šå¯Ÿè§‰åˆ°å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®åšçš„æ›´æ”¹, è€Œselectå¯Ÿè§‰ä¸åˆ°: 12345select ... lock in share modeselect ... for updateinsertupdatedelete æœ€å, ä½¿ç”¨éš”ç¦»æ€§çš„æœ€é«˜éš”ç¦»çº§åˆ«SERIALIZABLEä¹Ÿå¯ä»¥è§£å†³å¹»è¯», ä½†è¯¥éš”ç¦»çº§åˆ«åœ¨å®é™…ä¸­å¾ˆå°‘ä½¿ç”¨!","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"21. MySQLé«˜å¹¶å‘äº‹åŠ¡é—®é¢˜ åŠ è§£å†³æ–¹æ¡ˆ","slug":"mysql/2017-09-16-mysql-21","date":"2017-09-16T05:40:53.000Z","updated":"2018-04-07T10:39:44.000Z","comments":true,"path":"2017/09/16/mysql/2017-09-16-mysql-21/","link":"","permalink":"http://blog.renyimin.com/2017/09/16/mysql/2017-09-16-mysql-21/","excerpt":"","text":"å‰è¨€ä¸Šä¸€ç¯‡MySQLäº‹åŠ¡ç®€ä»‹ç®€å•ä»‹ç»äº†MySQLäº‹åŠ¡çš„ç›¸å…³æ¦‚å¿µåŠç‰¹æ€§; ä½†åœ¨å®é™…åœºæ™¯ä¸­, å¯èƒ½ç»å¸¸ä¼šé¢å¯¹ä¸€äº›é«˜å¹¶å‘åº”ç”¨, æ­¤æ—¶, ç®€å•äº†è§£äº‹åŠ¡æ¦‚å¿µå’Œç‰¹æ€§å°±ä¸è¶³ä»¥åº”å¯¹é—®é¢˜äº†; é«˜å¹¶å‘çš„äº‹åŠ¡é—®é¢˜åœ¨å¹¶å‘é‡æ¯”è¾ƒå¤§çš„æ—¶å€™, å¾ˆå®¹æ˜“å‡ºç° å¤šä¸ªäº‹åŠ¡åŒæ—¶è¿›è¡Œ çš„æƒ…å†µã€‚ å‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡æ­£åœ¨åŒæ—¶è¿›è¡Œ, å€¼å¾—æ³¨æ„çš„æ˜¯: å®ƒä»¬ä¸¤è€…ä¹‹é—´æ˜¯äº’ç›¸ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨çš„, å„è‡ªéƒ½å¯¹è‡ªèº«æ‰€å¤„çš„ç¯å¢ƒè¿‡åˆ†ä¹è§‚, ä»è€Œå¹¶æ²¡æœ‰å¯¹è‡ªå·±æ‰€æ“ä½œçš„æ•°æ®åšä¸€å®šçš„ä¿æŠ¤å¤„ç†, æ‰€ä»¥æœ€ç»ˆå¯¼è‡´äº†ä¸€äº›é—®é¢˜çš„å‡ºç°; è„è¯» Mysqlä¸­, å¦‚æœ äº‹åŠ¡A è¯»å–äº†å¦ä¸€ä¸ªå¹¶è¡Œ äº‹åŠ¡B æœªæœ€ç»ˆæäº¤çš„å†™æ•°æ®, é‚£äº‹åŠ¡Açš„è¿™æ¬¡è¯»å–æ“ä½œå°±å« è„è¯»ã€‚ å› ä¸º â€˜äº‹åŠ¡Aâ€™ æ­¤æ—¶è¯»å–åˆ°çš„æ˜¯ å°šæœªè¢«æŒä¹…åŒ– çš„æ•°æ® (äº‹åŠ¡Bä¸­ä¿®æ”¹çš„æ•°æ®è¿˜ä¸å…·å¤‡äº‹åŠ¡çš„æŒä¹…æ€§ç‰¹æ€§) äº‹åŠ¡Aæ­¤æ—¶è¯»å–çš„æ•°æ®ä¹Ÿå« è„æ•°æ®äº‹åŠ¡B æœ€ç»ˆå¯èƒ½ä¼šå› ä¸ºå†…éƒ¨å…¶ä»–åç»­æ“ä½œçš„å¤±è´¥æˆ–è€…ç³»ç»Ÿåç»­çªç„¶å´©æºƒç­‰åŸå› , å¯¼è‡´äº‹åŠ¡Bæœ€ç»ˆæ•´ä½“æäº¤å¤±è´¥, ä»è€Œå¯¼è‡´äº‹åŠ¡Aè¯»å–çš„æ•°æ®è¢«å›æ»š;é‚£ä¹ˆæœ€ç»ˆ äº‹åŠ¡A æ‹¿åˆ°çš„è‡ªç„¶å°±æ˜¯è„çš„æ•°æ®äº†, å› ä¸º äº‹åŠ¡A æ‹¿åˆ°çš„æ•°æ®å·²ç»å’Œæ•°æ®è¡¨ä¸­æŒä¹…åŒ–çš„çœŸå®æ•°æ®ä¸ä¸€è‡´äº†ã€‚ å›¾ç¤º: è§£å†³æ–¹æ¡ˆ : RC+ åœ¨MySQLä¸­, äº‹åŠ¡å·²ç»ç”¨è‡ªèº«ç‰¹æ€§ éš”ç¦»æ€§ çš„ â€“ READ COMMITEDæˆ–ä»¥ä¸Šéš”ç¦»çº§åˆ« è§£å†³äº†è¿™ä¸ªé—®é¢˜; READ COMMITED çº§åˆ«ä¿è¯äº†: åœ¨äº‹åŠ¡ä¸­, æŸæ¡è¯­å¥æ‰§è¡Œå‰, å·²ç»è¢«å…¶ä»–äº‹åŠ¡æäº¤çš„æ•°æ®, å¯¹è¯¥è¯­å¥éƒ½æ˜¯å¯è§çš„ã€‚ ä¸å¯é‡å¤è¯» ç°åœ¨, ä¸Šé¢çš„ è„è¯»é—®é¢˜ å·²ç»è¢«è§£å†³äº†, é‚£å°±æ„å‘³ç€äº‹åŠ¡ä¸­æ¯æ¬¡è¯»å–åˆ°çš„æ•°æ®éƒ½æ˜¯ æŒä¹…æ€§ çš„æ•°æ®(è¢«åˆ«çš„äº‹åŠ¡æœ€ç»ˆ æäº¤/å›æ»š çš„è½åœ°æ•°æ®)ã€‚ ä½†è„è¯»é—®é¢˜çš„è§£å†³, ä¹Ÿä»…ä»…åªèƒ½ä¿è¯ä½ åœ¨äº‹åŠ¡ä¸­æ¯æ¬¡è¯»åˆ°çš„æ•°æ®éƒ½æ˜¯æŒä¹…æ€§çš„æ•°æ®è€Œå·²ã€‚ è¯•æƒ³, å¦‚æœåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ®, æ­£å¥½åœ¨ä¸¤æ¬¡è¯»å–ä¹‹é—´, å¦å¤–ä¸€ä¸ªäº‹åŠ¡å·²ç»å®Œæˆäº†å¯¹è¯¥æ•°æ®çš„ä¿®æ”¹å¹¶æäº¤, é‚£é—®é¢˜å°±æ¥äº†: ä¸¤æ¬¡è¯»å–çš„ç»“æœä¸ä¸€æ ·äº†; é‚£ä¹ˆ, å¤šæ¬¡è¯»å–æ•°æ®ä¸ä¸€è‡´, æœ‰ä»€ä¹ˆå±å®³å‘¢? é¦–å…ˆ, ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸ºä»€ä¹ˆè¦å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®, ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦è¿™ä¹ˆåš? 1234æŸ¥è¯¢ä½™é¢: 100ç»™åˆ«äººæ±‡æ¬¾: 20è®°å½•æ—¥å¿—: ....å±•ç¤ºä½™é¢(ä½ å¯ä»¥ç›´æ¥è®¡ç®—ç„¶åè¿”å›80, ä½†å¦‚æœä½ æ˜¯æŸ¥è¯¢çš„è¯, å°±åº”è¯¥ä¿è¯ä½ æŸ¥åˆ°çš„æ˜¯80, è€Œä¸å—å…¶ä»–äº‹åŠ¡å¹²æ‰°) è§£å†³æ–¹æ¡ˆ : RR+ åœ¨MySQLä¸­, äº‹åŠ¡å·²ç»ç”¨è‡ªèº«ç‰¹æ€§ éš”ç¦»æ€§ çš„ â€“ REPEATABLE READæˆ–ä»¥ä¸Šéš”ç¦»çº§åˆ« è§£å†³äº†è¿™ä¸ªé—®é¢˜; REPEATABLE READ çº§åˆ«ä¿è¯äº†:1.åœ¨äº‹åŠ¡ä¸­, æŸæ¡è¯­å¥æ‰§è¡Œå‰, å·²ç»è¢«å…¶ä»–äº‹åŠ¡ æäº¤/å›æ»š çš„è½åœ°æ•°æ®, å¯¹è¯¥è¯­å¥éƒ½æ˜¯å¯è§çš„;2.åœ¨äº‹åŠ¡ä¸­, å¤šæ¬¡è¯»å–åŒä¸€ä¸ªæ•°æ® (åœ¨ä¸¤æ¬¡è¯»å–æ“ä½œä¹‹é—´, æ— è®ºæ•°æ®è¢« æäº¤/å›æ»š å¤šå°‘æ¬¡(å³æ— è®ºè½åœ°è¿‡å¤šå°‘é), æ¯æ¬¡è¯»å–çš„ç»“æœéƒ½åº”è¯¥æ˜¯ä¸€æ ·çš„; å¹»è¯» (åŒºåˆ†ä¸å¯é‡å¤è¯»å–)1.ä¹‹å‰ç»å¸¸ææ·· ä¸å¯é‡å¤è¯» å’Œ å¹»è¯» è¿™ä¸¤ä¸ªæ¦‚å¿µï¼ˆè¿™ä¸¤è€…ç¡®å®éå¸¸ç›¸ä¼¼ï¼‰ ä½† ä¸å¯é‡å¤è¯» ä¸»è¦æ˜¯è¯´å¤šæ¬¡è¯»å–åŒä¸€æ¡è®°å½•, å‘ç°è¯¥è®°å½•ä¸­æŸäº›åˆ—å€¼è¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¿‡; è€Œ å¹»è¯» ä¸»è¦æ˜¯è¯´å¤šæ¬¡è¯»å–ä¸€ä¸ªèŒƒå›´å†…çš„è®°å½•(åŒ…æ‹¬ç›´æ¥æŸ¥è¯¢æ‰€æœ‰è®°å½•ç»“æœæˆ–è€…åšèšåˆç»Ÿè®¡), å‘ç°ç»“æœä¸ä¸€è‡´(æ¯”å¦‚å‘ç°å¢åŠ /å‡å°‘äº†ä¸€æ¡è®°å½•)ã€‚(å¯ä»¥å‚è€ƒ MySQLå®˜æ–¹æ–‡æ¡£å¯¹ Phantom Rows çš„ä»‹ç» ) 2.è§£å†³æ–¹æ¡ˆ: RR + MVCC å…¶å®å¯¹äº å¹»è¯», åœ¨Mysqlçš„InnoDBå­˜å‚¨å¼•æ“ä¸­, äº‹åŠ¡é»˜è®¤çš„ RR çº§åˆ«å·²ç»é€šè¿‡ MVCCæœºåˆ¶ å¸®æˆ‘ä»¬è§£å†³äº†(å¹¶éå®Œå…¨è§£å†³), æ‰€ä»¥è¯¥çº§åˆ«ä¸‹, ä½ ä¹Ÿæ¨¡æ‹Ÿä¸å‡ºå¹»è¯»çš„åœºæ™¯; é€€å›åˆ° RC éš”ç¦»çº§åˆ«çš„è¯, ä½ åˆå®¹æ˜“æŠŠ å¹»è¯» å’Œ ä¸å¯é‡å¤è¯» ææ··æ·†, æ‰€ä»¥è¿™å¯èƒ½å°±æ˜¯æ¯”è¾ƒå¤´ç—›çš„ç‚¹å§! å¦å¤–å¯ä»¥å‚è€ƒã€Šé«˜æ€§èƒ½MySQLã€‹å¯¹ RR éš”ç¦»çº§åˆ«çš„æè¿° ç†è®ºä¸Š, RRçº§åˆ«æ˜¯æ— æ³•è§£å†³å¹»è¯»çš„é—®é¢˜, ä½†æ˜¯ç”±äºInnoDBå¼•æ“çš„RRçº§åˆ«è¿˜ä½¿ç”¨äº†MVCC, æ‰€ä»¥ä¹Ÿå°±é¿å…äº†å¹»è¯»çš„å‡ºç°! 3.æƒ³äº†è§£æ›´å¤š, å¯ä»¥å‚è€ƒä¸‹ä¸€ç¯‡å¹»è¯»çš„å»¶ä¼¸ æ›´æ–°ä¸¢å¤± æœ€åèŠä¸€ä¸‹ é«˜å¹¶å‘äº‹åŠ¡ çš„å¦ä¸€ä¸ªé—®é¢˜: ä¸¢å¤±æ›´æ–°é—®é¢˜, è¯¥é—®é¢˜å’Œä¹‹å‰å‡ ä¸ªé—®é¢˜éœ€è¦åŒºåˆ†å¼€, å› ä¸ºè§£å†³æ–¹æ¡ˆä¸æ˜¯ä¸€ç±»! ç¬¬ä¸€ç±»ä¸¢å¤±æ›´æ–°: Aäº‹åŠ¡æ’¤é”€æ—¶, æŠŠå·²ç»æäº¤çš„Bäº‹åŠ¡çš„æ›´æ–°æ•°æ®è¦†ç›–äº†ä¸è¿‡è¿™ç§æƒ…å†µåœ¨Mysqlä¸­ä¸ä¼šå‡ºç°, å› ä¸ºå³ä½¿æ˜¯InnoDBäº‹åŠ¡çš„æœ€ä½éš”ç¦»çº§åˆ«(READ UNCOMMITED): ä¼šåœ¨äº‹åŠ¡(å‡è®¾äº‹åŠ¡A)ä¸­å¯¹å†™æ•°æ®è®¾ç½®xé”, å…¶ä»–äº‹åŠ¡(å‡è®¾äº‹åŠ¡B)æƒ³å¯¹ç›¸åŒæ•°æ®åšä¿®æ”¹, è¦ç­‰åˆ°äº‹åŠ¡Aæ•°æ®ä¿®æ”¹å®Œæ¯•å¹¶æäº¤(é‡Šæ”¾äº†xé”æ‰è¡Œ); ç”±äºæœ€ä½éš”ç¦»çº§åˆ«ä¼šå‡ºç°è„è¯», æ‰€ä»¥å³ä½¿äº‹åŠ¡Båœ¨äº‹åŠ¡Aæäº¤ä¹‹å, å¯¹æ•°æ®åšäº†ä¿®æ”¹, rollbackå›æ»šåˆ°çš„ä¹Ÿæ˜¯äº‹åŠ¡Aæœ€åçš„æäº¤æ•°æ®, æ‰€ä»¥ä¸ä¼šè¦†ç›–; (è€Œæ›´é«˜çš„RC,RRéš”ç¦»çº§åˆ«ä½¿ç”¨äº†MVCCæŠ€æœ¯, äº‹åŠ¡Bå›æ»šçš„è¯, ä¹Ÿæ˜¯å›æ»šåˆ°äº‹åŠ¡Aæœ€åçš„é‚£æ¬¡æäº¤) ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°: Aäº‹åŠ¡ è¦†ç›– Bäº‹åŠ¡ å·²ç»æäº¤çš„æ•°æ®ï¼Œé€ æˆBäº‹åŠ¡æ‰€åšæ“ä½œä¸¢å¤± ä¸‹å›¾å¯ä»¥çœ‹åˆ°, æç¬‘çš„æ˜¯: ä¹Ÿæ­£æ˜¯å› ä¸ºRRéš”ç¦»çº§åˆ«æ‰€ä¿è¯çš„å¯é‡å¤è¯», ç»™æ­¤ç±»é—®é¢˜çš„å‡ºç°æä¾›äº†åŸºç¡€æ¡ä»¶; è¿™ç§ä¸¢å¤±æ›´æ–°, æ— æ³•ä¾é å‰ä¸‰ç§éš”ç¦»çº§åˆ«æ¥è§£å†³, åªèƒ½æ‰‹åŠ¨ä½¿ç”¨ ä¹è§‚é”(åœ¨ä¿®æ”¹æ—¶, whereåˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºä½ è¯»å–æ—¶çš„æ•°æ®; æˆ–è€…æä¾›æ•°æ®ç‰ˆæœ¬å­—æ®µæ¥æ§åˆ¶), æ‚²è§‚é” æ¥è§£å†³ã€‚ æ³¨æ„æ³¨æ„: æœ€é«˜éš”ç¦»çº§åˆ«Serializableåœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­å¹¶ä¸è¢«é‡‡ç”¨ (å¹¶ä¸”, å®ƒä¹Ÿæ— æ³•è§£å†³æ›´æ–°ä¸¢å¤±çš„é—®é¢˜) å› ä¸ºè™½ç„¶serializeå°†äº‹åŠ¡ä¸²è¡ŒåŒ–äº†, ä½†å¯¹äºäº‹åŠ¡, åªè¦å¼€å¯äº‹åŠ¡çš„æ¡ä»¶éƒ½æ»¡è¶³, äº‹åŠ¡A,B,Cå‡è®¾å¹¶è¡Œåˆ°æ¥, ä»–ä»¬éƒ½ä¼šé¡ºåˆ©ä¾æ¬¡å¼€å¯äº‹åŠ¡(åªä¸è¿‡ä»¥å‰æ˜¯å¹¶è¡Œå¼€å¯)); ä½†æ˜¯å¼€å¯ä¹‹å, è™½ç„¶è¯»å†™éƒ½ä¼šäº’ç›¸é˜»å¡(ç»è¿‡æµ‹è¯•), ä½†æ˜¯è¿™åªæ˜¯ä»£è¡¨äº‹åŠ¡ä¹‹é—´éœ€è¦ç­‰å¾…, ä½†æœ€ç»ˆéƒ½ä¼šæ‰§è¡Œ, æ‰€ä»¥è¿˜ä¼šé€ æˆè¶…å–!; æ‰€ä»¥è¿˜æ˜¯ä¼šå‡ºç° æ›´æ–°ä¸¢å¤± çš„é«˜å¹¶å‘äº‹åŠ¡é—®é¢˜: å¯ä»¥å‚è€ƒ: https://segmentfault.com/q/1010000010353164/a-1020000010353684 å‚è€ƒèµ„æ–™: æ·˜å®æ•°æ®åº“å†…æ ¸6æœˆæŠ¥ ç¾å›¢æŠ€æœ¯åšå®¢ MySQLå®˜æ–¹æ–‡æ¡£ ã€Šé«˜æ€§èƒ½MySQLã€‹","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"20. MySQLäº‹åŠ¡ç®€ä»‹","slug":"mysql/2017-09-16-mysql-20","date":"2017-09-16T03:01:07.000Z","updated":"2018-03-08T13:36:24.000Z","comments":true,"path":"2017/09/16/mysql/2017-09-16-mysql-20/","link":"","permalink":"http://blog.renyimin.com/2017/09/16/mysql/2017-09-16-mysql-20/","excerpt":"","text":"äº‹åŠ¡çš„æ¦‚å¿µ äº‹åŠ¡ï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ª ç‹¬ç«‹çš„ å·¥ä½œå•å…ƒ, åœ¨è¿™ä¸ª ç‹¬ç«‹çš„ å·¥ä½œå•å…ƒä¸­, å¯ä»¥æœ‰ ä¸€ç»„ æ“ä½œ; æ”¾åœ¨è¿™ä¸ªç‹¬ç«‹å·¥ä½œå•å…ƒä¸­çš„ä¸€ç»„æ“ä½œ, è¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸ, è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ã€‚ ä»ç„¶é€šè¿‡æœ€ç»å…¸çš„é“¶è¡Œè½¬è´¦åº”ç”¨æ¥è§£é‡Šä¸€ä¸‹: å‡è®¾æœ‰ä¸¤ä¸ªè§’è‰² â€˜Iron Manâ€™(ä½™é¢500), â€˜Wolverineâ€™(ä½™é¢15), ç°åœ¨ â€˜Iron Manâ€™ é€šè¿‡è¯¥é“¶è¡Œåº”ç”¨ç»™ â€˜Wolverineâ€™ è½¬è´¦100å…ƒ, é‚£ä¹ˆæœ¬æ¬¡è½¬è´¦æ“ä½œè‡³å°‘éœ€è¦ä¸‰ä¸ªæ­¥éª¤ 123æ£€æŸ¥`Iron Man`ä½™é¢`&gt;=100`å…ƒä»`Iron Man`ä½™é¢ä¸­`-100`å…ƒç»™`Wolverine`ä½™é¢`+100`å…ƒ æ³¨æ„: ä¸Šé¢çš„ä¸‰ä¸ªæ­¥æ“ä½œï¼Œå…¶å®å°±éœ€è¦æ‰“åŒ…åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­, è¿™æ ·å°±å¯ä»¥ä¿è¯ä¸€ç»„æ“ä½œå¯ä»¥ä½œä¸ºä¸€ä¸ª ç‹¬ç«‹çš„å·¥ä½œå•å…ƒ æ¥æ‰§è¡Œã€‚å¹¶ä¸”åœ¨ ç‹¬ç«‹å·¥ä½œå•å…ƒ(å³äº‹åŠ¡) ä¸­çš„è¿™ä¸‰ä¸ªæ“ä½œ, åªè¦æœ‰ä»»ä½•ä¸€ä¸ªæ“ä½œå¤±è´¥, åˆ™äº‹åŠ¡æ•´ä½“å°±åº”è¯¥æ˜¯å¤±è´¥çš„, é‚£å°±å¿…é¡»å›æ»šæ‰€æœ‰å·²ç»æ‰§è¡Œäº†çš„æ­¥éª¤ã€‚ å‡è®¾ç¬¬äºŒæ­¥æ“ä½œæˆåŠŸ, ä½†æ˜¯ç¬¬ä¸‰æ­¥æ“ä½œå¤±è´¥, é‚£ä¹ˆæ•´ä¸ªäº‹åŠ¡å°±åº”è¯¥æ˜¯å¤±è´¥çš„, å°±å¿…é¡»å°†ç¬¬äºŒæ­¥çš„æ“ä½œå›æ»šã€‚(å…¶å®è¿™é‡Œä¹Ÿä½“ç°äº†äº‹åŠ¡æœ€åŸºæœ¬çš„ä¸€ä¸ªç‰¹æ€§: ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§) äº‹åŠ¡çš„ACIDç‰¹æ€§ä¸€ä¸ªè¿è¡Œè‰¯å¥½çš„äº‹åŠ¡å¤„ç†ç³»ç»Ÿå¿…é¡»å…·å¤‡ä¸‹é¢è¿™äº›æ ‡å‡†ç‰¹æ€§(é«˜å¹¶å‘åœºæ™¯ç¦»ä¸å¼€äº‹åŠ¡çš„è¿™å‡ ä¸ªæ ‡å‡†ç‰¹æ€§) Atomicity åŸå­æ€§ä¸€ä¸ªäº‹åŠ¡å¿…é¡»è¢«è§†ä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æœ€å°å·¥ä½œå•å…ƒ, æ•´ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æäº¤æˆåŠŸ, è¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚å¯¹äºä¸€ä¸ªäº‹åŠ¡æ¥è¯´, ä¸èƒ½åªæˆåŠŸæ‰§è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†æ“ä½œ, è¿™å°±æ˜¯äº‹åŠ¡çš„åŸå­æ€§ã€‚ Consistency ä¸€è‡´æ€§ä½ å¤§æ¦‚å¯ä»¥è¿™æ ·æ¥ç†è§£: è™½ç„¶æ•°æ®è¡¨ä¸­çš„æ•°æ®å¯èƒ½ä¸€ç›´åœ¨å˜åŒ–, ä½†æ˜¯äº‹åŠ¡çš„ä¸€è‡´æ€§ç‰¹æ€§æ€»æ˜¯èƒ½å¤Ÿä¿è¯ æ•°æ®åº“æ€»æ˜¯ä»ä¸€ä¸ªæ•°æ®ä¸€è‡´æ€§çš„çŠ¶æ€ è½¬æ¢åˆ° å¦ä¸€ä¸ªæ•°æ®ä¸€è‡´æ€§çš„çŠ¶æ€; æ¯”å¦‚ä¹‹å‰è½¬è´¦çš„ä¾‹å­:è½¬è´¦å‰çš„æ•°æ®ä¸€è‡´æ€§çŠ¶æ€æ˜¯: â€˜Iron Manâ€™(ä½™é¢500), â€˜Wolverineâ€™(ä½™é¢15)è½¬è´¦æˆåŠŸåçš„æ•°æ®ä¸€è‡´æ€§çŠ¶æ€æ˜¯: â€˜Iron Manâ€™(ä½™é¢400), â€˜Wolverineâ€™(ä½™é¢115)è½¬è´¦å¦‚æœå¤±è´¥çš„è¯, æ•°æ®çš„ä¸€è‡´æ€§çš„çŠ¶æ€åº”è¯¥å›æ»šåˆ°è½¬è´¦å‰çš„çŠ¶æ€: â€˜Iron Manâ€™(ä½™é¢500), â€˜Wolverineâ€™(ä½™é¢15) Isolation éš”ç¦»æ€§ é€šå¸¸æ¥è¯´, ä¸€ä¸ªäº‹åŠ¡æ‰€åšçš„ä¿®æ”¹åœ¨æœ€ç»ˆæäº¤ä»¥å‰, å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„;æ¯”å¦‚åœ¨ä¹‹å‰çš„è½¬è´¦ä¾‹å­ä¸­, åœ¨æ‰§è¡Œå®Œæˆæœ€åä¸€æ­¥(ç¬¬ä¸‰æ­¥), äº‹åŠ¡è¿˜æ²¡æ¥å¾—åŠæœ€ç»ˆæäº¤ä¹‹å‰, æ­¤æ—¶æœ‰å¦ä¸€ä¸ªç¨‹åºå»è¯»å–Aè´¦æˆ·çš„ä½™é¢, é‚£ä¹ˆè¿™ä¸ªç¨‹åºè¯»åˆ°çš„åº”è¯¥æ˜¯æ²¡æœ‰è¢«å‡100çš„ä½™é¢æ‰å¯¹ ä¸Šé¢ä¸ºä»€ä¹ˆè¯´ é€šå¸¸æ¥è¯´, éš¾é“è¿˜æœ‰å…¶ä»–æƒ…å†µ ?åé¢ä¼šè¯¦ç»†è®¨è®ºäº‹åŠ¡éš”ç¦»æ€§ çš„å››ä¸ª éš”ç¦»çº§åˆ«, åˆ°æ—¶å€™å°±çŸ¥é“è¿™é‡Œä¸ºä»€ä¹ˆè¯´é€šå¸¸æ¥è¯´å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„; (ä½†ç¡®å®ä¹Ÿè¿˜æœ‰ç‰¹ä¾‹, æ¯”å¦‚æœ€ä½éš”ç¦»çº§åˆ« READ UNCOMMITTED, å¯¹å…¶ä»–äº‹åŠ¡çš„å¯è§å°±é€ æˆäº† è„è¯»é—®é¢˜ çš„å‡ºç°) äº‹åŠ¡æœ‰å››ç§éš”ç¦»çº§åˆ«(ä»ä½åˆ°é«˜) READ UNCOMMITTED (æœªæäº¤è¯») READ COMMITTED (æäº¤è¯») REPEATABLE READ (å¯é‡å¤è¯») SERIALIZABLE (å¯ä¸²è¡ŒåŒ–) æ³¨æ„: å®ƒä»ç„¶æ— æ³•è§£å†³æ›´æ–°ä¸¢å¤±çš„é—®é¢˜(å¯ä»¥å‚è€ƒ) Durability æŒä¹…æ€§ä¸€æ—¦äº‹åŠ¡è¢«æœ€ç»ˆæäº¤å, åœ¨è¿™ä¸ªç‹¬ç«‹å•å…ƒä¸­çš„æ‰€æœ‰æ“ä½œæ‰€åšçš„ä¿®æ”¹å°†ä¼š æ°¸ä¹… ä¿å­˜åˆ°æ•°æ®åº“ä¸­; (æ‰€è°“æ°¸ä¹…å¯ä»¥ç†è§£ä¸ºè¢«äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®æ˜¯çœŸæ­£å­˜æ”¾åˆ°äº†è¡¨ä¸­, è€Œä¸æ˜¯å­˜æ”¾åœ¨äº†è¯¸å¦‚ä¸´æ—¶è¡¨ä¹‹ç±»çš„åœ°æ–¹);","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"},{"name":"äº‹åŠ¡","slug":"äº‹åŠ¡","permalink":"http://blog.renyimin.com/tags/äº‹åŠ¡/"}]},{"title":"12. MySQLå¤‡ä»½ä¸æ¢å¤","slug":"mysql/2017-08-23-mysql-12","date":"2017-08-23T10:51:28.000Z","updated":"2018-03-18T07:29:49.000Z","comments":true,"path":"2017/08/23/mysql/2017-08-23-mysql-12/","link":"","permalink":"http://blog.renyimin.com/2017/08/23/mysql/2017-08-23-mysql-12/","excerpt":"","text":"## ##","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"}]},{"title":"Git","slug":"2017-08-21-Git","date":"2017-08-21T02:07:12.000Z","updated":"2018-03-19T11:16:31.000Z","comments":true,"path":"2017/08/21/2017-08-21-Git/","link":"","permalink":"http://blog.renyimin.com/2017/08/21/2017-08-21-Git/","excerpt":"","text":"æš‚æ—¶æ²¡è¿ç§»äº‘ç¬”è®°, å¯ä»¥ç‚¹å‡»æ­¤å¤„è¿›è¡Œé˜…è¯», ç»å¸¸ä¼šæ›´æ–°é‡å»ºç¬”è®° git rebase ä¸ git merge: http://gitbook.liuhui998.com/4_2.html","categories":[{"name":"Git","slug":"Git","permalink":"http://blog.renyimin.com/categories/Git/"}],"tags":[{"name":"Git","slug":"Git","permalink":"http://blog.renyimin.com/tags/Git/"}]},{"title":"05. å¤åˆ¶","slug":"mysql/2017-08-18-mysql-05","date":"2017-08-18T10:51:28.000Z","updated":"2018-05-06T03:58:57.000Z","comments":true,"path":"2017/08/18/mysql/2017-08-18-mysql-05/","link":"","permalink":"http://blog.renyimin.com/2017/08/18/mysql/2017-08-18-mysql-05/","excerpt":"","text":"æ¦‚è¿° MySQLå†…å»ºçš„å¤åˆ¶åŠŸèƒ½æ˜¯æ„å»ºåŸºäºMySQLçš„å¤§è§„æ¨¡ã€é«˜æ€§èƒ½åº”ç”¨çš„åŸºç¡€, è¿™ç±»åº”ç”¨ä½¿ç”¨æ‰€è°“çš„æ°´å¹³æ‰©å±•çš„æ¶æ„ã€‚ å¯ä»¥é€šè¿‡ä¸ºæœåŠ¡å™¨é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªå¤‡åº“çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®åŒæ­¥, å¤åˆ¶åŠŸèƒ½ä¸ä»…æœ‰åˆ©äºæ„å»ºé«˜æ€§èƒ½çš„åº”ç”¨, åŒæ—¶ä¹Ÿæ˜¯é«˜å¯ç”¨ã€å¯æ‰©å±•æ€§ã€ç¾éš¾æ¢å¤ã€å¤‡ä»½ä»¥åŠæ•°æ®ä»“åº“ç­‰å·¥ä½œçš„åŸºç¡€ã€‚ å¤åˆ¶è§£å†³çš„åŸºæœ¬é—®é¢˜æ˜¯è®©ä¸€å°æœåŠ¡å™¨çš„æ•°æ®ä¸å…¶ä»–æœåŠ¡å™¨çš„æ•°æ®ä¿æŒåŒæ­¥ã€‚ä¸€å°ä¸»åº“çš„æ•°æ®å¯ä»¥åŒæ­¥åˆ°å¤šå°å¤‡åº“ä¸Š, å¤‡åº“æœ¬èº«ä¹Ÿå¯ä»¥è¢«é…ç½®æˆå¦å¤–ä¸€å°æœåŠ¡å™¨çš„ä¸»åº“ã€‚ä¸»åº“å’Œå¤‡åº“ä¹‹é—´å¯ä»¥æœ‰å¤šç§ä¸åŒçš„ç»„åˆæ–¹å¼ã€‚ MySQLç‰ˆæœ¬å¯¹ä¸»ä»å¤åˆ¶çš„å½±å“: æ–°ç‰ˆæœ¬æœåŠ¡å™¨å¯ä»¥ä½œä¸ºè€ç‰ˆæœ¬æœåŠ¡å™¨çš„å¤‡åº“, ä½†æ˜¯è€ç‰ˆæœ¬æœåŠ¡å™¨ä½œä¸ºæ–°ç‰ˆæœ¬æœåŠ¡å™¨çš„å¤‡åº“é€šå¸¸æ˜¯ä¸å¯è¡Œçš„, å› ä¸ºè€ç‰ˆæœ¬å¯èƒ½æ— æ³•è§£ææ–°ç‰ˆæœ¬æ‰€é‡‡ç”¨çš„æ–°ç‰¹æ€§æˆ–è¯­æ³•; å¦å¤–, æ‰€ä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ä¹Ÿå¯èƒ½ä¸ç›¸åŒ; å°ç‰ˆæœ¬å‡çº§é€šå¸¸æ˜¯å…¼å®¹çš„; å¼€é”€ å¤åˆ¶é€šå¸¸ä¸ä¼šå¢åŠ ä¸»åº“çš„å¼€é”€, ä¸»è¦æ˜¯å¯ç”¨äºŒè¿›åˆ¶å¸¦æ¥çš„å¼€é”€, ä½†å‡ºäºå¯¹å¤‡ä»½æˆ–åŠæ—¶ä»å´©æºƒä¸­æ¢å¤çš„ç›®çš„, è¿™ç‚¹å¼€é”€ä¹Ÿæ˜¯å¿…è¦çš„; æ¯ä¸ªå¤‡åº“ä¹Ÿä¼šå¯¹ä¸»åº“å¢åŠ ä¸€äº›è´Ÿè½½(ä¾‹å¦‚ç½‘ç»œI/Oå¼€é”€), å°¤å…¶å½“å¤‡åº“è¯·æ±‚ä»ä¸»åº“è¯»å–æ—§çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶æ—¶, å¯èƒ½ä¼šé€ æˆæ›´é«˜çš„I/Oå¼€é”€; å¦å¤–, é”ç«äº‰ä¹Ÿå¯èƒ½é˜»ç¢äº‹åŠ¡çš„æäº¤; æœ€å, å¦‚æœæ˜¯ä»ä¸€ä¸ªé«˜ååé‡çš„ä¸»åº“ä¸Šå¤åˆ¶åˆ°å¤šä¸ªå¤‡åº“, å”¤é†’å¤šä¸ªå¤åˆ¶çº¿ç¨‹å‘é€äº‹ä»¶çš„å¼€é”€å°†ä¼šç´¯åŠ ; å¤åˆ¶è§£å†³çš„é—®é¢˜ æ•°æ®åˆ†å¸ƒ: å¯ä»¥åœ¨ä¸åŒçš„åœ°ç†ä½ç½®æ¥åˆ†å¸ƒæ•°æ®å¤‡ä»½; è´Ÿè½½å‡è¡¡: é€šè¿‡MySQLå¤åˆ¶å¯ä»¥å°†è¯»æ“ä½œåˆ†å¸ƒåˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Š, å®ç°å¯¹è¯»å¯†é›†å‹åº”ç”¨çš„ä¼˜åŒ–, å¹¶ä¸”å®ç°å¾ˆæ–¹ä¾¿, é€šè¿‡ç®€å•çš„ä»£ç ä¿®æ”¹å°±èƒ½å®ç°åŸºæœ¬çš„è´Ÿè½½å‡è¡¡, å¤‡ä»½: å¯¹äºå¤‡ä»½æ¥è¯´, å¤åˆ¶æ˜¯ä¸€é¡¹å¾ˆæœ‰æ„ä¹‰çš„æŠ€æœ¯è¡¥å……; é«˜å¯ç”¨æ€§å’Œæ•…éšœåˆ‡æ¢: å¤åˆ¶èƒ½å¤Ÿå¸®åŠ©åº”ç”¨ç¨‹åºé¿å…MySQLå•ç‚¹å¤±è´¥, ä¸€ä¸ªåŒ…å«å¤åˆ¶çš„è®¾è®¡è‰¯å¥½çš„æ•…éšœåˆ‡æ¢ç³»ç»Ÿèƒ½å¤Ÿæ˜¾è‘—åœ°ç¼©çŸ­å®•æœºæ—¶é—´; MySQLå‡çº§æµ‹è¯•: è¿™ç§åšæ³•æ¯”è¾ƒæ™®é, ä½¿ç”¨ä¸€ä¸ªæ›´é«˜ç‰ˆæœ¬çš„MySQLä½œä¸ºå¤‡åº“, ä¿è¯åœ¨å‡çº§å…¨éƒ¨å®ä¾‹å‰, æŸ¥è¯¢èƒ½å¤Ÿåœ¨å¤‡åº“æŒ‰ç…§é¢„æœŸæ‰§è¡Œ; å¤åˆ¶åŸç†æ¦‚è¿° ç®€å•æ¥è¯´, MySQLçš„å¤åˆ¶æœ‰å¦‚ä¸‹ä¸‰ä¸ªæ­¥éª¤ åœ¨ä¸»åº“ä¸ŠæŠŠæ•°æ®æ›´æ”¹è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—(Binary Log)ä¸­(è¿™äº›è®°å½•è¢«ç§°ä¸ºäºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶) å¤‡åº“å°†ä¸»åº“ä¸Šçš„æ—¥å¿—å¤åˆ¶åˆ°è‡ªå·±çš„ä¸­ç»§æ—¥å¿—(Relay Log)ä¸­ å¤‡åº“è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶, å°†å…¶é‡æ”¾åˆ°å¤‡åº“æ•°æ®ä¹‹ä¸Š é«˜æ€§èƒ½MySQLä¸­ç”¨ä¸‹å›¾æè¿°äº†ä¸Šé¢ä¸‰æ­¥ äºŒè¿›åˆ¶æ—¥å¿—è®°å½•æ ¼å¼ äº‹å®ä¸Š, MySQLæ”¯æŒä¸¤ç§å¤åˆ¶æ–¹å¼: åŸºäºè¡Œçš„å¤åˆ¶ å’Œ åŸºäºè¯­å¥çš„å¤åˆ¶; è¿™ä¸¤ç§å¤åˆ¶æ–¹å¼éƒ½æ˜¯é€šè¿‡åœ¨ä¸»åº“ä¸Šè®°å½•äºŒè¿›åˆ¶æ—¥å¿—ã€åœ¨å¤‡åº“é‡æ”¾æ—¥å¿—çš„æ–¹å¼æ¥å®ç°å¼‚æ­¥çš„æ•°æ®å¤åˆ¶(è¿™ä¹Ÿå°±æ„å‘³ç€, åœ¨åŒä¸€æ—¶é—´ç‚¹, å¤‡åº“ä¸Šçš„æ•°æ®å¯èƒ½ä¸ä¸»åº“å­˜åœ¨ä¸ä¸€è‡´, å¹¶ä¸”æ— æ³•ä¿è¯ä¸»å¤‡ä¹‹é—´çš„å»¶è¿Ÿ, ä¸€äº›å¤§çš„è¯­å¥å¯èƒ½å¯¼è‡´å¤‡åº“äº§ç”Ÿå‡ ç§’,å‡ åˆ†é’Ÿç”šè‡³å‡ ä¸ªå°æ—¶çš„å»¶è¿Ÿ) è¿™ä¸¤ç§æ–¹å¼ä¸»è¦æ˜¯æŒ‡åœ¨ä¸»åº“åœ¨è®°å½•äºŒè¿›åˆ¶æ—¥å¿—æ—¶æ‰€é‡‡ç”¨çš„æ—¥å¿—æ ¼å¼(Binary Logging Formats), å…¶å®æœ‰ STATEMENT, ROW, MIXED ä¸‰ç§é…ç½®; åŸºäºè¯­å¥çš„æ—¥å¿—è®°å½•: æ—©åœ¨MySQL3.23ç‰ˆæœ¬ä¸­å°±å­˜åœ¨; å¯ä»¥é€šè¿‡ä½¿ç”¨ --binlog-format = STATEMENT å¯åŠ¨æœåŠ¡å™¨æ¥ä½¿ç”¨æ­¤æ ¼å¼; åŸºäºè¡Œçš„æ—¥å¿—è®°å½•: åœ¨5.1ç‰ˆæœ¬ä¸­æ‰è¢«åŠ è¿›æ¥(åœ¨5.0ä¹‹å‰çš„ç‰ˆæœ¬ä¸­æ˜¯åªæ”¯æŒåŸºäºè¯­å¥çš„å¤åˆ¶); å¯ä»¥é€šè¿‡ä»¥ --binlog-format = ROW å¯åŠ¨å®ƒæ¥ä½¿æœåŠ¡å™¨ä½¿ç”¨åŸºäºè¡Œçš„æ—¥å¿—è®°å½•; åŸºäºæ··åˆæ—¥å¿—è®°å½•: å¯¹äºæ··åˆæ—¥å¿—è®°å½•, é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨åŸºäºè¯­å¥çš„æ—¥å¿—è®°å½•, ä½†åœ¨æŸäº›æƒ…å†µä¸‹, æ—¥å¿—è®°å½•æ¨¡å¼ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºåŸºäºè¡Œçš„; å½“ç„¶, æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨--binlog-format = MIXEDé€‰é¡¹å¯åŠ¨mysqldæ¥æ˜¾å¼ä½¿ç”¨æ··åˆæ—¥å¿—è®°å½•; ä¼˜ç¼ºç‚¹æœªå®Œå¾…ç»­~~ ä¸‰ä¸ªçº¿ç¨‹ MySQLä½¿ç”¨3ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œå¤åˆ¶åŠŸèƒ½(å…¶ä¸­1ä¸ªåœ¨ä¸»æœåŠ¡å™¨ä¸Š, å¦å¤–ä¸¤ä¸ªåœ¨ä»æœåŠ¡å™¨ä¸Š); å½“ä»æœåŠ¡å™¨å‘å‡ºSTART SLAVEæ—¶, ä»æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªI/Oçº¿ç¨‹, ä»¥è¿æ¥ä¸»æœåŠ¡å™¨å¹¶è®©å®ƒå‘é€è®°å½•åœ¨å…¶äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„è¯­å¥; ä¸»æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªbinlog dumpçº¿ç¨‹, å°†äºŒè¿›åˆ¶æ—¥å¿—ä¸­çš„å†…å®¹å‘é€åˆ°ä»æœåŠ¡å™¨; ä»æœåŠ¡å™¨I/Oçº¿ç¨‹è¯»å–ä¸»æœåŠ¡å™¨Binlog dumpçº¿ç¨‹å‘é€çš„å†…å®¹, å¹¶å°†è¯¥æ•°æ®æ‹·è´åˆ°ä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ä¸­; ç¬¬3ä¸ªçº¿ç¨‹æ˜¯ä»æœåŠ¡å™¨çš„SQLçº¿ç¨‹, æ˜¯ä»æœåŠ¡å™¨åˆ›å»ºç”¨äºè¯»å–ä¸­ç»§æ—¥å¿—å¹¶æ‰§è¡Œæ—¥å¿—ä¸­åŒ…å«çš„æ›´æ–°; é—®é¢˜?æœªå®Œå¾…ç»­~~ é…ç½®å¤åˆ¶ masteræœåŠ¡å™¨ä¸Šè¿›è¡Œsqlå†™æ“ä½œçš„æ—¶å€™, æ˜¯ä¼šå¼•èµ·ç£ç›˜å˜åŒ–çš„; æ‰€ä»¥slaveæœåŠ¡å™¨è¦æƒ³å’Œmasterä¸Šçš„æ•°æ®ä¿æŒä¸€è‡´, å¯ä»¥æœ‰ä¸¤ç§åŠæ³•: slaveæŒ‰ç…§masteræœåŠ¡å™¨ä¸Šæ¯æ¬¡çš„sqlå†™è¯­å¥æ¥æ‰§è¡Œä¸€é; slaveæŒ‰ç…§masteræœåŠ¡å™¨ç£ç›˜ä¸Šçš„å˜åŒ–æ¥åšä¸€æ¬¡å˜åŒ– ; ä¸»æœåŠ¡å™¨masterä¸Šçš„å†™æ“ä½œéƒ½ä¼šè¢«è®°å½•åˆ°binlogäºŒè¿›åˆ¶æ—¥å¿—ä¸­, ä»æœåŠ¡å™¨slaveå»è¯»ä¸»æœåŠ¡å™¨çš„binlogäºŒè¿›åˆ¶æ—¥å¿—, å½¢æˆè‡ªå·±çš„relayä¸­ç»§æ—¥å¿—, ç„¶åæ‰§è¡Œä¸€é ; æ‰€ä»¥ä¸»ä»é…ç½®éœ€è¦åšåˆ° ä¸»æœåŠ¡å™¨è¦é…ç½®binlogäºŒè¿›åˆ¶ ä»æœåŠ¡å™¨è¦é…ç½®relaylog(ä¸­ç»§æ—¥å¿—) masterè¦æˆäºˆslaveè´¦å·: ä»æœåŠ¡å™¨å¦‚ä½•æœ‰æƒè¯»å–ä¸»æœåŠ¡å™¨çš„ binlog (binlogéå¸¸æ•æ„Ÿ, ä¸å¯èƒ½è®©è°å»éšä¾¿è¯») ä»æœåŠ¡å™¨ç”¨è´¦å·è¿æ¥master ä»æœåŠ¡å™¨ä¸€å£°ä»¤ä¸‹å¼€å¯åŒæ­¥åŠŸèƒ½ start slave æ³¨æ„: ä¸€èˆ¬ä¼šåœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªsqlæœåŠ¡å™¨ä¸­åŠ ä¸€ä¸ªserver-idæ¥åšå”¯ä¸€æ ‡è¯† ; é…ç½®å¯åŠ¨ä¸»ä» ä¸»æœåŠ¡å™¨é…ç½® 1234#ä¸»ä»å¤åˆ¶é…ç½®server-id=4 #æœåŠ¡å™¨èµ·ä¸€ä¸ªå”¯ä¸€çš„idä½œä¸ºæ ‡è¯†log-bin=mysql-bin #å£°æ˜äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶åbinlog-format= #äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ mixed,row,statement ä¸»æœåŠ¡å™¨çš„ binlogäºŒè¿›åˆ¶æ—¥å¿— æœ‰ä¸‰ç§è®°å½•æ–¹å¼ mixed, row, statement ; statement: äºŒè¿›åˆ¶è®°å½•æ‰§è¡Œè¯­å¥, å¦‚ updateâ€¦.. row: è®°å½•çš„æ˜¯ç£ç›˜çš„å˜åŒ– å¦‚ä½•é€‰æ‹© binlogäºŒè¿›åˆ¶æ—¥å¿— è®°å½•æ–¹å¼? update salary=salary+100; // è¯­å¥çŸ­, ä½†å½±å“ä¸Šä¸‡è¡Œ, ç£ç›˜å˜åŒ–å¤§, å®œç”¨statement update age=age+1 where id=3; // è¯­å¥é•¿è€Œç£ç›˜å˜åŒ–å°, å®œç”¨row ä½ è¦æ˜¯æ‹¿ä¸å‡†ç”¨å“ªä¸ª? é‚£å°±è®¾ç½®ä¸ºmixed, ç”±ç³»ç»Ÿæ ¹æ®è¯­å¥æ¥å†³å®š; ä»æœåŠ¡å™¨é…ç½® é¦–å…ˆä»æœåŠ¡å™¨è‚¯å®šè¦å¼€å¯relaylogæ—¥å¿—åŠŸèƒ½ ; ä»æœåŠ¡å™¨ä¸€èˆ¬ä¹Ÿä¼šå¼€å¯binlog, ä¸€æ–¹é¢ä¸ºäº†å¤‡ä»½, ä¸€æ–¹é¢å¯èƒ½è¿˜æœ‰åˆ«çš„æœåŠ¡å™¨ä½œä¸ºè¿™å°ä»æœåŠ¡å™¨çš„slave ; ä¸»ä»ä¹‹é—´å»ºç«‹å…³ç³» : ä¸»æœåŠ¡å™¨ä¸Šå»ºç«‹ä¸€ä¸ªç”¨æˆ·: grant replication client,replication slave on *.* to repl@&#39;192.168.56.%&#39; identified by &#39;repl&#39; å‘Šè¯‰ä»æœåŠ¡å™¨è¦è¿æ¥å“ªä¸ªä¸»æœåŠ¡å™¨: åœ¨ä»æœåŠ¡å™¨ä¸Šè¿›å…¥mysqlæ‰§è¡Œå¦‚ä¸‹è¯­å¥ 1234567reset slave #å¯ä»¥æŠŠä¹‹å‰çš„ä»æœåŠ¡å™¨åŒæ­¥æœºåˆ¶é‡ç½®ä¸€ä¸‹change master to master_host=&apos;192.168.56.4&apos;,master_user=&apos;repl&apos;,master_password=&apos;repl&apos;,master_log_file=&apos;mysql-bin.000001&apos;,#å½“å‰ä¸»æœåŠ¡å™¨äº§ç”Ÿçš„binlogèµ°åˆ°å“ªå„¿äº†(éœ€è¦åœ¨ä¸»æœåŠ¡å™¨ä¸Š`show maste status`æ¥æŸ¥çœ‹fileåå’ŒpositionæŒ‡é’ˆä½ç½®)master_log_pos=349 ç„¶åæŸ¥çœ‹ä»æœåŠ¡å™¨çš„slaveçŠ¶æ€ show slave status å‘ç°å·²ç»è¿ä¸Šä¸»æœåŠ¡å™¨äº† ä»æœåŠ¡å™¨ä¸­å¯åŠ¨slave: start slave æ³¨æ„: å¯ä»¥ä¸€ä¸»å¤šä», ä½†ä¸€ä¸ªä»æœ‰å¤šä¸ªä¸»å°±ä¼šå‚»é€¼äº† ; æ­¤æ—¶æˆ‘ä»¬åšçš„åªæ˜¯mysqlä¸»ä»å¤åˆ¶, ä½†ä¸æ˜¯è¯»å†™åˆ†ç¦», è·ç¦»è¯»å†™åˆ†ç¦»è¿˜å·®ä¸€å°æ­¥; å› ä¸ºè¯»å†™åˆ†ç¦»è¿˜éœ€è¦å¯¹sqlè¯­å¥è¿›è¡Œåˆ¤æ–­(å¯ä»¥åœ¨phpå±‚é¢åˆ¤æ–­sqlè¯­å¥è¿›è¡Œè·¯ç”±, å†³å®šå“ªç§sqlå»å“ªä¸ªæœåŠ¡å™¨) å¯ä»¥å‚è€ƒæœ¬äººæœ‰é“ç¬”è®°ä¸Šçš„è®°å½•","categories":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/categories/MySQL/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://blog.renyimin.com/tags/MySQL/"}]},{"title":"02.","slug":"oauth/2017-07-12-02","date":"2017-07-12T13:10:12.000Z","updated":"2018-04-26T12:20:32.000Z","comments":true,"path":"2017/07/12/oauth/2017-07-12-02/","link":"","permalink":"http://blog.renyimin.com/2017/07/12/oauth/2017-07-12-02/","excerpt":"","text":"ç­¾åè®¤è¯è…¾è®¯äº‘apiå®‰å…¨ç­¾å åŒ…å«é˜²é‡æ”¾ Base64(HMAC-SHA1(secretKey, orignal)) é˜¿é‡Œäº‘apiå®‰å…¨ç­¾å uppercase (hex (hmac_sha1 (s, secretKey)) äº¬ä¸œäº‘å®™æ–¯apiå®‰å…¨ç­¾å md5 ä¸ƒç‰›äº‘apiå®‰å…¨ç­¾å hmac_sha1 ç¾å›¢äº‘apiå®‰å…¨ç­¾å HmacSHA256ç®—æ³• ç™¾åº¦äº‘apiå®‰å…¨ç­¾å: åŒ…å«é˜²é‡æ”¾ åä¸ºAPIç½‘å…³ å³ä½¿ä¸Šé¢çš„æ‰€æœ‰å®‰å…¨ç®—æ³•å‡è¢«ç ´è§£;å³ä½¿ç§˜é’¥è¢«è·å–;ä¹Ÿå°±æ˜¯è¯´ä½ å³ä¾¿æˆªè·äº†ç®—æ³•+ç§˜é’¥, æ„å»ºäº†è‡ªå·±çš„æ”»å‡»æ€§url;æ­¤æ—¶, urlä¸­ç”¨æˆ·çš„tokenæ˜¯å…·æœ‰æ—¶æ•ˆæ€§çš„, ä¸€æ—¦tokenè¿‡æœŸ, æœåŠ¡å™¨ä¼šåˆ·æ–°å‡ºæ–°çš„tokenç»™åˆ°å®¢æˆ·ç«¯;ä½ è¿˜éœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´æˆªè·ç”Ÿæˆçš„token, æ¢åˆ°è‡ªå·±çš„urlä¸­;è¿™ä¸€ç³»åˆ—æ“ä½œä¸‹æ¥, ä½ æˆªè·çš„è¿˜åªæ˜¯ä¸€ä¸ªç”¨æˆ·çš„, æ„ä¸æˆå¤šå¤§å¨èƒ!!! æˆæƒè¢«æˆæƒä¹‹å, å¦‚ä½•å®‰å…¨åœ°è®¿é—®APIæ¥å£, è¿™æ˜¯ä¸Šé¢çš„ ç­¾åè®¤è¯ è¦åšçš„!å¤§æ¦‚æ˜¯ç­¾åè®¤è¯ä¸­ä¹Ÿç»å¸¸ç”¨åˆ°è¯¸å¦‚ â€˜æƒé™â€™ è¿™ä¸ªè¯, æ‰€ä»¥ç»å¸¸ææ·· ç­¾åè®¤è¯ å’Œ æˆæƒ ç™¾åº¦å¯¹äºè®¤è¯æ–¹å¼: éœ€è¦é€šè¿‡ä½¿ç”¨Access Key Id / Secret Access Key åŠ å¯†çš„æ–¹æ³•æ¥éªŒè¯æŸä¸ªè¯·æ±‚çš„å‘é€è€…èº«ä»½, Access Key Id(AK)ç”¨äºæ ‡ç¤ºç”¨æˆ·, Secret Access Key(SK)æ˜¯ç”¨æˆ·ç”¨äºåŠ å¯†è®¤è¯å­—ç¬¦ä¸², å’Œç™¾åº¦äº‘ç”¨æ¥éªŒè¯è®¤è¯å­—ç¬¦ä¸²çš„å¯†é’¥, å…¶ä¸­SKå¿…é¡»ä¿å¯†, åªæœ‰ç”¨æˆ·å’Œç™¾åº¦äº‘çŸ¥é“;å½“ç™¾åº¦äº‘æ¥æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚å, ç³»ç»Ÿå°†ä½¿ç”¨ç›¸åŒçš„SKå’ŒåŒæ ·çš„è®¤è¯æœºåˆ¶ç”Ÿæˆè®¤è¯å­—ç¬¦ä¸², å¹¶ä¸ç”¨æˆ·è¯·æ±‚ä¸­åŒ…å«çš„è®¤è¯å­—ç¬¦ä¸²è¿›è¡Œæ¯”å¯¹, å¦‚æœè®¤è¯å­—ç¬¦ä¸²ç›¸åŒ, ç³»ç»Ÿè®¤ä¸ºç”¨æˆ·æ‹¥æœ‰æŒ‡å®šçš„æ“ä½œæƒé™, å¹¶æ‰§è¡Œç›¸å…³æ“ä½œ; å¦‚æœè®¤è¯å­—ç¬¦ä¸²ä¸åŒ, ç³»ç»Ÿå°†å¿½ç•¥è¯¥æ“ä½œå¹¶è¿”å›é”™è¯¯ç ; æ³¨æ„: signingKeyç­¾åKeyç™¾åº¦äº‘ä¸ç›´æ¥ä½¿ç”¨SKå¯¹å¾…ç­¾åä¸²ç”Ÿæˆæ‘˜è¦, ç›¸åçš„, ç™¾åº¦äº‘é¦–å…ˆä½¿ç”¨SKå’Œè®¤è¯å­—ç¬¦ä¸²å‰ç¼€ç”ŸæˆsigningKey, ç„¶åç”¨signingKeyå¯¹å¾…ç­¾åä¸²ç”Ÿæˆæ‘˜è¦;å…¶å®ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨SKå¯¹canonicalRequestç”Ÿæˆç­¾åæ‘˜è¦signature; ç™¾åº¦è¿™ä¹ˆåš, æ„Ÿè§‰æ„ä¹‰ä¹Ÿä¸å¤§;Authorization = bce-auth-v1/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/2015-04-27T08:23:49Z/1800//b02547aedd91dc438d6bb6d1be68b35917828271b340b9e7d1a7bcd051869054","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"01.","slug":"oauth/2017-07-12-01","date":"2017-07-12T12:10:12.000Z","updated":"2018-04-25T07:44:10.000Z","comments":true,"path":"2017/07/12/oauth/2017-07-12-01/","link":"","permalink":"http://blog.renyimin.com/2017/07/12/oauth/2017-07-12-01/","excerpt":"","text":"ä¸ºä»€ä¹ˆä½¿ç”¨token? è€Œä¸ä½¿ç”¨è´¦å·å¯†ç ? OAuth çš„èº«ä»½éªŒè¯è¿‡ç¨‹, å…¶å®å°±æ˜¯ä¸€ä¸ªè·å– access_token çš„è¿‡ç¨‹, ä¸ºä»€ä¹ˆè¦ç”¨tokenè€Œä¸ç›´æ¥ç”¨è´¦å·å¯†ç æ¥ç™»å½•? ç»å¸¸ä½¿ç”¨ OAuth èº«ä»½è®¤è¯çš„å¼€å‘äººå‘˜, å¯èƒ½ä¹Ÿä¼šæ„Ÿè§‰åˆ°ä½¿ç”¨ token éƒ½æ˜¯å‡ºç°åœ¨ è®©ç¬¬ä¸‰æ–¹ç½‘ç«™è®¿é—®ç”¨æˆ·æ•°æ®æä¾›æœåŠ¡ åœºæ™¯(æ¯”å¦‚ç¬¬ä¸‰æ–¹ç½‘ç«™æ¥å…¥çš„å¾®ä¿¡, å¾®åšç™»å½•, å¯ä»¥æä¾›ç”¨æˆ·åœ¨å¾®ä¿¡, å¾®åšä¸­çš„ç”¨æˆ·æ•°æ®ç»™ç¬¬ä¸‰æ–¹ç«™ç‚¹); å…¶å® token ä¸ è´¦å·+å¯†ç  æœ€å¤§çš„ä¸åŒ, å°±æ˜¯ token å¿…ç„¶æ˜¯æœ‰æ—¶æ•ˆæ€§çš„, å¹¶ä¸”å¯è¢«å›æ”¶, å³ä½¿ä¸å°å¿ƒ token è¢«æ”»å‡»è€…è·å–, ä»–ä¹Ÿæ²¡æœ‰åŠæ³•æ°¸è¿œèƒ½è®¿é—®ä½ çš„æ•°æ®; è€Œ OAuth æ­£æ˜¯æä¾›äº†è®©ç¬¬ä¸‰æ–¹è·å– token è¿™ä¸ªä¸´æ—¶é’¥åŒ™çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚ https://www.chrisyue.com/security-issue-about-oauth-2-0-you-should-know.html å¾®ä¿¡:å…¬ä¼—å¹³å°: https://mp.weixin.qq.com/cgi-bin/home?t=home/index&amp;lang=zh_CN&amp;token=208919843 (qqé‚®ç®±)å¼€æ”¾å¹³å°ï¼š https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN (126é‚®ç®±)","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"31. Luaè„šæœ¬","slug":"Redis/2017-06-29-redis-31","date":"2017-06-29T10:40:07.000Z","updated":"2018-03-10T12:12:08.000Z","comments":true,"path":"2017/06/29/Redis/2017-06-29-redis-31/","link":"","permalink":"http://blog.renyimin.com/2017/06/29/Redis/2017-06-29-redis-31/","excerpt":"","text":"å‰è¨€ ä¹‹å‰å·²ç»äº†è§£åˆ°, åœ¨redisäº‹ç‰©ä¸­, ä¸ºäº†æ£€æµ‹äº‹åŠ¡å³å°†æ“ä½œçš„keys, æ˜¯å¦æœ‰å¤šä¸ªclientsåŒæ—¶æ”¹å˜è€Œå¼•èµ·å†²çª, è¿™äº›keyså°†ä¼šåœ¨äº‹åŠ¡å¼€å§‹å‰ä½¿ç”¨ watch è¢«ç›‘æ§; å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªè¢«ç›‘æ§çš„keyåœ¨æ‰§è¡Œexecå‘½ä»¤å‰è¢«ä¿®æ”¹, åˆ™äº‹åŠ¡ä¼šè¢«æ‰“æ–­, ä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œ, ä»è€Œä¿è¯åŸå­æ€§æ“ä½œã€‚ ä¹‹å‰çš„è¿™ç§æ–¹æ¡ˆæ˜¯åœ¨è§£å†³ä¸€ç§å«åš CAS(check-and-set) (æ£€æŸ¥åå†è®¾ç½®) çš„é—®é¢˜, è¿™ç§é—®é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬æ¥è¿›è¡Œè§£å†³; Lua è„šæœ¬åŠŸèƒ½æ˜¯Reids 2.6ç‰ˆæœ¬çš„æœ€å¤§äº®ç‚¹, é€šè¿‡å†…åµŒå¯¹Luaç¯å¢ƒçš„æ”¯æŒ, Redisè§£å†³äº†é•¿ä¹…ä»¥æ¥ä¸èƒ½é«˜æ•ˆåœ°å¤„ç†CAS(check-and-setæ£€æŸ¥åå†è®¾ç½®) å‘½ä»¤çš„ç¼ºç‚¹, å¹¶ä¸”å¯ä»¥é€šè¿‡ç»„åˆä½¿ç”¨å¤šä¸ªå‘½ä»¤, è½»æ¾å®ç°ä»¥å‰å¾ˆéš¾å®ç°æˆ–è€…ä¸èƒ½é«˜æ•ˆå®ç°çš„æ¨¡å¼ã€‚ è„šæœ¬çš„åŸå­æ€§Redis ä½¿ç”¨å•ä¸ª Lua è§£é‡Šå™¨å»è¿è¡Œæ‰€æœ‰è„šæœ¬,å¹¶ä¸”Redis ä¹Ÿä¿è¯è„šæœ¬ä¼šä»¥åŸå­æ€§(atomic)çš„æ–¹å¼æ‰§è¡Œ;(å½“æŸä¸ªè„šæœ¬æ­£åœ¨è¿è¡Œçš„æ—¶å€™,ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤è¢«æ‰§è¡Œ, è¿™å’Œä½¿ç”¨ MULTI / EXEC åŒ…å›´çš„äº‹åŠ¡å¾ˆç±»ä¼¼, åœ¨å…¶ä»–åˆ«çš„å®¢æˆ·ç«¯çœ‹æ¥ï¼Œè„šæœ¬çš„æ•ˆæœè¦ä¹ˆæ˜¯ä¸å¯è§çš„ï¼Œè¦ä¹ˆå°±æ˜¯å·²å®Œæˆçš„;å¦ä¸€æ–¹é¢å…¶å®ä¹Ÿæ„å‘³ç€, æ‰§è¡Œä¸€ä¸ªè¿è¡Œç¼“æ…¢çš„è„šæœ¬å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„, å†™ä¸€ä¸ªè·‘å¾—å¾ˆå¿«å¾ˆé¡ºæºœçš„è„šæœ¬å¹¶ä¸éš¾, å› ä¸ºè„šæœ¬çš„è¿è¡Œå¼€é”€(overhead)éå¸¸å°‘, ä½†æ˜¯å½“ä½ ä¸å¾—ä¸ä½¿ç”¨ä¸€äº›è·‘å¾—æ¯”è¾ƒæ…¢çš„è„šæœ¬æ—¶, è¯·å°å¿ƒ, å› ä¸ºå½“è¿™äº›èœ—ç‰›è„šæœ¬åœ¨æ…¢åååœ°è¿è¡Œçš„æ—¶å€™, å…¶ä»–å®¢æˆ·ç«¯ä¼šå› ä¸ºæœåŠ¡å™¨æ­£å¿™è€Œæ— æ³•æ‰§è¡Œå‘½ä»¤; Redisä¸­æ‰§è¡ŒLuaè„šæœ¬çš„å¥½å¤„ Luaè„šæœ¬åœ¨Redisä¸­æ˜¯åŸå­æ‰§è¡Œçš„ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­é—´ä¸ä¼šæ’å…¥å…¶ä»–å‘½ä»¤; (ä¸€ä¸ªLuaè„šæœ¬ä¸­çš„å‘½ä»¤, å°±ç›¸å½“äºç±»ä¼¼Redisä¸­GETSETè¿™ç§åŸç”Ÿå‘½ä»¤, æ˜¯å…·å¤‡åŸå­æ€§çš„) Luaè„šæœ¬å¯ä»¥å¸®åŠ©å¼€å‘å’Œè¿ç»´äººå‘˜åˆ›é€ å‡ºè‡ªå·±å®šåˆ¶çš„å‘½ä»¤ï¼Œå¹¶å¯ä»¥å°†è¿™äº›å‘½ä»¤å¸¸é©»åœ¨Rediså†…å­˜ä¸­ï¼Œå®ç°å¤ç”¨çš„æ•ˆæœ; Luaè„šæœ¬å¯ä»¥å°†å¤šæ¡å‘½ä»¤ä¸€æ¬¡æ€§æ‰“åŒ…ï¼Œæœ‰æ•ˆåœ°å‡å°‘ç½‘ç»œå¼€é”€; ä¸åº”è¯¥ä½¿ç”¨Luaä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥æŠŠè„šæœ¬åµŒå…¥åˆ°Redisé‡Œé¢?å› ä¸ºRedisçš„å®ç°æ˜¯å µå¡çš„, å³, ä¸€ä¸ªRedis server, åœ¨åŒä¸€æ—¶å€™, åªèƒ½æ‰§è¡Œä¸€ä¸ªè„šæœ¬;å› æ­¤, å¦‚æœä½ å†™äº†ä¸€ä¸ªé€»è¾‘éå¸¸å¤æ‚çš„è„šæœ¬, è¿™ä¸ªè„šæœ¬çš„æ‰§è¡Œæ—¶é—´éå¸¸é•¿, è¿™æ ·, è¿™ä¸ªæ—¶å€™å¦‚æœæœ‰åˆ«çš„è¯·æ±‚è¿›æ¥, å°±åªèƒ½æ’é˜Ÿ, ç­‰å¾…è¿™ä¸ªè„šæœ¬ç»“æŸäº†, è¿™ä¸ªRedis serveræ‰èƒ½å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚åœ¨è¿™ä¸ªæ—¶å€™, å°±è¿ä»…ä»…æ˜¯è·å–æ•°æ®çš„å‘½ä»¤éƒ½ä¼šè¢«å µä½ã€‚è¿™ä¸ªRedis-Serverçš„æ•ˆç‡å°±ä¼šè¢«å¤§å¤§çš„æ‹–æ…¢, å› æ­¤, å¦‚æœä½ çš„è„šæœ¬æ‰§è¡Œéå¸¸å¤æ‚è€—æ—¶, é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ æ˜¯ä¸åº”è¯¥æŠŠå®ƒæ”¾åœ¨Redisé‡Œé¢æ‰§è¡Œçš„ã€‚ Lua åŸºç¡€hello.lua hello.lua: è¿™ä¸ªLuaè„šæœ¬æ¯”è¾ƒç®€å•, ä»…ä»…è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸², æ²¡æœ‰ä¸redis-Serverè¿›è¡Œæ¯”è¾ƒæœ‰æ„ä¹‰çš„æ“ä½œ(æ¯”å¦‚è·å–æˆ–è®¾ç½®æ•°æ®) 12local msg = &quot;Hello, world!&quot; --å®šä¹‰äº†ä¸€ä¸ªæœ¬åœ°å˜é‡msgå­˜å‚¨æˆ‘ä»¬çš„ä¿¡æ¯return msg ä¿å­˜è¿™ä¸ªæ–‡ä»¶åˆ°hello.lua, è¿è¡Œ: 123456 renyimindembp:test renyimin$ redis-cli eval \"$(cat /Users/renyimin/Desktop/test/test.lua)\" 0 \"Hello, world!\"-- ä¸‹é¢è¿™ç§æ–¹æ³•ä¹Ÿè¡Œ renyimindembp:test renyimin$ redis-cli --eval /Users/renyimin/Desktop/test/test.lua 0 \"Hello, world!\" renyimindembp:test renyimin$ è¿è¡Œè¿™æ®µä»£ç ä¼šæ‰“å°â€Hello,world!â€ EVAL æŒ‡ä»¤ è¯­æ³•: VAL script numkeys key [key ...] arg [arg ...] script å‚æ•°: æ˜¯ä¸€æ®µluaè„šæœ¬ç¨‹åº, å®ƒä¼šè¢«è¿è¡Œåœ¨RedisæœåŠ¡å™¨ä¸Šä¸‹æ–‡ä¸­, å¯ä»¥ç›´æ¥å†™åœ¨å‘½ä»¤è¡Œ, ä¹Ÿå¯ä»¥å¼•å…¥.luaæ–‡ä»¶; numkeys å‚æ•°: æŒ‡å®šå³å°†ä¼ å…¥luaè„šæœ¬ä¸­çš„keyçš„ä¸ªæ•° (å¦‚æœæ²¡æœ‰å‚æ•°çš„è¯, ä¹Ÿéœ€è¦æŒ‡æ˜å‚æ•°ä¸ªæ•°ä¸º0, å¦åˆ™ä¼šæŠ¥é”™) ä»ç¬¬ä¸‰ä¸ªå‚æ•°å¼€å§‹çš„numkerysä¸ªå‚æ•°, å°±æ˜¯ä½ è¦ä¼ å…¥è„šæœ¬çš„é”®åå‚æ•°, è¿™äº›é”®åå‚æ•°å¯ä»¥åœ¨Luaè„šæœ¬ä¸­é€šè¿‡å…¨å±€å˜é‡KEYSæ•°ç»„(ç´¢å¼•ä»1å¼€å§‹)çš„å½¢å¼è®¿é—®(å¦‚:KEYS[1], KEYS[2]); å‰©ä¸‹çš„åœ¨å‘½ä»¤æœ€åçš„é™„åŠ å‚æ•° arg [arg ...], å¯ä»¥åœ¨Luaä¸­é€šè¿‡å…¨å±€å˜é‡ ARGV æ•°ç»„è®¿é—®, è®¿é—®çš„å½¢å¼å’ŒKEYSå˜é‡ç±»ä¼¼; ä¾‹å­: (..æ˜¯luaä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥è¯­æ³•) 123127.0.0.1:6379&gt; EVAL &apos;return &quot;K1: &quot;..KEYS[1]..&quot; K2: &quot;..KEYS[2]..&quot; A1: &quot;..ARGV[1]..&quot; A2: &quot;..ARGV[2]&apos; 3 k1 k2 k3 a1 a2 a3 a4&quot;K1: k1 K2: k2 A1: a1 A2: a2&quot;127.0.0.1:6379&gt; å¸¦å®½å’Œ EVALSHA EVAL å‘½ä»¤è¦æ±‚ä½ åœ¨æ¯æ¬¡æ‰§è¡Œè„šæœ¬çš„æ—¶å€™éƒ½å‘é€ä¸€æ¬¡è„šæœ¬, ä½†æ˜¯Redisæœ‰ä¸€ä¸ªå†…éƒ¨çš„ç¼“å­˜æœºåˆ¶, å› æ­¤å®ƒä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°ç¼–è¯‘è„šæœ¬, è¿™æ ·, evalå‘é€è„šæœ¬ä¸»ä½“å°±æ˜¯åœ¨æµªè´¹å¸¦å®½äº†; ä¸ºäº†å‡å°‘å¸¦å®½çš„æ¶ˆè€—, Rediså®ç°äº† EVALSHA å‘½ä»¤, å®ƒçš„ä½œç”¨å’ŒEVALä¸€æ ·, éƒ½ç”¨äºå¯¹è„šæœ¬æ±‚å€¼ä½†å®ƒæ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯è„šæœ¬, è€Œæ˜¯è„šæœ¬çš„SHA1æ ¡éªŒå’Œ(sum)(SHA1æ ¡éªŒå’Œ çš„ç”Ÿæˆçœ‹ä¸‹ä¸€èŠ‚SCRIPT LOAD); EVALSHAæ‰§è¡Œå, å¦‚æœæœåŠ¡å™¨è¿˜è®°å¾—ç»™å®šçš„ SHA1æ ¡éªŒå’Œ æ‰€ä»£è¡¨çš„è„šæœ¬, é‚£ä¹ˆæ‰§è¡Œè¿™ä¸ªè„šæœ¬; å¦‚æœæœåŠ¡å™¨ä¸è®°å¾—ç»™å®šçš„ SHA1æ ¡éªŒå’Œ æ‰€ä»£è¡¨çš„è„šæœ¬, é‚£ä¹ˆå®ƒè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„é”™è¯¯, æé†’ç”¨æˆ·ä½¿ç”¨EVALä»£æ›¿EVALSHAä»¥ä¸‹æ˜¯ç¤ºä¾‹ï¼š 123456789101112// ç°åœ¨æ˜¯æœ‰aè¿™ä¸ªkeyçš„127.0.0.1:6379&gt; get a&quot;haha&quot;// å¼€å§‹æµ‹è¯•127.0.0.1:6379&gt; SCRIPT LOAD &quot;return redis.call(&apos;GET&apos;,&apos;a&apos;)&quot;&quot;8a2f221803757b26fc7d283bec7ba834d91202c9&quot;127.0.0.1:6379&gt; evalsha 8a2f221803757b26fc7d283bec7ba834d91202c9 0&quot;haha&quot;// å¦‚ä¸‹çå†™çš„ sha1æ ¡éªŒå’Œ, æœåŠ¡å™¨å°±ä¸è®¤è¯†äº†, è¦ä½ ä½¿ç”¨ eval å‘½ä»¤æ¥ç›´æ¥ä½¿ç”¨è„šæœ¬127.0.0.1:6379&gt; evalsha lalalala 0(error) NOSCRIPT No matching script. Please use EVAL.127.0.0.1:6379&gt; SCRIPT LOADå¦‚æœä½¿ç”¨ EVALSHA å‘é€æ ¡éªŒå’Œç»™æœåŠ¡å™¨, ä»è€Œè°ƒç”¨æ­£ç¡®è„šæœ¬çš„è¯, è¿™ä¸ª æ ¡éªŒå’Œ å¦‚ä½•ç”Ÿæˆ? è¿™å°±è¦ç”¨åˆ° SCRIPT LOAD å‘½ä»¤äº†;SCRIPT LOAD: å°†è„šæœ¬åŠ è½½åˆ°è„šæœ¬ç¼“å­˜, è€Œä¸æ‰§è¡Œå®ƒ (åœ¨å°†æŒ‡å®šçš„å‘½ä»¤åŠ è½½åˆ°è„šæœ¬ç¼“å­˜ä¸­ä¹‹å, ä¹‹åä½ å°†éœ€è¦ä½¿ç”¨EVALSHAå‘½ä»¤å’Œè„šæœ¬çš„æ­£ç¡®SHA1æ‘˜è¦æ¥è°ƒç”¨å®ƒ) è¯¥è„šæœ¬è¢«ä¿è¯æ°¸è¿œç•™åœ¨è„šæœ¬ç¼“å­˜ä¸­(é™¤éè°ƒç”¨SCRIPT FLUSH) luaè°ƒç”¨rediså‘½ä»¤ Luaè„šæœ¬ä¸­å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„Luaå‡½æ•°æ¥è°ƒç”¨Redisçš„å‘½ä»¤ redis.call() redis.pcall() redis.call() ä¸ redis.pcall()çš„åŒºåˆ« è¿™ä¸¤ä¸ªå‘½ä»¤å¾ˆç±»ä¼¼, ä»–ä»¬å”¯ä¸€çš„åŒºåˆ«æ˜¯å½“rediså‘½ä»¤æ‰§è¡Œç»“æœè¿”å›é”™è¯¯æ—¶, redis.call()å°†è¿”å›ç»™è°ƒç”¨è€…ä¸€ä¸ªé”™è¯¯; è€Œredis.pcall()ä¼šå°†æ•è·çš„é”™è¯¯ä»¥Luaè¡¨çš„å½¢å¼è¿”å›; æµ‹è¯• (redis.call() å’Œ redis.pcall() ä¸¤ä¸ªå‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯ä»»æ„çš„ Redis å‘½ä»¤) 12345127.0.0.1:6379&gt; eval &quot;return redis.call(&apos;set&apos;,&apos;foo&apos;,&apos;bar&apos;)&quot; 0OK127.0.0.1:6379&gt; eval &quot;return redis.call(&apos;get&apos;,&apos;foo&apos;)&quot; 0&quot;bar&quot;127.0.0.1:6379&gt; .lua è„šæœ¬æ–‡ä»¶ å…¶å®å†™luaè„šæœ¬è¿˜æ˜¯æœ‰å¾ˆå¤šæ³¨æ„ç‚¹çš„, å¯ä»¥å‚è€ƒä¸­çº¯å‡½æ•°è„šæœ¬è¿™ä¸€å°èŠ‚; æœ¬ç¯‡å­¦ä¹ ä¸»è¦æ˜¯å°†æ¥èƒ½å†™ä¸€äº›ç®€å•çš„åŸå­å‘½ä»¤, å¹¶ä¸ä¼šæ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘æ“ä½œ, æ‰€ä»¥åªæ˜¯ç®€å•äº†è§£äº†ä¸€ä¸‹ä¸Šé¢é‚£äº›æ³¨æ„ç‚¹; æ¼”ç¤ºåœ¨redisè®¾ç½®ä¸€ä¸ªnumä¸º10çš„åº“å­˜ set num 10; ä¸‹é¢é€šè¿‡luaè„šæœ¬å†™ä¸€ä¸ªåŸå­æ“ä½œ, å°†æ£€æµ‹åº“å­˜å’Œæœ€ç»ˆå‡å°‘åº“å­˜æ”¾åœ¨ä¸€èµ· 123456local good = redis.call(&apos;get&apos;, &apos;num&apos;);if tonumber(good) &gt; 0then redis.call(&apos;decr&apos;, &apos;num&apos;)endreturn &apos;ok&apos; è°ƒç”¨è¯¥è„šæœ¬ 12renyimindembp:test renyimin$ redis-cli --eval /Users/renyimin/Desktop/test/test.lua 0&quot;ok&quot; ä¼šæ­£å¸¸å‡å°‘æ•°å­— laravelä¸­å®ç°å¦‚ä¸‹ å‡ºç°è¶…å–çš„ä»£ç  123456789101112131415/** * ä½¿ç”¨redisæ¨¡æ‹Ÿå¹¶å‘è¶…å– * ç”±äºcheckå’Œsetæ˜¯åˆ†ä¸¤æ­¥æ‰§è¡Œçš„ */public function redisOversell()&#123; $good = Redis::get(&apos;num&apos;); if ($good &gt; 0) &#123; Redis::multi(); usleep(500000); //é¢„å…ˆå·²ç»è®¾ç½®å¥½åº“å­˜ä¸º10ä¸ªäº† Redis::decr(&apos;num&apos;); Redis::exec(); &#125;&#125; å®šä¹‰è„šæœ¬: å°†check å’Œ setæ”¾åˆ°ä¸€ä¸ªè„šæœ¬é‡Œ(ä½†è¿™ä¸ªè„šæœ¬ç”±äºæ²¡æœ‰è®¾ç½®sleep, æ‰€ä»¥åªèƒ½å¾—å‡ºç†è®ºä¸Šæ˜¯æ²¡æœ‰é—®é¢˜çš„) 123456protected $lua = &quot; local good = redis.call(&apos;get&apos;, &apos;num&apos;);&quot; . &quot; if tonumber(good) &gt; 0 then&quot; . &quot; redis.call(&apos;decr&apos;, &apos;num&apos;)&quot; . &quot; end&quot; . &quot; return &apos;ok&apos;&quot;; æ‰§è¡Œ 1234567/** * luaè„šæœ¬è§£å†³è¶…å– */public function redisLua()&#123; Redis::eval($this-&gt;lua, 0);&#125; å‚è€ƒhttps://segmentfault.com/a/1190000009811453#articleHeader0https://www.cnblogs.com/huangxincheng/p/6230129.htmlhttps://segmentfault.com/a/1190000007615411","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"23. redis ä¸»ä», å“¨å…µ","slug":"Redis/2017-06-24-redis-23","date":"2017-06-24T12:50:07.000Z","updated":"2018-03-09T07:50:19.000Z","comments":true,"path":"2017/06/24/Redis/2017-06-24-redis-23/","link":"","permalink":"http://blog.renyimin.com/2017/06/24/Redis/2017-06-24-redis-23/","excerpt":"","text":"å‰è¨€ å’ŒMySQLä¸»ä»å¤åˆ¶çš„åŸå› ä¸€æ ·, Redisè™½ç„¶è¯»å–å†™å…¥çš„é€Ÿåº¦éƒ½ç‰¹åˆ«å¿«, ä½†æ˜¯ä¹Ÿä¼šäº§ç”Ÿè¯»å‹åŠ›ç‰¹åˆ«å¤§çš„æƒ…å†µ, ä¸ºäº†åˆ†æ‹…è¯»å‹åŠ›, redisæ”¯æŒä¸»ä»å¤åˆ¶; Redisçš„ä¸»ä»ç»“æ„å¯ä»¥é‡‡ç”¨ ä¸€ä¸»å¤šä» æˆ–è€… çº§è”ç»“æ„ , ä¸‹å›¾ä¸ºçº§è”ç»“æ„: ä¸»ä»å¤åˆ¶(Replication)å®ç°è¯»å†™åˆ†ç¦», æé«˜æœåŠ¡å™¨è´Ÿè½½èƒ½åŠ› Redisçš„ä¸»ä»å¤åˆ¶æ¶æ„ä¸­, ä¸€ç±»æ˜¯ä¸»æ•°æ®åº“(master), ä¸€ç±»æ˜¯ä»æ•°æ®åº“(slave)masterå¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œ, å½“å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™è‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æ•°æ®åº“;è€Œä»æ•°æ®åº“ä¸€èˆ¬æ˜¯åªè¯»çš„, å¹¶æ¥æ”¶ä¸»æ•°æ®åº“åŒæ­¥è¿‡æ¥çš„æ•°æ®; ä¸€ä¸ªä¸»æ•°æ®åº“å¯ä»¥æœ‰å¤šä¸ªä»æ•°æ®åº“, è€Œä¸€ä¸ªä»æ•°æ®åº“åªèƒ½æœ‰ä¸€ä¸ªä¸»æ•°æ®åº“; Redisä¸»ä»å¤åˆ¶å¯ä»¥æ ¹æ®æ˜¯å¦å…¨é‡åˆ†ä¸º å…¨é‡åŒæ­¥ å’Œ å¢é‡åŒæ­¥ Rediså…¨é‡å¤åˆ¶ ä¸€èˆ¬å‘ç”Ÿåœ¨Slaveåˆå§‹åŒ–é˜¶æ®µ, è¿™æ—¶Slaveéœ€è¦å°†Masterä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½å¤åˆ¶ä¸€ä»½ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ä»æœåŠ¡å™¨è¿æ¥ä¸»æœåŠ¡å™¨, å¹¶å‘é€SYNCå‘½ä»¤ ; ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°SYNCå‘½ä»¤å, å¼€å§‹æ‰§è¡ŒBGSAVEå‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤; ä¸»æœåŠ¡å™¨BGSAVEæ‰§è¡Œå®Œå, å‘æ‰€æœ‰ä»æœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶, å¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤; ä»æœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®,è½½å…¥æ”¶åˆ°çš„å¿«ç…§; ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤; ä»æœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥, å¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚, å¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ ; æ³¨æ„ï¼šredis2.8ä¹‹å‰çš„ç‰ˆæœ¬, å½“ä¸»ä»æ•°æ®åº“åŒæ­¥çš„æ—¶å€™ä»æ•°æ®åº“å› ä¸ºç½‘ç»œåŸå› æ–­å¼€é‡è¿åä¼šé‡æ–°æ‰§è¡Œä¸Šè¿°æ“ä½œ, ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ , redis2.8ä¹‹åæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚ Rediså¢é‡å¤åˆ¶ Rediså¢é‡å¤åˆ¶æ˜¯æŒ‡Slaveåˆå§‹åŒ–åå¼€å§‹æ­£å¸¸å·¥ä½œæ—¶ä¸»æœåŠ¡å™¨å‘ç”Ÿçš„å†™æ“ä½œåŒæ­¥åˆ°ä»æœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚ å¢é‡å¤åˆ¶çš„è¿‡ç¨‹ä¸»è¦æ˜¯ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤, ä»æœåŠ¡å™¨æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ã€‚ å°ç»“ ä¸»ä»åˆšåˆšè¿æ¥çš„æ—¶å€™, è¿›è¡Œå…¨é‡åŒæ­¥; å…¨åŒæ­¥ç»“æŸå, è¿›è¡Œå¢é‡åŒæ­¥; å½“ç„¶, å¦‚æœæœ‰éœ€è¦, slave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥; redis ç­–ç•¥æ˜¯, æ— è®ºå¦‚ä½•, é¦–å…ˆä¼šå°è¯•è¿›è¡Œå¢é‡åŒæ­¥, å¦‚ä¸æˆåŠŸ, åˆ™è¦æ±‚ä»æœºè¿›è¡Œå…¨é‡åŒæ­¥; Redisä¸»ä»é…ç½®æ–¹æ³•åŠ¨æ€é…ç½® åœ¨å¯åŠ¨æ–°çš„rediså®ä¾‹çš„æ—¶å€™, è®¾ç½®è¿™ä¸ªæ–°çš„å®ä¾‹ä¸ºæŸä¸ªredisä¸»æœåŠ¡å™¨çš„Slave: redis-server --port 6379 --slaveof 127.0.0.1 6379 å°è¯•å‘ä»æœåŠ¡å™¨å‘é€å†™å‘½ä»¤, å‘ç°ä¸ä¼šæˆåŠŸ; åœ¨masterä¸Šæ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹, å‘ç°ä»æœåŠ¡å™¨ä¸Šç«‹é©¬å°±ä¼šåŒæ­¥åˆ°è¿™æ¡æ•°æ®; åŠ¨æ€é…ç½®å¯¹ä¸€ä¸ªå·²ç»å¯åŠ¨çš„redisæœåŠ¡å‘é€å‘½ä»¤: slaveof ip port, åˆ™ä¼šå°†å½“å‰æœåŠ¡å™¨çŠ¶æ€ä»Masterä¿®æ”¹ä¸ºåˆ«çš„æœåŠ¡å™¨çš„Slave é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸ºæ¯ä¸ªå‡†å¤‡å¯åŠ¨çš„redisä»æœåŠ¡, åˆ›å»ºå„è‡ªçš„é…ç½®æ–‡ä»¶, ç„¶ååœ¨å¯åŠ¨redisæ–°å®ä¾‹çš„æ—¶å€™, ä¸ºæ–°å®ä¾‹æŒ‡å®šå„è‡ªçš„é…ç½®æ–‡ä»¶å³å¯ æ¯”å¦‚ä¸€ä¸ª6380çš„ä»å®ä¾‹, å…¶é…ç½®æ–‡ä»¶ä¸º: redis-server /usr/local/redis/etc/redis-6380.conf é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹: 12slaveof 127.0.0.1 6379port 6380 ä¸Šé¢ä¸‰ç§æ–¹å¼éƒ½å¯ä»¥å¾ˆè½»æ¾åœ°é…å‡ºä¸»ä»æ•ˆæœæ¥! sentinelå“¨å…µå¼•å‡ºsentinel ä¹‹å‰çš„ä¸»ä»é…ç½®å¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³ä¸€ä¸ªrediså®ä¾‹è¯»å‹åŠ›å¤§çš„é—®é¢˜, å¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè¿›è¡Œä¸»ä»å¤šå®ä¾‹çš„é…ç½®, ä¹Ÿå¯ä»¥åœ¨ä¸åŒæœºå™¨ä¹‹é—´è¿›è¡Œä¸»ä»é…ç½®; å¦‚æœslaveæœåŠ¡å™¨æŒ‚æ‰, åªæ˜¯è¯»æ€§èƒ½ä¼šä¸‹é™, ç°åœ¨çš„é—®é¢˜æ˜¯, å¦‚æœä¸€æ—¦ä¸»redisæœåŠ¡å™¨(ä¹Ÿå°±æ˜¯masterå®ä¾‹)æŒ‚äº†, ä½ ç›®å‰è²Œä¼¼åªèƒ½æ‰‹åŠ¨å»æŠŠè¿™å°masterå®ä¾‹å¯åŠ¨èµ·æ¥; å¦‚æœç¡®å®è¿™å°æœºå™¨/å®ä¾‹å°±æ˜¯å¯åŠ¨ä¸èµ·æ¥çš„è¯, é‚£ä½ å¯èƒ½å°±éœ€è¦æ‰‹åŠ¨å»å°†å½“å‰çš„æŸä¸€ä¸ªslaveå®ä¾‹åˆ‡æ¢ä¸ºmaster:slaveof no one //å…ˆæŠŠè¿™ä¸ªslaveå®ä¾‹å˜æˆä¸€ä¸ªmasterå®ä¾‹slaveof ip port //åœ¨ä¹‹å‰çš„ä»å®ä¾‹ä¸­æ‰§è¡Œ, å°†ä»–ä»¬çš„masteré‡æ–°åˆ‡æ¢åˆ°è¿™ä¸ªæ–°çš„masterä¸Š è¿™ç§æ‰‹åŠ¨æ“ä½œæ˜æ˜¾ä¸å¯èƒ½è¢«æ¥æ”¶, æˆ‘ä»¬éœ€è¦å½“masterä¸»æŒ‚äº†ä¹‹å, è‡ªåŠ¨æœ‰ä¸€ä¸ªslaveèƒ½å¤Ÿå‹‡äºæ‰¿æ‹…åœ°é¡¶ä¸Šæ¥(å› ä¸ºslaveç›¸å¯¹äºä¹‹å‰çš„masteré™¤äº†åˆ†æ‹…è¯»å‹åŠ›å¤–, è¿˜æ˜¯ä¹‹å‰masterçš„å¤‡ä»½), è¿™å°±å¼•å‡ºäº†redisçš„sentinelå“¨å…µ; ç®€ä»‹ sentinelå“¨å…µ æ˜¯rediså®˜æ–¹æä¾›çš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ, å¯ä»¥ç”¨å®ƒæ¥ç®¡ç†å¤šä¸ªredisæœåŠ¡çš„å®ä¾‹; ä¹‹å‰åœ¨ç¼–è¯‘å®‰è£…å¥½redisä¹‹å, å°±å¯ä»¥åœ¨ /usr/local/redis/src/ ç›®å½•ä¸‹çœ‹åˆ° redis-sentinel ç­‰å¾ˆå¤šå‘½ä»¤; sentinelçš„ç›‘æ§: å®ƒä¼šä¸æ–­åœ°æ£€æŸ¥masterå’Œslavesæ˜¯å¦æ­£å¸¸; ä¸€ä¸ªsentinelå¯ä»¥ç›‘æ§ä»»æ„å¤šä¸ªmasteråŠå…¶ä¸‹çš„slaves; å½“ç„¶, sentinelä¹Ÿå¯èƒ½æŒ‚æ‰, ä¹Ÿæœ‰å•ç‚¹é—®é¢˜ (è¿˜å¥½Sentinelæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿ, å¯ä»¥åœ¨ä¸€ä¸ªæ¶æ„ä¸­è¿è¡Œå¤šä¸ªSentinelè¿›ç¨‹, ä»–ä»¬å¯ä»¥ç»„æˆä¸€ä¸ªsentinelç½‘ç»œ, ä¹‹é—´æ˜¯å¯ä»¥äº’ç›¸é€šä¿¡çš„, å¯ä»¥é€šè¿‡â€æŠ•ç¥¨â€æ¥å†³å®šmasteræ˜¯å¦æŒ‚äº†) å½“ä¸€ä¸ªsentinelè®¤ä¸ºè¢«ç›‘æ§çš„æœåŠ¡å·²ç»ä¸‹çº¿æ—¶, å®ƒä¼šå‘ç½‘ç»œä¸­çš„å…¶ä»–sentinelè¿›è¡Œç¡®è®¤, åˆ¤æ–­è¯¥æœåŠ¡å™¨æ˜¯å¦çœŸçš„ä¸‹çº¿; å¦‚æœä¸‹çº¿çš„æ˜¯ä¸€ä¸ªä¸»æœåŠ¡å™¨, é‚£ä¹ˆsentinelå°†ä¼šå¯¹ä¸‹çº¿çš„ä¸»æœåŠ¡å™¨è¿›è¡Œ è‡ªåŠ¨æ•…éšœè½¬ç§»é€šè¿‡å°†ä¸‹çº¿ä¸»æœåŠ¡å™¨çš„æŸä¸ªä»æœåŠ¡å™¨æå‡ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨;å¹¶å°†ä¸‹çº¿ä¸»æœåŠ¡å™¨ä¸‹çš„ä»æœåŠ¡å™¨é‡æ–°æŒ‡å‘æ–°çš„ä¸»æœåŠ¡å™¨;æ¥è®©ç³»ç»Ÿä»æ–°å›åˆ°æ­£å¸¸; ä¹‹å‰çš„masterä¸‹çº¿å, å¦‚æœé‡æ–°ä¸Šçº¿äº†, sentinelä¼šè®©å®ƒä½œä¸ºä¸€ä¸ªsalve, å»æ–°çš„masterä¸­åŒæ­¥æ•°æ® å®æˆ˜ å¯åŠ¨sentinel: å°† /usr/local/src/ ç›®å½•ä¸‹çš„redis-sentinelç¨‹åºæ–‡ä»¶å¤åˆ¶åˆ° /usr/local/redis/bin ç›®å½•ä¸‹; å¯åŠ¨ä¸€ä¸ªè¿è¡Œåœ¨sentinelæ¨¡å¼ä¸‹çš„redisæœåŠ¡å®ä¾‹(ä¸¤ç§æ–¹å¼): redis-sentinel æˆ–è€… redis-server /usr/local/redis/sentinel.conf --sentinel sentinelé…ç½® Sentinelä¹‹é—´çš„è‡ªåŠ¨å‘ç°æœºåˆ¶è™½ç„¶sentinelé›†ç¾¤ä¸­å„ä¸ªsentineléƒ½äº’ç›¸è¿æ¥å½¼æ­¤æ¥æ£€æŸ¥å¯¹æ–¹çš„å¯ç”¨æ€§ä»¥åŠäº’ç›¸å‘é€æ¶ˆæ¯, ä½†å…¶å®ä½ æ˜¯ä¸ç”¨åœ¨ä»»ä½•ä¸€ä¸ªsentinelä¸­é…ç½®ä»»ä½•å…¶å®ƒçš„sentinelçš„èŠ‚ç‚¹çš„, å› ä¸ºsentinelåˆ©ç”¨äº†masterçš„å‘å¸ƒ/è®¢é˜…æœºåˆ¶å»è‡ªåŠ¨å‘ç°å…¶å®ƒä¹Ÿç›‘æ§äº†åŒä¸€masterçš„sentinelèŠ‚ç‚¹ã€‚ åŒæ ·ï¼Œä½ ä¹Ÿä¸éœ€è¦åœ¨sentinelä¸­é…ç½®æŸä¸ªmasterçš„æ‰€æœ‰slaveçš„åœ°å€ï¼Œsentinelä¼šé€šè¿‡è¯¢é—®masteræ¥å¾—åˆ°è¿™äº›slaveçš„åœ°å€çš„ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"21. äº†è§£redisæŒä¹…åŒ–","slug":"Redis/2017-06-24-redis-21","date":"2017-06-24T05:40:54.000Z","updated":"2018-03-09T07:49:23.000Z","comments":true,"path":"2017/06/24/Redis/2017-06-24-redis-21/","link":"","permalink":"http://blog.renyimin.com/2017/06/24/Redis/2017-06-24-redis-21/","excerpt":"","text":"Redisçš„ä¸¤ç§æŒä¹…åŒ–æ¨¡å¼ä»‹ç» RDB(Redis DB)ç®€ä»‹ RDBæŒä¹…åŒ–åŠŸèƒ½å¯ä»¥å°†redisæœåŠ¡å™¨åŒ…å«çš„æ‰€æœ‰æ•°æ®åº“æ•°æ®ä»¥äºŒè¿›åˆ¶æ–‡ä»¶(.rdbæ–‡ä»¶)çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜; RDB é»˜è®¤æ˜¯å¼€å¯çš„, å…³é—­æ–¹å¼æœ‰: æ³¨é‡Šæ‰é…ç½®æ–‡ä»¶ä¸­saveç­–ç•¥è¡Œ; åœ¨æ‰€æœ‰saveç­–ç•¥ä¸‹æ·»åŠ save &quot;&quot;; åˆ›å»ºRDBæ–‡ä»¶, å¸¸è§çš„ä¸‰ç§æ–¹å¼ ç»™redisæœåŠ¡å™¨å‘é€SAVEå‘½ä»¤; ç»™redisæœåŠ¡å™¨å‘é€BGSAVEå‘½ä»¤; åœ¨redisé…ç½®æ–‡ä»¶ä¸­é…ç½®rdbæŒä¹…åŒ–çš„saveç­–ç•¥, å¦‚æœé…ç½®é€‰é¡¹è¢«æ»¡è¶³, åˆ™æœåŠ¡å™¨ä¼šè‡ªåŠ¨æ‰§è¡ŒBGSAVE; è¿™ä¸‰ç§åˆ›å»ºRDBçš„æ–¹å¼, å‰ä¸¤ç§éœ€è¦æ‰‹åŠ¨å»æ‰§è¡Œ;è€Œç¬¬ä¸‰ç§æ˜¯æœåŠ¡å™¨è‡ªåŠ¨æ‰§è¡Œçš„; rdbæ–‡ä»¶æ¯æ¬¡éƒ½æ˜¯è¦†ç›–åˆ›å»º, æ‰€ä»¥ä¸ºäº†å®‰å…¨èµ·è§, éœ€è¦ä¸æ—¶åœ°å»å¤‡ä»½ç”Ÿæˆçš„rdbæ–‡ä»¶; ä¸‰ç§æ–¹å¼çš„åŒºåˆ« é€šè¿‡ä½¿ç”¨å®¢æˆ·ç«¯å‘redisæœåŠ¡å™¨å‘é€SAVEå‘½ä»¤, å¯ä»¥å‘½ä»¤æœåŠ¡å™¨å»åˆ›å»ºä¸€ä¸ªæ–°çš„RDBæ–‡ä»¶; æ³¨æ„: åœ¨redisæœåŠ¡å™¨æ‰§è¡ŒSAVEå‘½ä»¤çš„è¿‡ç¨‹ä¸­(ä¹Ÿå³åˆ›å»ºRDBæ–‡ä»¶çš„è¿‡ç¨‹ä¸­), redisæœåŠ¡å™¨å°†è¢«é˜»å¡, æœåŠ¡å™¨ç«¯æ— æ³•å†å»å¤„ç†å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤è¯·æ±‚, åªæœ‰åœ¨SAVEå‘½ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹å(ä¹Ÿå³RDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¹‹å), æœåŠ¡å™¨æ‰ä¼šé‡æ–°å¼€å§‹å¤„ç†å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤è¯·æ±‚; æ³¨æ„: å¦‚æœrdbæ–‡ä»¶å·²ç»å­˜åœ¨, æœåŠ¡å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„rdbæ–‡ä»¶å»ä»£æ›¿æ—§çš„rdbæ–‡ä»¶;æ‰€ä»¥: ä¹‹å‰çš„rdbæ–‡ä»¶ä½ å¯ä»¥ç”¨å®šæ—¶è„šæœ¬å®šæ—¶åœ°æ‹·èµ°, å¯ä»¥é˜²æ­¢å¤–ä¸€æ‰§è¡Œäº†flush dbå¹¶ä¸”æœåŠ¡å™¨è¿›è¡Œäº†save, æ­¤æ—¶æ—§çš„rdbä¼šè¢«æ–°çš„rdbæ–‡ä»¶è¦†ç›–æ‰, é‚£å°±å®Œè›‹äº†!!! é€šè¿‡ä½¿ç”¨å®¢æˆ·ç«¯å‘redisæœåŠ¡å™¨å‘é€BGSAVEå‘½ä»¤,ä¹Ÿå¯ä»¥å‘½ä»¤æœåŠ¡å™¨å»åˆ›å»ºä¸€ä¸ªæ–°çš„RDBæ–‡ä»¶; æ³¨æ„: BGSAVEå‘½ä»¤ä¸ä¼šé€ æˆæœåŠ¡å™¨é˜»å¡, ä¹Ÿå°±æ˜¯è¯´redisæœåŠ¡å™¨åœ¨æ‰§è¡ŒBGSAVEå‘½ä»¤çš„è¿‡ç¨‹ä¸­, redisæœåŠ¡å™¨ä»ç„¶å¯ä»¥æ­£å¸¸çš„å¤„ç†å…¶ä»–å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤è¯·æ±‚;BGSAVEå‘½ä»¤ä¸ä¼šé€ æˆæœåŠ¡å™¨é˜»å¡çš„åŸå› åœ¨äº: 12å½“redisæœåŠ¡å™¨æ¥æ”¶åˆ°BGSAVEå‘½ä»¤å,å®ƒä¸ä¼šäº²è‡ªå»åˆ›å»ºrdbæŒä¹…åŒ–æ–‡ä»¶,è€Œæ˜¯é€šè¿‡forkä¸€ä¸ªå­è¿›ç¨‹,ç„¶åç”±å­è¿›ç¨‹å»è´Ÿè´£è¿™ä¸ªrdbæ–‡ä»¶çš„ç”Ÿæˆ, è‡ªå·±åˆ™ç»§ç»­å¤„ç†å®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚;å½“å­è¿›ç¨‹åˆ›å»ºå¥½rdbæ–‡ä»¶å¹¶é€€å‡ºå, å®ƒä¼šå‘çˆ¶è¿›ç¨‹(ä¹Ÿå°±æ˜¯è´Ÿè´£å¤„ç†å‘½ä»¤è¯·æ±‚çš„redisæœåŠ¡å™¨)å‘é€ä¸€ä¸ªä¿¡å·,å‘ŠçŸ¥redisæœåŠ¡å™¨rdbæ–‡ä»¶å·²ç»åˆ›å»ºå®Œæ¯•; æ³¨æ„: ç”±äºåˆ›å»ºå­è¿›ç¨‹ä¼šæ¶ˆè€—é¢å¤–çš„å†…å­˜, æ‰€ä»¥saveåˆ›å»ºRDBæ–‡ä»¶çš„é€Ÿåº¦å…¶å®ä¼šæ¯”bgsaveå¿«, å› ä¸ºå®ƒå¯ä»¥é›†ä¸­èµ„æºæ¥åˆ›å»ºrdbæ–‡ä»¶; save å’Œ bgsave æ²¡æœ‰å­°å¥½å­°å, ä½ è¦è€ƒè™‘å“ªä¸ªæ›´é€‚åˆä½ å¦‚æœä½ çš„æ•°æ®åº“æ­£åœ¨ä¸Šçº¿å½“ä¸­, è‡ªç„¶ä½¿ç”¨ bgsave (è®©æœåŠ¡å™¨ä»¥éé˜»å¡æ–¹å¼è¿›è¡Œæœ€å¥½);ç›¸å,å¦‚æœä½ éœ€è¦åœ¨å‡Œæ™¨3ç‚¹é’Ÿç»´æŠ¤ä½ çš„redis, æ¯”å¦‚ç»´æŠ¤éœ€è¦åœæœºä¸€å°æ—¶, è¿™æ—¶ç³»ç»Ÿè¢«é˜»å¡äº†ä¹Ÿæ˜¯æ²¡å…³ç³»çš„, è¿™æ—¶å€™ä½ ä½¿ç”¨saveå‘½ä»¤å°±ä¼šå¥½ä¸€ç‚¹; è‡ªåŠ¨åˆ›å»ºrdbæ–‡ä»¶ é€šè¿‡åœ¨redisé…ç½®æ–‡ä»¶ä¸­é…ç½®redisæœåŠ¡å™¨åˆ›å»ºrdbæ–‡ä»¶çš„æ¡ä»¶, å°±å¯ä»¥è®©æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯æ“ä½œæ»¡è¶³saveç­–ç•¥æ‰€æŒ‡å®šçš„æ¡ä»¶æ—¶, è‡ªåŠ¨å»åˆ›å»ºrdbæ–‡ä»¶; æ¯”å¦‚, redisé»˜è®¤æƒ…å†µä¸‹å°±æ˜¯å¼€å¯rdbæŒä¹…åŒ–çš„, å¹¶ä¸”åˆ¶å®šäº†é»˜è®¤çš„saveæ¡ä»¶:123456save 900 1 #900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰å†…è‡³å°‘1ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰ save 300 10 #300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…è‡³å°‘10ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰ save 60 10000 #60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰å†…è‡³å°‘10000ä¸ªkeyå€¼æ”¹å˜ï¼ˆåˆ™è¿›è¡Œæ•°æ®åº“ä¿å­˜--æŒä¹…åŒ–ï¼‰è¿™äº›é»˜è®¤çš„saveé€‰é¡¹çš„æ„æ€æ˜¯:åªè¦ä¸‰ä¸ªæ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªæ¡ä»¶è¢«æ»¡è¶³æ—¶,æœåŠ¡å™¨å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æ¥åˆ›å»ºæ–°çš„rdbæ–‡ä»¶; æ¯æ¬¡åˆ›å»ºå®Œrdbæ–‡ä»¶ä¹‹å,æœåŠ¡å™¨ä¸ºå®ç°è‡ªåŠ¨æŒä¹…åŒ–ä¼šå°†&apos;ä¸ºå®ç°æŒä¹…åŒ–è€Œè®¾ç½®çš„æ—¶é—´è®¡æ•°å™¨å’Œæ¬¡æ•°è®¡æ•°å™¨æ¸…é›¶å¹¶é‡æ–°å¼€å§‹è®¡æ•°&apos;, æ‰€ä»¥å¤šä¸ªä¿å­˜æ¡ä»¶çš„æ•ˆæœæ˜¯ä¸ä¼šå åŠ çš„; RDBæŒä¹…åŒ–é—®é¢˜ rediså…³æœºæŒä¹…åŒ–: å½“ä½ æ­£å¸¸å…³é—­redisçš„æ—¶å€™, redisæœåŠ¡å™¨ä¸ä¼šå‚è€ƒé…ç½®ä¸­çš„saveç­–ç•¥; è€Œæ˜¯ä¼šç›´æ¥å…ˆè°ƒç”¨saveå‘½ä»¤, å°†redisæ‰€æœ‰æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¹‹åæ‰ä¼šçœŸæ­£è¿›è¡Œé€€å‡º; redis - crashä¸æŒä¹…åŒ–é—®é¢˜: è€Œå½“redisæœåŠ¡å™¨æ„å¤–æ–­ç”µå®•æœºçš„æ—¶å€™, ä½ ä¼šå‘ç°ä»ä¸Šä¸€æ¬¡å¿«ç…§ä¹‹åçš„æ•°æ®å°†å…¨éƒ¨ä¸¢å¤±; rdbæŒä¹…åŒ–çš„ä¼˜ç‚¹ é‡å»ºå¿«: åœ¨redisé‡Œ, é»˜è®¤ä½¿ç”¨RDBæ¨¡å¼, å› ä¸ºRDBæ¨¡å¼é‡å»ºæ•°æ®åº“æ¯”è¾ƒå¿«, è¿™é‡Œçš„é‡å»ºæ•°æ®åº“æ˜¯æŒ‡å°†æ•°æ®ä»ç¡¬ç›˜ç§»åˆ°å†…å­˜,å¹¶å»ºç«‹èµ·æ•°æ®åº“çš„è¿‡ç¨‹; å› ä¸ºå¯¹äºRDBæ¨¡å¼æ¥è¯´, é‡å»ºå°±æ˜¯æŠŠ dump.rdb æ–‡ä»¶åŠ è½½åˆ°å†…å­˜, å¹¶è§£å‹å­—ç¬¦ä¸²,å°±å»ºç«‹èµ·äº†æ•°æ®åº“; è€Œå¯¹äºAOFæ¨¡å¼æ¥è¯´, åˆ™æ˜¯åœ¨å¯åŠ¨RedisæœåŠ¡å™¨çš„æ—¶å€™, è¿è¡Œappendonly.aofæ—¥å¿—æ–‡ä»¶, åœ¨å†…å­˜ä¸­é‡æ–°å»ºç«‹æ•°æ®åº“; æ‰€ä»¥ä»è¿™é‡Œçš„æè¿°å°±å¯ä»¥çœ‹å‡º,AOFçš„é‡å»ºè¿‡ç¨‹æ˜¯è¦æ¯”RDBæ…¢çš„; ä½¿ç”¨RDBæ¨¡å¼çš„è¯ï¼Œ ç³»ç»Ÿä¼šå°†å†…å­˜ä¸­æ•°æ®åº“çš„å¿«ç…§æ¯éš”ä¸€æ®µæ—¶é—´é—´éš”æ›´æ–°åˆ°ç¡¬ç›˜ä¸­(dump.rdb æ–‡ä»¶é‡Œ), è¿™ä¸ªæ›´æ–°çš„é¢‘ç‡æ˜¯å¯ä»¥æŒ‡å®šçš„ã€‚ åœ¨redis.confä¸­æœ‰ä¸‰ä¸ªé…ç½®ç”¨æ¥æŒ‡å®šå†…å­˜æ•°æ®æ›´æ–°åˆ°ç¡¬ç›˜çš„é¢‘ç‡ï¼š 1234//æ ¼å¼æ˜¯ï¼šsave &lt;seconds&gt; &lt;changes&gt;save 900 1 //å¦‚æœä»…æœ‰1-9æ¬¡æ›´æ”¹æ“ä½œï¼Œé‚£ä¹ˆè¦900sæ‰å†™å…¥ç¡¬ç›˜ä¸€æ¬¡save 300 10 //å¦‚æœä»…æœ‰10-9999æ¬¡æ›´æ”¹æ“ä½œï¼Œé‚£ä¹ˆè¦300sæ‰å†™å…¥ç¡¬ç›˜ä¸€æ¬¡save 60 10000 //å¦‚æœè¶…è¿‡10000æ¬¡æ›´æ”¹æ“ä½œï¼Œé‚£ä¹ˆ60sæ‰ä¼šå†™å…¥ç¡¬ç›˜ä¸€æ¬¡ 900s(ä¹Ÿå°±æ˜¯15åˆ†é’Ÿ), 300s(å°±æ˜¯5åˆ†é’Ÿ): è¿™ä¸ªæ—¶é—´æŒºé•¿çš„, è¿™æ­£æ˜¯RDBæ¨¡å¼çš„ç¼ºç‚¹æ‰€åœ¨å¦‚æœæœåŠ¡å™¨å®•æœºçš„è¯, å¯èƒ½ä¼šé€ æˆæœ€åå‡ åˆ†é’Ÿ, ä¿å­˜åœ¨å†…å­˜ä¸­è¿˜æ¥ä¸åŠåˆ·å…¥ç¡¬ç›˜çš„æ•°æ®ä¸¢å¤±, å¦‚æœæ•°æ®å¾ˆé‡è¦é‚£å°±æƒ¨äº†; ä½†æ˜¯å¦‚æœæ•°æ®ä¸æ˜¯é‚£ä¹ˆé‡è¦, ä¸¢å¤±å‡ åˆ†é’Ÿæ•°æ®ä¹Ÿæ²¡ä»€ä¹ˆå…³ç³», é‚£ä¹ˆRDBæ¨¡å¼æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ rdbæŒä¹…åŒ–çš„ç¼ºç‚¹ ç”±äºåˆ›å»ºRDBæ–‡ä»¶éœ€è¦å°†æœåŠ¡å™¨æ‰€æœ‰çš„æ•°æ®åº“çš„æ•°æ®éƒ½ä¿å­˜èµ·æ¥, è¿™æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—èµ„æºå’Œæ—¶é—´çš„æ“ä½œ, æ‰€ä»¥æœåŠ¡å™¨éœ€è¦éš”ä¸€æ®µäº‹ä»¶å†æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„rdbæ–‡ä»¶, ä¹Ÿå°±æ˜¯è¯´rdbæ–‡ä»¶çš„åˆ›å»ºæ“ä½œä¸èƒ½æ‰§è¡Œçš„è¿‡äºé¢‘ç¹, å¦åˆ™å°†ä¼šä¸¥é‡å½±å“æœåŠ¡å™¨çš„æ€§èƒ½; ç”±äºåªèƒ½éš”ä¸€æ®µæ—¶é—´å†å»åˆ›å»ºä¸€ä¸‹rdbæ–‡ä»¶, æ‰€ä»¥å¦‚æœåœ¨é—´éš”çš„è¿™æ®µæ—¶é—´ä¸­æœåŠ¡å™¨å®•æœº, é‚£è¿™æ®µé—´éš”ä¸­çš„æ•°æ®å°±ä¸¢å¤±äº†, æ¯”å¦‚redisæœåŠ¡åœ¨åˆ›å»ºrdbæ–‡ä»¶æ—¶, å¦‚æœä½¿ç”¨äº†é»˜è®¤çš„saveé€‰é¡¹, å¯èƒ½å°±ä¼šä¸¢å¤±60ç§’çš„æ•°æ®, è¿™å°±æœ‰ç‚¹ä¸¥é‡äº†!!! æ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, rdbå¯ä»¥ç»“åˆaofæ¥ä¸€èµ·è¿›è¡ŒæŒä¹…åŒ– aofå°±è§£å†³äº†æœåŠ¡å™¨ä¸èƒ½é¢‘ç¹æ‰§è¡ŒrdbæŒä¹…åŒ–çš„é—®é¢˜! AOF (Append Only File)ç®€ä»‹ ä¸ºäº†è§£å†³rdbæŒä¹…åŒ–åœ¨æœåŠ¡å™¨æ„å¤–å®•æœºçš„æƒ…å†µä¸‹é€ æˆçš„æ•°æ®ä¸¥é‡ä¸¢å¤±çš„é—®é¢˜, redisè¿˜æä¾›äº†å¦å¤–ä¸€ç§æŒä¹…åŒ–æ–¹æ¡ˆ, é‚£å°±æ˜¯ aofæŒä¹…åŒ–! AOFæ¨¡å¼æ˜¯å°†æ“ä½œæ—¥å¿—è®°åœ¨appendonly.aofæ–‡ä»¶é‡Œ, æ¯æ¬¡å¯åŠ¨æœåŠ¡å™¨å°±ä¼šè¿è¡Œappendonly.aofé‡Œçš„å‘½ä»¤é‡æ–°å»ºç«‹æ•°æ®åº“; å› ä¸ºè¦é‡æ–°è¿è¡Œå‘½ä»¤, æ‰€ä»¥appendonly.aofæ˜¯æ¯”è¾ƒæ…¢çš„, é»˜è®¤AOFæ¨¡å¼ä¹Ÿæ˜¯å…³é—­çš„; ä½ å¯ä»¥åœ¨redisé…ç½®æ–‡ä»¶(redis.conf)ä¸­, é…ç½® appendonly yes æ‰“å¼€AOFæ¨¡å¼; aoféœ€è¦æ³¨æ„çš„é—®é¢˜ åœ¨aofæŒä¹…åŒ–çš„æ¨¡å¼ä¸‹, è™½ç„¶redisæœåŠ¡å™¨åœ¨æ‰§è¡Œä¿®æ”¹æ•°æ®çš„å‘½ä»¤å, ä¼šæŠŠæ‰§è¡Œçš„å‘½ä»¤å†™å…¥åˆ°aofæ–‡ä»¶ä¸­, ä½†è¿™å¹¶ä¸æ„å‘³ç€aofæ–‡ä»¶æŒä¹…åŒ–ä¸ä¼šä¸¢å¤±ä»»ä½•æ•°æ®; åœ¨å¸¸è§çš„æ“ä½œç³»ç»Ÿä¸­, æ‰§è¡Œç³»ç»Ÿè°ƒç”¨writeå‡½æ•°, å°†ä¸€äº›å†…å®¹å†™åˆ°æŸä¸ªæ–‡ä»¶ä¸­æ—¶, ä¸ºäº†æé«˜æ•ˆç‡, ç³»ç»Ÿé€šå¸¸ä¸ä¼šç›´æ¥å°†å†…å®¹å†™å…¥åˆ°ç£ç›˜é‡Œé¢, è€Œæ˜¯å…ˆå°†å†…å®¹æ”¾å…¥ä¸€ä¸ªå†…å­˜ç¼“å†²åŒº(buffer)é‡Œé¢, ç­‰åˆ°ç¼“å†²åŒºè¢«å¡«æ»¡, æˆ–è€…ç”¨æˆ·æ‰§è¡Œfsyncè°ƒç”¨å’Œfdatasyncè°ƒç”¨æ—¶, ç³»ç»Ÿæ‰ä¼šå°†å­˜å‚¨åœ¨ç¼“å†²åŒºé‡Œé¢çš„å†…å®¹çœŸæ­£å†™å…¥åˆ°ç¡¬ç›˜é‡Œ; æ‰€ä»¥å¯¹AOFæŒä¹…åŒ–æ¥è¯´, å½“ä¸€æ¡å‘½ä»¤çœŸæ­£çš„è¢«å†™å…¥åˆ°ç¡¬ç›˜é‡Œé¢æ—¶, è¿™æ¡å‘½ä»¤æ‰ä¸ä¼šå› åœæœºè€Œæ„å¤–ä¸¢å¤±; å› æ­¤,aofæŒä¹…åŒ–åœ¨é­é‡åœæœºæ—¶ä¸¢å¤±å‘½ä»¤çš„æ•°é‡, å–å†³äºå‘½ä»¤è¢«å†™å…¥åˆ°ç¡¬ç›˜çš„æ—¶é—´;è¶Šæ—©å°†å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜,å‘ç”Ÿæ„å¤–åœæœºæ—¶ä¸¢å¤±çš„æ•°æ®å°±è¶Šå°‘;è€Œè¶Šè¿Ÿå°†å‘½ä»¤å†™å…¥ç¡¬ç›˜,å‘ç”Ÿæ„å¤–åœæœºæ—¶ä¸¢å¤±çš„æ•°æ®å°±è¶Šå¤š; æ‰€ä»¥aofæŒä¹…åŒ–æ¨¡å¼è¿˜æœ‰ä¸‰ç§æ‰§è¡Œç­–ç•¥ä¾›ä½ é€‰æ‹©; AOFæ¨¡å¼ä¸‰ç§è¿½åŠ ç­–ç•¥è¿™ä¸‰ç§è¿½åŠ ç­–ç•¥ä¸»è¦å°±æ˜¯ç”¨æ¥æŒ‡å®šä»€ä¹ˆæ—¶æœºå¯ä»¥å°†æ“ä½œæ—¥å¿—çœŸæ­£è¿½åŠ åˆ°appendonly.aofæ–‡ä»¶é‡Œ; always : æœåŠ¡å™¨æ¯å†™å…¥ä¸€ä¸ªå‘½ä»¤, å°±è°ƒç”¨ä¸€æ¬¡fdatasync, å°†ç¼“å†²åŒºé‡Œé¢çš„å‘½ä»¤å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ä¸­, åœ¨è¿™ç§æ¨¡å¼ä¸‹, æœåŠ¡å™¨å³ä½¿é­é‡æ„å¤–åœæœº, ä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•è‡ªå·±å·²ç»æˆåŠŸæ‰§è¡Œçš„å‘½ä»¤æ•°æ®; æ¯”è¾ƒå®‰å…¨, ä½†æ¯”è¾ƒæ…¢; (ç±»ä¼¼mysqläº†) everysec: æœåŠ¡å™¨æ¯ä¸€ç§’é‡æ–°è°ƒç”¨ä¸€æ¬¡fdatasync, å°†ç¼“å†²åŒºé‡Œé¢çš„æ“ä½œæ—¥å¿—å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ä¸­, è¿™æ˜¯ç³»ç»Ÿé»˜è®¤çš„æ–¹å¼, æ˜¯ä¸€ç§æƒè¡¡æŠ˜è¡·; é€šå¸¸è¿™ç§æ–¹å¼ä¼šæ¯”è¾ƒå¥½, åœ¨è¿™ç§æ¨¡å¼ä¸‹, æœåŠ¡å™¨å³ä½¿é­é‡æ„å¤–åœæœºæ—¶, æœ€å¤šåªä¸¢å¤±ä¸€ç§’é’Ÿçš„å†…æ‰§è¡Œçš„å‘½ä»¤; no: æœåŠ¡å™¨ä¸ä¸»åŠ¨è°ƒç”¨fdatasync, ç”±æ“ä½œç³»ç»Ÿå»å†³å®šä»€ä¹ˆæ—¶å€™å°†ç¼“å†²åŒºé‡Œé¢çš„å‘½ä»¤å†™å…¥åˆ°ç¡¬ç›˜é‡Œé¢; åœ¨è¿™ç§æ¨¡å¼ä¸‹,æœåŠ¡å™¨é­é‡æ„å¤–åœæœºæ—¶, ä¸¢å¤±çš„å‘½ä»¤æ•°é‡æ˜¯ä¸ç¡®å®šçš„; å¯ä»¥åœ¨redis.confä¸­é…ç½®è¿™ä¸‰ç§ç­–ç•¥ å¯ä»¥çœ‹åˆ°é»˜è®¤ä½¿ç”¨çš„æ˜¯everysecè¿™ç§æŠ˜ä¸­ç­–ç•¥;123# appendfsync alwaysappendfsync everysec# appendfsync no AOFæ–‡ä»¶ä¸­çš„å†—ä½™å‘½ä»¤(aofæ–‡ä»¶é‡å†™) éšç€æœåŠ¡å™¨çš„ä¸æ–­è¿è¡Œ,ä¸ºäº†è®°å½•æ•°æ®åº“å‘ç”Ÿçš„å˜åŒ–, æœåŠ¡å™¨ä¼šå°†è¶Šæ¥è¶Šå¤šçš„å‘½ä»¤å†™å…¥åˆ°aofæ–‡ä»¶ä¸­, ä½¿å¾—aofæ–‡ä»¶çš„ä½“ç§¯ä¸æ–­å¢å¤§; ä¸ºäº†è®©aofæ–‡ä»¶çš„å¤§å°æ§åˆ¶åœ¨åˆç†çš„èŒƒå›´, é¿å…å®ƒç–¯ç‹‚å¢é•¿, redisæä¾›äº†AOFé‡å†™åŠŸèƒ½, é€šè¿‡è¿™ä¸ªåŠŸèƒ½, æœåŠ¡å™¨å¯ä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„aofæ–‡ä»¶: æ–°çš„aofæ–‡ä»¶è®°å½•çš„å†…å®¹å’ŒåŸæœ‰çš„aofæ–‡ä»¶è®°å½•çš„å†…å®¹åœ¨redisæœåŠ¡å™¨é‡å»ºæ•°æ®å, æ•°æ®å®Œå…¨ä¸€æ ·; æ–°çš„aofæ–‡ä»¶ä¼šä½¿ç”¨å°½å¯èƒ½å°‘çš„å‘½ä»¤æ¥è®°å½•æ•°æ®åº“æ•°æ®, å› æ­¤æ–°çš„aofæ–‡ä»¶çš„ä½“ç§¯é€šå¸¸ä¼šæ¯”åŸæœ‰aofæ–‡ä»¶çš„ä½“ç§¯è¦å°å¾—å¤š; aofé‡å†™æœŸé—´, æœåŠ¡å™¨ä¸ä¼šè¢«é˜»å¡, å¯ä»¥æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤è¯·æ±‚; æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§¦å‘aofæ–‡ä»¶é‡å†™ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ BGREWRITEAOF å‘½ä»¤; é€šè¿‡è®¾ç½®é…ç½®æ–‡ä»¶é€‰é¡¹æ¥è®©æœåŠ¡å™¨è‡ªåŠ¨æ‰§è¡ŒBGWRITEAOFå‘½ä»¤; 1234567auto-aof-rewrite-min-size &lt;size&gt;è§¦å‘aofé‡å†™æ‰€éœ€çš„æœ€å°ä½“ç§¯:åªè¦aofæ–‡ä»¶çš„ä½“ç§¯å¤§äºç­‰äºsizeæ—¶,æœåŠ¡å™¨æ‰ä¼šè€ƒè™‘æ˜¯å¦éœ€è¦è¿›è¡Œaofé‡å†™,è¿™ä¸ªé€‰é¡¹ç”¨äºé¿å…å¯¹ä½“ç§¯è¿‡å°çš„aofæ–‡ä»¶è¿›è¡Œé‡å†™auto-aof-rewrite-percentage 100æŒ‡å®šè§¦å‘é‡å†™æ‰€éœ€çš„aofæ–‡ä»¶ä½“ç§¯ç™¾åˆ†æ¯”, å½“aofæ–‡ä»¶çš„ä½“ç§¯å¤§äºauto-aof-rewrite-min-sizeæŒ‡å®šçš„ä½“ç§¯,å¹¶ä¸”è¶…è¿‡ä¸Šä¸€æ¬¡é‡å†™ä¹‹åçš„aofæ–‡ä»¶ä½“ç§¯çš„percent%æ—¶, å°±ä¼šè§¦å‘aofé‡å†™,(å¦‚æœæœåŠ¡å™¨å¯åŠ¨åˆšåˆšä¸å°±,è¿˜æ²¡æœ‰è¿›è¡Œè¿‡aofé‡å†™,é‚£ä¹ˆä½¿ç”¨æœåŠ¡å™¨å¯åŠ¨æ—¶è½½å…¥çš„aofæ–‡ä»¶ä½“ç§¯æ¥ä½œä¸ºåŸºå‡†å€¼)å°†è¿™ä¸ªå€¼è®¾ç½®ä¸º0è¡¨ç¤ºå…³é—­è‡ªåŠ¨aofé‡å†™; ä¾‹å­ 1234//åªæœ‰å½“aofæ–‡ä»¶çš„å¢é‡å¤§äº100%çš„æ—¶å€™æ‰è¿›è¡Œé‡å†™auto-aof-rewrite-percentage 100//å½“aofæ–‡ä»¶å¤§äº64mbä¹‹åæ‰è€ƒè™‘è¿›è¡Œaofé‡å†™,è¿˜éœ€è¦çœ‹ä¸Šä¸€æ¡çš„ç™¾åˆ†æ¯”å¢é‡å¤Ÿä¸å¤Ÿauto-aof-rewrite-min-size 64mb å¦‚æœAOFæ–‡ä»¶å‡ºé”™äº† æœåŠ¡å™¨å¯èƒ½åœ¨ç¨‹åºæ­£åœ¨å¯¹AOFæ–‡ä»¶è¿›è¡Œå†™å…¥æ—¶åœæœº, å¦‚æœåœæœºé€ æˆäº†AOFæ–‡ä»¶å‡ºé”™(corrupt), é‚£ä¹ˆ Redis åœ¨é‡å¯æ—¶ä¼šæ‹’ç»è½½å…¥è¿™ä¸ª AOF æ–‡ä»¶, ä»è€Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ä¸ä¼šè¢«ç ´å; å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶,å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä¿®å¤å‡ºé”™çš„ AOF æ–‡ä»¶ï¼š é¦–å…ˆå…ˆä¸ºç°æœ‰çš„ AOF æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå¤‡ä»½; ç„¶åä½¿ç”¨ Redis é™„å¸¦çš„ redis-check-aof ç¨‹åº, å¯¹åŸæ¥çš„ AOF æ–‡ä»¶è¿›è¡Œä¿®å¤: $ redis-check-aof --fix (å¯é€‰)ä½¿ç”¨ diff -u å¯¹æ¯”ä¿®å¤åçš„ AOF æ–‡ä»¶å’ŒåŸå§‹ AOFæ–‡ä»¶çš„å¤‡ä»½, æŸ¥çœ‹ä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´çš„ä¸åŒä¹‹å¤„ã€‚ é‡å¯ Redis æœåŠ¡å™¨ï¼Œç­‰å¾…æœåŠ¡å™¨è½½å…¥ä¿®å¤åçš„ AOF æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"11. Redis -- task queue","slug":"Redis/2017-06-17-redis-11","date":"2017-06-17T03:30:03.000Z","updated":"2018-03-16T06:08:00.000Z","comments":true,"path":"2017/06/17/Redis/2017-06-17-redis-11/","link":"","permalink":"http://blog.renyimin.com/2017/06/17/Redis/2017-06-17-redis-11/","excerpt":"","text":"å‰è¨€ç°åœ¨æœ‰å¾ˆå¤šä¸“é—¨çš„é˜Ÿåˆ—è½¯ä»¶(å¦‚ActiveMQ, RabbitMQç­‰)ï¼Œåœ¨ç¼ºå°‘ä¸“é—¨çš„ä»»åŠ¡é˜Ÿåˆ—å¯ç”¨çš„æƒ…å†µä¸‹, ä¹Ÿå¯ä»¥ä½¿ç”¨Redisçš„é˜Ÿåˆ—æœºåˆ¶; FIFO å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ— Redisçš„åˆ—è¡¨ç»“æ„, å…è®¸é€šè¿‡ RPUSHå’ŒLPUSHä»¥åŠRPOPå’ŒLPOP, ä»åˆ—è¡¨çš„ä¸¤ç«¯æ¨å…¥å’Œå¼¹å‡ºå…ƒç´ ã€‚ å‡è®¾ä¸€ä¸ªæ“ä½œä¸­, æœ‰å‘ç”¨æˆ·å‘é€ç”µå­é‚®ä»¶è¿™ä¸€åŠŸèƒ½, ç”±äºè¿™ä¸€åŠŸèƒ½å¯èƒ½ä¼šæœ‰éå¸¸é«˜çš„å»¶è¿Ÿ,ç”šè‡³å¯èƒ½ä¼šå‡ºç°å‘é€å¤±è´¥, æ‰€ä»¥è¿™é‡Œå°±ä¸èƒ½é‡‡ç”¨å¹³æ—¶å¸¸è§çš„ä»£ç æµæ–¹å¼æ¥æ‰§è¡Œè¿™ä¸ªé‚®ä»¶å‘é€æ“ä½œ; ä¸ºæ­¤, å¯ä»¥ä½¿ç”¨ ä»»åŠ¡é˜Ÿåˆ— æ¥è®°å½• â€œé‚®ä»¶çš„æ”¶ä¿¡äºº,é‚®ä»¶å†…å®¹,å‘é€é‚®ä»¶çš„åŸå› â€, ä»¥ å…ˆåˆ°å…ˆæœåŠ¡ çš„æ–¹å¼å‘é€é‚®ä»¶(æ­¤å¤„é‡‡ç”¨çš„æ˜¯ ä»å³æ¨å…¥é˜Ÿåˆ—, ä»å·¦å¼¹å‡ºå…ƒç´ ) é˜Ÿåˆ—: redisæœåŠ¡ä¸­çš„åˆ—è¡¨ç±»å‹å°±å……å½“äº†é˜Ÿåˆ—æœåŠ¡ æ¶ˆè´¹è€…: é˜»å¡ç­‰å¾… (åœ¨Laravelå°†å…¶åšæˆå‘½ä»¤è¿›è¡Œå¯åŠ¨, è¯¥æ¶ˆè´¹è€…å°±ä¼šé˜»å¡ç­‰å¾…) 12345public function redisListBrpop()&#123; $res = Redis::blpop([&apos;queue:email&apos;], 0); return $res;&#125; ç”Ÿäº§è€…: ç›´æ¥è®¿é—®å¦‚ä¸‹ä»£ç æ¨é€å¤šæ¡æ¶ˆæ¯ 1234567891011121314151617181920public function rPush()&#123; $data1 = json_encode([ &apos;user_id&apos; =&gt; 11, &apos;content&apos; =&gt; &apos;æœ€è¿‘æ¨å‡ºæ–°æ¬¾æ±½è½¦--å®é©¬, å”®ä»·:$12W&apos;, &apos;time&apos; =&gt; time(), ], JSON_UNESCAPED_UNICODE); $data2 = json_encode([ &apos;user_id&apos; =&gt; 12, &apos;content&apos; =&gt; &apos;æœ€è¿‘æ¨å‡ºæ–°æ¬¾æ±½è½¦--å¥”é©°, å”®ä»·:$15.8W&apos;, &apos;time&apos; =&gt; time(), ], JSON_UNESCAPED_UNICODE); $data3 = json_encode([ &apos;user_id&apos; =&gt; 13, &apos;content&apos; =&gt; &apos;æœ€è¿‘æ¨å‡ºæ–°æ¬¾æ±½è½¦--å¤§ä¼—, å”®ä»·:$20W&apos;, &apos;time&apos; =&gt; time(), ], JSON_UNESCAPED_UNICODE); //ä¸€æ—¦è¿è¡Œå°±ä¼šé˜»å¡èµ·æ¥ Redis::rpush(&apos;queue:email&apos;, [$data1, $data2, $data3]);&#125; æœ€ç»ˆæ¶ˆè´¹è€…æ­£å¸¸æ‹¿åˆ°æ¶ˆæ¯, å¹¶ä¸”é¡ºåºä¹Ÿæ˜¯æ­£ç¡®çš„; å¤šç§ä»»åŠ¡çš„é˜Ÿåˆ— ä¸€èˆ¬æƒ…å†µä¸‹, æˆ‘ä»¬ä¸ºæ¯ç§ä»»åŠ¡å•ç‹¬ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—çš„; ä½†å¦‚æœæœ‰ä¸€ä¸ªé˜Ÿåˆ—å¤„ç†å¤šç§ä»»åŠ¡çš„åœºæ™¯, å®ç°èµ·æ¥ä¹Ÿå¾ˆæ–¹ä¾¿; åªç”¨åœ¨æ¶ˆæ¯ä¸­æŒ‡æ˜æ¶ˆæ¯æ‰€éœ€è¦è°ƒç”¨çš„å›è°ƒå‡½æ•°å³å¯; priority ä¼˜å…ˆçº§é˜Ÿåˆ—ä¼˜å…ˆçº§é˜Ÿåˆ—å…¶å®åœ¨redisä¸­å¯ä»¥ä¾é  BRPOPå’ŒBLPOPçš„ç‰¹æ€§; å½“ BLPOP è¢«è°ƒç”¨æ—¶, å¦‚æœç»™å®škey(é˜Ÿåˆ—)åˆ—è¡¨ä¸­, è‡³å°‘æœ‰ä¸€ä¸ªéç©ºåˆ—è¡¨, é‚£ä¹ˆå¼¹å‡ºé‡åˆ°çš„ç¬¬ä¸€ä¸ªéç©ºåˆ—è¡¨çš„å¤´å…ƒç´ , å¹¶å¼¹å‡ºå…ƒç´ æ‰€å±çš„åˆ—è¡¨åå­—ä¸€èµ·, ç»„æˆç»“æœè¿”å›ç»™è°ƒç”¨è€…; ä¹Ÿå°±æ˜¯è¯´, BLPOP ç»™å®šçš„é˜Ÿåˆ—åˆ—è¡¨ä¸­, é å‰çš„å°±æ˜¯ä¼˜å…ˆçº§é«˜çš„;å‡è®¾ä½ æœ‰ â€˜é‡ç½®å¯†ç çš„é‚®ä»¶â€™, â€˜æé†’é‚®ä»¶â€™, â€˜å‘å¹¿å‘Šçš„é‚®ä»¶â€™, ä¸‰ç§é˜Ÿåˆ—, å¦‚æœä½ æœŸæœ›ä»–ä»¬æŒ‰ç…§ä¼˜å…ˆçº§ä¾æ¬¡æ’åˆ—, é‚£ä¹ˆåªç”¨è®¾ç½®ä¸º:12345public function redisListBrpop()&#123; $res = Redis::blpop([&apos;queue:email:resetpwd&apos;, &apos;queue:email:warning&apos;, &apos;queue:email:advertisement&apos;], 0); return $res;&#125; æƒ³ä¼˜å…ˆæ¨é€çš„, ä½ å°±æ”¾å…¥ç¬¬ä¸€ä¸ªé˜Ÿåˆ—â€™queue:email:resetpwdâ€™ä¸­(BRPOP)ä¹Ÿç±»ä¼¼ ä¹Ÿå¯å‚è€ƒ: http://blog.csdn.net/woshiaotian/article/details/44757621 å»¶è¿Ÿé˜Ÿåˆ—æœªå®Œå¾…ç»­~~","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"12. Redis -- å‘å¸ƒè®¢é˜…","slug":"Redis/2017-06-18-redis-12","date":"2017-06-17T03:30:03.000Z","updated":"2018-03-09T09:55:58.000Z","comments":true,"path":"2017/06/17/Redis/2017-06-18-redis-12/","link":"","permalink":"http://blog.renyimin.com/2017/06/17/Redis/2017-06-18-redis-12/","excerpt":"","text":"å‘å¸ƒè®¢é˜…å…¶å® å’Œ é˜Ÿåˆ— éå¸¸ç›¸ä¼¼: è¿™é‡Œçš„ é¢‘é“, å°±ç±»ä¼¼äºä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰€è®¨è®ºçš„ é˜Ÿåˆ—; è€Œè®¢é˜…è€…å°±ç±»ä¼¼äº ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰€è®¨è®ºçš„ æ¶ˆè´¹è€…; ä½†ä»–ä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„: å¯¹äºé˜Ÿåˆ—æ¥è¯´, å³ä½¿æ¶ˆè´¹è€…ä¸åœ¨çº¿, æ¶ˆæ¯ä¹Ÿä¸€ç›´åœ¨é˜Ÿåˆ—ä¸­å­˜æ”¾ç€, ç­‰å¾…æ¶ˆè´¹è€…ä¸Šçº¿åè¿›è¡Œå¤„ç†; è€Œå¯¹äº å‘å¸ƒè®¢é˜… ä¸­çš„ è®¢é˜…è€…æ¥è¯´, å¦‚æœæ¶ˆæ¯å‘å¸ƒåˆ°é¢‘é“ä¸­æ—¶, è®¢é˜…è€…ä¸åœ¨çº¿(æ²¡æœ‰ä¸€ç›´é˜»å¡ç­‰å¾…), é‚£ä¹ˆè¿™æ¡æ¶ˆæ¯ä¹Ÿä¸ä¼šä¸ºå®ƒä¿å­˜ç€; å¦å¤–å¯¹äºé˜Ÿåˆ—æ¥è¯´, å…¶ä¸­çš„æ¶ˆæ¯åªè¦è¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†äº†, å…¶ä»–æ¶ˆè´¹è€…å°±ä¸ç”¨å¤„ç†äº†; è€Œå¯¹äºå‘å¸ƒè®¢é˜…æ¥è¯´, å‘é¢‘é“ä¸­å‘å¸ƒä¸€æ¡æ¶ˆæ¯, åˆ™æ‰€æœ‰åœ¨çº¿çš„è®¢é˜…è€…éƒ½å¯ä»¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯; (è²Œä¼¼æ˜¯æ¯”è¾ƒæ˜¯ä¸ªåšèŠå¤©å®¤ä¹‹ç±»çš„ä¸œè¥¿) å®ä¾‹å¯ä»¥å‚è€ƒæœ‰é“ç¬”è®°","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"08. redisé” -- ä¸å¤ªå®‰å…¨?","slug":"Redis/2017-06-12-redis-08","date":"2017-06-12T08:35:08.000Z","updated":"2018-03-16T06:16:10.000Z","comments":true,"path":"2017/06/12/Redis/2017-06-12-redis-08/","link":"","permalink":"http://blog.renyimin.com/2017/06/12/Redis/2017-06-12-redis-08/","excerpt":"","text":"å‰è¨€ä¸€èˆ¬æ¥è¯´, åœ¨å¯¹æ•°æ®è¿›è¡Œâ€åŠ é”â€æ—¶, ç¨‹åºé¦–å…ˆéœ€è¦è·å–é”æ¥å¾—åˆ°å¯¹æ•°æ®è¿›è¡Œæ’ä»–æ€§è®¿é—®çš„èƒ½åŠ›, ç„¶åæ‰èƒ½å¯¹æ•°æ®æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œ, æœ€åè¿˜è¦å°†é”é‡Šæ”¾ç»™å…¶ä»–ç¨‹åº;ä¹‹å‰å·²ç»äº†è§£è¿‡, Redisä½¿ç”¨WATCHå‘½ä»¤æ¥ä»£æ›¿å¯¹æ•°æ®è¿›è¡ŒåŠ é”, å› ä¸ºWATCHåªä¼šåœ¨æ•°æ®è¢«å…¶ä»–å®¢æˆ·ç«¯æŠ¢å…ˆä¿®æ”¹äº†çš„æƒ…å†µä¸‹é€šçŸ¥æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤çš„å®¢æˆ·ç«¯, æ‰€ä»¥è¿™ä¸ªå‘½ä»¤è¢«ç§°ä¸ºä¹è§‚é”; SETEX å®ç°é”ä»‹ç»ä¸ºäº†å¯¹æ•°æ®è¿›è¡Œæ’ä»–æ€§è®¿é—®, ç¨‹åºé¦–å…ˆè¦åšçš„å°±æ˜¯è·å–é”; è€Œ Redis çš„ SETEX å‘½ä»¤å¤©ç”Ÿå°±é€‚åˆç”¨æ¥å®ç°é”çš„è·å–åŠŸèƒ½; è¿™ä¸ªå‘½ä»¤åªä¼šåœ¨é”®ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ä¸ºé”®è®¾ç½®å€¼, è€Œå…¶ä»–è¿›ç¨‹ä¸€æ—¦å‘ç°é”®å­˜åœ¨, é‚£å°±åªèƒ½ç­‰å¾…ä¹‹å‰é”çš„é‡Šæ”¾; å‡†å¤‡ç¯å¢ƒ æ•°æ®è¡¨å‡†å¤‡ 123456789DROP TABLE IF EXISTS `goods`;CREATE TABLE `goods` ( `id` int(10) NOT NULL AUTO_INCREMENT, `goods_name` varchar(100) NOT NULL, `num` int(100) DEFAULT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;INSERT INTO `goods` VALUES (1, &apos;iphone 6 plus&apos;, 10); è¶…å–ä»£ç : 12345678public function mysqlOverSell()&#123; $good = Goods::select(&apos;num&apos;)-&gt;find(1); if ($good[&apos;num&apos;] &gt; 0) &#123; usleep(500000); Goods::where([&apos;id&apos; =&gt; 1])-&gt;decrement(&apos;num&apos;, 1); &#125;&#125; Jmeterå‹æµ‹é…ç½®: ç»“æœå‘ç°è¶…å–: (åæ¥è®¾ç½®å‹æµ‹ä¸ºæ¯ç§’3ä¸ªçº¿ç¨‹, ä¹Ÿè¶…å–äº†1ä»¶) ä½¿ç”¨redisçš„setexåŠ é” redis 123127.0.0.1:6379&gt; keys *(empty list or set)127.0.0.1:6379&gt; ä»£ç  123456789101112131415public function setnx()&#123; $lock = Redis::setnx(&apos;tag&apos;, 1); // å¦‚æœåŠ é”æˆåŠŸ, åˆ™å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œ(å…¶ä»–å®¢æˆ·ç«¯åªèƒ½ç­‰å¾…é”é‡Šæ”¾) if ($lock) &#123; $good = Goods::select(&apos;num&apos;)-&gt;find(1); if ($good[&apos;num&apos;] &gt; 0) &#123; usleep(200000); Goods::where([&apos;id&apos; =&gt; 1])-&gt;decrement(&apos;num&apos;, 1); &#125; // æ³¨æ„: æ‰§è¡Œå®Œæˆä¹‹å, å¿…é¡»é‡Šæ”¾é” Redis::del(&apos;tag&apos;); &#125;&#125; ä¿®æ”¹jmeterè®¿é—®è·¯ç”±, é‡æ–°æµ‹è¯•, å‘ç°ç¡®å®ä¸ä¼šå‡ºç°è¶…å–ç°è±¡äº† SETEXé” - é—®é¢˜æ­»é”å®¢æˆ·ç«¯çš„çªç„¶ä¸‹çº¿å¯¼è‡´é”ä¸è¢«é‡Šæ”¾å› ä¸ºå®¢æˆ·ç«¯å³ä½¿åœ¨ä½¿ç”¨é”çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½ä¼šå› ä¸ºè¿™æ ·æˆ–é‚£æ ·çš„åŸå› è€Œä¸‹çº¿, æ‰€ä»¥ä¸ºäº†é˜²æ­¢å®¢æˆ·ç«¯åœ¨å–å¾—é”ä¹‹åå´©æºƒ, å¹¶å¯¼è‡´é”ä¸€ç›´å¤„äº å·²è·å– çŠ¶æ€;æ‰€ä»¥è¿˜åº”è¯¥ä¸ºé”çš„å®ç°åŠ ä¸Š è¶…æ—¶é™åˆ¶ çš„ç‰¹æ€§: å¦‚æœè·å¾—é”çš„è¿›ç¨‹æœªèƒ½åœ¨æŒ‡å®šæ—¶é™å†…å®Œæˆæ“ä½œ, é‚£ä¹ˆå¯èƒ½ä¼šè®¤ä¸ºå®¢æˆ·ç«¯å·²ç»crashæ‰çº¿, æ‰€ä»¥é”å°†éœ€è¦è¢«è‡ªåŠ¨é‡Šæ”¾; SETEXé”è®¾è¶…æ—¶é™åˆ¶ ä¸ºé”åŠ è¶…æ—¶é™åˆ¶çš„æ™®é€šæ–¹æ³•å¦‚ä¸‹ 1234567$lock = Redis::setnx(&quot;tag&quot;, 1)if ($lock) &#123; Redis::expire(&quot;my:lock&quot;, 10); // ... do something Redis::del(&quot;my:lock&quot;)&#125; å¦‚æœå®¢æˆ·ç«¯æ˜¯åœ¨ Redis::expire(&quot;my:lock&quot;, 10); ä¹‹å‰å°±å´©æºƒ, é”ä¸è¢«é‡Šæ”¾çš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨; ä» setnx åˆ° set æ‰€ä»¥, ä»redis2.6.12å¼€å§‹(setæ–°å¢äº†å¯é€‰é€‰é¡¹), å®˜æ–¹å»ºè®®ä½¿ç”¨setå‘½ä»¤æ›¿ä»£setnxæ¥å®ç°é”, å¦‚ä¸‹ 12345if (Redis::set(&quot;tag&quot;, 1, &quot;nx&quot;, &quot;ex&quot;, 10)) &#123; ... do something Redis::del(&quot;tag&quot;)&#125; é‡Šæ”¾äº†å…¶ä»–è¿›ç¨‹çš„é”å¦‚æœæŒæœ‰é”çš„è¿›ç¨‹å› ä¸ºæ“ä½œæ—¶é—´è¿‡é•¿, è€Œå¯¼è‡´é”è¶…æ—¶è¢«è‡ªåŠ¨é‡Šæ”¾, ä½†è¿›ç¨‹æœ¬èº«ä¸çŸ¥é“è¿™ä¸€ç‚¹, å¹¶ä¸”å…¶ä»–è¿›ç¨‹å¯èƒ½å·²ç»è·å–äº†é”; è¿™æ ·, è¿›ç¨‹åœ¨ç¨ååšé‡Šæ”¾é”æ“ä½œæ—¶, å¦‚æœåªæ˜¯ç®€å•çš„ Redis::del(&quot;tag&quot;&quot;), è¿™å¯èƒ½ä¼šé‡Šæ”¾æ‰å…¶ä»–è¿›ç¨‹æŒæœ‰çš„é”; å› æ­¤, åœ¨è·å–é”çš„æ—¶å€™, éœ€è¦è®¾ç½®ä¸€ä¸ªtoken, æ”¾å…¥è‡ªå·±çš„é”ä¸­, åœ¨é‡Šæ”¾é”çš„æ—¶å€™, ç”¨æ¥ä¿è¯é‡Šæ”¾çš„æ˜¯è‡ªå·±çš„é”; é”é‡Šæ”¾æ³¨æ„ å¦‚æœå®¢æˆ·ç«¯Aæ˜¯å› ä¸ºæ‰§è¡Œè¶…æ—¶, è€Œå¯¼è‡´é”è¢«è‡ªåŠ¨é‡Šæ”¾, é‚£ä¹ˆå½“å®¢æˆ·ç«¯Aæœ€ååœ¨é‡Šæ”¾é”æ—¶, å¯èƒ½æ­¤æ—¶å®¢æˆ·ç«¯Bå·²ç»åŠ ä¸Šäº†è‡ªå·±çš„é”, æ‰€ä»¥åœ¨é”é‡Šæ”¾æ—¶éœ€è¦åšä¸¤ä¸ªæ“ä½œ æ£€æŸ¥tokenæ˜¯å¦ä¸€è‡´ é‡Šæ”¾é” æ³¨æ„: åœ¨ä¸Šé¢ä¸¤æ­¥ä¹‹é—´, æ¯”å¦‚è¯´åˆšæ£€æŸ¥å®Œtokenä¸€è‡´, ä¹Ÿå¯èƒ½å‘ç”Ÿè¶…æ—¶è€Œè‡ªåŠ¨é‡Šæ”¾é”, å¯¼è‡´é”tokenè¢«æ¢ä¸Šåˆ«çš„å®¢æˆ·ç«¯çš„, æ‰€ä»¥é‡Šæ”¾é”è¿™ä¸€æ­¥åº”è¯¥æ”¾åœ¨äº‹åŠ¡ä¸­, å¹¶æå‰ç”¨watchç›‘æ§ä»£è¡¨é”çš„é‚£ä¸ªkey, ä¼ªä»£ç å¦‚ä¸‹: 123456Redis::watch(&apos;tag&apos;);if (Redis::get(&apos;tag&apos;) == $token) &#123; Redis::multi(); Redis::del(&apos;tag&apos;); Redis::exec();&#125; å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è·å–é” å‡è®¾å®¢æˆ·ç«¯Aè¶…æ—¶å, é”è¢«è‡ªåŠ¨é‡Šæ”¾, æ­¤æ—¶å®¢æˆ·ç«¯Bæ‹¿åˆ°äº†é”, å¦‚æœå®¢æˆ·ç«¯Bä¹Ÿå› ä¸ºè¶…æ—¶å¯¼è‡´é”è¢«é‡Šæ”¾(æ­¤æ—¶å®¢æˆ·ç«¯Aè¿˜æ²¡æ‰§è¡Œå®Œ, Bä¹Ÿæ²¡æ‰§è¡Œå®Œ), é‚£ä¹ˆå®¢æˆ·ç«¯Cä¹Ÿèƒ½æ‹¿åˆ°é”; è¿™æ ·å°±åŒæ—¶å­˜åœ¨3ä¸ªå®¢æˆ·ç«¯æ‹¿åˆ°äº†é”; è¿™ä¸ªé—®é¢˜è²Œä¼¼å°±æ˜¯ä¸€ç›´æ²¡è§£å†³çš„é—®é¢˜!! å¯èƒ½ä½ éœ€è¦è¯„ä¼°ä¸šåŠ¡çš„å¤æ‚åº¦, æ¥è®¾ç½®è¶…æ—¶æ—¶é—´ä¸ºå¤šé•¿; å‚è€ƒ:åŸºäºRedisçš„åˆ†å¸ƒå¼é”åˆ°åº•å®‰å…¨å—(ä¸Š)https://segmentfault.com/q/1010000013626041?_ea=3427544~~æœªå®Œå¾…ç»­","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"07. redisäº‹åŠ¡ä¸WATCHä¹è§‚é”","slug":"Redis/2017-06-11-redis-07","date":"2017-06-11T13:14:46.000Z","updated":"2018-03-16T05:41:21.000Z","comments":true,"path":"2017/06/11/Redis/2017-06-11-redis-07/","link":"","permalink":"http://blog.renyimin.com/2017/06/11/Redis/2017-06-11-redis-07/","excerpt":"","text":"Redisäº‹åŠ¡ä¸å•çº¿ç¨‹ å› ä¸ºRedisæ˜¯å•çº¿ç¨‹çš„, æ‰€ä»¥å³ä½¿å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶æ¥å¯¹åŒä¸€æ•°æ®å‘æ¥å¾ˆå¤šå‘½ä»¤, ä¹Ÿä¼šè¢«ä¸²è¡ŒæŒ¨ä¸ªæ‰§è¡Œ; ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯, è¿™å’Œmysqlçš„srializeéš”ç¦»çº§åˆ«ä¸€æ ·, å³ä½¿æ˜¯ä¸²è¡Œæ‰§è¡Œå‘½ä»¤, redisä¹Ÿé€ƒä¸è¿‡é«˜å¹¶å‘äº‹åŠ¡æ—¶çš„ æ›´æ–°ä¸¢å¤± é—®é¢˜; mysqlæ˜¯ä½¿ç”¨ä¹è§‚é”, æ‚²è§‚é”æ¥è§£å†³çš„ å‚è€ƒMySQLé«˜å¹¶å‘äº‹åŠ¡é—®é¢˜ åŠ è§£å†³æ–¹æ¡ˆ è€Œredisçš„äº‹åŠ¡ä¹Ÿæ˜¯é€šè¿‡ä¸WATCH(ä¹è§‚é”)çš„ç»“åˆæ‰å¾—ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ Redisäº‹åŠ¡ä¸WATCH æ¼”ç¤ºRedisäº‹åŠ¡åœ¨å®¢æˆ·ç«¯é«˜å¹¶å‘æ—¶å‡ºç°çš„ ä¸¢å¤±æ›´æ–° é—®é¢˜ redis ä¸ºäº†è§£å†³é«˜å¹¶å‘äº‹åŠ¡æ—¶è¿™ç§ ä¸¢å¤±æ›´æ–° çš„é—®é¢˜, æä¾›äº† WATCH WATCHä»‹ç» redis å¹¶æ²¡æœ‰å®ç°å…¸å‹çš„åŠ é”åŠŸèƒ½(æ¯”å¦‚MySQLä¸­, åœ¨è®¿é—®ä»¥å†™å…¥ä¸ºç›®çš„æ•°æ®æ—¶ SELECT FOR UPDATE), å› ä¸ºåŠ è¿™ç§æ‚²è§‚é”å¯èƒ½ä¼šé€ æˆé•¿æ—¶é—´çš„ç­‰å¾…; æ‰€ä»¥redisä¸ºäº†å°½å¯èƒ½åœ°å‡å°‘å®¢æˆ·ç«¯çš„ç­‰å¾…æ—¶é—´, é‡‡ç”¨äº†WATCHç›‘æ§æœºåˆ¶, å¦‚æœæŸä¸ªå®¢æˆ·ç«¯Aåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰ WATCH äº†ä¸€ä¸ªkey, é‚£ä¹ˆå…¶å®å°±ç›¸å½“äºå¯¹è¯¥keyåŠ äº†ä¹è§‚é” äº‹åŠ¡ä¸­æ­£å¸¸æ‰§è¡Œä½ è¦æ‰§è¡Œçš„æ“ä½œ (ä¹è§‚åœ°è®¤ä¸ºä¸ä¼šæœ‰å…¶ä»–å®¢æˆ·ç«¯æŠ¢åœ¨ä½ å‰é¢å»æ”¹åŠ¨é‚£ä¸ªkey) ç›´åˆ°å½“å®¢æˆ·ç«¯AçœŸæ­£execçš„æ—¶å€™, æ‰ä¼šéªŒè¯å®¢æˆ·ç«¯Aä¹‹å‰WATCH(ç›‘æ§)çš„keyæ˜¯å¦è¢«å˜åŠ¨è¿‡, å¦‚æœå˜åŠ¨è¿‡, åˆ™å®¢æˆ·ç«¯Aå¯ä»¥è¿›è¡Œé‡è¯•; æµ‹è¯•:","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"06. Redis äº‹åŠ¡","slug":"Redis/2017-06-11-redis-06","date":"2017-06-11T11:10:03.000Z","updated":"2018-03-16T05:37:18.000Z","comments":true,"path":"2017/06/11/Redis/2017-06-11-redis-06/","link":"","permalink":"http://blog.renyimin.com/2017/06/11/Redis/2017-06-11-redis-06/","excerpt":"","text":"Redisäº‹åŠ¡ä»‹ç» redisäº‹åŠ¡æ˜¯ä½¿ç”¨é˜Ÿåˆ—ä»¥å…ˆè¿›å…ˆå‡º(FIFO)çš„æ–¹æ³•ä¿å­˜å‘½ä»¤, è¾ƒå…ˆå…¥é˜Ÿçš„å‘½ä»¤ä¼šè¢«æ”¾åˆ°æ•°ç»„çš„å‰é¢, è€Œè¾ƒåå…¥é˜Ÿçš„å‘½ä»¤åˆ™ä¼šè¢«æ”¾åˆ°æ•°ç»„çš„åé¢; redisäº‹åŠ¡ä»å¼€å§‹åˆ°ç»“æŸé€šå¸¸ä¼šé€šè¿‡ä¸‰ä¸ªé˜¶æ®µ: äº‹åŠ¡å¼€å§‹ å‘½ä»¤å…¥é˜Ÿ äº‹åŠ¡æ‰§è¡Œ Redisäº‹åŠ¡é€šå¸¸ä¼šä½¿ç”¨ MULTI, EXEC, WATCHç­‰å‘½ä»¤æ¥å®Œæˆ; redisäº‹åŠ¡çš„ACIDç‰¹æ€§åœ¨redisä¸­, äº‹åŠ¡å…·æœ‰ åŸå­æ€§(Atomicity) , ä¸€è‡´æ€§(Consistency) å’Œ éš”ç¦»æ€§(Isolation);å¹¶ä¸”å½“redisè¿è¡Œåœ¨æŸç§ç‰¹å®šçš„æŒä¹…åŒ–æ¨¡å¼ä¸‹,äº‹åŠ¡ä¹Ÿå…·æœ‰ æŒä¹…æ€§(Durability); (å¼±)åŸå­æ€§ å¯¹äºredisçš„äº‹åŠ¡æ¥è¯´, äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¹Ÿæ˜¯è¦ä¹ˆå°±å…¨éƒ¨æ‰§è¡Œ, è¦ä¹ˆå°±ä¸€ä¸ªéƒ½ä¸æ‰§è¡Œ, å› æ­¤redisçš„äº‹åŠ¡æ˜¯å…·æœ‰åŸå­æ€§çš„; ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯: redisäº‹åŠ¡çš„åŸå­æ€§æœ‰ä¸¤ç§æƒ…å†µéœ€è¦åŒºåˆ† ä¸€ç§æ˜¯ è¯­æ³•é”™è¯¯å¯¼è‡´redisäº‹åŠ¡æ‰§è¡Œå‡ºé”™, æ¯”å¦‚, ä½ äº‹åŠ¡ä¸­çš„æŸæ¡å‘½ä»¤è¯­æ³•é”™è¯¯, é‚£ä¹ˆä½ åœ¨execçš„æ—¶å€™, æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œ: 1234567891011127.0.0.1:6379&gt; keys *(empty list or set)127.0.0.1:6379&gt; multiOK127.0.0.1:6379&gt; set name renyiminQUEUED127.0.0.1:6379&gt; set age(error) ERR wrong number of arguments for &apos;set&apos; command127.0.0.1:6379&gt; exec(error) EXECABORT Transaction discarded because of previous errors.127.0.0.1:6379&gt; å¦ä¸€ç§æ˜¯ æ— è¯­æ³•é”™è¯¯,å¯ä»¥è¿è¡ŒæˆåŠŸ, ä½†æ˜¯è¿è¡Œå®Œä¹‹åä¼šè¿”å›è¿è¡Œé”™è¯¯, è¿™ç§æƒ…å†µä¸‹, é”™è¯¯ä¹‹å‰çš„å‘½ä»¤ä¸ä¼šå›æ»š; 123456789101112131415161718192021222324//æ¯”å¦‚å‘½ä»¤æˆ–å‘½ä»¤çš„å‚æ•°æ ¼å¼é”™è¯¯,é‚£ä¹ˆäº‹åŠ¡å°±ä¼šå‡ºç°æœ‰å¯èƒ½éƒ¨åˆ†å‘½ä»¤æˆåŠŸ,è€Œéƒ¨åˆ†å‘½ä»¤å¤±è´¥çš„æƒ…å†µ127.0.0.1:6379&gt; keys *(empty list or set)127.0.0.1:6379&gt; multiOK127.0.0.1:6379&gt; set name renyiminQUEUED127.0.0.1:6379&gt; set age 10QUEUED//è¿™é‡Œå°±ä¼šå‡ºç°è¿è¡Œé”™è¯¯127.0.0.1:6379&gt; incr nameQUEUED127.0.0.1:6379&gt; set addr yunchengQUEUED127.0.0.1:6379&gt; exec1) OK2) OK3) (error) ERR value is not an integer or out of range4) OK127.0.0.1:6379&gt; keys *1) &quot;addr&quot;2) &quot;age&quot;3) &quot;name&quot;127.0.0.1:6379&gt; éœ€è¦è¯´æ˜çš„æ˜¯: ä¸Šè¿°çš„ç¬¬äºŒç§æƒ…å†µ, ä»è¡¨é¢ä¸Šçœ‹, ä¸ç¬¦åˆâ€åŸå­æ€§â€, å› ä¸ºä½ æ‰€æ‰§è¡Œçš„å‘½ä»¤ä¸­æœ‰ä¸€æ¡å‡ºé”™å, rediså¹¶æ²¡æœ‰è¿›è¡Œå›æ»š; å…¶å®æ˜¯ç”±äºä½ çš„æ­¤ç§é”™è¯¯å‘½ä»¤ä¸å±äºè¯­æ³•é”™è¯¯, å¯¹redisæ¥è¯´, ä¸ä¼šå¯¼è‡´æ‰§è¡Œå‡ºé”™,æ‰€ä»¥ä½ çš„è¿™æ¡é”™è¯¯å‘½ä»¤æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„, ä¸è¿‡æˆåŠŸåä¼šè¿”å›é”™è¯¯æç¤º, æ‰€ä»¥rediså¹¶ä¸ä¼šè¿›è¡Œå›æ»š; redisçš„ä½œè€…åœ¨äº‹åŠ¡ç›¸å…³çš„æ–‡æ¡£ä¸­è§£é‡Šè¯´:1234ä¸æ”¯æŒäº‹åŠ¡å›æ»šæ˜¯å› ä¸ºè¿™ç§å¤æ‚çš„åŠŸèƒ½å’Œredisè¿½æ±‚çš„ç®€å•é«˜æ•ˆçš„è®¾è®¡ä¸»æ—¨ä¸ç¬¦åˆ,å¹¶ä¸”ä»–è®¤ä¸º, redisäº‹åŠ¡çš„æ‰§è¡Œæ—¶é”™è¯¯é€šå¸¸éƒ½æ˜¯ç¼–ç¨‹é”™è¯¯é€ æˆçš„,è¿™ç§é”™è¯¯é€šå¸¸åªä¼šå‡ºç°åœ¨å¼€å‘ç¯å¢ƒä¸­, è€Œå¾ˆå°‘ä¼šåœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°,æ‰€ä»¥ä»–è®¤ä¸ºæ²¡æœ‰å¿…è¦ä¸ºrediså¼€å‘äº‹åŠ¡å›æ»šåŠŸèƒ½ã€‚ æ‰€ä»¥, åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œrediså‘½ä»¤æ—¶, æœ€å¥½ç¡®ä¿æ‰€æœ‰å‘½ä»¤éƒ½èƒ½æ‰§è¡ŒæˆåŠŸ; ä¸€è‡´æ€§redisé€šè¿‡è°¨æ…çš„é”™è¯¯æ£€æµ‹å’Œç®€å•çš„è®¾è®¡æ¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ã€‚ éš”ç¦»æ€§ äº‹åŠ¡çš„éš”ç¦»æ€§æŒ‡çš„æ˜¯, å³ä½¿æ•°æ®åº“ä¸­æœ‰å¤šä¸ªäº‹åŠ¡å¹¶å‘åœ¨æ‰§è¡Œ, å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¹Ÿä¸ä¼šäº’ç›¸å½±å“, å¹¶ä¸”åœ¨å¹¶å‘çŠ¶æ€ä¸‹æ‰§è¡Œçš„äº‹åŠ¡å’Œä¸²è¡Œæ‰§è¡Œçš„äº‹åŠ¡äº§ç”Ÿçš„ç»“æœå®Œå…¨ç›¸åŒ; å› ä¸ºredisä½¿ç”¨å•çº¿ç¨‹çš„æ–¹å¼æ¥æ‰§è¡Œäº‹åŠ¡(ä»¥åŠäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„å‘½ä»¤), å¹¶ä¸”æœåŠ¡å™¨ä¿è¯, åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´ä¸ä¼šå¯¹äº‹åŠ¡è¿›è¡Œä¸­æ–­, å› æ­¤, redisçš„äº‹åŠ¡æ€»æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼è¿è¡Œçš„, å¹¶ä¸”äº‹åŠ¡ä¹Ÿæ€»æ˜¯å…·æœ‰éš”ç¦»æ€§çš„; Redisä¸ºå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼, é‡‡ç”¨é˜Ÿåˆ—æ¨¡å¼å°†å¹¶å‘è®¿é—®å˜ä¸ºä¸²è¡Œè®¿é—®(Redisæœ¬èº«æ²¡æœ‰é”çš„æ¦‚å¿µ, Rediså¯¹äºå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¹¶ä¸å­˜åœ¨ç«äº‰) æŒä¹…æ€§å› ä¸ºredisäº‹åŠ¡ä¸è¿‡æ˜¯ç®€å•çš„ç”¨é˜Ÿåˆ—åŒ…è£¹èµ·æ¥ä¸€ç»„rediså‘½ä»¤,rediså¹¶æ²¡æœ‰ä¸ºäº‹åŠ¡æä¾›ä»»ä½•é¢å¤–çš„æŒä¹…åŒ–åŠŸèƒ½, æ‰€ä»¥redisäº‹åŠ¡çš„è€ä¹…æ€§ç”±redisä½¿ç”¨çš„æŒä¹…åŒ–æ¨¡å¼(rdb/aof)æ¥å†³å®š: å…³äºæŒä¹…åŒ–, å¯ä»¥å‚è€ƒåšæ–‡:äº†è§£redisæŒä¹…åŒ–","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"03. ä¸€äº›è§„èŒƒç‚¹","slug":"Redis/2017-06-07-redis-03","date":"2017-06-07T13:31:47.000Z","updated":"2018-03-16T05:26:33.000Z","comments":true,"path":"2017/06/07/Redis/2017-06-07-redis-03/","link":"","permalink":"http://blog.renyimin.com/2017/06/07/Redis/2017-06-07-redis-03/","excerpt":"","text":"å°†æ ¼å¼çº¦å®š: è¡¨å:å­—ç¬¦ä¸²1:å­—ç¬¦ä¸²2:Â·Â·Â·Â·Â· ä¸è¦ä½¿ç”¨keysæ­£åˆ™åŒ¹é…æ“ä½œ, åŒ…æ‹¬ä½†ä¸é™äºå„ç§å½¢å¼çš„æ¨¡ç³ŠåŒ¹é…æ“ä½œ å› ä¸ºRedisæ˜¯å•çº¿ç¨‹å¤„ç†, åœ¨çº¿ä¸ŠKEYæ•°é‡è¾ƒå¤šæ—¶, æ“ä½œæ•ˆç‡æä½(æ—¶é—´å¤æ‚åº¦ä¸ºO(N)), è¯¥å‘½ä»¤ä¸€æ—¦æ‰§è¡Œä¼šä¸¥é‡é˜»å¡çº¿ä¸Šå…¶å®ƒå‘½ä»¤çš„æ­£å¸¸è¯·æ±‚, è€Œä¸”åœ¨é«˜QPSæƒ…å†µä¸‹ä¼šç›´æ¥é€ æˆRedisæœåŠ¡å´©æºƒ å¯é çš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡Redis Listç»å¸¸è¢«ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡;å‡è®¾æ¶ˆè´¹è€…ç¨‹åºåœ¨ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯åç«‹åˆ»å´©æºƒ, ä½†ç”±äºè¯¥æ¶ˆæ¯å·²ç»è¢«å–å‡ºä¸”æ²¡æœ‰è¢«æ­£å¸¸å¤„ç†, é‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¯¥æ¶ˆæ¯å·²ç»ä¸¢å¤±, ç”±æ­¤å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡æ•°æ®ä¸¢å¤±, æˆ–ä¸šåŠ¡çŠ¶æ€ä¸ä¸€è‡´ç­‰ç°è±¡å‘ç”Ÿ;ä¸ºäº†é¿å…è¿™ç§æƒ…å†µ, Redisæä¾›äº† RPOPLPUSH å‘½ä»¤, æ¶ˆè´¹è€…ç¨‹åº ä¼š åŸå­æ€§ çš„ ä»ä¸»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å°†å…¶æ’å…¥åˆ°å¤‡ä»½é˜Ÿåˆ—ä¸­, å¹¶ä¸”ä¼šè¿”å›å¼¹å‡ºé˜Ÿåˆ—çš„æ•°æ®ç„¶åç­‰åˆ°æ¶ˆè´¹è€…ç¨‹åºå®Œæˆæ­£å¸¸çš„å¤„ç†é€»è¾‘åå†å°†è¯¥æ¶ˆæ¯ä»å¤‡ä»½é˜Ÿåˆ—ä¸­åˆ é™¤;åŒæ—¶è¿˜å¯ä»¥æä¾›ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹, å½“å‘ç°å¤‡ä»½é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¿‡æœŸæ—¶ï¼Œå¯ä»¥é‡æ–°å°†å…¶å†æ”¾å›åˆ°ä¸»æ¶ˆæ¯é˜Ÿåˆ—ä¸­, ä»¥ä¾¿å…¶å®ƒçš„æ¶ˆè´¹è€…ç¨‹åºç»§ç»­å¤„ç†ã€‚ æœªå®Œå¾…ç»­~~","categories":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"http://blog.renyimin.com/tags/Redis/"}]},{"title":"Xhgui","slug":"PHP/2017-04-26-Xhgui","date":"2017-04-26T10:16:30.000Z","updated":"2018-05-10T02:28:08.000Z","comments":true,"path":"2017/04/26/PHP/2017-04-26-Xhgui/","link":"","permalink":"http://blog.renyimin.com/2017/04/26/PHP/2017-04-26-Xhgui/","excerpt":"","text":"","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"Xhprof","slug":"PHP/2017-04-23-Xhprof","date":"2017-04-23T12:10:32.000Z","updated":"2018-05-10T02:29:11.000Z","comments":true,"path":"2017/04/23/PHP/2017-04-23-Xhprof/","link":"","permalink":"http://blog.renyimin.com/2017/04/23/PHP/2017-04-23-Xhprof/","excerpt":"","text":"æ˜¯å¦éœ€è¦è£…æ‰©å±• è¿˜æ˜¯phpå·²å†…ç½®? http://blog.oneapm.com/apm-tech/235.html","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"03. OPcache","slug":"PHP/2017-04-21-OPcache","date":"2017-04-21T05:20:28.000Z","updated":"2018-05-10T02:29:11.000Z","comments":true,"path":"2017/04/21/PHP/2017-04-21-OPcache/","link":"","permalink":"http://blog.renyimin.com/2017/04/21/PHP/2017-04-21-OPcache/","excerpt":"","text":"OPCachehttp://www.laruence.com/tag/opcachehttps://www.cnblogs.com/jysdhr/p/6924178.html APCeAccelerator","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"03. php.inié…ç½®æ–‡ä»¶","slug":"PHP/2017-04-15-php.ini","date":"2017-04-15T12:16:32.000Z","updated":"2018-05-09T12:34:00.000Z","comments":true,"path":"2017/04/15/PHP/2017-04-15-php.ini/","link":"","permalink":"http://blog.renyimin.com/2017/04/15/PHP/2017-04-15-php.ini/","excerpt":"","text":"## ##","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"","slug":"PHP/2017-04-14-lnmp-user-authority.conf","date":"2017-04-13T11:23:56.000Z","updated":"2018-05-15T10:19:02.000Z","comments":true,"path":"2017/04/13/PHP/2017-04-14-lnmp-user-authority.conf/","link":"","permalink":"http://blog.renyimin.com/2017/04/13/PHP/2017-04-14-lnmp-user-authority.conf/","excerpt":"","text":"Nginx çš„æƒé™é…ç½®Nginxè™½ç„¶å¯ä»¥ç›´æ¥è§£æé™æ€æ–‡ä»¶(å¦‚HTMLç­‰)å¹¶è¿”å›ç»“æœ, ä½†æ˜¯å¯¹äºPHPæ–‡ä»¶çš„è¯·æ±‚, Nginxä¼šè½¬äº¤ç»™PHPçš„è§£é‡Šå™¨php-fpmè¿›è¡Œå¤„ç†, å¤„ç†å®Œåå†è¿”å›å“åº”ç»™å®¢æˆ·ç«¯æµè§ˆå™¨; å¯¹äºæˆ‘ä»¬çš„ä»£ç ç›®å½•, éœ€è¦ç»Ÿä¸€ Nginx å’Œ php æœåŠ¡æ‰€éœ€çš„æƒé™ å¦‚æœç»Ÿä¸€ä½¿ç”¨rootç”¨æˆ·, åˆ™ä¸€èˆ¬æ¸¸å®¢è´¦æˆ·æ— æ³•è®¿é—®åº”ç”¨, è€Œnginxé…ç½®æˆä»¥rootè¿è¡Œçš„è¯ä¼šå­˜åœ¨å¾ˆå¤§çš„å®‰å…¨éšæ‚£, ä¸€æ—¦è¢«æ”»å‡»å°±ä¼šè¢«è·å–rootèº«ä»½è¿›è¡Œç³»ç»Ÿçš„ä¸€åˆ‡æ“ä½œ; å¦‚æœç»Ÿä¸€å°†ä»£ç ç›®å½•æƒé™å…¨éƒ¨è®¾ç½®ä¸º rwxrwxrwx, åˆ™å­˜åœ¨ç”¨æˆ·ç›´æ¥é€šè¿‡æµè§ˆå™¨ä¿®æ”¹ä»£ç ç›®å½•çš„éšæ‚£;æ‰€ä»¥æœ€å¥½çš„åŠæ³•å°±æ˜¯ç»Ÿä¸€å½’ç±»åˆ°ä¸€ä¸ªæ–°çš„ç”¨æˆ·ç»„é‡Œé¢, é€šè¿‡ç»™è¯¥ç”¨æˆ·ç»„åˆ†é… Nginx å’Œ php è¿è¡Œå¿…è¦çš„æƒé™, æ¥å®ç°å¯¹webåº”ç”¨çš„æƒé™ç›®å½•ç®¡ç†, é€šå¸¸æƒ…å†µä¸‹, è®¸å¤šå›¢é˜Ÿéƒ½ä¼šæŠŠè¿™ä¸ªç”¨æˆ·ç»„å–åwww, ç”±wwwç”¨æˆ·æ¥ç»Ÿä¸€ç®¡ç†ä»£ç ç›®å½•æƒé™, åœ¨Nginxçš„é…ç½®æ–‡ä»¶nginix.confé‡Œå°±å°†è¿è¡Œæƒé™é…ç½®åˆ°äº†wwwç”¨æˆ·ä¸‹ï¼Œå› æ­¤Nginxçš„å­è¿›ç¨‹ä¹Ÿæ˜¯ç”±wwwç”¨æˆ·æ‰§è¡Œ, å¯ä»¥é€šè¿‡ps aux | grep nginxæ¥æŸ¥çœ‹; PHPçš„æƒé™é…ç½® åŒæ ·çš„, phpçš„è¿è¡Œæ–¹å¼ä¹Ÿæ˜¯ç”±ä¸»è¿›ç¨‹rootè¿è¡Œ, åœ¨å­è¿›ç¨‹æ± (pool)é‡Œé¢é…ç½®wwwç”¨æˆ·æ‰§è¡Œæƒé™, åŒæ ·ç”¨ps aux | grep phpå¯ä»¥æŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨çš„ç”¨æˆ·èº«ä»½ é¡¹ç›®åŠ è½¯é“¾? https://blog.csdn.net/dream_successor/article/details/78615825?locationNum=8&amp;fps=1","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"php-fpmé…ç½®æ–‡ä»¶","slug":"PHP/2017-04-12-fpm.conf","date":"2017-04-12T08:40:32.000Z","updated":"2018-05-15T10:00:03.000Z","comments":true,"path":"2017/04/12/PHP/2017-04-12-fpm.conf/","link":"","permalink":"http://blog.renyimin.com/2017/04/12/PHP/2017-04-12-fpm.conf/","excerpt":"","text":"å¤šä¸ªé…ç½®æ–‡ä»¶åœ¨ä¸‹è½½å¹¶ç¼–è¯‘å®‰è£…å®Œæˆphp7.2ä¹‹å, åœ¨å®‰è£…ç›®å½•ä¸‹çš„ etc/ ç›®å½•ä¸­, æœ‰å‡ ä¸ªå’Œphp-fpmç›¸å…³çš„é…ç½®æ–‡ä»¶éœ€è¦äº†è§£ä¸€ä¸‹ php-fpm.conf.default æ–‡ä»¶, ä¸€èˆ¬ä¼šç”¨è¯¥æ–‡ä»¶æ‹·è´ä¸€ä»½ php-fpm.conf æ–‡ä»¶, ä½œä¸ºphp-fpmçš„å…¨å±€é…ç½®æ–‡ä»¶; php-fpm.d/www.conf.default æ–‡ä»¶, ä¸€èˆ¬ä¼šç”¨è¯¥æ–‡ä»¶æ‹·è´ä¸€ä»½ www.ç«™ç‚¹å.conf æ–‡ä»¶, ä½œä¸ºphp-fpmçš„ä¸€ä¸ªpoolé…ç½®æ–‡ä»¶; php-fpmçš„pool å¦‚ä¸Šé¢ä»‹ç»çš„é‚£æ ·, php-fpmçš„é…ç½®æ–‡ä»¶å¯èƒ½ä¸æ­¢ä¸€ä»½, å› ä¸ºè€Œåœ¨ä¸€å°æ‰¿è½½äº†å¤šä¸ªç½‘ç«™çš„phpæœåŠ¡å™¨ä¸Šï¼Œä¸ºäº†å®ç°æƒé™éš”ç¦», ç®¡ç†å‘˜é€šå¸¸ä¼šå°†ç½‘ç«™åˆ†é…åˆ°ä¸åŒçš„ pool é‡Œ, æ¢å¥è¯è¯´, åœ¨ç°å®ç¯å¢ƒé‡Œ, php-fpmçš„é…ç½®æ–‡ä»¶å¯èƒ½ä¸æ­¢ä¸€ä¸ª æ¯ä¸ªpoolå¯ä»¥ç›‘å¬ä¸åŒçš„sockã€tcp/ip æ¯”å¦‚nginxæœ‰å¥½å‡ ä¸ªç«™ç‚¹, å¦‚æœæ‰€æœ‰çš„ç½‘ç«™ä½¿ç”¨åŒä¸€ä¸ªæ± , é‚£å…¶ä¸­ä¸€ä¸ªç½‘ç«™å‘ç”Ÿä¸€äº›æ•…éšœ, æ¯”å¦‚ç¨‹åºå‘˜å†™çš„ä¸€äº›ç¨‹åºæœ‰é—®é¢˜, å°±ä¼šæŠŠphpèµ„æºè€—å°½, ä¹Ÿå°±æ˜¯å½“å…¶ä¸­çš„ä¸€ä¸ªç«™ç‚¹502(å¯èƒ½æ˜¯phpèµ„æºä¸å¤Ÿ)äº†, è¿™æ ·çš„ç»“æœå°±æ˜¯å…¶ä»–ç«™ç‚¹çš„phpä¹Ÿä¼š502, æ‰€ä»¥æœ‰å¿…è¦æŠŠæ¯ä¸€ä¸ªç«™ç‚¹éš”ç¦»å¼€, æ¯ä¸ªpoolçš„åå­—è¦å”¯ä¸€; æœ‰ä¸€ä»½å…¨å±€é…ç½®æ–‡ä»¶php-fpm.conf, å¦å¤–, åœ¨php-fpm.dä¸‹, è¿˜å¯ä»¥åˆ›å»ºå¤šä¸ª pool é…ç½®æ–‡ä»¶; nginxå¯ä»¥é…ç½®ä¸åŒçš„è™šæ‹Ÿä¸»æœºå»ä½¿ç”¨php-fpmçš„ä¸åŒpool æµ‹è¯•php-fpmçš„pool php-fpmé…ç½®å‚è€ƒ: https://blog.csdn.net/mrding991124/article/details/79018917 nginx é…ç½® php-fpmå„é…ç½®é¡¹åˆ†æ pidè®¾ç½®, é»˜è®¤åœ¨PHPå®‰è£…ç›®å½•(/usr/local/php72)ä¸­çš„ var/run/php-fpm.pid, å»ºè®®å¼€å¯ pid = run/php-fpm.pid é”™è¯¯æ—¥å¿—, é»˜è®¤åœ¨å®‰è£…ç›®å½•ä¸­çš„ var/log/php-fpm.log error_log = log/php-fpm.log é”™è¯¯çº§åˆ«, å¯ç”¨çº§åˆ«ä¸º: alert(å¿…é¡»ç«‹å³å¤„ç†), error(é”™è¯¯æƒ…å†µ), warning(è­¦å‘Šæƒ…å†µ), notice(ä¸€èˆ¬é‡è¦ä¿¡æ¯), debug(è°ƒè¯•ä¿¡æ¯); é»˜è®¤ä¸º: notice. log_level = notice è¡¨ç¤ºåœ¨ emergency_restart_interval æ‰€è®¾å€¼çš„æ—¶é—´å†…, å‡ºç° SIGSEGV æˆ–è€… SIGBUS é”™è¯¯çš„php-cgiè¿›ç¨‹æ•°å¦‚æœè¶…è¿‡ emergency_restart_threshold ä¸ª, php-fpmå°±ä¼šä¼˜é›…é‡å¯, è¿™ä¸¤ä¸ªé€‰é¡¹ä¸€èˆ¬ä¿æŒé»˜è®¤å€¼: 123#å¦‚ä¸‹, è¡¨ç¤ºåœ¨60ç§’å†…å‡ºç° SIGSEGV æˆ–è€… SIGBUSé”™è¯¯ çš„php-cgiè¿›ç¨‹æ•°å¦‚æœè¶…è¿‡10ä¸ª, php-fpmå°±ä¼šé‡å¯emergency_restart_threshold = 60emergency_restart_interval = 60s 12345SIGSEGV --- æ®µé”™è¯¯, é‡åˆ°æ­¤é”™è¯¯çš„å¯èƒ½æƒ…å†µæ˜¯:1. ç¼“å†²åŒºæº¢å‡º --- é€šå¸¸ç”±æŒ‡é’ˆå¼•ç”¨è¶…å‡ºèŒƒå›´å¼•èµ·;2. å †æ ˆæº¢å‡º --- è¯·è®°ä½é»˜è®¤å †æ ˆå¤§å°ä¸º8192K;3. ç¦æ­¢æ–‡ä»¶è®¿é—® --- æ–‡ä»¶æ“ä½œåœ¨æˆ‘ä»¬çš„è¯„åˆ¤ç³»ç»Ÿä¸Šç¦æ­¢;å…¶ä¸­çš„ç¬¬ä¸‰æ¡, è·Ÿæœ¬é—®é¢˜çš„å…³ç³»æ¯”è¾ƒå¤§, ä¹Ÿå°±æ˜¯php-cgiè®¿é—®äº†ä¸€ä¸ªä¸å­˜åœ¨çš„æˆ–è€…æ²¡æœ‰æƒé™è®¿é—®çš„æ–‡ä»¶; è®¾ç½®å­è¿›ç¨‹æ¥å—ä¸»è¿›ç¨‹å¤ç”¨ä¿¡å·çš„è¶…æ—¶æ—¶é—´, å¯ç”¨å•ä½: s(ç§’), m(åˆ†), h(å°æ—¶), æˆ–è€… d(å¤©) ; é»˜è®¤å•ä½: s(ç§’); é»˜è®¤å€¼:0; process_control_timeout = 0 è¿›ç¨‹å¤ç”¨ å…ˆæ¥ç®€å•è°ˆè°ˆPHPè¯·æ±‚å¤„ç†è¿‡ç¨‹å§Nginxä¸PHPçš„äº¤äº’ä¾èµ–äºCGIæ¥å£, å› ä¸ºä¸¤è€…éƒ½å®ç°äº†CGIæ¥å£, æ‰€ä»¥Nginxå¯ä»¥æŠŠæ”¶åˆ°çš„è¯·æ±‚äº¤ç»™PHP, å¹¶ä»PHPè·å¾—ç›¸åº”çš„ç»“æœå›ä¼ ç»™å®¢æˆ·ç«¯;æœ€åŸºæœ¬çš„CGIå®ç°æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ªPHPè¿›ç¨‹, å¤„ç†å®Œæˆåå…³é—­è¿›ç¨‹, è¿™ç§æ–¹å¼ä¼šæ¶ˆè€—å¾ˆå¤šçš„èµ„æºåœ¨è¿›ç¨‹çš„å¯åŠ¨å’Œå…³é—­ä¸Š, æ‰€ä»¥æ•ˆç‡å¹¶ä¸é«˜;è¿›è€Œå‡ºç°äº†FastCGIè¿™ç§å®ç°æ–¹å¼, ä¹Ÿå°±æ˜¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹åè®©å®ƒå¤„ç†å¤šä¸ªè¯·æ±‚å†å…³é—­, è¿™ç§æ–¹å¼å°±æ˜¯è§£å†³æ¯æ¬¡è¯·æ±‚éƒ½æ‰“å¼€å’Œå…³é—­è¿›ç¨‹çš„æ¶ˆè€—çš„, ä½†FastCGIæœ‰ä¸ªç¼ºç‚¹, å°±æ˜¯å› ä¸ºä¸€ä¸ªè¿›ç¨‹åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¯·æ±‚, å¦‚æœåŒæ—¶æ”¶åˆ°å¤šä¸ªè¯·æ±‚, å®ƒä»¬åªèƒ½æ’é˜Ÿç­‰å¾…FastCGIè¿›ç¨‹çš„å¤„ç†;è§£å†³FastCGIåªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ–¹å¼å¾ˆç®€å•, å°±æ˜¯å¼€å¯å¤šä¸ªFastCGIè¿›ç¨‹, ä¸è¿‡å¼€å¯å¤šä¸ªFastCGIè¿›ç¨‹çš„è¯å°±å­˜åœ¨å¯¹è¿™äº›è¿›ç¨‹çš„ç®¡ç†é—®é¢˜, æ¯”å¦‚ç©¶ç«Ÿè¦å¼€å¤šå°‘ä¸ªè¿›ç¨‹, æ€ä¹ˆæ ¹æ®éœ€è¦åˆ†é…è¯·æ±‚åˆ°è¿™äº›è¿›ç¨‹ä¸Šç­‰ç­‰;è€ŒPHP-FPMå°±æ˜¯è¿™æ ·ä¸€ä¸ªç®¡ç†FastCGIè¿›ç¨‹çš„ç®¡ç†ç¨‹åº, Nginxå…ˆå°†è¯·æ±‚ä¼ é€’ç»™PHP-FPMï¼Œå†ç”±PHP-FPMé€‰æ‹©åˆé€‚çš„FastCGIå¤„ç†è¿›ç¨‹è¿›è¡Œå¤„ç†;åœ¨PHP-FPMå°†è¯·æ±‚ä¼ é€’ç»™FastCGIå¤„ç†è¿›ç¨‹çš„æ—¶å€™, å°±æ¶‰åŠåˆ°è¿›ç¨‹å¤ç”¨äº†, åŸåˆ™ä¸Š, PHP-FPMä¼šé€‰æ‹©ç©ºé—²çš„FastCGIè¿›ç¨‹å»å¤„ç†è¯·æ±‚, åœ¨å¤„ç†ä¹‹å‰, PHP-FPMä¼šå‘é€è¿›ç¨‹å¤ç”¨ä¿¡å·ç»™FastCGIè¿›ç¨‹, ç”¨æ¥è®©FastCGIè¿›ç¨‹å‡†å¤‡å¥½æ¥å—è¯·æ±‚å¹¶å¤„ç†; ä½†æ˜¯, FastCGIè¿›ç¨‹å¹¶ä¸æ€»æ˜¯èƒ½å¤Ÿå¤„ç†è¯·æ±‚, ä¹Ÿå°±æ˜¯ä¸ä¸€å®šèƒ½å¤Ÿå“åº”è¿›ç¨‹å¤ç”¨ä¿¡å·(æ¯”å¦‚è¯´å‡ºç°å‡æ­»çš„æƒ…å†µ), æ‰€ä»¥è¿™ä¸ªå‚æ•°å°±è¡¨ç¤ºäº†PHP-FPMç•™ç»™FastCGIè¿›ç¨‹å¤šä¹…æ—¶é—´å»å“åº”è¿›ç¨‹å¤ç”¨ä¿¡å·, å¦‚æœè¶…æ—¶äº†, PHP-FPMä¼šé€‰æ‹©å…¶ä»–çš„æ–¹å¼(ä¾‹å¦‚ä½¿ç”¨å…¶ä»–çš„FastCGIè¿›ç¨‹)å»å¤„ç†è¯·æ±‚;å‚è€ƒsegmentfaulté—®ç­” åå°æ‰§è¡Œfpm, é»˜è®¤å€¼ä¸ºyesï¼Œå¦‚æœä¸ºäº†è°ƒè¯•å¯ä»¥æ”¹ä¸ºno, åœ¨FPMä¸­, å¯ä»¥ä½¿ç”¨ä¸åŒçš„è®¾ç½®æ¥è¿è¡Œå¤šä¸ªè¿›ç¨‹æ± ; è¿™ä¸ªé…ç½®å¯ä»¥é’ˆå¯¹æ¯ä¸ªè¿›ç¨‹æ± å•ç‹¬è®¾ç½® daemonize = yes FPMè¿›ç¨‹æ± ? fpmç›‘å¬ç«¯å£, å³ nginx ä¸­é…ç½®çš„phpçš„å¤„ç†åœ°å€, ä¸€èˆ¬é»˜è®¤å€¼å³å¯ï¼Œ å¯ç”¨æ ¼å¼ä¸º: ip:port, port, /path/to/unix/socket, æ¯ä¸ªè¿›ç¨‹æ± éƒ½éœ€è¦è®¾ç½® listen = 127.0.0.1:9000 backlogæ•°, -1è¡¨ç¤ºæ— é™åˆ¶, ç”±æ“ä½œç³»ç»Ÿå†³å®š, æ­¤è¡Œæ³¨é‡Šæ‰å°±è¡Œ, backlogå«ä¹‰å‚è€ƒ: http://www.3gyou.cc/?p=41 listen.backlog = -1 rrcçš„omsç³»ç»Ÿ, çº¿ä¸Šbacklogè®¾ç½®çš„æ˜¯65535 backlog å…³äºbacklogæ›´å¤šè¯¦æƒ…, å¯ä»¥å‚è€ƒæ­¤æ–‡ å…è®¸è®¿é—®FastCGIè¿›ç¨‹çš„IP, è®¾ç½® any ä¸ºä¸é™åˆ¶IP, å¦‚æœè¦è®¾ç½®å…¶ä»–ä¸»æœºçš„nginxä¹Ÿèƒ½è®¿é—®è¿™å°FPMè¿›ç¨‹, listenå¤„è¦è®¾ç½®æˆæœ¬åœ°å¯è¢«è®¿é—®çš„IP, é»˜è®¤å€¼æ˜¯any; æ¯ä¸ªåœ°å€æ˜¯ç”¨é€—å·åˆ†éš”, å¦‚æœæ²¡æœ‰è®¾ç½®æˆ–è€…ä¸ºç©º, åˆ™å…è®¸ä»»ä½•æœåŠ¡å™¨è¯·æ±‚è¿æ¥ listen.allowed_clients = 127.0.0.1 unix socket éœ€è¦è®¾ç½®çš„é€‰é¡¹, å¦‚æœä½¿ç”¨tcpæ–¹å¼è®¿é—®, è¿™é‡Œæ³¨é‡Šå³å¯ 123listen.owner = www # socké€šä¿¡æ–‡ä»¶çš„å±ä¸», å’Œnginxé€šä¿¡listen.group = www # socké€šä¿¡æ–‡ä»¶çš„å±ç»„, å’Œnginxé€šä¿¡listen.mode = 0666 å¯åŠ¨è¿›ç¨‹çš„å¸æˆ·å’Œç»„ user = www group = www è¿™ä¸ªå’Œnginxä¸­é…ç½®çš„è´¦æˆ·å’Œç»„æœ‰ä»€ä¹ˆå…³è”ä¹ˆ? å¦‚ä½•æ§åˆ¶å­è¿›ç¨‹, é€‰é¡¹æœ‰ static å’Œ dynamic, å¯¹äºä¸“ç”¨æœåŠ¡å™¨, pmå¯ä»¥è®¾ç½®ä¸ºstatic pm = dynamic å¦‚æœé€‰æ‹©static, åˆ™ç”± pm.max_children æŒ‡å®šå›ºå®šçš„å­è¿›ç¨‹æ•°, å¦‚æœé€‰æ‹©dynamic, åˆ™ç”±ä¸‹å¼€å‚æ•°å†³å®š: pm.max_children # å­è¿›ç¨‹æœ€å¤§æ•° pm.start_servers # å¯åŠ¨æ—¶çš„è¿›ç¨‹æ•° pm.min_spare_servers # ä¿è¯ç©ºé—²è¿›ç¨‹æ•°æœ€å°å€¼, å¦‚æœç©ºé—²è¿›ç¨‹å°äºæ­¤å€¼, åˆ™åˆ›å»ºæ–°çš„å­è¿›ç¨‹ pm.max_spare_servers # ä¿è¯ç©ºé—²è¿›ç¨‹æ•°æœ€å¤§å€¼, å¦‚æœç©ºé—²è¿›ç¨‹å¤§äºæ­¤å€¼, æ­¤è¿›è¡Œæ¸…ç† è®¾ç½®æ¯ä¸ªå­è¿›ç¨‹é‡ç”Ÿä¹‹å‰æœåŠ¡çš„è¯·æ±‚æ•°, å¯¹äºå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„ç¬¬ä¸‰æ–¹æ¨¡å—æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„, å¦‚æœè®¾ç½®ä¸º 0 åˆ™ä¸€ç›´æ¥å—è¯·æ±‚, ç­‰åŒäº PHP_FCGI_MAX_REQUESTS ç¯å¢ƒå˜é‡, é»˜è®¤å€¼:0 pm.max_requests = 1000 FPMçŠ¶æ€é¡µé¢çš„ç½‘å€, å¦‚æœæ²¡æœ‰è®¾ç½®, åˆ™æ— æ³•è®¿é—®çŠ¶æ€é¡µé¢, é»˜è®¤å€¼: none, muninç›‘æ§ ä¼šä½¿ç”¨åˆ° pm.status_path = /status rrc é…ç½®ä¸º pm.status_path = /status/fpm FPMç›‘æ§é¡µé¢çš„pingç½‘å€, å¦‚æœæ²¡æœ‰è®¾ç½®, åˆ™æ— æ³•è®¿é—®pingé¡µé¢, è¯¥é¡µé¢ç”¨äºå¤–éƒ¨æ£€æµ‹FPMæ˜¯å¦å­˜æ´»å¹¶ä¸”å¯ä»¥å“åº”è¯·æ±‚, è¯·æ³¨æ„å¿…é¡»ä»¥æ–œçº¿å¼€å¤´ (/) ping.path = /ping rrc omsç³»ç»Ÿçº¿ä¸Šæ²¡å¼€å¯ ç”¨äºå®šä¹‰pingè¯·æ±‚çš„è¿”å›ç›¸åº”, è¿”å›ä¸º HTTP 200 çš„ text/plain æ ¼å¼æ–‡æœ¬, é»˜è®¤å€¼: pong ping.response = pong rrc omsç³»ç»Ÿçº¿ä¸Šæ²¡å¼€å¯ è®¾ç½®å•ä¸ªè¯·æ±‚çš„è¶…æ—¶ä¸­æ­¢æ—¶é—´ request_terminate_timeout = 0 è¯¥é€‰é¡¹å¯èƒ½ä¼šå¯¹ php.ini è®¾ç½®ä¸­çš„ max_execution_time å› ä¸ºæŸäº›ç‰¹æ®ŠåŸå› æ²¡æœ‰ä¸­æ­¢è¿è¡Œçš„è„šæœ¬æœ‰ç”¨; è®¾ç½®ä¸º 0 è¡¨ç¤º Off, å½“ç»å¸¸å‡ºç°502é”™è¯¯æ—¶å¯ä»¥å°è¯•æ›´æ”¹æ­¤é€‰é¡¹ php.ini è®¾ç½®ä¸­çš„ max_execution_time ï¼šè¿™è®¾ç½®äº†è„šæœ¬è¢«è§£æå™¨ä¸­æ­¢ä¹‹å‰å…è®¸çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œé»˜è®¤æ˜¯30s ä¹Ÿå°±æ˜¯php.ini è®¾ç½®ä¸­çš„ max_execution_timeå¦‚æœæ˜¯30ç§’è¿‡æœŸ, è€Œfpmä¸­çš„request_terminate_timeoutè®¾ç½®ä¸º0, åˆ™æ˜¯php.iniåœ¨30ç§’åç»ˆæ­¢äº†è¿›ç¨‹;phpæœ‰Fatal errorè¶…æ—¶æ—¥å¿—ï¼ŒhttpçŠ¶æ€ç ä¸º500 è€Œå¦‚æœphp.ini è®¾ç½®ä¸­çš„ max_execution_timeå¦‚æœæ˜¯30ç§’è¿‡æœŸ, è€Œfpmä¸­çš„request_terminate_timeoutè®¾ç½®ä¸º15, åˆ™æ˜¯phpfpmçš„è§£æå™¨åœ¨15ç§’åç»ˆæ­¢äº†è¿›ç¨‹;phpæ— Fatal errorè¶…æ—¶æ—¥å¿—ï¼ŒhttpçŠ¶æ€ç ä¸º502ï¼Œphp-fpmæ—¥å¿—ä¸­æœ‰æ€æ‰å­è¿›ç¨‹æ—¥å¿— å‚è€ƒ å½“ä¸€ä¸ªè¯·æ±‚è¶…è¿‡è¯¥è®¾ç½®çš„è¶…æ—¶æ—¶é—´å, å°±ä¼šå°†å¯¹åº”çš„PHPè°ƒç”¨å †æ ˆä¿¡æ¯å®Œæ•´å†™å…¥åˆ°æ…¢æ—¥å¿—ä¸­, è®¾ç½®ä¸º â€˜0â€™ è¡¨ç¤º â€˜Offâ€™ request_slowlog_timeout = 10s rrcomsç³»ç»Ÿçº¿ä¸Šè®¾ç½®ä¸º request_slowlog_timeout = 1 æ…¢è¯·æ±‚çš„è®°å½•æ—¥å¿—,é…åˆrequest_slowlog_timeoutä½¿ç”¨ slowlog = log/$pool.log.slow rrcomsç³»ç»Ÿçº¿ä¸Šå› ä¸ºåªæœ‰ä¸€ä¸ªç«™ç‚¹, æ‰€ä»¥ä¹Ÿæ˜¯åªæœ‰ä¸€ä¸ªé»˜è®¤çš„ www.conf æ± é…ç½®æ–‡ä»¶, æ‰€ä»¥æ…¢æ—¥å¿—æ–‡ä»¶ä¸º www.log.slow è®¾ç½®æ–‡ä»¶æ‰“å¼€æè¿°ç¬¦çš„rlimité™åˆ¶, é»˜è®¤å€¼:ç³»ç»Ÿå®šä¹‰å€¼é»˜è®¤å¯æ‰“å¼€å¥æŸ„æ˜¯1024ï¼Œå¯ä½¿ç”¨ ulimit -n æŸ¥çœ‹, ulimit -n 2048ä¿®æ”¹ rlimit_files = 1024 rrc omsç³»ç»Ÿçº¿ä¸Šæ²¡é…ç½® è®¾ç½®æ ¸å¿ƒ rlimit æœ€å¤§é™åˆ¶å€¼, å¯ç”¨å€¼: â€˜unlimitedâ€™ ã€0æˆ–è€…æ­£æ•´æ•°; é»˜è®¤å€¼: ç³»ç»Ÿå®šä¹‰å€¼ rlimit_core = 0 rrc omsç³»ç»Ÿçº¿ä¸Šæ²¡é…ç½® å¯åŠ¨æ—¶çš„Chrootç›®å½•, æ‰€å®šä¹‰çš„ç›®å½•éœ€è¦æ˜¯ç»å¯¹è·¯å¾„, å¦‚æœæ²¡æœ‰è®¾ç½®, åˆ™ chroot ä¸è¢«ä½¿ç”¨. chroot = rrc omsç³»ç»Ÿçº¿ä¸Šæ²¡é…ç½® è®¾ç½®å¯åŠ¨ç›®å½•ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨Chdiråˆ°è¯¥ç›®å½•. æ‰€å®šä¹‰çš„ç›®å½•éœ€è¦æ˜¯ç»å¯¹è·¯å¾„. é»˜è®¤å€¼: å½“å‰ç›®å½•ï¼Œæˆ–è€…/ç›®å½•ï¼ˆchrootæ—¶ï¼‰ chdir = rrc omsç³»ç»Ÿçº¿ä¸Šæ²¡é…ç½® é‡å®šå‘è¿è¡Œè¿‡ç¨‹ä¸­çš„ stdout å’Œ stderr åˆ°ä¸»è¦çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¸­, å¦‚æœæ²¡æœ‰è®¾ç½®, stdout å’Œ stderr å°†ä¼šæ ¹æ®FastCGIçš„è§„åˆ™è¢«é‡å®šå‘åˆ° /dev/null, é»˜è®¤å€¼:ç©º catch_workers_output = yes rrc omsç³»ç»Ÿçº¿ä¸Šé…ç½®ä¸º yes phpå‘½ä»¤è¡Œç›´æ¥è¿è¡Œphpæ–‡ä»¶, æ¯”å¦‚laravelä¸­è‡ªå®šä¹‰çš„å‘½ä»¤è„šæœ¬(ä¾‹å¦‚æ¶ˆè´¹è€…è„šæœ¬)å’Œé€šè¿‡php-fpmè§£æçš„ç¨‹åºæœ‰ä»€ä¹ˆåŒºåˆ«? php.iniä¸­çš„opcacheç¼“å­˜ä¼šå¯¹ä¸¤ç§è¿è¡Œæ–¹å¼éƒ½ç”Ÿæ•ˆä¹ˆ? Nginxä½¿ç”¨UnixåŸŸSocketé€šä¿¡(Nginxå’Œphp-fpmåœ¨åŒä¸€å°æœåŠ¡å™¨): https://www.cnblogs.com/JohnABC/p/4531107.html","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"CGIåè®®, CGIç¨‹åº, FastCGIåè®®, FastCGIç¨‹åº, PHP-FPM","slug":"PHP/2017-04-11-fpm","date":"2017-04-11T08:40:32.000Z","updated":"2018-05-15T09:48:13.000Z","comments":true,"path":"2017/04/11/PHP/2017-04-11-fpm/","link":"","permalink":"http://blog.renyimin.com/2017/04/11/PHP/2017-04-11-fpm/","excerpt":"","text":"CGIåè®®: åªæ˜¯ä¸€ä¸ªåè®® FastCGIåè®®: ä¹Ÿåªæ˜¯ä¸€ä¸ªåè®®(ä¸è¿‡æ˜¯CGIåè®®å‡çº§åçš„åè®®); FastCGIç¨‹åº: å®ç°äº†FastCGIåè®®çš„ç¨‹åºä¸ºFastCGIç¨‹åº; php-cgiç¨‹åº: åœ¨phpä¸­çš„sapi/cgi/php-cgiå°±å®ç°äº†FastCGIåè®®, è™½ç„¶å®ƒçš„åå­—å–åä¸ºphp-cgi, ä½†å…¶å®æ˜¯æ”¯æŒFacsCGIåè®®çš„; PHP-FPM: ä¸ä½†å®ç°äº†FastCGIåè®®, è€Œä¸”è‡ªå·±å…·æœ‰è¿›ç¨‹ç®¡ç†åŠŸèƒ½; Nginxä¸PHPçš„äº¤äº’ä¾èµ–äºCGIæ¥å£, å› ä¸ºä¸¤è€…éƒ½å®ç°äº†CGIæ¥å£, æ‰€ä»¥Nginxå¯ä»¥æŠŠæ”¶åˆ°çš„è¯·æ±‚äº¤ç»™PHP, å¹¶ä»PHPè·å¾—ç›¸åº”çš„ç»“æœå›ä¼ ç»™å®¢æˆ·ç«¯; æœ€åŸºæœ¬çš„CGIå®ç°æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½æ–°å»ºä¸€ä¸ªPHPè¿›ç¨‹, å¤„ç†å®Œæˆåå…³é—­è¿›ç¨‹, è¿™ç§æ–¹å¼ä¼šæ¶ˆè€—å¾ˆå¤šçš„èµ„æºåœ¨è¿›ç¨‹çš„å¯åŠ¨å’Œå…³é—­ä¸Š, æ‰€ä»¥æ•ˆç‡å¹¶ä¸é«˜; è¿›è€Œå‡ºç°äº†FastCGIè¿™ç§å®ç°æ–¹å¼, ä¹Ÿå°±æ˜¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹åè®©å®ƒå¤„ç†å¤šä¸ªè¯·æ±‚å†å…³é—­, è¿™ç§æ–¹å¼å°±æ˜¯è§£å†³æ¯æ¬¡è¯·æ±‚éƒ½æ‰“å¼€å’Œå…³é—­è¿›ç¨‹çš„æ¶ˆè€—çš„, ä½†FastCGIæœ‰ä¸ªç¼ºç‚¹, å°±æ˜¯å› ä¸ºä¸€ä¸ªè¿›ç¨‹åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¯·æ±‚, å¦‚æœåŒæ—¶æ”¶åˆ°å¤šä¸ªè¯·æ±‚, å®ƒä»¬åªèƒ½æ’é˜Ÿç­‰å¾…FastCGIè¿›ç¨‹çš„å¤„ç†; è§£å†³FastCGIåªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ–¹å¼å¾ˆç®€å•, å°±æ˜¯å¼€å¯å¤šä¸ªFastCGIè¿›ç¨‹, ä¸è¿‡å¼€å¯å¤šä¸ªFastCGIè¿›ç¨‹çš„è¯å°±å­˜åœ¨å¯¹è¿™äº›è¿›ç¨‹çš„ç®¡ç†é—®é¢˜, æ¯”å¦‚ç©¶ç«Ÿè¦å¼€å¤šå°‘ä¸ªè¿›ç¨‹, æ€ä¹ˆæ ¹æ®éœ€è¦åˆ†é…è¯·æ±‚åˆ°è¿™äº›è¿›ç¨‹ä¸Šç­‰ç­‰; è€ŒPHP-FPMå°±æ˜¯è¿™æ ·ä¸€ä¸ªç®¡ç†FastCGIè¿›ç¨‹çš„ç®¡ç†ç¨‹åº, Nginxå…ˆå°†è¯·æ±‚ä¼ é€’ç»™PHP-FPMï¼Œå†ç”±PHP-FPMé€‰æ‹©åˆé€‚çš„FastCGIå¤„ç†è¿›ç¨‹è¿›è¡Œå¤„ç†; åœ¨PHP-FPMå°†è¯·æ±‚ä¼ é€’ç»™FastCGIå¤„ç†è¿›ç¨‹çš„æ—¶å€™, å°±æ¶‰åŠåˆ°è¿›ç¨‹å¤ç”¨äº†, åŸåˆ™ä¸Š, PHP-FPMä¼šé€‰æ‹©ç©ºé—²çš„FastCGIè¿›ç¨‹å»å¤„ç†è¯·æ±‚, åœ¨å¤„ç†ä¹‹å‰, PHP-FPMä¼šå‘é€è¿›ç¨‹å¤ç”¨ä¿¡å·ç»™FastCGIè¿›ç¨‹, ç”¨æ¥è®©FastCGIè¿›ç¨‹å‡†å¤‡å¥½æ¥å—è¯·æ±‚å¹¶å¤„ç†; ä½†æ˜¯, FastCGIè¿›ç¨‹å¹¶ä¸æ€»æ˜¯èƒ½å¤Ÿå¤„ç†è¯·æ±‚, ä¹Ÿå°±æ˜¯ä¸ä¸€å®šèƒ½å¤Ÿå“åº”è¿›ç¨‹å¤ç”¨ä¿¡å·(æ¯”å¦‚è¯´å‡ºç°å‡æ­»çš„æƒ…å†µ), æ‰€ä»¥è¿™ä¸ªå‚æ•°å°±è¡¨ç¤ºäº†PHP-FPMç•™ç»™FastCGIè¿›ç¨‹å¤šä¹…æ—¶é—´å»å“åº”è¿›ç¨‹å¤ç”¨ä¿¡å·, å¦‚æœè¶…æ—¶äº†, PHP-FPMä¼šé€‰æ‹©å…¶ä»–çš„æ–¹å¼(ä¾‹å¦‚ä½¿ç”¨å…¶ä»–çš„FastCGIè¿›ç¨‹)å»å¤„ç†è¯·æ±‚;å‚è€ƒsegmentfaulté—®ç­”","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"Trait","slug":"PHP/2017-03-20-Trait","date":"2017-03-20T11:36:23.000Z","updated":"2018-03-15T04:37:21.000Z","comments":true,"path":"2017/03/20/PHP/2017-03-20-Trait/","link":"","permalink":"http://blog.renyimin.com/2017/03/20/PHP/2017-03-20-Trait/","excerpt":"","text":"ç®€ä»‹ phpä»¥å‰ä¸€ç›´éƒ½æ˜¯å•ç»§æ‰¿çš„è¯­è¨€, æ— æ³•åŒæ—¶ä»ä¸¤ä¸ªåŸºç±»ä¸­ç»§æ‰¿å±æ€§å’Œæ–¹æ³•; ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, è‡ªPHP5.4.0èµ·, PHPå®ç°äº†ä¸€ç§ä»£ç å¤ç”¨çš„æ–¹æ³•, ç§°ä¸ºtrait; å®ƒä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè‡ªç”±åœ°åœ¨ä¸åŒå±‚æ¬¡ç»“æ„å†…ç‹¬ç«‹çš„ç±»ä¸­å¤ç”¨ method, Trait å’Œ Class ç»„åˆçš„è¯­ä¹‰å®šä¹‰äº†ä¸€ç§å‡å°‘å¤æ‚æ€§çš„æ–¹å¼, é¿å…ä¼ ç»Ÿå¤šç»§æ‰¿ å’Œ Mixin ç±»ç›¸å…³å…¸å‹é—®é¢˜; ç”¨æ³•: é€šè¿‡åœ¨ç±»ä¸­ä½¿ç”¨ use å…³é”®å­—, å£°æ˜è¦ç»„åˆçš„Traitåç§°, å…·ä½“çš„Traitçš„å£°æ˜ä½¿ç”¨Traitå…³é”®è¯, Traitä¸èƒ½å®ä¾‹åŒ–; æ³¨æ„ ä½¿ç”¨traitçš„ æœ¬ç±»å’Œå…¶åŸºç±»ä¸­, ä¸èƒ½å‡ºç°ä¸traitä¸­åŒåçš„å±æ€§, å¯ä»¥ä½¿ç”¨åŒåæ–¹æ³•; ä¸€ä¸ªç±»ä¸­å¯ä»¥æ’å…¥å¤šä¸ªtrait, é€šè¿‡ useå…³é”®å­—å£°æ˜åˆ—å‡ºå¤šä¸ªtrait, toé‚£ä¸ªè¿‡é€—å·åˆ†éš”; å†²çª: å¦‚æœä¸¤ä¸ª trait éƒ½æ’å…¥äº†ä¸€ä¸ªåŒåçš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®è§£å†³å†²çªå°†ä¼šäº§ç”Ÿä¸€ä¸ªè‡´å‘½é”™è¯¯; ä¸ºäº†è§£å†³å¤šä¸ª trait åœ¨åŒä¸€ä¸ªç±»ä¸­çš„å‘½åå†²çª, éœ€è¦ä½¿ç”¨ insteadof æ“ä½œç¬¦æ¥æ˜ç¡®æŒ‡å®šä½¿ç”¨å†²çªæ–¹æ³•ä¸­çš„å“ªä¸€ä¸ª; ä»¥ä¸Šæ–¹å¼ä»…å…è®¸æ’é™¤æ‰å…¶å®ƒæ–¹æ³•, as æ“ä½œç¬¦å¯ä»¥ä¸ºæŸä¸ªæ–¹æ³•å¼•å…¥åˆ«å, æ³¨æ„, as æ“ä½œç¬¦ä¸ä¼šå¯¹æ–¹æ³•è¿›è¡Œé‡å‘½å, ä¹Ÿä¸ä¼šå½±å“å…¶æ–¹æ³•; as æ“ä½œ è¿˜å¯ä»¥è°ƒæ•´æ–¹æ³•çš„è®¿é—®æ§åˆ¶ Demo123456789101112131415161718192021222324252627282930313233343536373839404142434445&lt;?phptrait A &#123; public function smallTalk() &#123; echo &apos;a&apos;; &#125; public function bigTalk() &#123; echo &apos;A&apos;; &#125;&#125;trait B &#123; public function smallTalk() &#123; echo &apos;b&apos;; &#125; private function bigTalk() &#123; echo &apos;B&apos;; &#125;&#125;class Talker &#123; use A, B &#123; B::smallTalk insteadof A; A::bigTalk insteadof B; &#125;&#125;$test = new Talker();$test-&gt;bigTalk(); // Aä¸­çš„bigTalk A$test-&gt;smallTalk(); // Bä¸­çš„smallTalk bclass Aliased_Talker &#123; use A, B &#123; B::smallTalk insteadof A; A::bigTalk insteadof B; // æœ¬æ¥ä¸Šé¢å·²ç»å®šä¹‰çš„æ˜¯, ä½¿ç”¨Aä¸­çš„ bigTalk; // ä½†æ˜¯ä¸‹é¢åˆæƒ³ä½¿ç”¨Bä¸­çš„bigTalkï¼Œè¿™æ ·å°±éœ€è¦ä¸ºBé‡çš„bigTalkè®¾ç½®åˆ«å å¹¶ä¸”ä¸‹é¢è¿˜ä¸ºBä¸­çš„ bigTalk å†²æ´—ä½ è®¾ç½®äº†è®¿é—®æƒé™å’Œåˆ«å B::bigTalk as public talk; &#125;&#125;$test = new Aliased_Talker();$test-&gt;smallTalk(); // b$test-&gt;bigTalk(); // A$test-&gt;talk(); // B","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"å¯†ç ä¿æŠ¤","slug":"PHP/2016-11-25-bcrypt","date":"2016-11-25T13:25:03.000Z","updated":"2018-03-14T02:05:30.000Z","comments":true,"path":"2016/11/25/PHP/2016-11-25-bcrypt/","link":"","permalink":"http://blog.renyimin.com/2016/11/25/PHP/2016-11-25-bcrypt/","excerpt":"","text":"å…³äºå¯†ç å­˜å‚¨çš„æœ€ä½³å®è·µæ˜¯è®¡ç®—å¯†ç çš„å“ˆå¸Œå€¼,è€Œä¸æ˜¯åŠ å¯†ç”¨æˆ·çš„å¯†ç ; åŠ å¯†å’Œå“ˆå¸Œä¸æ˜¯ä¸€å›äº‹, åŠ å¯†æ˜¯åŒå‘ç®—æ³•, åŠ å¯†çš„æ•°æ®å¯ä»¥è§£å¯†, è€Œå“ˆå¸Œæ˜¯å•å‘ç®—æ³•, å“ˆå¸Œåçš„æ•°æ®ä¸èƒ½å†è¿˜åŸæˆåŸå§‹å€¼, è€Œä¸”ç›¸åŒçš„æ•°æ®å¾—åˆ°çš„å“ˆå¸Œå€¼å§‹ç»ˆç›¸åŒ; åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ç”¨æˆ·çš„å¯†ç , è¦å…ˆè®¡ç®—å¯†ç çš„å“ˆå¸Œå€¼, ç„¶ååœ¨æ•°æ®åº“ä¸­å­˜å‚¨å¯†ç çš„å“ˆå¸Œå€¼, å¦‚æœé»‘å®¢æ”»å…¥æ•°æ®åº“, åªèƒ½çœ‹åˆ°æ— æ„ä¹‰çš„å¯†ç å“ˆå¸Œå€¼, éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œèµ„æºæ‰èƒ½ç ´è§£; å“ˆå¸Œç®—æ³•æœ‰å¾ˆå¤šç§(å¦‚md5ã€SHA1ã€bcrypt å’Œ scrypt), æœ‰äº›ç®—æ³•é€Ÿåº¦å¾ˆå¿«, ç”¨äºéªŒè¯æ•°æ®å®Œæ•´æ€§; æœ‰äº›ç®—æ³•çš„é€Ÿåº¦åˆ™å¾ˆæ…¢, æ—¨åœ¨æé«˜å®‰å…¨æ€§; ç”Ÿæˆå¯†ç å’Œå­˜å‚¨å¯†ç æ—¶è¦ä½¿ç”¨é€Ÿåº¦æ…¢ã€å®‰å…¨æ€§é«˜çš„ç®—æ³•; ç›®å‰, æœ€å®‰å…¨çš„ç®—æ³•å½“å±bcryptï¼Œä¸md5å’ŒSHA1ä¸åŒ, bcryptæ•…æ„è®¾è®¡å¾—å¾ˆæ…¢, bcryptä¼šè‡ªåŠ¨åŠ ç›(salt), é˜²æ­¢æ½œåœ¨çš„å½©è™¹è¡¨æ”»å‡», bcryptç®—æ³•ä¼šèŠ±è´¹å¤§é‡æ—¶é—´åå¤å¤„ç†æ•°æ®, ç”Ÿæˆç‰¹åˆ«å®‰å…¨çš„å“ˆå¸Œå€¼ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­, å¤„ç†æ•°æ®çš„æ¬¡æ•°å«å·¥ä½œå› å­, å·¥ä½œå› å­çš„å€¼è¶Šé«˜, ç ´è§£å¯†ç æ‰€éœ€çš„æ—¶é—´è¶Šé•¿, å®‰å…¨æ€§è¶Šå¥½; bcryptç®—æ³•æ°¸ä¸è¿‡æ—¶, å¦‚æœè®¡ç®—æœºè¿ç®—é€Ÿåº¦å˜å¿«äº†, æˆ‘ä»¬åªéœ€æé«˜å·¥ä½œå› å­çš„å€¼; åœ¨Laravelä¸­å¯ä»¥é€šè¿‡Hashé—¨é¢æ¥å®Œæˆå¯†ç çš„ç”Ÿæˆ, æ£€æµ‹, åŠå·¥ä½œå› å­å˜æ›´åå¯†ç çš„é‡æ–°ç”Ÿæˆ; å‚è€ƒ:Laravelæ–‡æ¡£Laravelæ–‡æ¡£","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"03. OAuth2.0çš„CSRFæ”»å‡»","slug":"oauth/2016-10-22-OAuth-03","date":"2016-10-25T11:27:36.000Z","updated":"2018-03-14T01:33:36.000Z","comments":true,"path":"2016/10/25/oauth/2016-10-22-OAuth-03/","link":"","permalink":"http://blog.renyimin.com/2016/10/25/oauth/2016-10-22-OAuth-03/","excerpt":"","text":"åœºæ™¯å‡è®¾æœ‰å¦‚ä¸‹å‡ ä¸ªè§’è‰²: å—å®³è€… lant ; æ”»å‡»è€… rymuscle ; ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ liangrenç½‘ ; OAuth2æœåŠ¡æä¾›å¹³å° QQ ; æ”»å‡»æµç¨‹ æ”»å‡»è€…rymuscle ç™»å½• liangrenç½‘ å¹¶ä¸”é€‰æ‹©ä½¿ç”¨è‡ªå·±çš„ qqè´¦å·ç™»å½• ; liangrenç½‘ å°† æ”»å‡»è€…rymuscle é‡å®šå‘åˆ° qqçš„æˆæƒé¡µ, qqçš„æˆæƒé¡µ å‘ æ”»å‡»è€…rymuscle æ˜¾ç¤º æ˜¯å¦æˆæƒliangrenç½‘è®¿é—® ; æ”»å‡»è€…rymuscle åœ¨ç‚¹å‡»â€åŒæ„æˆæƒâ€ä¹‹å, æˆªè· qqæœåŠ¡å™¨è¿”å›çš„å«æœ‰ Authorization Code å‚æ•°çš„HTTPå“åº”; ç„¶å æ”»å‡»è€…rymuscle ç²¾å¿ƒæ„é€ ä¸€ä¸ªWebé¡µé¢, å®ƒä¼šè§¦å‘ liangrenç½‘ å‘ qqæˆæƒæœåŠ¡å™¨ å‘èµ·ä»¤ç‰Œç”³è¯·çš„è¯·æ±‚, è€Œè¿™ä¸ªè¯·æ±‚ä¸­çš„Authorization Codeå‚æ•°æ­£æ˜¯ä¸Šä¸€æ­¥ æ”»å‡»è€…rymuscle æˆªè·åˆ°è‡ªå·±çš„code ; æ”»å‡»è€…rymuscleå°†è¿™ä¸ªWebé¡µé¢æ”¾åˆ°äº’è”ç½‘ä¸Š, ç­‰å¾…æˆ–è€…è¯±éª—å—å®³è€…æ¥è®¿é—® ; å‡è®¾å—å®³è€… lant æ— æ„ä¸­è®¿é—®äº† æ”»å‡»è€…rymuscle å‡†å¤‡çš„è¿™ä¸ªWebé¡µé¢å, ä»¤ç‰Œç”³è¯·æµç¨‹åœ¨ å—å®³è€…lant çš„æµè§ˆå™¨é‡Œè¢«é¡ºåˆ©è§¦å‘, laingrenç½‘ ä» qqè®¤è¯æœåŠ¡å™¨ é‚£é‡Œè·å–åˆ°access_token, ä½†æ˜¯è¿™ä¸ªtokenä»¥åŠé€šè¿‡å®ƒè¿›ä¸€æ­¥è·å–åˆ°çš„ç”¨æˆ·ä¿¡æ¯å´éƒ½æ˜¯æ”»å‡»è€…rymuscleçš„ ; ä¹Ÿå°±æ˜¯æœ€ç»ˆ liangrenç½‘ å°† æ”»å‡»è€…rymuscle çš„ qq è´¦å·åŒ lantåœ¨liangrenç½‘çš„è´¦å·å…³è”äº†èµ·æ¥ ä»æ­¤ä»¥å, lantåªè¦æ²¡æœ‰å¯Ÿè§‰åˆ°è‡ªå·±æœ€åˆä½¿ç”¨çš„æ˜¯åˆ«äººçš„qqè´¦å·ç™»å½•çš„, é‚£ä¹ˆlantåœ¨ç«™ç‚¹ä¸Šæ‰€åšçš„ä¸€åˆ‡æ“ä½œ, rymuscleä¹Ÿå¯ä»¥ä½¿ç”¨qqç™»å½•è¿›è¡ŒæŸ¥çœ‹; æ”»å‡»çš„å…³é”®ç‚¹OAuth2çš„è®¤è¯æµç¨‹æ˜¯åˆ†ä¸ºå¥½å‡ æ­¥æ¥å®Œæˆçš„, åœ¨æ ‡å‡†oauthä¸­, ç¬¬ä¸‰æ–¹åº”ç”¨åœ¨æ”¶åˆ°ä¸€ä¸ªGETè¯·æ±‚æ—¶, é™¤äº†èƒ½çŸ¥é“å½“å‰ç”¨æˆ·çš„cookie, ä»¥åŠURLä¸­çš„Authorization Codeä¹‹å¤–, éš¾ä»¥åˆ†è¾¨å‡ºè¿™ä¸ªè¯·æ±‚åˆ°åº•æ˜¯ç”¨æˆ·æœ¬äººçš„æ„æ„¿, è¿˜æ˜¯æ”»å‡»è€…åˆ©ç”¨ç”¨æˆ·çš„èº«ä»½ä¼ªé€ å‡ºæ¥çš„è¯·æ±‚;äºæ˜¯ä¹, æ”»å‡»è€…å°±èƒ½ä½¿ç”¨ç§»èŠ±æ¥æœ¨çš„æ‰‹æ®µ, æå‰å‡†å¤‡ä¸€ä¸ªå«æœ‰è‡ªå·±çš„Authorization Codeçš„è¯·æ±‚, å¹¶è®©å—å®³è€…çš„æµè§ˆå™¨æ¥æ¥ç€å®Œæˆåç»­çš„ä»¤ç‰Œç”³è¯·æµç¨‹ ; æ”»å‡»éš¾ç‚¹ åŠ è§£å†³æ–¹æ¡ˆ å°½ç®¡è¿™ä¸ªæ”»å‡»æ—¢å·§å¦™åˆéšè”½, ä½†æ˜¯è¦æˆåŠŸè¿›è¡Œè¿™æ ·çš„CSRFæ”»å‡»ä¹Ÿæ˜¯æ¯”è¾ƒå›°éš¾çš„ æ•´ä¸ªæ”»å‡»å¿…é¡»åœ¨çŸ­æ—¶é—´å†…å®Œæˆ, å› ä¸ºOAuth2æä¾›è€…é¢å‘çš„Authorization Codeæœ‰æ•ˆæœŸå¾ˆçŸ­, OAuth2å®˜æ–¹æ¨èçš„æ—¶é—´æ˜¯ä¸å¤§äº10åˆ†é’Ÿ, è€Œä¸€æ—¦Authorization Codeè¿‡æœŸé‚£ä¹ˆåç»­çš„æ”»å‡»ä¹Ÿå°±ä¸èƒ½è¿›è¡Œä¸‹å»äº†; ä¸€ä¸ªAuthorization Codeåªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡, å¦‚æœOAuth2æä¾›è€…æ”¶åˆ°é‡å¤çš„Authorization Code, å®ƒä¼šæ‹’ç»å½“å‰çš„ä»¤ç‰Œç”³è¯·è¯·æ±‚, ä¸æ­¢å¦‚æ­¤, æ ¹æ®OAuth2å®˜æ–¹æ¨è, å®ƒè¿˜å¯ä»¥æŠŠå’Œè¿™ä¸ªå·²ç»ä½¿ç”¨è¿‡çš„Authorization Codeç›¸å…³è”çš„access_tokenå…¨éƒ¨æ’¤é”€æ‰, è¿›ä¸€æ­¥é™ä½å®‰å…¨é£é™©; å…¶å®è²Œä¼¼åªè¦åšåˆ°Authorization Codeåªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡, å°±å¯ä»¥é˜²æ­¢csrfåœ¨æ­¤å¤„çš„æ”»å‡»äº†, å› ä¸º rymuscle åœ¨æ”»å‡»çš„æ—¶å€™, ä¸€æ—¦è·å¾— Authorization Code, ç¬¬ä¸‰æ–¹ç«™ç‚¹æœåŠ¡å™¨å°±ä¼šä½¿ç”¨ Authorization Code å»ç”³è¯·access_token, ç„¶ååªè¦æ ‡è®° Authorization Code ä¸ºå·²ç»ä½¿ç”¨, é‚£ä¹ˆ å—å®³è€…lant å³ä½¿ç‚¹å‡» æ”»å‡»è€…rymuscle æ„é€ å¥½çš„é“¾æ¥ä¹Ÿæ²¡ç”¨, å› ä¸ºè¿æ¥ä¸­çš„ Authorization Code å·²ç»è¢«æ ‡è®°ä¸ºä½¿ç”¨è¿‡äº†; æ‰€ä»¥ä¸ä¸€å®šéè¦ä½¿ç”¨ä¸‹é¢çš„stateå‚æ•°æ¥è¿›è¡Œé˜²å¾¡ æ¯”å¦‚å¾®ä¿¡å…¬ä¼—å¹³å°çš„OAuthæˆæƒ: stateå‚æ•°å°±æ˜¯å¯é€‰çš„ æ–°æµªå¼€æ”¾å¹³å°çš„OAuthæˆæƒ, stateå‚æ•°ä¹Ÿæ˜¯å¯é€‰çš„ å½“ç„¶, ä»–ä»¬ä¸ä¸€å®šåšçš„æ˜¯å’Œæ­¤å¤„ä¸€æ ·çš„é˜²å¾¡æ–¹æ¡ˆ, ä½†æ˜æ˜¾ä¸ä¾èµ–äºstateå‚æ•°æ¥è§£å†³é—®é¢˜; stateå‚æ•°é˜²å¾¡: è¦é˜²æ­¢è¿™æ ·çš„æ”»å‡»å…¶å®å¾ˆå®¹æ˜“, ä½œä¸ºç¬¬ä¸‰æ–¹åº”ç”¨çš„å¼€å‘è€…, åªéœ€åœ¨OAuthè®¤è¯è¿‡ç¨‹ä¸­åŠ å…¥ state å‚æ•°, å¹¶éªŒè¯å®ƒçš„å‚æ•°å€¼å³å¯; åœ¨å°†ç”¨æˆ·é‡å®šå‘åˆ°OAuth2çš„Authorization Endpointå»çš„æ—¶å€™, ä¸ºç”¨æˆ·ç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸², å¹¶ä½œä¸ºstateå‚æ•°åŠ å…¥åˆ°URLä¸­ ; åœ¨æ”¶åˆ°OAuth2æœåŠ¡æä¾›è€…è¿”å›çš„Authorization Codeè¯·æ±‚çš„æ—¶å€™, éªŒè¯æ¥æ”¶åˆ°çš„stateå‚æ•°å€¼, å¦‚æœæ˜¯æ­£ç¡®åˆæ³•çš„è¯·æ±‚, é‚£ä¹ˆæ­¤æ—¶æ¥å—åˆ°çš„å‚æ•°å€¼åº”è¯¥å’Œä¸Šä¸€æ­¥æåˆ°çš„ä¸ºè¯¥ç”¨æˆ·ç”Ÿæˆçš„stateå‚æ•°å€¼å®Œå…¨ä¸€è‡´, å¦åˆ™å°±æ˜¯å¼‚å¸¸è¯·æ±‚; ä½†éœ€è¦æ³¨æ„ stateå‚æ•° éœ€è¦å…·å¤‡ä¸‹é¢å‡ ä¸ªç‰¹æ€§: ä¸å¯é¢„æµ‹æ€§: è¶³å¤Ÿçš„éšæœº, ä½¿å¾—æ”»å‡»è€…éš¾ä»¥çŒœåˆ°æ­£ç¡®çš„å‚æ•°å€¼ ;å¦‚æœä½ æ¯æ¬¡ç”Ÿæˆçš„stateéƒ½è¢«æ”¾åœ¨ä¸€èµ·, æ¯”å¦‚ä¸€ä¸ªåº“/ç¼“å­˜ä¸­å­˜åœ¨å¾ˆå¤šstate;é‚£ä¹ˆé—®é¢˜å°±æ˜¯æ”»å‡»è€…è¿˜æ˜¯å¯ä»¥æ‹¿ç€è‡ªå·±çš„codeå†åŠ ä¸Šä¸€ä¸ªstate, æ¥æ„é€ ä¸€ä¸ªé“¾æ¥æ¬ºéª—ç”¨æˆ·æ¥ç‚¹å‡»;(å‡è®¾stateæ­£å¥½å°±åœ¨ä½ çš„åº“/ç¼“å­˜ä¸­); é‡ç‚¹æ˜¯å…³è”æ€§: stateå‚æ•°å€¼å¯ä»¥å’Œå½“å‰ç”¨æˆ·ä¼šè¯(user session)ç›¸äº’å…³è”çš„æ‰€ä»¥åº”è¯¥è®©stateå’Œå…·ä½“çš„ç”¨æˆ·å…³è”èµ·æ¥, è™½ç„¶ç”¨æˆ·è¿˜æ²¡æœ‰ç™»å½•, ä½†æ˜¯ä¹Ÿå¯ä»¥è®©stateæ”¾åˆ°sessionä¸­ ;ç„¶åæ”»å‡»è€…è¦çŒœæµ‹å‡ºæ¥ä¸€ä¸ªstateçš„è¯, å³ä¾¿æ˜¯å·²ç»ç”Ÿæˆè¿‡äº†, ä½†æ˜¯ä¹Ÿå¾—æ­£å¥½æ”»å‡»çš„æ˜¯è¿™ä¸ªç”¨æˆ·; å”¯ä¸€æ€§: æ¯ä¸ªç”¨æˆ·æ¯æ¬¡è¯·æ±‚ç”Ÿæˆçš„stateå‚æ•°å€¼éƒ½æ˜¯å”¯ä¸€çš„ ; æ—¶æ•ˆæ€§: stateå‚æ•°ä¸€æ—¦è¢«ä½¿ç”¨åˆ™ç«‹å³å¤±æ•ˆ ; å‚è€ƒ èš‚èšé‡‘æœå¼€æ”¾å¹³å°: å…¶å®å¯ä»¥ç»“åˆä»¥ä¸Šå„ç§æ–¹æ³•ä¸€èµ·æ¥è¿›è¡Œé˜²å¾¡! å‚è€ƒ ç§»èŠ±æ¥æœ¨å‚è€ƒ stateå‚æ•°æ¼æ´å‚è€ƒ é˜®ä¸€å³°","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"02. æˆæƒç æ¨¡å¼","slug":"oauth/2016-10-21-OAuth-02","date":"2016-10-21T07:27:36.000Z","updated":"2018-03-12T09:16:01.000Z","comments":true,"path":"2016/10/21/oauth/2016-10-21-OAuth-02/","link":"","permalink":"http://blog.renyimin.com/2016/10/21/oauth/2016-10-21-OAuth-02/","excerpt":"","text":"å‰è¨€ä¹‹å‰å·²ç»ç®€å•äº†è§£äº†æˆæƒç æ¨¡å¼æµç¨‹, å…·ä½“å¦‚ä½•å¼€å‘å®ç°? å¼€å‘æµç¨‹å¯å‚è€ƒ è…¾è®¯å¼€æ”¾å¹³å° ä½¿ç”¨Authorization_Codeè·å–Access_Token æ–°æµªAuthorization_Codeæˆæƒæœºåˆ¶ å¾®ä¿¡ç½‘é¡µAuthorization_Codeæˆæƒæœºåˆ¶","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"01. OAuth(Open Authorization)å¼€æ”¾å¼æˆæƒåè®®","slug":"oauth/2016-10-21-OAuth-01","date":"2016-10-21T03:05:08.000Z","updated":"2018-04-25T07:58:43.000Z","comments":true,"path":"2016/10/21/oauth/2016-10-21-OAuth-01/","link":"","permalink":"http://blog.renyimin.com/2016/10/21/oauth/2016-10-21-OAuth-01/","excerpt":"","text":"èƒŒæ™¯OAuthæ˜¯ä¸€ä¸ªå…³äºæˆæƒ(authorization)çš„å¼€æ”¾ç½‘ç»œæ ‡å‡†, ç›®å‰çš„ç‰ˆæœ¬æ˜¯2.0ç‰ˆ ç¬¬ä¸‰æ–¹ç«™ç‚¹ä¼ ç»Ÿæˆæƒçš„å¼Šç«¯èŠèµ·OAuth, å¯èƒ½æœ€å¸¸è§çš„å°±æ˜¯å¾ˆå¤šç¬¬ä¸‰æ–¹ç«™ç‚¹æ¥å…¥çš„ QQç™»å½•, å¾®ä¿¡ç™»å½•, æ–°æµªå¾®åšç™»å½•, Githubç™»å½•ç­‰; OAuthä¹‹å‰çš„ ä¼ ç»Ÿæˆæƒ æ¯”è¾ƒ ç®€å•, ç›´æ¥, æš´åŠ›, ä¸€èˆ¬æ˜¯ç”¨æˆ·ç›´æ¥å°†è‡ªå·± èµ„æºæœåŠ¡å™¨(qq,å¾®ä¿¡,Github) çš„è´¦å·å’Œå¯†ç ç»™å®¢æˆ·ç«¯ç¬¬ä¸‰æ–¹ç«™ç‚¹, è¿™ç§åšçš„æ³•å¼Šç«¯å¤ªå¤š: å¦‚æœç”¨æˆ·å¯¹æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹ç«™ç‚¹éƒ½æä¾›è‡ªå·± èµ„æºæœåŠ¡å™¨ çš„ è´¦å·+å¯†ç , é‚£å°†ä¼šå­˜åœ¨ä¸¥é‡å®‰å…¨éšæ‚£; ç”¨æˆ·æ— æ³•è®¾å®šç¬¬ä¸‰æ–¹ç«™ç‚¹çš„æƒåˆ©èŒƒå›´; ç”¨æˆ·æƒ³æ”¶å›ç¬¬ä¸‰æ–¹ç«™ç‚¹çš„æƒåˆ©ä¸å¤ªæ–¹ä¾¿;ç”¨æˆ·åªæœ‰ä¿®æ”¹å¯†ç , æ‰èƒ½æ”¶å›èµ‹äºˆç¬¬ä¸‰æ–¹ç½‘ç«™çš„æƒåŠ›, å¦åˆ™ç¬¬ä¸‰æ–¹ç½‘ç«™å°†ä¼šæ°¸ä¹…æ‹¥æœ‰ç”¨æˆ·æˆæƒ;ä½†æ˜¯ç”¨æˆ·ç›´æ¥ä¿®æ”¹å¯†ç å, åˆä¼šä½¿å¾—æ‰€æœ‰è·å¾—ç”¨æˆ·æˆæƒçš„ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå…¨éƒ¨å¤±æ•ˆ;è™½ç„¶ä¸€äº›è‰¯å¿ƒç¬¬ä¸‰æ–¹å¯ä»¥è®¾ç½® ç”¨æˆ·è´¦å· å’Œ èµ„æºæœåŠ¡å™¨è´¦å· çš„ç»‘å®šå’Œè§£ç»‘, ä½†ä¸ä¸€å®šæ‰€æœ‰ç¬¬ä¸‰æ–¹éƒ½ä¼šç»™ä½ åš (csdnå°±åšäº†ä¸ç”¨æˆ·çš„QQ,å¾®åšç­‰èµ„æºæœåŠ¡å™¨çš„è§£ç»‘åŠŸèƒ½) è€ŒOAuthçš„æˆæƒä¸ä¼šè®© ç¬¬ä¸‰æ–¹ç«™ç‚¹ è§¦åŠåˆ°ç”¨æˆ·åœ¨ èµ„æºæœåŠ¡å™¨ ä¸Šçš„å¸å·ä¿¡æ¯(å¦‚ç”¨æˆ·åä¸å¯†ç ), å³, ç¬¬ä¸‰æ–¹ç«™ç‚¹æ— éœ€ä½¿ç”¨ç”¨æˆ·èµ„æºæœåŠ¡å™¨ä¸Šçš„è´¦å·ä¸å¯†ç , å°±å¯ä»¥è·å¾—è¯¥ç”¨æˆ·åœ¨ èµ„æºæœåŠ¡å™¨ ä¸Šçš„èµ„æº, å› æ­¤ OAuth ç›¸æ¯”äºç›´æ¥ä½¿ç”¨è´¦å·å¯†ç æ˜¯å®‰å…¨çš„; å†…éƒ¨å¾®æœåŠ¡ç³»ç»Ÿé—´çš„æˆæƒ å…¶å®å¯¹äºå†…éƒ¨ç³»ç»Ÿä¹‹é—´æ¥å£äº’è°ƒæ—¶çš„æˆæƒ, ç›´æ¥ä½¿ç”¨ è´¦å·+å¯†ç (AppID+AppSecret) å’Œ ä½¿ç”¨ token æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§åŒºåˆ«, éƒ½æ˜¯å†…éƒ¨ç³»ç»Ÿ, ä¹Ÿä¸ä¼šå®¹æ˜“å‡ºç°è´¦å·å’Œå¯†ç æ³„éœ²çš„é—®é¢˜; å’Œæ¯æ¬¡è¯·æ±‚å‘é€tokenä¸€æ ·, æ¯æ¬¡è¯·æ±‚éœ€è¦å‘é€å½“å‰æœåŠ¡çš„ è´¦å·+å¯†ç (AppID+AppSecret), éƒ½å¯ä»¥åŠ scopeå‚æ•°æ¥åšæƒé™è®¾ç½®; (æ³¨æ„è¿™ç§æƒé™æ˜¯é’ˆå¯¹æœåŠ¡çš„, ä¸æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„ç”¨æˆ·çš„) ä»ç„¶å­˜åœ¨çš„é—®é¢˜: æ¯æ¬¡è¯·æ±‚éƒ½ç›´æ¥å‘é€è´¦å·å’Œå¯†ç è¿˜æ˜¯ä¸å¤ªå®‰å…¨, å¤–ä¸€å°±æœ‰æ³„éœ²äº†å‘¢?æ‰€ä»¥æœ€å¥½ä½¿ç”¨å…·æœ‰æ—¶æ•ˆæ€§çš„token, å³ä½¿è¢«æ³„éœ², ä¹Ÿä¸æ˜¯æ°¸ä¹…æ³„éœ², ç›¸å¯¹äºæ°¸ä¹…ä¸å˜æˆ–è€…å¾ˆä¹…æ‰å˜æ›´ä¸€æ¬¡çš„å¯†ç æ¥è¯´, tokençš„ æ—¶æ•ˆæ€§ å¸¦æ¥çš„å®‰å…¨æå‡è¦æ›´å¤§ä¸€äº›; å†…éƒ¨ç³»ç»Ÿç”¨æˆ·ä¸ç³»ç»Ÿçš„æˆæƒ å…¸å‹çš„å°±æ˜¯å½“å‰å¾ˆå¤šå…¬å¸åšçš„APPå¼€å‘, å®¢æˆ·ç«¯ä¸åå°åšæ•°æ®äº¤äº’çš„åœºæ™¯; è…¾è®¯code: http://wiki.open.qq.com/wiki/website/%E4%BD%BF%E7%94%A8Authorization_Code%E8%8E%B7%E5%8F%96Access_Token åœºæ™¯: å…¬å¸å¯¹æ¥ç¬¬ä¸‰æ–¹ç™»å½•, ä½ éœ€è¦äº†è§£OAuthåè®®; å…¬å¸å†…éƒ¨åšæˆæƒä¸­å¿ƒ(SSO(Single Sign On)å•ç‚¹ç™»å½•, ) å‡ ä¸ªåè¯å®šä¹‰1.ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åº: åˆç§° å®¢æˆ·ç«¯(client) æ¯”å¦‚ä½ çš„ç«™ç‚¹ä¸ºäº†å®ç°è®©ç”¨æˆ·å¿«æ·ç™»å½•, å¿«é€Ÿå¼•æµçš„ç›®çš„, éœ€è¦å¯¹æ¥QQ, å¾®åšç­‰ç¬¬ä¸‰æ–¹ç™»å½•, è™½ç„¶å¯¹ä½ çš„ç«™ç‚¹æ¥è¯´, QQ, å¾®åšè¿™äº›éƒ½æ˜¯ç¬¬ä¸‰æ–¹ç«™ç‚¹; ä½†æ˜¯ä»å…¨å±€ä¸Šæ¥è¯´, æœåŠ¡æä¾›å•†å¼€å‘çš„è®¤è¯æœåŠ¡å™¨æ˜¯è¦ç»™ç¬¬ä¸‰æ–¹çš„ç«™ç‚¹æˆæƒçš„, ä½ çš„ç«™ç‚¹æ‰æ˜¯ç¬¬ä¸‰æ–¹ç«™ç‚¹, æ˜¯è¦ç”¨æˆ· QQ,å¾®åš è¿™äº›èµ„æºæœåŠ¡å™¨ä¸Šçš„æˆæƒ, ä¹‹å, ä½ çš„ç«™ç‚¹æ‰èƒ½å…·æœ‰ ä½¿ç”¨ç”¨æˆ·QQå¾®åšè´¦å·ç™»å½•, å¹¶ä¸”è·å–QQå¤´åƒâ€¦.æƒåˆ©; 2.æœåŠ¡æä¾›å•†: ä¹Ÿå°±æ˜¯æ‹¥æœ‰èµ„æºæœåŠ¡å™¨, è®¤è¯æœåŠ¡å™¨çš„å‚å•† (æ¯”å¦‚QQ, å¾®åš) 3.è®¤è¯æœåŠ¡å™¨: å³æœåŠ¡æä¾›å•†ä¸“é—¨ç”¨æ¥å¤„ç†è®¤è¯çš„æœåŠ¡å™¨; (æ¯”å¦‚QQ, å¾®åšçš„è®¤è¯æœåŠ¡å™¨) 4.èµ„æºæœåŠ¡å™¨: å³æœåŠ¡æä¾›å•†å­˜æ”¾ç”¨æˆ·ç”Ÿæˆçš„èµ„æºçš„æœåŠ¡å™¨(å®ƒä¸è®¤è¯æœåŠ¡å™¨,å¯ä»¥æ˜¯åŒä¸€å°æœåŠ¡å™¨,ä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„æœåŠ¡å™¨) OAuth2.0å››ç§æˆæƒç±»å‹OAuth2.0åè®®å®šä¹‰äº†ç”¨äºè·å¾—æˆæƒçš„â€å››ç§ä¸»è¦æˆæƒç±»å‹â€ æˆæƒç æ¨¡å¼Authorization code1.æˆæƒç æ¨¡å¼æ˜¯åŠŸèƒ½æœ€å®Œæ•´ã€æµç¨‹æœ€ä¸¥å¯†çš„æˆæƒæ¨¡å¼(æ ‡å‡†çš„Serveræˆæƒæ¨¡å¼, éå¸¸é€‚åˆServerç«¯çš„Webåº”ç”¨); 2.å®ƒçš„ç‰¹ç‚¹æ˜¯: é€šè¿‡å®¢æˆ·ç«¯çš„åå°æœåŠ¡å™¨ ä¸ æœåŠ¡æä¾›å•†çš„è®¤è¯æœåŠ¡å™¨ è¿›è¡Œäº’åŠ¨; 3.åœºæ™¯: æ¯”å¦‚, å…¬å¸éœ€è¦å¯¹æ¥ QQ, å¾®åš, å¾®ä¿¡(ç½‘é¡µæˆæƒ) ç­‰ç¬¬ä¸‰æ–¹ç™»å½•æˆæƒ; 4.æˆæƒæµç¨‹å›¾ 5.æµç¨‹è§£æ (A) ç”¨æˆ· è®¿é—® ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯(æ¯”å¦‚ç‚¹å‡»äº†ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ä¸Šçš„QQç™»å½•), åˆ™ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ä¼šå°†ç”¨æˆ·å¯¼å‘ æœåŠ¡æä¾›å•†çš„è®¤è¯æœåŠ¡å™¨; (B) ç”¨æˆ·é€‰æ‹©æ˜¯å¦ç»™äºˆ ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ æˆæƒ; (C) å‡è®¾ç”¨æˆ·ç»™äºˆæˆæƒ, æœåŠ¡æä¾›å•†çš„è®¤è¯æœåŠ¡å™¨ ä¼šå°†ç”¨æˆ·å¯¼å‘ ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ äº‹å…ˆæŒ‡å®šçš„ é‡å®šå‘URI(redirection URI), åŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ; (D) ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ æ”¶åˆ°æˆæƒç , é™„ä¸Šæ—©å…ˆçš„é‡å®šå‘URI, å‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œ, è¿™ä¸€æ­¥æ˜¯åœ¨ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯çš„åå°æœåŠ¡å™¨ä¸Šå®Œæˆçš„, å¯¹ç”¨æˆ·ä¸å¯è§; (E) æœåŠ¡æä¾›å•†çš„è®¤è¯æœåŠ¡å™¨ æ ¸å¯¹äº† æˆæƒç  å’Œ é‡å®šå‘URI, ç¡®è®¤æ— è¯¯å, å‘å®¢æˆ·ç«¯å‘é€è®¿é—® ä»¤ç‰Œ(access token) å’Œ æ›´æ–°ä»¤ç‰Œ(refresh token); éšå¼æˆæƒæ¨¡å¼Implicit Grant1.ä¹Ÿå«ç®€åŒ–æ¨¡å¼, è¯¥æ¨¡å¼ä¸é€šè¿‡ ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ çš„æœåŠ¡å™¨, è€Œæ˜¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­å‘ æœåŠ¡æä¾›å•†çš„è®¤è¯æœåŠ¡å™¨ ç”³è¯·ä»¤ç‰Œ, è·³è¿‡äº†æˆæƒç è¿™ä¸ªæ­¥éª¤, å› æ­¤å¾—å; 2.å®ƒçš„ç‰¹ç‚¹æ˜¯: ç”¨æˆ·æ˜¯ä»¥å•ä¸ªç”¨æˆ·çš„åä¹‰, æ‰€æœ‰æ­¥éª¤åœ¨æµè§ˆå™¨ä¸­å®Œæˆ, ä»¤ç‰Œå¯¹è®¿é—®è€…æ˜¯å¯è§çš„; 3.åœºæ™¯: å¯†ç æ¨¡å¼Resource Owner Password Credentials1.ç”¨æˆ·å‘å®¢æˆ·ç«¯æä¾›è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç , å®¢æˆ·ç«¯ä½¿ç”¨è¿™äº›ä¿¡æ¯å‘ â€œæœåŠ¡å•†æä¾›å•†â€ ç´¢è¦æˆæƒ ; 2.å®ƒçš„ç‰¹ç‚¹æ˜¯: å®¢æˆ·ç«¯ä»ç„¶æ˜¯ä»¥å•ä¸ªç”¨æˆ·çš„åä¹‰å‘æœåŠ¡æä¾›å•†è¿›è¡Œè®¤è¯, è¿™ç§æ¨¡å¼è¦æ±‚ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç æ¥äº¤æ¢è®¿é—®ä»¤ç‰Œ access_token ; åœ¨è¿™ç§æ¨¡å¼ä¸­, ç”¨æˆ·å¿…é¡»æŠŠè‡ªå·±çš„å¯†ç ç»™ç¬¬ä¸‰æ–¹, ä½†æ˜¯ç¬¬ä¸‰æ–¹ä¸å¾—å‚¨å­˜å¯†ç , è¿™é€šå¸¸ç”¨åœ¨ç”¨æˆ·å¯¹å®¢æˆ·ç«¯é«˜åº¦ä¿¡ä»»çš„æƒ…å†µä¸‹, æ¯”å¦‚å®¢æˆ·ç«¯ä¹Ÿæ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†; ç¬¬ä¸‰æ–¹ç«™ç‚¹, è®¤è¯æœåŠ¡å™¨, ç”¨æˆ·éƒ½æ˜¯ä¸€å®¶, ç”¨æˆ·å¯¹ç¬¬ä¸‰æ–¹ç«™ç‚¹è¶³å¤Ÿä¿¡ä»»ï¼Œæ‰èƒ½é‡‡å–è¿™ç§æ¨¡å¼æ¥å®ç° (æ¯”å¦‚å‰åç«¯åˆ†ç¦»çš„tokenæˆæƒæ¨¡å¼) 3.åœºæ™¯: æ¯”å¦‚å…¬å¸åšå‰åç«¯åˆ†ç¦», è²Œä¼¼å°±å¯ä»¥ä½¿ç”¨è¿™ç§å¯†ç æ¨¡å¼æ¥ç”Ÿæˆtokenç»™å‰ç«¯ä½¿ç”¨; å…¬å¸å¦‚æœæœ‰å¤šå¥—å†…éƒ¨åå°ç³»ç»Ÿ, å¼€å‘äººå‘˜å’Œå…¬å¸ç®¡ç†å‘˜å¯èƒ½å°±è¦å‡†å¤‡å¤šå¥—è´¦å·, æ¯”è¾ƒéº»çƒ¦, ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, å¯ä»¥åšä¸€ä¸ªè´¦å·ä¸­å¿ƒç³»ç»Ÿ, ç”¨æˆ·åœ¨ç™»å½•å„ä¸ªç³»ç»Ÿåå°çš„æ—¶å€™, ä¼šå…ˆè·³è½¬åˆ°ç”¨æˆ·ä¸­å¿ƒè¿›è¡Œç™»å½•, ä¸€æ—¦ç™»å½•æˆåŠŸä¹‹å, å°±ä¼šç»™ç”¨æˆ·åˆ†å‘ä¸€ä¸ªaccess_token, ç”¨æ¥åœ¨å„ä¸ªç³»ç»Ÿé—´ä½œä¸ºç™»å½•è®¤è¯ (è¿™ä¹Ÿå®ç°äº†SSOå•ç‚¹ç™»å½•); 4.æµç¨‹å›¾: å®¢æˆ·ç«¯æ¨¡å¼Client Credentials1.å®¢æˆ·ç«¯æ¨¡å¼æŒ‡ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ä»¥ç«™ç‚¹çš„åä¹‰, è€Œä¸æ˜¯ä»¥å•ä¸ªç”¨æˆ·çš„åä¹‰, å‘æœåŠ¡æä¾›å•†è¿›è¡Œè®¤è¯; 2.åœºæ™¯ æœåŠ¡å™¨ ä¸æä¾›åƒç”¨æˆ·æ•°æ®è¿™æ ·çš„é‡è¦èµ„æº, ä»…ä»…æ˜¯ä¸€äº›å¼€æ”¾çš„åŠŸèƒ½æ€§API; (ä¾‹å¦‚å¾®ä¿¡å…¬ä¼—å¹³å°, Google Storageæˆ–Amazon S3 ç­‰å¼€æ”¾å¹³å°æä¾›çš„åŸºç¡€æœåŠ¡æ¥å£) æ¯”å¦‚: å¾®ä¿¡å…¬ä¼—å¹³å°çš„å¼€æ”¾æ¥å£å…¶å®å°±æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼, å› ä¸ºæˆ‘ä»¬çš„å¾®ä¿¡å…¬ä¼—å·æ˜¯ä½œä¸ºä¸€ä¸ªå®¢æˆ·ç«¯æ¥è°ƒç”¨å¾®ä¿¡åŸºç¡€çš„åŠŸèƒ½æ€§æœåŠ¡çš„ (è€Œå¾®ä¿¡çš„ç½‘é¡µæˆæƒé‡‡ç”¨çš„æ˜¯æˆæƒç æ¨¡å¼, å› ä¸ºé’ˆå¯¹çš„æ˜¯æ¯ä¸ªå…·ä½“çš„ç”¨æˆ·è¿›è¡Œæˆæƒçš„);(å¦‚æœå…¬å¸å®ç°äº†ä¸€å¥—åŸºç¡€æœåŠ¡çš„Api(éƒ½æ˜¯äº›åŸºç¡€åŠŸèƒ½æ¥å£, å¹¶ä¸æ¶‰åŠç”¨æˆ·æ•°æ®è¿™ç§é‡è¦èµ„æº), å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æä¾›ç»™å†…éƒ¨å…¶ä»–ç³»ç»Ÿé€šè¿‡è®¤è¯çš„æ–¹å¼æ¥è°ƒç”¨; å…¬å¸å¦‚æœå®åŠ›å¼ºæ‚çš„è¯, ä¹Ÿå¯ä»¥å°†å…¬å¸å¼€å‘çš„åŸºç¡€æœåŠ¡Apiå…¬å¼€å‡ºæ¥ ä¾›å¤–éƒ¨å…¶ä»–ç¬¬ä¸‰æ–¹ç«™ç‚¹æœåŠ¡å™¨ æ¥è°ƒç”¨) 3.æµç¨‹å›¾: èµ„æ–™å¾®ä¿¡å…¬ä¼—å¹³å°é˜®ä¸€å³°åšæ–‡åšæ–‡","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"07.\"Jsonp\" å¯¹æ¯” \"CORSç®€å•/éç®€å•è¯·æ±‚\"","slug":"2016-09-18-sameoriginpolicy-07","date":"2016-09-18T13:20:16.000Z","updated":"2018-03-02T06:52:27.000Z","comments":true,"path":"2016/09/18/2016-09-18-sameoriginpolicy-07/","link":"","permalink":"http://blog.renyimin.com/2016/09/18/2016-09-18-sameoriginpolicy-07/","excerpt":"","text":"Jsonp å¯¹æ¯” CORSç®€å•/éç®€å•è¯·æ±‚éƒ½å¯ä»¥æ–¹ä¾¿å®ç°è·¨åŸŸ; Jsonp ç®€å•é€‚ç”¨, è€å¼æµè§ˆå™¨å…¨éƒ¨æ”¯æŒ, æœåŠ¡å™¨ç«¯æ”¹åŠ¨å¾ˆå°; ä½†æ˜¯JSONPåªèƒ½å‘GETè¯·æ±‚; JSONPè·¨åŸŸå‘é€Cookieçš„è¯, åªç”¨è®¾ç½® cookieçš„domainå±æ€§ ä¸ºç›¸åŒçš„é¡¶çº§åŸŸåå³å¯; CORSç®€å•è¯·æ±‚ æœåŠ¡ç«¯éœ€è¦è®¾ç½®ä¸€äº›å…è®¸é€‰é¡¹; è¯·æ±‚æ–¹æ³•æ¯”è¾ƒç®€å•, å¦‚ GET, POST, HEAD ; è·¨å­åŸŸå…±äº«cookieçš„è¯, æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½è¦å¯¹Credentials headerå±æ€§è¿›è¡Œè®¾ç½®; å¦å¤–, è·¨å­åŸŸçš„è¯, å¦‚æœæƒ³åŒæ—¶å…±äº«cookieçš„è¯, æœåŠ¡ç«¯ Access-Control-Allow-Origin ä¸èƒ½è®¾ç½®ä¸º *, å¦åˆ™ä¼šæç¤º :123Failed to load http://test.test.com/index.php?sex=renyimin&amp;age=100: The value of the 'Access-Control-Allow-Origin' header in the response must not be the wildcard '*' when the request's credentials mode is 'include'. Origin 'http://www.test.com' is therefore not allowed access. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute. CORSéç®€å•è¯·æ±‚ æœåŠ¡ç«¯éœ€è¦è®¾ç½®ä¸€äº›å…è®¸é€‰é¡¹; å…¶ä»–è¯·æ±‚æ–¹æ³• PUT, DELETEâ€¦. å¯ä»¥è®¾ç½®è‡ªå®šä¹‰headerå¤´ è·¨å­åŸŸå…±äº«cookieæ–¹é¢ å’Œ CORSç®€å•è¯·æ±‚ä¸€æ ·","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"06.CORSæ–¹æ¡ˆ not-so-simple request","slug":"2016-09-18-sameoriginpolicy-06","date":"2016-09-18T12:10:16.000Z","updated":"2018-03-01T02:14:12.000Z","comments":true,"path":"2016/09/18/2016-09-18-sameoriginpolicy-06/","link":"","permalink":"http://blog.renyimin.com/2016/09/18/2016-09-18-sameoriginpolicy-06/","excerpt":"","text":"é¢„æ£€è¯·æ±‚ preflight è¯´æ˜éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚, æ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯ PUT æˆ– DELETE, æˆ–è€… Content-Type å­—æ®µçš„ç±»å‹æ˜¯ application/json ; éç®€å•è¯·æ±‚çš„CORSè¯·æ±‚, ä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰, å¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚, ç§°ä¸º &quot;é¢„æ£€&quot;è¯·æ±‚(preflight) æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨, å½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­, ä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µ; åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤, æµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚, å¦åˆ™å°±æŠ¥é”™ ; éç®€å•è¯·æ±‚ä¼šå¯¼è‡´åŸå…ˆçš„ä¸€æ¬¡è¯·æ±‚å˜æˆä¸¤æ¬¡, ç¬¬ä¸€æ¬¡è¯·æ±‚æ˜¯ é¢„æ£€è¯·æ±‚;â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ OPTIONSï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ï¼Œå¤´ä¿¡æ¯é‡Œé¢å…³é”®å­—æ®µæ˜¯Originï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæº ; éç®€å•è¯·æ±‚çš„ä¾‹å­1.æœåŠ¡å™¨å‰ç«¯ä»£ç : www.test.com/index.html æœ¬ä¾‹å­ä½¿ç”¨ PUT æ¥è¿›è¡Œajaxè¯·æ±‚, æ»¡è¶³ éç®€å•è¯·æ±‚ çš„æ¡ä»¶ ; å¦å¤–, æœ¬ä¾‹è¿˜è‡ªå®šä¹‰äº†è¯·æ±‚æ—¶çš„ header é¦–éƒ¨å­—æ®µ, ä¹Ÿæ»¡è¶³ éç®€å•è¯·æ±‚ çš„æ¡ä»¶ ; 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; //è®¾ç½®cookie document.cookie = &quot;name=renyimin; domain=test.com&quot;; document.cookie = &quot;age=100; domain=test.com&quot;; document.cookie = &quot;gender=boy; domain=test.com&quot;; //è·¨å­åŸŸå¸¦cookieå’Œç®€å•è¯·æ±‚çš„è®¾ç½®æ–¹æ³•ä¸€æ · $.ajaxSetup(&#123;crossDomain: true, xhrFields: &#123;withCredentials: true&#125;&#125;); $(&quot;#btn&quot;).click(function() &#123; //åºåˆ—åŒ–name/value var data = $(&quot;form&quot;).serializeArray(); $.ajax(&#123; //è¿™é‡Œç”¨PUT, åˆ™ä¸º `éç®€å•` è¯·æ±‚ type: &apos;PUT&apos;, url: &apos;http://test.test.com/index.php&apos;, dataType: &apos;json&apos;, data: data, //æˆ–è€…å¦‚æœä½ è‡ªå®šä¹‰äº†ä¸€äº›è¯·æ±‚æ—¶çš„ header é¦–éƒ¨å­—æ®µ, é‚£ä¹ˆè¯·æ±‚å°±ä¹Ÿæ˜¯ å¤æ‚è¯·æ±‚ headers: &#123;&quot;custom-header-field&quot; : &quot;test&quot;&#125;, success: function (result) &#123; console.log(result); &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 2.æœåŠ¡å™¨åç«¯ä»£ç : test.test.com/index.php 123456789101112&lt;?php//æœåŠ¡å™¨å…è®¸çš„ Originheader(\"Access-Control-Allow-Origin: http://www.test.com\");//æœåŠ¡å™¨å…è®¸çš„ methodsheader(\"Access-Control-Allow-Methods: PUT, GET, POST\");//æœåŠ¡å™¨å…è®¸è®¾ç½®çš„å¤´éƒ¨å­—æ®µheader(\"Access-Control-Allow-Headers: custom-header-field\");//è·¨å­åŸŸå¸¦cookieå’Œç®€å•è¯·æ±‚çš„è®¾ç½®æ–¹æ³•ä¸€æ ·header(\"Access-Control-Allow-Credentials: true\");var_dump($_COOKIE);var_dump($_SERVER['HTTP_CUSTOM_HEADER_FIELD']); 3.æ³¨æ„: åƒä¸Šé¢ä¾‹å­çš„å¤æ‚è·¨åŸŸè¯·æ±‚ å¿…é¡»: é¦–å…ˆå’Œç®€å•è¯·æ±‚ä¸€æ ·, æœåŠ¡å™¨ç«¯çš„ Access-Control-Allow-Origin æ˜¯å¿…é¡»è®¾ç½®çš„, ä¸ç„¶é¦–å…ˆå°±è·¨ä¸äº†åŸŸ; å¿…é¡»: å…¶æ¬¡, æ˜¯ä½¿ç”¨äº† get, post, head ä¹‹å¤–æ–¹æ³•çš„ å¤æ‚è¯·æ±‚, é‚£ä¹ˆå°±å¿…é¡»åœ¨æœåŠ¡ç«¯æœ‰å¯¹åº”çš„ Access-Control-Allow-Method, å¦åˆ™: å¯é€‰: å¦‚æœä½ è‡ªå®šä¹‰äº† è‡ªå®šä¹‰é¦–éƒ¨å­—æ®µ çš„ å¤æ‚è¯·æ±‚, é‚£ä¹ˆä¹Ÿè¦åœ¨æœåŠ¡ç«¯æœ‰å¯¹åº”çš„ Access-Control-Allow-Headers, å¦åˆ™: 4.å¦å¤–éœ€è¦å…³æ³¨çš„æ˜¯: å¦‚æœåœ¨ajaxè·¨åŸŸçš„æƒ…å†µä¸‹, ä½ è®¾ç½®äº†è‡ªå®šä¹‰çš„é¦–éƒ¨å­—æ®µ, é‚£ä¹ˆå³ä½¿ä½ çš„è¯·æ±‚ç±»å‹æ˜¯get, post, head, ä¹Ÿä¼šå˜æˆä¹Ÿæ˜¯å¤æ‚è¯·æ±‚, æ‰€ä»¥ä»ç„¶ä¼šå‘å‡ºé¢„è¯·æ±‚; åˆ†æé¢„æ£€è¯·æ±‚1.ä¸Šé¢www.test.com/index.phpä»£ç è¿›è¡Œajaxè¯·æ±‚çš„æ—¶å€™, HTTPè¯·æ±‚çš„æ–¹æ³•æ˜¯PUT, æ‰€ä»¥æµè§ˆå™¨ä¼šå‘ç°, è¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚, å°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ªâ€é¢„æ£€â€è¯·æ±‚, è¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ ; 2.æ‰€ä»¥è¯·æ±‚åº”è¯¥æ˜¯åŒ…æ‹¬ é¢„æ£€è¯·æ±‚å’Œ çœŸæ­£çš„è¯·æ±‚ ä¸¤ä¸ªè¯·æ±‚çš„: 3.ä¸‹é¢æ˜¯è¿™ä¸ªâ€é¢„æ£€â€è¯·æ±‚çš„HTTPå¤´ä¿¡æ¯ å’Œ å“åº”ä¿¡æ¯: 4.å¯ä»¥çœ‹åˆ°, â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„HTTPè¯·æ±‚æ–¹æ³•æ˜¯OPTIONSæ–¹æ³•, è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¿›è¡Œè¯¢é—®çš„, å¤´ä¿¡æ¯é‡Œé¢, å…³é”®å­—æ®µæ˜¯Origin, è¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæº; é™¤äº†Originå­—æ®µï¼Œâ€é¢„æ£€â€è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µ:(1)Access-Control-Request-Method ï¼šè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯PUT ;(2)Access-Control-Request-Headersï¼šè¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µ, ä¸Šä¾‹æ˜¯X-Custom-Header ; å¦å¤–å¯ä»¥çœ‹åˆ°Access-Control-Allow-Credentials å“åº”é¦–éƒ¨å­—æ®µ, å’Œç®€å•è¯·æ±‚ä¸€æ ·, éƒ½æ˜¯ä¸ºäº†åšè·¨å­åŸŸcookieå…±äº«; åˆ†æé¢„æ£€å“åº”1.ä»ä¹‹å‰çš„å›¾ä¸­è¿˜å¯ä»¥çœ‹åˆ°, åœ¨é¢„æ£€è¯·æ±‚çš„å“åº”ä¸­, æœåŠ¡å™¨æ”¶åˆ°â€é¢„æ£€â€è¯·æ±‚ä»¥å, æ£€æŸ¥äº† Origin,Access-Control-Request-Method,Access-Control-Request-Headers,Access-Control-Allow-Credentials å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº” ; 2.å¹¶ä¸”é¢„æ£€è¯·æ±‚éƒ¨åˆ†æ˜¯ä¸ä¼šçœŸçš„å‘é€æ•°æ®çš„:è€Œç¬¬äºŒæ¬¡çœŸå®è¯·æ±‚å°±ä¼šæœ‰çœŸæ­£æ•°æ®! 3.ä¸Šé¢çš„HTTPå›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯ Access-Control-Allow-Origin å­—æ®µï¼Œè¡¨ç¤º http://www.test.com å¯ä»¥è¯·æ±‚æ•°æ®, è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ ; 123Access-Control-Allow-Origin: http://www.test.comæˆ–è€…Access-Control-Allow-Origin: * 4.å¦‚æœæœåŠ¡å™¨å¦å®šäº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”, æµè§ˆå™¨ä¼šè®¤å®šæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢« XMLHttpRequest å¯¹è±¡çš„ onerror å›è°ƒå‡½æ•°æ•è·;æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ ; å…¶ä»–CORSç›¸å…³å­—æ®µåˆ†æ Access-Control-Allow-Methods: GET, POST, PUT è¯¥å­—æ®µå¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€é¢„æ£€â€è¯·æ±‚ã€‚ Access-Control-Allow-Headers: X-Custom-Header å¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬Access-Control-Request-Headerså­—æ®µï¼Œåˆ™Access-Control-Allow-Headerså­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨â€é¢„æ£€â€ä¸­è¯·æ±‚çš„å­—æ®µã€‚ Access-Control-Allow-Credentials: true è¯¥å­—æ®µä¸ç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚ Access-Control-Max-Age: 1728000 è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯20å¤©ï¼ˆ1728000ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº”1728000ç§’ï¼ˆå³20å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚ æœ€åæ³¨æ„, å¤æ‚è¯·æ±‚ è·¨å­åŸŸå¸¦cookieå’Œ ç®€å•è¯·æ±‚ çš„è®¾ç½®æ–¹æ³•ä¸€æ ·;","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"05.CORSæ–¹æ¡ˆ simple request","slug":"2016-09-18-sameoriginpolicy-05","date":"2016-09-18T04:45:07.000Z","updated":"2018-03-16T09:42:05.000Z","comments":true,"path":"2016/09/18/2016-09-18-sameoriginpolicy-05/","link":"","permalink":"http://blog.renyimin.com/2016/09/18/2016-09-18-sameoriginpolicy-05/","excerpt":"","text":"CORSè¯´æ˜CORS æ˜¯ä¸€ä¸ªW3Cæ ‡å‡†, å…¨ç§°æ˜¯ è·¨åŸŸèµ„æºå…±äº«(Cross-origin resource sharing), é€šä¿—è¯´å°±æ˜¯æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„è·¨åŸŸè¯·æ±‚; åœ¨ä»¥å‰ï¼Œè·¨åŸŸå¯ä»¥é‡‡ç”¨ ä»£ç†ã€JSONP ç­‰æ–¹å¼ï¼Œè€Œåœ¨Modernæµè§ˆå™¨é¢å‰, è¿™äº›ç»ˆå°†æˆä¸ºè¿‡å»å¼, å› ä¸ºæœ‰äº†CORS ; CORSå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨å‘å‡ºXMLHttpRequestè¯·æ±‚, ä¹Ÿå°±æ˜¯å…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶; å¦å¤–, CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒ (ç›®å‰, æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½, IEæµè§ˆå™¨ä¸èƒ½ä½äºIE10) ; æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹éƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆ, ä¸éœ€è¦ç”¨æˆ·å‚ä¸ å¯¹äºå¼€å‘è€…æ¥è¯´, CORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«, ä»£ç å®Œå…¨ä¸€æ ·, æµè§ˆå™¨ä¸€æ—¦å‘ç°AJAXçš„è¯·æ±‚æ˜¯è·¨æºçš„, å°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯, æœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚, ä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰; ä¹‹æ‰€ä»¥CORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡çš„ä»£ç æ²¡æœ‰å·®åˆ«, æ˜¯å› ä¸º: å…¶å®å®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨, åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ CORSçš„ä¸¤ç±»è¯·æ±‚æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»: ç®€å•è¯·æ±‚(simple request) å’Œ éç®€å•è¯·æ±‚(not-so-simple request) ä»¥ä¸‹æƒ…å†µä¼šè¢«å½’ç±»ä¸º éç®€å•è¯·æ±‚ : ä»¥ GET, HEAD æˆ–è€… POST ä»¥å¤–çš„æ–¹æ³•å‘èµ·è¯·æ±‚; è™½ç„¶ä½¿ç”¨ POSTï¼Œä½†è¯·æ±‚æ•°æ®ä¸º application/x-www-form-urlencoded, multipart/form-data æˆ–è€… text/plain ä»¥å¤–çš„æ•°æ®ç±»å‹, æ¯”å¦‚è¯´ï¼Œç”¨ POST å‘é€æ•°æ®ç±»å‹ä¸º application/xml æˆ–è€… text/xml çš„ XML æ•°æ®çš„è¯·æ±‚ ; ä½¿ç”¨è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼ˆæ¯”å¦‚æ·»åŠ è¯¸å¦‚ X-PINGOTHERï¼‰ ç®€å•è¯·æ±‚ä»£ç æ¡ˆä¾‹è·¨åŸŸå‡ºé”™1.å‰ç«¯ä»£ç : www.test.com/index.html: 12345678910111213141516171819202122232425262728293031323334&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; $(&quot;#btn&quot;).click(function(k) &#123; var data = $(&quot;form&quot;).serializeArray();//åºåˆ—åŒ–name/value $.ajax(&#123; type: &apos;post&apos;, //è¿™é‡Œç”¨GET url: &apos;http://www.haha.com/index.php&apos;, dataType: &apos;json&apos;, //ç±»å‹ data: data, success: function (result) &#123;//è¿”å›çš„jsonæ•°æ® console.log(result); //å›è°ƒè¾“å‡º &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 2.è·¨åŸŸåç«¯ä»£ç : www.haha.com/index.php : 12&lt;?phpecho json_encode(['name' =&gt; 'lant', 'age' =&gt; 100]); 3.ç”±äºå‡ºç°è·¨åŸŸ(è€ŒåŒæºç­–ç•¥ä¼šé™åˆ¶Ajaxè·¨åŸŸè¯·æ±‚)æ‰€ä»¥ä¼šæŠ¥é”™: 123Failed to load http://www.haha.com/index.php: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource. Origin &apos;http://www.test.com&apos; is therefore not allowed access. Access-Control-Allow-Originå“åº”å¤´è§£å†³ä¿®æ”¹æœåŠ¡å™¨åç«¯ä»£ç : www.haha.com/index.php å¦‚ä¸‹, å‘ç°å¯ä»¥æ­£å¸¸è¿›è¡Œ è·¨åŸŸajaxè¯·æ±‚: 123&lt;?phpheader(&quot;Access-Control-Allow-Origin: http://www.test.com&quot;);echo json_encode([&apos;name&apos; =&gt; &apos;lant&apos;, &apos;age&apos; =&gt; 100]); ç®€å•è¯·æ±‚åŸºæœ¬æµç¨‹åˆ†æorigin è¯·æ±‚é¦–éƒ¨å­—æ®µ1.å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡ºCORSè¯·æ±‚, å…·ä½“æ¥è¯´, å°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­, è‡ªåŠ¨å¢åŠ ä¸€ä¸ª Origin å­—æ®µ ; æµè§ˆå™¨å‘ç°è¿™æ¬¡è·¨æºAJAXè¯·æ±‚æ˜¯ç®€å•è¯·æ±‚, å°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­, æ·»åŠ ä¸€ä¸ªOriginå­—æ®µ: 2.Originè¯·æ±‚é¦–éƒ¨å­—æ®µ ç”¨æ¥è¯´æ˜æœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæº(åè®® + åŸŸå + ç«¯å£), æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼, å†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚; 3.å¦‚æœOriginæºä¸åœ¨æœåŠ¡å™¨çš„è®¸å¯èŒƒå›´å†… æœåŠ¡å™¨ä»ç„¶ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”, ä¸è¿‡æµè§ˆå™¨ä¼šå‘ç°, è¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯å¹¶æ²¡æœ‰åŒ…å« Access-Control-Allow-Origin å­—æ®µ(è¯¦è§ä¸‹æ–‡), å°±çŸ¥é“å‡ºé”™äº†, ä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯, è¢«XMLHttpRequestçš„onerrorå›è°ƒå‡½æ•°æ•è·; æ³¨æ„, è¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«, å› ä¸ºHTTPå›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯200 ; 4.å¦‚æœOriginæºåœ¨æœåŠ¡å™¨è®¾ç½®çš„è®¸å¯èŒƒå›´å†…æœåŠ¡å™¨çš„å“åº”å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹å‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µ(å½“ç„¶ä¹Ÿä¸ä¸€å®šæ˜¯æ‰€æœ‰éƒ½åŒ…å«, å…·ä½“è¿˜å¾—çœ‹æœåŠ¡å™¨å¦‚ä½•è¿›è¡Œè®¾ç½®): 1234Access-Control-Allow-Origin: http://api.bob.comAccess-Control-Allow-Credentials: trueAccess-Control-Expose-Headers: FooBarContent-Type: text/html; charset=utf-8 æœåŠ¡å™¨å“åº”é¦–éƒ¨å­—æ®µåˆ†æä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸CORSè¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥Access-Control-å¼€å¤´: Access-Control-Allow-OriginæœåŠ¡å™¨è¦è®¾ç½®ajaxè¯·æ±‚å¯ä»¥è·¨åŸŸ, è¯¥å­—æ®µæ˜¯å¿…é¡»çš„, å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶Originå­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª*ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚; Access-Control-Allow-Credentialsè¯¥å­—æ®µå¯é€‰, å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookie, é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­; å¦‚æœè®¾ç½®ä¸ºtrueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨;æ³¨æ„, è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸ºtrueï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚å½“ç„¶, å¦‚æœå¸¦äº†cookie, é‚£è²Œä¼¼ä¹Ÿåªèƒ½æ˜¯è·¨å­åŸŸäº†; Access-Control-Expose-Headersè¯¥å­—æ®µå¯é€‰, CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragma;å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨Access-Control-Expose-Headersé‡Œé¢æŒ‡å®š;ä¹‹å‰æåˆ°çš„ Access-Control-Expose-Headers: FooBar å°±å¯ä»¥è®©getResponseHeader(â€˜FooBarâ€™)è·å–é¢å¤–è¿”å›çš„FooBarå­—æ®µçš„å€¼ã€‚ ç›®æ ‡åŸŸå“åº”é¦–éƒ¨å…·ä½“è®¾ç½®Access-Control-Allow-Origin1.æœåŠ¡å™¨åœ¨è®¾ç½®çš„æ—¶å€™, å…¶å®å°±æ˜¯é€šè¿‡headerå‡½æ•°è®¾ç½®ä¸Šé¢çš„ä¸‰ä¸ªé€‰é¡¹;2.æ¯”å¦‚ä¹‹å‰çš„ä¾‹å­ä¸­, å¦‚æœæœåŠ¡å™¨åªæ˜¯ç®€å•çš„ä¸ºäº†å®ç°è·¨åŸŸ, ç›´æ¥è®¾ç½®å¦‚ä¸‹é€‰é¡¹å³å¯: 123&lt;?phpheader(\"Access-Control-Allow-Origin: http://www.haha.com\");echo json_encode(['name' =&gt; 'lant', 'age' =&gt; 100]); Access-Control-Allow-Credentialsæ³¨æ„é…åˆwithCredentialså±æ€§1.CORSè¯·æ±‚é»˜è®¤ä¸ä¼šåœ¨ä¸åŒåŸŸä¹‹é—´å…±äº«Cookieå’ŒHTTPè®¤è¯ä¿¡æ¯, å¦‚æœè¦å…±äº«Cookie: ä¸€æ–¹é¢è¦ æœåŠ¡å™¨åŒæ„æŒ‡å®šAccess-Control-Allow-Credentialså­—æ®µ : 123Access-Control-Allow-Credentials: true//phpä¸­è®¾ç½®å¦‚ä¸‹:header(\"Access-Control-Allow-Credentials: true\"); å¦ä¸€æ–¹é¢, å¼€å‘è€…å¿…é¡»åœ¨AJAXè¯·æ±‚ä¸­æ‰“å¼€ withCredentials å±æ€§ (è¿™ä¸€ç‚¹JSONPä¸ç”¨è®¾ç½®) 1234var xhr = new XMLHttpRequest();xhr.withCredentials = true;//jqueryä¸­è®¾ç½®withCredentialsçš„ä»£ç å¦‚ä¸‹:$.ajaxSetup(&#123;crossDomain: true, xhrFields: &#123;withCredentials: true&#125;&#125;); å½“ç„¶, ä¹Ÿä»…é™äºè·¨å­åŸŸ 2.éœ€è¦ä»¥ä¸Š3æ–¹é¢éƒ½åšåˆ°æ‰å¯ä»¥ å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ ; ä½†æ˜¯, å¦‚æœçœç•¥ withCredentials è®¾ç½®, æœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€Cookie, è¿™æ—¶, å¯ä»¥æ˜¾å¼å…³é—­ withCredentials ; 3.éœ€è¦æ³¨æ„çš„æ˜¯: å¦‚æœè¦å‘é€Cookie, Access-Control-Allow-Origin å°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·*, å¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸå ; åŒæ—¶ï¼ŒCookieä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰é¡¶çº§åŸŸåä¸€æ ·çš„æƒ…å†µä¸‹, çš„Cookieæ‰ä¼šå…±äº«, å…¶ä»–åŸŸåçš„Cookieå¹¶ä¸ä¼šä¸Šä¼  ; æµ‹è¯•ä»£ç 1.å‰ç«¯ä»£ç  (www.test.com/index.html): 12345678910111213141516171819202122232425262728293031323334353637383940&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; //è®¾ç½®cookie document.cookie = &quot;name=renyimin; domain=test.com&quot;; document.cookie = &quot;age=100; domain=test.com&quot;; document.cookie = &quot;gender=boy; domain=test.com&quot;; //è¦åœ¨è·¨åŸŸè¯·æ±‚æœåŠ¡å™¨æ—¶åœ¨corsè¯·æ±‚ä¸­åŒ…å«cookie, å°±éœ€è¦å¼€å¯withCredentialså±æ€§ $.ajaxSetup(&#123;crossDomain: true, xhrFields: &#123;withCredentials: true&#125;&#125;); $(&quot;#btn&quot;).click(function(k) &#123; var data = $(&quot;form&quot;).serializeArray();//åºåˆ—åŒ–name/value $.ajax(&#123; type: &apos;GET&apos;, //è¿™é‡Œç”¨GET url: &apos;http://test.test.com/index.php&apos;, dataType: &apos;json&apos;, //ç±»å‹ data: data, success: function (result) &#123;//è¿”å›çš„jsonæ•°æ® console.log(result); //å›è°ƒè¾“å‡º &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 2.æœåŠ¡å™¨åç«¯ä»£ç  (test.test.com/index.php): 12345&lt;?phpheader(\"Access-Control-Allow-Origin: http://www.test.com\");//æœåŠ¡å™¨å…è®¸å‰ç«¯åœ¨è·¨å­åŸŸcorsè¯·æ±‚æ—¶åŒ…å«cookieheader(\"Access-Control-Allow-Credentials: true\");var_dump($_COOKIE); 3.æ•ˆæœ: æˆåŠŸå®ç°è·¨åŸŸ, å¹¶ä¸”å®ç°è·¨å­åŸŸcookieå…±äº«! å°ç»“ å¦‚æœ www.test.com/index.html ä¸­è®¾ç½®äº† withCredentials ä¸º true , é‚£ä¹ˆåœ¨ajaxè¯·æ±‚çš„ç›®æ ‡åŸŸtest.test.com/index.phpä¸­å¿…é¡»è®¾ç½®: 1header(\"Access-Control-Allow-Credentials: true\"); å¦åˆ™, æŠ¥é”™å¦‚ä¸‹: å¦‚æœwww.test.com/index.htmlä¸­æ²¡æœ‰è®¾ç½® withCredentials å±æ€§,test.test.com/index.phpä¹Ÿæ²¡è®¾ç½® header(&quot;Access-Control-Allow-Credentials: true&quot;);é‚£ä¹ˆå³ä½¿www.test.com/index.htmlä¸­è®¾ç½®äº†domainå±æ€§ä¸º .test.com çš„cookieé”®å€¼å¯¹test.test.com/index.php ä¸­ä¹Ÿè·å–ä¸åˆ°cookie; å¦‚æœæƒ³è·¨å­åŸŸæºå¸¦cookie, åˆ™æœåŠ¡å™¨ç«¯éœ€è¦æ³¨æ„: Access-Control-Allow-Originå“åº”é¦–éƒ¨å­—æ®µä¸èƒ½ä¸º*å“¦!!","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"04.JSONPæ–¹æ¡ˆ","slug":"2016-09-17-sameoriginpolicy-04","date":"2016-09-17T11:27:31.000Z","updated":"2018-03-01T01:51:34.000Z","comments":true,"path":"2016/09/17/2016-09-17-sameoriginpolicy-04/","link":"","permalink":"http://blog.renyimin.com/2016/09/17/2016-09-17-sameoriginpolicy-04/","excerpt":"","text":"JSONPJSONPæ˜¯æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ è·¨æºé€šä¿¡ çš„å¸¸ç”¨æ–¹æ³•; æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ ç®€å•é€‚ç”¨, è€å¼æµè§ˆå™¨å…¨éƒ¨æ”¯æŒ, æœåŠ¡å™¨ç«¯æ”¹é€ éå¸¸å°; ä½†é—®é¢˜æ˜¯ï¼ŒJSONPåªèƒ½å‘GETè¯·æ±‚ ; æ­£å¸¸ajaxè¯·æ±‚1.æœåŠ¡å™¨å‰ç«¯ä»£ç : www.test.com/index.html 123456789101112131415161718192021222324252627282930313233&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; $(&quot;#btn&quot;).click(function() &#123; var data = $(&quot;form&quot;).serializeArray();//åºåˆ—åŒ–name/value $.ajax(&#123; type: &apos;GET&apos;, //è¿™é‡Œç”¨GET url: &apos;http://www.test.com/index.php&apos;, dataType: &apos;json&apos;, //ç±»å‹ data: data, success: function (result) &#123;//è¿”å›çš„jsonæ•°æ® console.log(result); //å›è°ƒè¾“å‡º &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 2.æœåŠ¡å™¨åç«¯ä»£ç : www.test.com/index.php 12345678&lt;?php//å‚æ•°$sex = isset($_GET['sex']) ? trim($_GET['sex']) : '';$age = isset($_GET['age']) ? trim($_GET['age']) : '';$data = [\"sex\" =&gt; $sex, \"age\" =&gt; $age];$res = json_encode($data, JSON_UNESCAPED_UNICODE); //json æ•°æ®echo $res; 3.ç»“æœ: å‰ç«¯ajaxæ­£å¸¸å¾—åˆ°åç«¯ä»£ç çš„å“åº”!! è·¨åŸŸAjaxè¯·æ±‚æ¡ˆä¾‹1.æœåŠ¡å™¨å‰ç«¯ä»£ç : www.test.com/index.html, ä¿®æ”¹è¯·æ±‚çš„åç«¯è¿æ¥ä¸º test.test.com/index.php 123456789101112131415161718192021222324252627282930313233&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; $(&quot;#btn&quot;).click(function() &#123; var data = $(&quot;form&quot;).serializeArray();//åºåˆ—åŒ–name/value $.ajax(&#123; type: &apos;GET&apos;, //è¿™é‡Œç”¨GET url: &apos;http://test.test.com/index.php&apos;, dataType: &apos;json&apos;, //ç±»å‹ data: data, success: function (result) &#123;//è¿”å›çš„jsonæ•°æ® console.log(result); //å›è°ƒè¾“å‡º &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 2.æœåŠ¡å™¨åç«¯ä»£ç ä¸å˜ 3.é—®é¢˜å‡ºç°: 123Failed to load http://test.test.com/index.php?sex=%E7%94%B7&amp;age=100: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource. Origin &apos;http://www.test.com&apos; is therefore not allowed access. jsonpè·¨åŸŸæ–¹æ¡ˆ1.æœåŠ¡å™¨å‰ç«¯ä»£ç : www.test.com/index.html 12345678910111213141516171819202122232425262728293031323334&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; $(&quot;#btn&quot;).click(function() &#123; var data = $(&quot;form&quot;).serializeArray();//åºåˆ—åŒ–name/value $.ajax(&#123; type: &apos;GET&apos;, //è¿™é‡Œç”¨GET url: &apos;http://test.test.com/index.php&apos;, dataType: &apos;jsonp&apos;, //ç±»å‹ data: data, jsonp: &apos;callback&apos;, //jsonpå›è°ƒå‚æ•°ï¼Œå³°å“¥èµ„æ–™ä¸Šè¯´æ˜¯å¿…é¡»çš„(ç»æµ‹è¯•, è‡³å°‘çš„jqueryä¸‹æ˜¯å¯ä»¥ä¸å¸¦çš„) success: function (result) &#123;//è¿”å›çš„jsonæ•°æ® console.log(result); //å›è°ƒè¾“å‡º &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; 2.æœåŠ¡å™¨åç«¯ä»£ç : test.test.com/index.php 12345678910&lt;?php//jsonpå›è°ƒå‚æ•°ï¼Œå¿…éœ€$callback = isset($_GET['callback']) ? trim($_GET['callback']) : '';//å‚æ•°$sex = isset($_GET['sex']) ? trim($_GET['sex']) : '';$age = isset($_GET['age']) ? trim($_GET['age']) : '';$data = [\"sex\" =&gt; $sex, \"age\" =&gt; $age];$res = json_encode($data,JSON_UNESCAPED_UNICODE); //json æ•°æ®echo '(' . $res . ')'; // è¿”å›æ ¼å¼è²Œä¼¼éœ€è¦æ³¨æ„ () çš„ä½¿ç”¨ 3.ç»“æœ, è§„é¿äº†åŒæºç­–ç•¥é™åˆ¶å¯¼è‡´çš„Ajaxè¯·æ±‚ä¸èƒ½å‘é€çš„é—®é¢˜!! åªæ”¯æŒGETåœ¨ä½¿ç”¨jsonpçš„æ—¶å€™, å½“ä½ æŠŠGETæ–¹æ³•æ¢æˆPOSTä¹‹å, å‘ç°å…¶å®ä¹Ÿå¯ä»¥è¿›è¡Œæ­£å¸¸çš„Ajaxè¯·æ±‚;ä»”ç»†è§‚å¯Ÿè¯·æ±‚å¤´, å‘ç°ä½ è®¾ç½®çš„POSTè¯·æ±‚æ–¹æ³•æœ€ç»ˆè¿˜æ˜¯è¢«æ¢æˆäº† GET; JSONPè·¨å­åŸŸcookieå…±äº«1.JSONPå¦‚æœæ˜¯åƒä¸Šé¢æµ‹è¯•é‚£æ ·è·¨å­åŸŸçš„è¯, æ˜¯å¯ä»¥åŒæ—¶è€ƒè™‘è·¨å­åŸŸå…±äº«Cookieçš„; (ä½†æ˜¯å¦‚æœæ˜¯è·¨é¡¶çº§åŸŸ, é‚£å°±ä¸èƒ½å…±äº«cookieäº†) æœåŠ¡å™¨å‰ç«¯ä»£ç : www.test.com/index.html, å¢åŠ å¯¹cookieçš„è®¾ç½® 12345678910111213141516171819202122232425262728293031323334&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;https://cdn.staticfile.org/jquery/3.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot; &gt; $(document).ready(function()&#123; $(&quot;#btn&quot;).click(function() &#123; document.cookie = &quot;name=renyimin; domain=test.com&quot;; var data = $(&quot;form&quot;).serializeArray();//åºåˆ—åŒ–name/value $.ajax(&#123; type: &apos;POST&apos;, //è¿™é‡Œç”¨GET url: &apos;http://test.test.com/index.php&apos;, dataType: &apos;jsonp&apos;, //ç±»å‹ data: data, success: function (result) &#123;//è¿”å›çš„jsonæ•°æ® console.log(result); //å›è°ƒè¾“å‡º &#125;, timeout: 3000 &#125;); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;form name=&quot;form&quot;&gt; æ€§åˆ«:&lt;input type=&quot;text&quot; name=&quot;sex&quot;&gt; &lt;br/&gt; å¹´é¾„:&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;input type=&quot;button&quot; id=&quot;btn&quot; value=&quot;button&quot; /&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt; æœåŠ¡å™¨åç«¯ä»£ç  test.test.com/index.php, åœ¨è·¨å­åŸŸçš„æƒ…å†µä¸‹,å¯ä»¥æ­£å¸¸è·å–cookie 2.ä½†æ˜¯å¦‚æœæ˜¯è·¨é¡¶çº§åŸŸå, å°±åˆ«å¥¢æœ›äº†, æµ‹è¯•å‘ç°, ä¸Šè¿°ä»£ç åšå¦‚ä¸‹ä¸¤å¤„æ”¹åŠ¨: è®¾ç½®cookieçš„ä»£ç å¦‚æœæ”¹ä¸º: document.cookie = &quot;name=renyimin; domain=haha.com&quot;;; ajaxçš„urlæ”¹ä¸ºè·¨é¡¶çº§åŸŸåçš„url: â€˜http://www.haha.com/index.phpâ€˜, 3.ä½ ä¼šå‘ç°, ajaxå¯ä»¥æ­£å¸¸è·¨åŸŸ, ä½†æ˜¯cookieå´ä¸ä¼šè¢«è®¾ç½®æˆåŠŸçš„! 4.å°ç»“: ajaxä½¿ç”¨jsonpè·¨å­åŸŸçš„æ—¶å€™æ˜¯å¯ä»¥è½»æ¾åƒä¸Šé¢è®¾ç½® cookieçš„domainå±æ€§ æ¥å…±äº«cookieçš„ ; è€Œä¸‹ä¸€ç¯‡ä»‹ç»çš„ajaxä½¿ç”¨corsæ–¹æ¡ˆè·¨åŸŸçš„è¯, å³ä½¿è®¾ç½®äº†cookieçš„ document.domain , ä¹Ÿä¸èƒ½å¸¦ä¸Šcookie, è¿˜éœ€è¦æ³¨æ„å‰ç«¯å’Œåç«¯çš„ withCredentials å¤´å­—æ®µ ;","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"03.è§„é¿åŒæºç­–ç•¥é™åˆ¶ ä¹‹ \"Ajaxè¯·æ±‚ä¸èƒ½å‘é€\"","slug":"2016-09-16-sameoriginpolicy-03","date":"2016-09-16T05:04:17.000Z","updated":"2018-03-01T12:16:58.000Z","comments":true,"path":"2016/09/16/2016-09-16-sameoriginpolicy-03/","link":"","permalink":"http://blog.renyimin.com/2016/09/16/2016-09-16-sameoriginpolicy-03/","excerpt":"","text":"åŒæºæ”¿ç­–è§„å®š, AJAXè¯·æ±‚åªèƒ½å‘ç»™åŒæºçš„ç½‘å€, å¦åˆ™å°±æŠ¥é”™ ; é™¤äº†æ¶è®¾æœåŠ¡å™¨ä»£ç†(æµè§ˆå™¨è¯·æ±‚åŒæºæœåŠ¡å™¨ï¼Œå†ç”±åè€…è¯·æ±‚å¤–éƒ¨æœåŠ¡), æœ‰ä¸‰ç§æ–¹æ³•è§„é¿è¿™ä¸ªé™åˆ¶ : JSONP CORS WebSocket å‚è€ƒ","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"02.è§„é¿åŒæºç­–ç•¥é™åˆ¶ ä¹‹ \"Cookieæ— æ³•è¯»å–\"","slug":"2016-09-15-sameoriginpolicy-02","date":"2016-09-15T13:10:13.000Z","updated":"2018-03-01T12:08:45.000Z","comments":true,"path":"2016/09/15/2016-09-15-sameoriginpolicy-02/","link":"","permalink":"http://blog.renyimin.com/2016/09/15/2016-09-15-sameoriginpolicy-02/","excerpt":"","text":"å›é¡¾ ä¹‹å‰å­¦ä¹ åŒæºç­–ç•¥åŸºç¡€çŸ¥è¯†çš„æ—¶å€™, äº†è§£äº†åŒæºç­–ç•¥çš„ ä¸‰ç§è¡Œä¸º é™åˆ¶: Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å– DOM æ— æ³•è·å¾— AJAX è¯·æ±‚ä¸èƒ½å‘é€ æ³¨æ„:åŒæºç­–ç•¥çš„é™åˆ¶, å¹¶æ²¡æœ‰é™åˆ¶ä½CSRFæ”»å‡», å®ƒå¹¶ä¸ä¼šé™åˆ¶ Bç«™ç‚¹ä¸­åµŒå…¥çš„Aç«™ç‚¹è¶…é“¾æ¥å»è¯»å–Aç«™ç‚¹ç”¨æˆ·çš„cookie; åŒæºç­–ç•¥é™åˆ¶ â€“ Cookieæ— æ³•è¯»å– å‡†å¤‡è·¨åŸŸç«™ç‚¹: www.test.com å’Œ test.tset.com www.test.comç«™ç‚¹(http://www.test.com/setCookie.php)å†™å…¥cookie 12&lt;?phpsetcookie(\"name\", 'renyimin'); www.test.com ç«™ç‚¹(http://www.test.com/getCookie.php)å°è¯•è¯»å–cookie 12&lt;?phpvar_dump($_COOKIE['name']); // å¯ä»¥çœ‹åˆ°, æœªè·¨åŸŸçš„æƒ…å†µä¸‹, å¯ä»¥æ­£å¸¸è·å–cookie test.test.com ç«™ç‚¹(http://test.test.com/getCookie.php)å°è¯•è¯»å–cookie 12&lt;?phpvar_dump($_COOKIE['name']); // ä½ ä¼šå‘ç°è¯»å–ä¸åˆ°cookie, å› ä¸ºå·²ç»è·¨åŸŸ (è™½ç„¶ä¸€çº§åŸŸåä¸€æ ·, ä½†æ˜¯ç”±äºäºŒçº§åŸŸåä¸ä¸€è‡´, å¯¼è‡´äº†è·¨åŸŸ) åˆç†è§„é¿ Cookieæ— æ³•è¯»å–çš„é™åˆ¶ è™½ç„¶åŒæºçš„é‚£äº›é™åˆ¶æ˜¯å¿…è¦, ä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹, æˆ‘ä»¬å¯èƒ½éœ€è¦å»åˆç†è§„é¿Cookieæ— æ³•è¯»å–çš„é™åˆ¶çš„; æ¯”å¦‚: å¦‚æœä¸¤ä¸ªç«™ç‚¹çš„é¡¶çº§åŸŸåç›¸åŒ, åªæ˜¯äºŒçº§åŸŸåä¸åŒçš„è¯, æµè§ˆå™¨å…¶å®æ˜¯å…è®¸ä½ é€šè¿‡è®¾ç½® document.domain æ¥å…±äº« Cookie çš„; ä¾‹å­: è¿˜æ˜¯ä¹‹å‰çš„ä¾‹å­, å¦‚æœwww.test.com/setCookie.phpä»£ç æ”¹ä¸º: 12&lt;?phpsetcookie(&quot;name&quot;, &apos;renyimin&apos;, 0, &apos;&apos;, &apos;test.com&apos;); // è¿™æ ·ä½ ä¼šå‘ç°, www.test.com/getCookie.php å’Œ test.test.com/getCookie.php éƒ½å¯ä»¥æ­£å¸¸è·å– www.test.com/setCookie.php è®¾ç½®çš„cookie å°ç»“åˆç†è§„é¿åŒæºç­–ç•¥å› è·¨åŸŸå¯¼è‡´çš„cookieæ— æ³•è¯»å–çš„é—®é¢˜, æœ‰ä¸ªå‰ææ˜¯, è·¨åŸŸåŒæ–¹éœ€åœ¨åŒé¡¶çº§åŸŸä¸‹(å³é¡¶çº§åŸŸåä¸€è‡´çš„æƒ…å†µä¸‹);ä½ åœ¨è®¾ç½®cookieæ—¶, å¦‚æœæŒ‡å®šçš„domainå‚æ•°å’Œå½“å‰åŸŸåçš„é¡¶çº§åŸŸåä¸ä¸€è‡´, cookie çš„è®¾ç½®å°±ä¼šå¤±è´¥;","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"01.åŒæºç­–ç•¥(Same origin policy)","slug":"2016-09-15-sameoriginpolicy-01","date":"2016-09-15T11:21:54.000Z","updated":"2018-03-01T12:08:03.000Z","comments":true,"path":"2016/09/15/2016-09-15-sameoriginpolicy-01/","link":"","permalink":"http://blog.renyimin.com/2016/09/15/2016-09-15-sameoriginpolicy-01/","excerpt":"","text":"åŒæºç­–ç•¥1995å¹´ï¼ŒåŒæºæ”¿ç­–ç”± Netscape å…¬å¸å¼•å…¥æµè§ˆå™¨ã€‚ç›®å‰, æ‰€æœ‰æµè§ˆå™¨éƒ½å®è¡Œè¿™ä¸ªæ”¿ç­–; æœ€åˆï¼Œå®ƒçš„å«ä¹‰æ˜¯æŒ‡ï¼ŒAç«™ç‚¹è®¾ç½®çš„Cookieï¼ŒBç«™ç‚¹ä¸èƒ½æ‰“å¼€ï¼Œé™¤éè¿™ä¸¤ä¸ªç«™ç‚¹å± åŒæºï¼Œæ‰€è°“åŒæºæŒ‡çš„æ˜¯ â€œä¸‰ä¸ªç›¸åŒâ€: 1.åè®®ç›¸åŒhttp://blog.renyimin.com å’Œ https://blog.renyimin.com å°±ä¸æ˜¯åŒä¸€ä¸ªæº ï¼› 2.åŸŸåå®Œå…¨ç›¸åŒhttp://blog.renyimin.com/test/index.php å’Œ http://blog.renyimin.com/welcome/index.html å°±æ˜¯åŒä¸€ä¸ªæº;ä½†æ˜¯ http://www.renyimin.com/test/index.php å’Œ http://blog.renyimin.com/test/index.php å°±ä¸æ˜¯åŒä¸€ä¸ªæº ï¼›è¯·æ³¨æ„ï¼šlocalhostå’Œ127.0.0.1è™½ç„¶éƒ½æŒ‡å‘æœ¬æœº, ä½†ä¹Ÿä¸æ˜¯åŒä¸€ä¸ªæº ; 3.ç«¯å£ç›¸åŒhttp://www.renyimin.com:8080/test/index.php å’Œ http://www.renyimin.com:80/test/index.php å°±ä¸æ˜¯åŒä¸€ä¸ªæº ; åŒæºç­–ç•¥ç›®çš„ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–å¹¶åˆ©ç”¨æ•°æ®; æ¯”å¦‚ç”¨æˆ·ç™»å½•ä¸€å®¶é“¶è¡Œç½‘ç«™åï¼Œåˆå»æµè§ˆå…¶ä»–ç«™ç‚¹, å¦‚æœæ²¡æœ‰åŒæºç­–ç•¥é™åˆ¶, å…¶ä»–ç«™ç‚¹å°±ä¹Ÿèƒ½è¯»å–é“¶è¡Œç½‘ç«™çš„ Cookie, è¿™æ ·çš„è¯: å¦‚æœ Cookie åŒ…å«ç”¨æˆ·çš„ç§å¯†ä¿¡æ¯ï¼Œæ³„æ¼ç»™ç¬¬ä¸‰æ–¹ç«™ç‚¹å°±æ¯”è¾ƒå±é™©, å½“ç„¶, Cookieä¸­åŒ…å«çš„æ•æ„Ÿä¿¡æ¯é€šå¸¸ç»è¿‡åŠ å¯†ï¼Œå¾ˆéš¾å°†å…¶åå‘ç ´è§£, ä½†è¿™å¹¶ä¸æ„å‘³ç€ç»å¯¹å®‰å…¨; è™½ç„¶ç¬¬ä¸‰æ–¹æ— æ³•é€šè¿‡è§£å¯†è·å–cookieä¸­çš„ä¿¡æ¯, ä½†å®ƒå¯ä»¥ä¸è§£å¯†,è€Œæ˜¯ç›´æ¥ä½¿ç”¨Cookieå»éª—å–é“¶è¡Œç½‘ç«™çš„ä¿¡ä»»; ç”±æ­¤å¯è§ï¼Œâ€åŒæºæ”¿ç­–â€ æ˜¯å¿…éœ€çš„ï¼Œå¦åˆ™, å„ç«™ç‚¹çš„ Cookie å¯ä»¥éšä¾¿å…±äº«ï¼Œé‚£äº’è”ç½‘å°±æ¯«æ— å®‰å…¨å¯è¨€äº† ; åŒæºç­–ç•¥çš„é™åˆ¶éšç€äº’è”ç½‘çš„å‘å±•, â€œåŒæºæ”¿ç­–â€è¶Šæ¥è¶Šä¸¥æ ¼, ç›®å‰, å¦‚æœéåŒæº, å…±æœ‰ä¸‰ç§è¡Œä¸ºå—åˆ°é™åˆ¶: Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å– DOM æ— æ³•è·å¾— AJAX è¯·æ±‚ä¸èƒ½å‘é€ åŒæºç­–ç•¥å’ŒCSRFå®‰å…¨é—®é¢˜éœ€è¦æ³¨æ„ä¸€ç‚¹: åŒæºç­–ç•¥çš„é™åˆ¶, å¹¶æ²¡æœ‰é™åˆ¶ä½CSRFæ”»å‡» ä¸Šé¢åŒæºç­–ç•¥çš„å‡ ä¸ªé™åˆ¶ä¸­, å¹¶æ²¡æœ‰é™åˆ¶ ä»Bç«™ç‚¹ä¸­é€šè¿‡è¶…é“¾æ¥å»è·³è½¬åˆ°Aç«™ç‚¹æ—¶, Aç«™ç‚¹å»è¯»å–è‡ªèº«çš„cookie, è¿™æ ·å°±ä¼šå­˜åœ¨é—®é¢˜: å‡å¦‚ä½ å½“å‰å·²ç»ç™»å½•äº†é‚®ç®±ï¼Œæˆ–bbsï¼ŒåŒæ—¶ä½ åˆè®¿é—®äº†å¦å¤–ä¸€ä¸ªç«™ç‚¹ï¼Œå‡è®¾è¿™å°±æ˜¯ä¸€ä¸ªé’“é±¼ç½‘ç«™(ç«™ç‚¹ä¸­ä¼ªè£…äº†å¾ˆå¤šè¯±å¯¼ç”¨æˆ·å»ç‚¹å‡»çš„è¶…é“¾æ¥, è€Œè¿™äº›è¶…é“¾æ¥éƒ½æ˜¯å…¶ä»–ç«™ç‚¹çš„ä¸€äº›æ•æ„Ÿæ“ä½œ, å°±è¿™æ ·æ”¾å¥½è¯±é¥µç­‰å¾…æ›¾ç»ç™»é™†è¿‡é‚£äº›ç«™ç‚¹çš„ç”¨æˆ·å»ç‚¹å‡», ç­‰é±¼å„¿ä¸Šé’©); å‡è®¾è¿™ä¸ªç½‘ç«™ä¸Šé¢å¯èƒ½å› ä¸ºæŸä¸ªå›¾ç‰‡å¸å¼•ä½ ï¼Œä½ å»ç‚¹å‡»ä¸€ä¸‹ï¼Œè€Œè¿™ä¸ªç‚¹å‡»æ­£æ˜¯å»å¾€ä½ çš„bbsç«™ç‚¹è¿›è¡Œä¸€ä¸ªå‘å¸–æ“ä½œï¼Œç”±äºå½“å‰ä½ çš„æµè§ˆå™¨çŠ¶æ€å·²ç»æ˜¯ç™»é™†äº†bbsç«™ç‚¹ï¼Œæ­¤æ—¶ä½ ç‚¹å‡»è¿™ä¸ªé’“é±¼ç½‘ç«™çš„è¿æ¥æ˜¯å°±ä¼šä½¿ç”¨ä½ ä¹‹å‰ç™»é™†bbsç«™ç‚¹åœ¨æµè§ˆå™¨cookieç½ä¸­ä¿å­˜çš„ä¿¡æ¯, å°±å’Œæ­£å¸¸çš„è¯·æ±‚ä¸€æ ·ã€‚äºæ˜¯é’“é±¼ç«™ç‚¹å°±çº¯å¤©ç„¶çš„åˆ©ç”¨äº†å…¶ä»–ç«™ç‚¹çš„ç™»é™†çŠ¶æ€ï¼Œè®©ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå¸®ä½ å‘å¸–æˆ–å¹²å…¶ä»–äº‹æƒ…; è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„CSRFæ”»å‡», CSRFæ”»å‡»çš„ä¸»è¦ç›®çš„æ˜¯è®©ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ”»å‡»è‡ªå·±å·²ç™»å½•çš„ä¸€ä¸ªç³»ç»Ÿ; å¼•å‡ºè·¨åŸŸé—®é¢˜ç”±äºåŒæºç­–ç•¥çš„è¿™äº›é™åˆ¶éƒ½æ˜¯ä¸ºäº†å®‰å…¨è€ƒè™‘, è‡ªç„¶æ˜¯å¿…è¦çš„; ä½†æ˜¯æœ‰æ—¶å¾ˆä¸æ–¹ä¾¿, å¯èƒ½ä¼šå¯¼è‡´åˆç†çš„ç”¨é€”ä¹Ÿå—åˆ°å½±å“, æ¥ä¸‹æ¥å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨éœ€è¦çš„æ—¶å€™åˆç†åœ°å» è§„é¿â€åŒæºæ”¿ç­–â€çš„é™åˆ¶; å‚è€ƒ é˜®ä¸€å³°","categories":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/categories/CrossDomain/"}],"tags":[{"name":"CrossDomain","slug":"CrossDomain","permalink":"http://blog.renyimin.com/tags/CrossDomain/"}]},{"title":"14. Curlåˆ©ç”¨cookieæ¨¡æ‹Ÿç™»å½•","slug":"PHP/2016-07-12-curl-14","date":"2016-07-12T13:07:24.000Z","updated":"2018-03-15T05:07:32.000Z","comments":true,"path":"2016/07/12/PHP/2016-07-12-curl-14/","link":"","permalink":"http://blog.renyimin.com/2016/07/12/PHP/2016-07-12-curl-14/","excerpt":"","text":"CURLOPT_COOKIEJARè¿æ¥ç»“æŸå, æ¯”å¦‚, è°ƒç”¨ curl_close å, ä¿å­˜ cookie ä¿¡æ¯çš„æ–‡ä»¶;æ¯”å¦‚, æ¨¡æ‹Ÿç™»å½•, ç™»å½•æˆåŠŸä¹‹å, å°†cookieæ–‡ä»¶å­˜æ”¾çš„ä½ç½®! CURLOPT_COOKIEè®¾å®š HTTP è¯·æ±‚ä¸­â€Cookie: â€œéƒ¨åˆ†çš„å†…å®¹ã€‚å¤šä¸ª cookie ç”¨åˆ†å·åˆ†éš”ï¼Œåˆ†å·åå¸¦ä¸€ä¸ªç©ºæ ¼(ä¾‹å¦‚: â€œfruit=apple; colour=redâ€)ã€‚ CURLOPT_COOKIEFILEç™»å½•æˆåŠŸ, ä¹‹åè¿›è¡Œè¯·æ±‚æ—¶æ‰€å¼•ç”¨çš„ cookie æ–‡ä»¶; åŒ…å«cookieæ•°æ®çš„æ–‡ä»¶å, cookieæ–‡ä»¶çš„æ ¼å¼å¯ä»¥æ˜¯Netscapeæ ¼å¼, æˆ–è€…åªæ˜¯çº¯HTTPå¤´éƒ¨é£æ ¼, å­˜å…¥æ–‡ä»¶; å¦‚æœæ–‡ä»¶åæ˜¯ç©ºçš„, ä¸ä¼šåŠ è½½cookie, ä½†cookieçš„å¤„ç†ä»æ—§å¯ç”¨; æ¨¡æ‹Ÿ æœåŠ¡ç«¯ç™»å½•ä»£ç : server_login.php 123456789&lt;?phpsession_start();if ($_POST[&apos;username&apos;] == &apos;renyimin&apos; &amp;&amp; $_POST[&apos;pwd&apos;] == &quot;renyimin&quot;) &#123; $_SESSION[&apos;username&apos;] = $_POST[&apos;username&apos;]; $_SESSION[&apos;pwd&apos;] = $_POST[&apos;pwd&apos;]; echo &quot;ç™»å½•æˆåŠŸ&quot;;&#125; else &#123; echo &quot;ç™»å½•å¤±è´¥&quot;;&#125; æœåŠ¡ç«¯é¦–é¡µä»£ç : server_index.php 12345&lt;?phpsession_start();if ($_SESSION[&apos;username&apos;]) &#123; echo &quot;ä½ è·å–æ•°æ®äº†!&quot;;&#125; curlæ¨¡æ‹Ÿç™»å½•ä»£ç : curl_login.php 1234567891011121314&lt;?php//æ¨¡æ‹Ÿç™»å½•function login_post($url, $cookie, $post) &#123; $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, 0); curl_setopt($curl, CURLOPT_COOKIEJAR, $cookie); curl_setopt($curl, CURLOPT_POST, 1); curl_setopt($curl, CURLOPT_POSTFIELDS, $post); curl_exec($curl); curl_close($curl);&#125;login_post(&apos;http://www.test.com/curl/server_login.php&apos;, dirname(__FILE__) . &apos;/cookie.txt&apos;, [&apos;username&apos; =&gt; &apos;renyimin&apos;, &apos;pwd&apos; =&gt; &apos;renyimin&apos;]); curlæ¨¡æ‹Ÿåˆ©ç”¨cookie, è·å–é¦–é¡µä¿¡æ¯ä»£ç  123456789101112131415&lt;?php//ç™»å½•æˆåŠŸåè·å–æ•°æ®function get_content($url, $cookie) &#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 0); // ç›´æ¥ä½¿ç”¨cookieæ–‡ä»¶ curl_setopt($ch, CURLOPT_COOKIEFILE, $cookie); // æˆ–è€…ä½ ä¹Ÿå¯ä»¥å–å‡ºcookieä¸­çš„ä¿¡æ¯ç›´æ¥ä¼ é€’ // curl_setopt($ch, CURLOPT_COOKIE, &quot;PHPSESSID=7bffe4cc3db027e14b5eb4e84f9e7275&quot;); curl_exec($ch); curl_close($ch);&#125;get_content(&apos;http://www.test.com/curl/server_index.php&apos;, dirname(__FILE__) . &apos;/cookie.txt&apos;); æˆåŠŸç”Ÿæˆcookie.txtæ–‡ä»¶, å¹¶ä¸”è®¿é—®server_index.phpæˆåŠŸ!","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"},{"name":"curl","slug":"curl","permalink":"http://blog.renyimin.com/tags/curl/"}]},{"title":"13. CURLOPT_AUTOREFERER, CURLOPT_REFERER","slug":"PHP/2016-07-12-curl-13","date":"2016-07-12T13:07:24.000Z","updated":"2018-03-15T05:07:28.000Z","comments":true,"path":"2016/07/12/PHP/2016-07-12-curl-13/","link":"","permalink":"http://blog.renyimin.com/2016/07/12/PHP/2016-07-12-curl-13/","excerpt":"","text":"CURLOPT_AUTOREFERERé»˜è®¤ä¸ºfalseè®¾ç½®ä¸ºtrue, åˆ™è®¿é—®ç›®æ ‡æ—¶, æµè§ˆå™¨ä¼šè‡ªåŠ¨å¸¦ç€referrerå¤´ (å¿½ç•¥ä½ é€šè¿‡CURLOPT_REFERERæ‰‹åŠ¨è®¾ç½®çš„referer), ç›®æ ‡é¡µå¯ä»¥é€šè¿‡ $_SERVER[&#39;HTTP_REFERER&#39;] æ¥è·å–æ¥æº;å¦‚æœè®¾ç½®ä¸ºfalse, åˆ™ä¸è¡Œ, åˆ™ä¼šæ£€æŸ¥ä½ æœ‰æ²¡æœ‰é€šè¿‡CURLOPT_REFERERæ‰‹åŠ¨è®¾ç½®çš„referer, å¦‚æœæœ‰, å°±ä½¿ç”¨æ‰‹åŠ¨è®¾ç½®çš„referer, æ²¡æœ‰åˆ™ç›®æ ‡é¡µä¸­æ— æ³•è·å–referer; åœ¨å¼€å‘ä¸­, ä½¿ç”¨curlæ—¶, å¦‚æœåç«¯éœ€è¦ä½¿ç”¨refererï¼Œä¸€èˆ¬ä¼šå¦‚ä¸‹åšæ£€æµ‹: 123456789function vcurl($url, $post = &apos;&apos;, $cookie = &apos;&apos;, $cookiejar = &apos;&apos;, $referer = &apos;&apos;, $isThrowEx = 0)// ......if ($referer) &#123; curl_setopt($curl, CURLOPT_REFERER, $referer);&#125; else &#123; curl_setopt($curl, CURLOPT_AUTOREFERER, 1);&#125;//.... CURLOPT_REFERERDemo curl_demo.php 1234567891011121314151617181920212223242526&lt;?php$ch = curl_init();// è®¾ç½®URLcurl_setopt($ch, CURLOPT_URL, &quot;www.test.com/curl_location.php&quot;);// è®¾ç½®æ˜¯å¦å°†å“åº”ç»“æœå­˜å…¥å˜é‡, 1æ˜¯å­˜å…¥, 0æ˜¯ç›´æ¥echoå‡ºcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);// å¯ç”¨æ—¶ä¼šå°†å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡º (ä¹Ÿå°±æ˜¯ä¼šè¾“å‡ºæ–‡ä»¶å¤´ä¿¡æ¯)//curl_setopt($ch,CURLOPT_HEADER, true);// è®¾ç½®ä¸ºtrue: å½“ä½ è®¿é—®ä¸€ä¸ªé¡µé¢æ—¶, å¦‚æœé¡µé¢å¤´ä¸­æœ‰Locationé‡å®šå‘, åˆ™ä¼šè¿›è¡Œé€’å½’è®¿é—®, å¹¶ä¸”é‡å®šå‘å‡ æ¬¡, å°±é€’å½’è®¿é—®å‡ æ¬¡; å¦åˆ™åˆ™ä¸è¿›è¡Œé€’å½’è®¿é—®;curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);// ä¸Šé¢é€’å½’è®¿é—®çš„æ¬¡æ•°æ ¹æ®å¦‚ä¸‹é™åˆ¶curl_setopt($ch,CURLOPT_MAXREDIRS, 4);// å¦‚æœè®¾ç½®ä¸ºfalse,ä¼šæŸ¥çœ‹æ˜¯å¦æœ‰æ‰‹åŠ¨è®¾ç½®referer, å¦‚æœæ²¡æœ‰, è®¿é—®ç›®æ ‡æ— æ³•é€šè¿‡ $_SERVER[&apos;HTTP_REFERER&apos;] è·å–æ¥æº// è®¾ç½®ä¸ºtrue, åˆ™ä¼šå¿½ç•¥æ‰‹åŠ¨è®¾ç½®çš„referer, æµè§ˆå™¨ä¼šè‡ªåŠ¨åŠ ä¸Šæ¥æº// å¹¶ä¸”ç›®æ ‡é¡µæ— è®ºlocationè·³è½¬å¤šæ·±, è²Œä¼¼éƒ½ä¼šå¸¦ç€è¿™ä¸ªæ¥æºcurl_setopt($ch, CURLOPT_AUTOREFERER, true);// å¦‚æœæ‰‹åŠ¨é…ç½®äº†æ¥æº, åˆ™åªæœ‰å½“CURLOPT_AUTOREFERERä¸ºfalseæ—¶,æ‰ä¼šç”Ÿæ•ˆcurl_setopt($ch, CURLOPT_REFERER, &apos;http://www.haha.com&apos;);// æ‰§è¡Œï¼Œç„¶åå°†å“åº”ç»“æœå­˜å…¥$outputå˜é‡$output = curl_exec($ch);echo $output;// å…³é—­è¿™ä¸ªcurlä¼šè¯èµ„æºcurl_close($ch); 1.ç›®æ ‡é¡µ curl_location.php ä»£ç : 123&lt;?php// ç¬¬ä¸€æ¬¡è·³è½¬çš„ç›®æ ‡åœ°å€header(&quot;Location:http://www.test.com/curl_location1.php&quot;); 2.curl_location1.php 12&lt;?phpheader(&quot;Location:http://www.test.com/curl_location2.php&quot;); 3.curl_location2.php 12&lt;?phpvar_dump($_SERVER); æœ€ç»ˆä¼šåœ¨è·³è½¬åˆ°æœ¬é¡µé¢ä¹‹å, ä»ç„¶å¯ä»¥è·å–åˆ°æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®çš„ referer;","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"},{"name":"curl","slug":"curl","permalink":"http://blog.renyimin.com/tags/curl/"}]},{"title":"11. CURLOPT_HEADER, CURLOPT_FOLLOWLOCATION, CURLOPT_MAXREDIRS","slug":"PHP/2016-07-12-curl-11","date":"2016-07-12T12:36:17.000Z","updated":"2018-03-15T05:07:25.000Z","comments":true,"path":"2016/07/12/PHP/2016-07-12-curl-11/","link":"","permalink":"http://blog.renyimin.com/2016/07/12/PHP/2016-07-12-curl-11/","excerpt":"","text":"CURLOPT_HEADER å¯ç”¨æ—¶ä¼šå°†å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡º æ¯”å¦‚, å½“ä½ ä½¿ç”¨curlè®¿é—®æŸä¸ªurlæ—¶, å¦‚æœè¯¥urlé¡µé¢è¿›è¡Œäº†Locationè·³è½¬, åˆ™ä½ çš„è®¿é—®ä¼šå¤±æ•ˆ, ä¼šæ²¡æœ‰ä»»ä½•è¿”å›å€¼; æ­¤æ—¶, ä½ å°±å¯ä»¥è®¾ç½® CURLOPT_HEADER é€‰é¡¹ä¸ºtrue; å¦‚æœä½ æœ€ç»ˆå¯¹è®¿é—®ä¿¡æ¯è¿›è¡Œäº†è¾“å‡º, ä½ ä¼šçœ‹åˆ°è¾“å‡ºå†…å®¹ä¸­åŒ…å«äº†é¡µé¢çš„HTTPå¤´ä¿¡æ¯, è€Œä¸”å‘ç°å…¶ä¸­æœ‰ Locationè·³è½¬; CURLOPT_FOLLOWLOCATION å¦‚æœé‡åˆ°Locationè·³è½¬, ä½ å¯ä»¥è®¾ç½® CURLOPT_FOLLOWLOCATION é€‰é¡¹ä¸ºtrue, æ¥ç»§ç»­è¿›è¡Œè¿½è¸ªè®¿é—®; å¦‚æœæ¥ä¸‹æ¥çš„é¡µé¢ä¸­è¿˜æœ‰ Locationè·³è½¬, åˆ™ä¼šè¿›è¡Œé€’å½’è®¿é—®; å½“ç„¶, å¦‚æœå¼€å¯äº†CURLOPT_FOLLOWLOCATION, CURLOPT_HEADERçš„è¾“å‡ºä¹Ÿä¼šæ˜¯é€’å½’æ¯ä¸ªé¡µé¢çš„HTTPå¤´ä¿¡æ¯è¿›è¡Œè¾“å‡º; CURLOPT_MAXREDIRS ä¸Šé¢çš„Locationè·³è½¬, å¯ä»¥ä½¿ç”¨CURLOPT_MAXREDIRSå‚æ•°æ¥è®¾ç½®æœ€å¤šè¿½è¸ªå‡ æ¬¡è·³è½¬; å¦‚æœè®¿é—®çš„ç›®æ ‡é¡µé¢æ¥ä¸‹æ¥ä¼šè¿›è¡Œ4æ¬¡locationè·³è½¬, è€Œä½ è®¾ç½®çš„CURLOPT_MAXREDIRSä¸º3, åˆ™ä¾ç„¶è®¿é—®ä¸åˆ°ä»»ä½•å†…å®¹; Demo0.curl_demo.php 123456789101112131415161718&lt;?php$ch = curl_init();// è®¾ç½®URLcurl_setopt($ch, CURLOPT_URL, &quot;www.test.com/curl_location.php&quot;);// è®¾ç½®æ˜¯å¦å°†å“åº”ç»“æœå­˜å…¥å˜é‡, 1æ˜¯å­˜å…¥, 0æ˜¯ç›´æ¥echoå‡ºcurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);// å¯ç”¨æ—¶ä¼šå°†å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡º (ä¹Ÿå°±æ˜¯ä¼šè¾“å‡ºæ–‡ä»¶å¤´ä¿¡æ¯)curl_setopt($ch,CURLOPT_HEADER, true);// è®¾ç½®ä¸ºtrue: å½“ä½ è®¿é—®ä¸€ä¸ªé¡µé¢æ—¶, å¦‚æœé¡µé¢å¤´ä¸­æœ‰Locationé‡å®šå‘, åˆ™ä¼šè¿›è¡Œé€’å½’è®¿é—®, å¹¶ä¸”é‡å®šå‘å‡ æ¬¡, å°±é€’å½’è®¿é—®å‡ æ¬¡; å¦åˆ™åˆ™ä¸è¿›è¡Œé€’å½’è®¿é—®;curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);// ä¸Šé¢é€’å½’è®¿é—®çš„æ¬¡æ•°æ ¹æ®å¦‚ä¸‹é™åˆ¶curl_setopt($ch,CURLOPT_MAXREDIRS, 4);// æ‰§è¡Œï¼Œç„¶åå°†å“åº”ç»“æœå­˜å…¥$outputå˜é‡$output = curl_exec($ch);echo $output;// å…³é—­è¿™ä¸ªcurlä¼šè¯èµ„æºcurl_close($ch); 1.ç›®æ ‡é¡µ curl_location.php ä»£ç : 123&lt;?php// ç¬¬ä¸€æ¬¡è·³è½¬çš„ç›®æ ‡åœ°å€header(&quot;Location:http://www.test.com/curl_location1.php&quot;); 2.curl_location1.php 12&lt;?phpheader(&quot;Location:http://www.test.com/curl_location2.php&quot;); 3.curl_location2.php 12&lt;?phpheader(&quot;Location:http://www.test.com/curl_location3.php&quot;); 4.curl_location3.php 12&lt;?phpheader(&quot;Location:http://www.test.com/test.html&quot;); 5.æœ€ç»ˆtest.htmlé¡µ 12345678910&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;test&lt;/body&gt;&lt;/html&gt; æ•ˆæœ","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"},{"name":"curl","slug":"curl","permalink":"http://blog.renyimin.com/tags/curl/"}]},{"title":"POSTè¯·æ±‚, æ–‡ä»¶ä¸Šä¼ ","slug":"PHP/2016-07-12-curl-02","date":"2016-07-12T12:36:17.000Z","updated":"2018-03-15T05:07:13.000Z","comments":true,"path":"2016/07/12/PHP/2016-07-12-curl-02/","link":"","permalink":"http://blog.renyimin.com/2016/07/12/PHP/2016-07-12-curl-02/","excerpt":"","text":"CURLOPT_POSTè®¾ç½®ä¸º TRUE æ—¶, ä¼šå‘é€ POST è¯·æ±‚, ç±»å‹ä¸º: application/x-www-form-urlencoded, æ˜¯ HTML è¡¨å•æäº¤æ—¶æœ€å¸¸è§çš„ä¸€ç§; CURLOPT_POSTFIELDS å…¨éƒ¨æ•°æ®ä½¿ç”¨HTTPåè®®ä¸­çš„ â€œPOSTâ€ æ“ä½œæ¥å‘é€; è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ urlencoded åçš„å­—ç¬¦ä¸², ç±»ä¼¼â€™para1=val1&amp;para2=val2&amp;â€¦â€™; ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªä»¥å­—æ®µåä¸ºé”®å€¼, å­—æ®µæ•°æ®ä¸ºå€¼çš„æ•°ç»„; å¦‚æœvalueæ˜¯ä¸€ä¸ªæ•°ç»„, Content-Typeå¤´å°†ä¼šè¢«è®¾ç½®æˆmultipart/form-data å¯¹äºæ–‡ä»¶çš„ä¸Šä¼  ä» PHP 5.2.0 å¼€å§‹, ä½¿ç”¨ @ å‰ç¼€ä¼ é€’æ–‡ä»¶æ—¶, value å¿…é¡»æ˜¯ä¸ªæ•°ç»„, å¦‚ä¸‹: 1234$data = [ &apos;name&apos;=&gt;&apos;boy&apos;, &quot;myFile&quot;=&gt;&quot;@/Users/renyimin/Desktop/qqq.jpeg&quot;]; ä» PHP 5.5.0 å¼€å§‹, @ å‰ç¼€å·²è¢«åºŸå¼ƒï¼Œæ–‡ä»¶å¯é€šè¿‡ CURLFile å‘é€, è®¾ç½® CURLOPT_SAFE_UPLOADä¸ºTRUE, å¯ç¦ç”¨ @ å‰ç¼€å‘é€æ–‡ä»¶, ä»¥å¢åŠ å®‰å…¨æ€§ 123$data[&apos;myFile&apos;]=new CURLFile(&apos;/Users/renyimin/Desktop/qqq.jpeg&apos;);// .....curl_setopt($ch, CURLOPT_SAFE_UPLOAD, true); æ•°ç»„æ•°æ®å‘é€POSTè¯·æ±‚ curl.demo.php 12345678910111213141516&lt;?php$data = [ &apos;name&apos; =&gt; &apos;ä»»ç›Šæ°‘&apos;, &quot;age&quot; =&gt; &quot;100&quot;, &quot;gender&quot; =&gt; &quot;ç”·&quot;];$ch = curl_init();curl_setopt($ch, CURLOPT_URL, &quot;http://www.test.com/server.php&quot;);curl_setopt($ch, CURLOPT_POST, true);// http_build_query ä¹‹å, æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨$_POSTæ¥æ”¶, ä¹Ÿå¯ä»¥ä½¿ç”¨ urldecode(file_get_contents(&apos;php://input&apos;));// å¦åˆ™åªèƒ½ä½¿ç”¨$_POSTæ¥æ”¶curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$output = curl_exec($ch);echo $output;curl_close($ch); server.php 12&lt;?phpvar_dump($_POST); jsonæ•°æ®å‘é€POST curl_demo.php : æ³¨æ„éœ€è¦è®¾ç½®HTTPå¤´ 1234567891011121314151617&lt;?php$data = [ &apos;name&apos; =&gt; &apos;ä»»ç›Šæ°‘&apos;, &quot;age&quot; =&gt; &quot;100&quot;, &quot;gender&quot; =&gt; &quot;ç”·&quot;];$data = json_encode($data, JSON_UNESCAPED_UNICODE);$ch = curl_init();curl_setopt($ch, CURLOPT_URL, &quot;http://www.test.com/server.php&quot;);curl_setopt($ch, CURLOPT_POST, true);// é‡ç‚¹curl_setopt($ch, CURLOPT_HTTPHEADER, [&apos;Content-Type: application/json&apos;, &apos;Content-Length:&apos; . strlen($data)]);curl_setopt($ch, CURLOPT_POSTFIELDS, $data);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$output = curl_exec($ch);echo $output;curl_close($ch); server.php 123&lt;?php$phpInput = file_get_contents(&apos;php://input&apos;);var_dump(json_decode($phpInput, true)); æ–‡ä»¶ä¸Šä¼ å‚æ•°ä¸ºæ•°ç»„å½¢å¼ uploadFile.php 1234567891011121314151617&lt;?php$data = [ &apos;name&apos; =&gt; &apos;ä»»ç›Šæ°‘&apos;, &quot;age&quot; =&gt; &quot;100&quot;, &quot;gender&quot; =&gt; &quot;ç”·&quot;];$data[&apos;myfile&apos;] = new CURLFile(&apos;/Users/renyimin/Desktop/qqq.jpeg&apos;);$ch = curl_init();curl_setopt($ch, CURLOPT_URL, &quot;http://www.test.com/server.php&quot;);// å¼€å¯ä¸Šä¼ å®‰å…¨curl_setopt($ch, CURLOPT_SAFE_UPLOAD, true);curl_setopt($ch, CURLOPT_POST, true);curl_setopt($ch, CURLOPT_POSTFIELDS, $data);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$output = curl_exec($ch);echo $output;curl_close($ch); server.php 12345678910&lt;?php// ä¹Ÿå¯ä»¥æ¥æ”¶POSTå‚æ•°if($_FILES)&#123; $filename = $_FILES[&apos;myfile&apos;][&apos;name&apos;]; $tmpname = $_FILES[&apos;myfile&apos;][&apos;tmp_name&apos;]; //ä¿å­˜å›¾ç‰‡åˆ°å½“å‰è„šæœ¬æ‰€åœ¨ç›®å½• if(move_uploaded_file($tmpname,dirname(__FILE__).&apos;/&apos;.$filename))&#123; echo (&apos;ä¸Šä¼ æˆåŠŸ&apos;); &#125;&#125;","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"},{"name":"curl","slug":"curl","permalink":"http://blog.renyimin.com/tags/curl/"}]},{"title":"closure é—­åŒ…","slug":"PHP/2016-06-28-closure","date":"2016-06-28T08:40:32.000Z","updated":"2018-04-03T05:45:14.000Z","comments":true,"path":"2016/06/28/PHP/2016-06-28-closure/","link":"","permalink":"http://blog.renyimin.com/2016/06/28/PHP/2016-06-28-closure/","excerpt":"","text":"JavaScriptçš„é—­åŒ… å¯¹äºJavaScriptçš„é—­åŒ…, å»ºè®®å¯ä»¥å‚è€ƒMDN Web Doc é—­åŒ…æ˜¯ç”±å‡½æ•°ä»¥åŠåˆ›å»ºè¯¥å‡½æ•°çš„è¯æ³•ç¯å¢ƒç»„åˆè€Œæˆ, è¿™ä¸ªç¯å¢ƒåŒ…å«äº†è¿™ä¸ªé—­åŒ…åˆ›å»ºæ—¶æ‰€èƒ½è®¿é—®çš„æ‰€æœ‰å±€éƒ¨å˜é‡; é—­åŒ…å¾ˆæœ‰ç”¨, å› ä¸ºå®ƒå…è®¸å°†å‡½æ•°ä¸å…¶æ‰€æ“ä½œçš„æŸäº›æ•°æ®(ç¯å¢ƒ)å…³è”èµ·æ¥; è¿™æ˜¾ç„¶ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹, åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­, å¯¹è±¡å…è®¸æˆ‘ä»¬å°†æŸäº›æ•°æ®(å¯¹è±¡çš„å±æ€§)ä¸ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–¹æ³•ç›¸å…³è”; (é€šå¸¸ä½ ä½¿ç”¨ åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„å¯¹è±¡ çš„åœ°æ–¹, éƒ½å¯ä»¥ä½¿ç”¨é—­åŒ…;) PHPä¸­çš„é—­åŒ… é—­åŒ…æ˜¯ä¸€ä¸ªClosureå¯¹è±¡(ä»£è¡¨åŒ¿åå‡½æ•°ç±») æ— å±æ€§é—­åŒ… 12345678910&lt;?php$test = function () &#123; echo &apos;This is a Closure&apos;;&#125;;echo &quot;&lt;pre/&gt;&quot;;var_dump($test);die;// ç»“æœobject(Closure)#1 (0) &#123;&#125; å«å±æ€§é—­åŒ… 1234567891011121314151617181920212223242526&lt;?php$a = 100;$b = 200;$test = function ($c) use ($a, $b) &#123; echo $a . &apos;-&apos; . $b . &apos;-&apos; . $c;&#125;;echo &quot;&lt;pre/&gt;&quot;;var_dump($test);die;// ç»“æœobject(Closure)#1 (2) &#123; [&quot;static&quot;]=&gt; array(2) &#123; [&quot;a&quot;]=&gt; int(100) [&quot;b&quot;]=&gt; int(200) &#125; [&quot;parameter&quot;]=&gt; array(1) &#123; [&quot;$c&quot;]=&gt; string(10) &quot;&quot; &#125;&#125; PHPçš„é—­åŒ…ä¸ä¼šåƒJSä¸­é‚£æ ·è‡ªåŠ¨å°è£…åº”ç”¨çš„çŠ¶æ€; åœ¨PHPä¸­, ä½ å¿…é¡»æ‰‹åŠ¨è°ƒç”¨é—­åŒ…å¯¹è±¡çš„ bindTo() æ–¹æ³•, æˆ–è€…ä½¿ç”¨ use å…³é”®å­—, æ¥æ‰‹åŠ¨æŠŠåº”ç”¨çš„çŠ¶æ€é™„åŠ åˆ°PHPé—­åŒ…ä¸Š; useå…³é”®å­—useçš„ç”¨æ³•æ¯”è¾ƒå¸¸è§, ç»å¸¸ç”¨äºä» çˆ¶ä½œç”¨åŸŸ ç»§æ‰¿å˜é‡; bindTo() bindTo()æ˜¯ä¸ªæˆå‘˜æ–¹æ³•, å¯ä»¥ç›´æ¥ä½¿ç”¨åŒ¿åå‡½æ•°æ¥è°ƒç”¨; â€˜bindTo()â€™çš„ç¬¬äºŒä¸ªå‚æ•°å°¤ä¸ºé‡è¦, å…¶ä½œç”¨æ˜¯æŒ‡å®šç»‘å®šé—­åŒ…çš„é‚£ä¸ªå¯¹è±¡æ‰€å±çš„PHPç±», è¿™æ ·, é—­åŒ…å°±å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹(æ¯”å¦‚ç±»å¤–éƒ¨), åœ¨é—­åŒ…å†…éƒ¨é€šè¿‡$thisè®¿é—®ç»‘å®šé—­åŒ…çš„å¯¹è±¡ä¸­å—ä¿æŠ¤å’Œç§æœ‰çš„æˆå‘˜å˜é‡; ä¸»è¦ç”¨äºå°† åŒ¿å(å›è°ƒ)å‡½æ•°æœ¬èº« ç»‘å®šåˆ°ç±»ä¸­; (è¿™æ ·, å°±å¯ä»¥åœ¨ç±»å¤–éƒ¨, åœ¨è¿™ä¸ªåŒ¿åå‡½æ•°ä¸­, ä½¿ç”¨ç±»ä¸­çš„ public, protected, private æˆå‘˜å±æ€§ åŠ é™æ€å±æ€§) Laravelä¸­è·¯ç”±ç»‘å®šçš„å®ç°å…¶å®ä½¿ç”¨äº†è¯¥æŠ€æœ¯ 123456789101112131415161718192021222324252627282930313233343536373839&lt;?phpclass App &#123; protected $routes = []; protected $responseStatus = &apos;200 OK&apos;; protected $responseContentType = &apos;text/html&apos;; public $responseBody1 = &apos;name&apos;; protected $responseBody2 = &apos;age&apos;; private $responseBody3 = &apos;gender&apos;; private static $responseBody4 = &apos;address&apos;; public function addRoute($routePath, $routeCallback) &#123; $this-&gt;routes[$routePath] = $routeCallback-&gt;bindTo($this, __CLASS__); &#125; public function dispatch($currentPath) &#123; foreach ($this-&gt;routes as $routePath =&gt; $callback) &#123; if( $routePath === $currentPath) &#123; $callback(); &#125; &#125; header(&apos;HTTP/1.1 &apos; . $this-&gt;responseStatus); header(&apos;Content-Type: &apos; . $this-&gt;responseContentType); header(&apos;Content-Length: &apos; . strlen($this-&gt;responseBody1 . $this-&gt;responseBody2 . $this-&gt;responseBody3 . self::$responseBody4)); echo $this-&gt;responseBody1 . $this-&gt;responseBody2 . $this-&gt;responseBody3 . self::$responseBody4; &#125;&#125;$app = new App();// å¦‚ä¸‹, åœ¨ç±»å¤–éƒ¨çš„åŒ¿åå‡½æ•°ä¸­, å®ç°äº†å¯¹ç±»å†…éƒ¨å±æ€§çš„æ“ä½œ$app-&gt;addRoute(&apos;user/nonfu&apos;, function()&#123; $this-&gt;responseContentType = &apos;application/json;charset=utf8&apos;; $this-&gt;responseBody1 = &apos;&#123;&quot;name&quot;:&quot;LaravelAcademy&quot;&#125;&apos;; $this-&gt;responseBody2 = &apos;&#123;&quot;age&quot;:&quot;100&quot;&#125;&apos;; $this-&gt;responseBody3 = &apos;&#123;&quot;gender&quot;:&quot;male&quot;&#125;&apos;; self::$responseBody4 = &apos;&#123;&quot;address&quot;:&quot;beijing&quot;&#125;&apos;;&#125;);$app-&gt;dispatch(&apos;user/nonfu&apos;); bind bind æ˜¯ä¸ªé™æ€æ–¹æ³•, éœ€è¦ä½¿ç”¨Closureæ¥é™æ€è°ƒç”¨; ä¸»è¦ç”¨äºå°† æŒ‡å®šçš„åŒ¿å(å›è°ƒ)å‡½æ•° ä»¥ é™æ€æˆ–éé™æ€ çš„æ–¹å¼ç»‘å®šåˆ° ç±»; è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­, åªç”¨åšå¾ˆå°çš„æ”¹åŠ¨å³å¯ 123456789101112131415161718192021222324252627282930313233343536373839&lt;?phpclass App &#123; protected $routes = []; protected $responseStatus = &apos;200 OK&apos;; protected $responseContentType = &apos;text/html&apos;; public $responseBody1 = &apos;name&apos;; protected $responseBody2 = &apos;age&apos;; private $responseBody3 = &apos;gender&apos;; private static $responseBody4 = &apos;address&apos;; public function addRoute($routePath, $routeCallback) &#123; // æ³¨æ„æ­¤å¤„æ”¹åŠ¨ $this-&gt;routes[$routePath] = Closure::bind($routeCallback, $this, __CLASS__); &#125; public function dispatch($currentPath) &#123; foreach ($this-&gt;routes as $routePath =&gt; $callback) &#123; if( $routePath === $currentPath) &#123; $callback(); &#125; &#125; header(&apos;HTTP/1.1 &apos; . $this-&gt;responseStatus); header(&apos;Content-Type: &apos; . $this-&gt;responseContentType); header(&apos;Content-Length: &apos; . strlen($this-&gt;responseBody1 . $this-&gt;responseBody2 . $this-&gt;responseBody3 . self::$responseBody4)); echo $this-&gt;responseBody1 . $this-&gt;responseBody2 . $this-&gt;responseBody3 . self::$responseBody4; &#125;&#125;$app = new App();$app-&gt;addRoute(&apos;user/nonfu&apos;, function()&#123; $this-&gt;responseContentType = &apos;application/json;charset=utf8&apos;; $this-&gt;responseBody1 = &apos;&#123;&quot;name&quot;:&quot;LaravelAcademy&quot;&#125;&apos;; $this-&gt;responseBody2 = &apos;&#123;&quot;age&quot;:&quot;100&quot;&#125;&apos;; $this-&gt;responseBody3 = &apos;&#123;&quot;gender&quot;:&quot;male&quot;&#125;&apos;; self::$responseBody4 = &apos;&#123;&quot;address&quot;:&quot;beijing&quot;&#125;&apos;;&#125;);$app-&gt;dispatch(&apos;user/nonfu&apos;); å†çœ‹ä¸€ä¸ªä¾‹å­ 12345678910111213141516&lt;?phpclass A &#123; private static $sfoo = 1; private $ifoo = 2;&#125;$cl1 = static function() &#123; return A::$sfoo;&#125;;$cl2 = function() &#123; return $this-&gt;ifoo;&#125;;$bcl1 = Closure::bind($cl1, null, &apos;A&apos;);$bcl2 = Closure::bind($cl2, new A(), &apos;A&apos;);echo $bcl1(), &quot;\\n&quot;;echo $bcl2(), &quot;\\n&quot;; __invokeè¿˜æœ‰ä¸€ä¸ª __invoke æ–¹æ³•, è¿™æ˜¯ä¸ºäº†ä¸å…¶ä»–å®ç°äº†__invoke()é­”æœ¯æ–¹æ³•çš„å¯¹è±¡ä¿æŒä¸€è‡´æ€§, ä½†è°ƒç”¨åŒ¿åå‡½æ•°çš„è¿‡ç¨‹ä¸å®ƒæ— å…³, å¦‚ä¸‹:123456&lt;?php$greet = function ($name) &#123; return sprintf(&quot;Hello %s\\r\\n&quot;, $name);&#125;;echo $greet(&apos;LaravelAcademy.org&apos;); ä¹‹æ‰€ä»¥èƒ½è°ƒç”¨$greetå˜é‡ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªå˜é‡çš„å€¼æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œä¸”é—­åŒ…å¯¹è±¡å®ç°äº†invoke()é­”æœ¯æ–¹æ³•, åªè¦å˜é‡ååæœ‰(), PHPå°±ä¼šæŸ¥æ‰¾å¹¶è°ƒç”¨invokeæ–¹æ³•; ~~æœªå®Œå¾…ç»­","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"10. Laravel-Facade","slug":"OOP/2016-05-28-OOP-10-Laravel-Facade","date":"2016-05-28T07:13:05.000Z","updated":"2018-03-15T11:03:35.000Z","comments":true,"path":"2016/05/28/OOP/2016-05-28-OOP-10-Laravel-Facade/","link":"","permalink":"http://blog.renyimin.com/2016/05/28/OOP/2016-05-28-OOP-10-Laravel-Facade/","excerpt":"","text":"ä»£ç è¿½è¸ª ä»¥è·å–é…ç½®é¡¹çš„ Illuminate\\Support\\Facades\\Config è¿½è¸ªFacade, Illuminate\\Support\\Facades 123456789101112131415161718192021public static function __callStatic($method, $args) &#123; $instance = static::getFacadeRoot(); if (! $instance) &#123; throw new RuntimeException(&apos;A facade root has not been set.&apos;); &#125; switch (count($args)) &#123; case 0: return $instance-&gt;$method(); case 1: return $instance-&gt;$method($args[0]); case 2: return $instance-&gt;$method($args[0], $args[1]); case 3: return $instance-&gt;$method($args[0], $args[1], $args[2]); case 4: return $instance-&gt;$method($args[0], $args[1], $args[2], $args[3]); default: return call_user_func_array([$instance, $method], $args); &#125; &#125; è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨Facadeçš„ç±»å¯ä»¥ç›´æ¥ä½¿ç”¨é™æ€è°ƒç”¨çš„æ–¹å¼æ¥è°ƒç”¨æ–¹æ³•, æ­£æ˜¯Facadeä¸­çš„ __callStatic æ–¹æ³•ç”Ÿæ•ˆäº†!","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"09. Facade é—¨é¢","slug":"OOP/2016-05-28-OOP-09-Facade","date":"2016-05-28T06:30:09.000Z","updated":"2018-03-15T11:03:00.000Z","comments":true,"path":"2016/05/28/OOP/2016-05-28-OOP-09-Facade/","link":"","permalink":"http://blog.renyimin.com/2016/05/28/OOP/2016-05-28-OOP-09-Facade/","excerpt":"","text":"å¤–è§‚æ¨¡å¼ å¤–è§‚æ¨¡å¼ä¸­, ä¸€ä¸ªå­ç³»ç»Ÿçš„å¤–éƒ¨ä¸å…¶å†…éƒ¨çš„é€šä¿¡, é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚ç±»è¿›è¡Œ å¤–è§‚ç±»å°†å®¢æˆ·ç±»ä¸å­ç³»ç»Ÿçš„å†…éƒ¨å¤æ‚æ€§åˆ†éš”å¼€, ä½¿å¾—å®¢æˆ·ç±»åªéœ€è¦ä¸å¤–è§‚è§’è‰²æ‰“äº¤é“, è€Œä¸éœ€è¦ä¸å­ç³»ç»Ÿå†…éƒ¨çš„å¾ˆå¤šå¯¹è±¡æ‰“äº¤é“; åœ¨å¤–è§‚æ¨¡å¼ä¸­, é‚£äº›éœ€è¦äº¤äº’çš„ä¸šåŠ¡ç±»è¢«ç§°ä¸ºå­ç³»ç»Ÿ(Subsystem); å¤–è§‚æ¨¡å¼: ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ å¤–è§‚æ¨¡å¼åˆç§°ä¸ºé—¨é¢æ¨¡å¼, å®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼; å¤–è§‚æ¨¡å¼æ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„ä¸€ç§å…·ä½“å®ç°, é€šè¿‡å¼•å…¥ä¸€ä¸ªæ–°çš„å¤–è§‚è§’è‰²å¯ä»¥é™ä½åŸæœ‰ç³»ç»Ÿçš„å¤æ‚åº¦, åŒæ—¶é™ä½å®¢æˆ·ç±»ä¸å­ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ è¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter)åˆå«ä½œæœ€å°‘çŸ¥é“åŸåˆ™(Least Knowledge Principle ç®€å†™LKP)å°±æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£, ä¸å’Œé™Œç”Ÿäººè¯´è¯ã€‚è‹±æ–‡ç®€å†™ä¸º: LoD. å¤–è§‚æ¨¡å¼æ²¡æœ‰ä¸€ä¸ªä¸€èˆ¬åŒ–çš„ç±»å›¾æè¿°, é€šå¸¸ä½¿ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºå¤–è§‚æ¨¡å¼ å¤–è§‚æ¨¡å¼åŒ…å«å¦‚ä¸‹ä¸¤ä¸ªè§’è‰²ï¼š Facade(å¤–è§‚è§’è‰²): åœ¨å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨å®ƒçš„æ–¹æ³•, åœ¨å¤–è§‚è§’è‰²ä¸­å¯ä»¥çŸ¥é“ç›¸å…³çš„(ä¸€ä¸ªæˆ–è€…å¤šä¸ª)å­ç³»ç»Ÿçš„åŠŸèƒ½å’Œè´£ä»»; åœ¨æ­£å¸¸æƒ…å†µä¸‹, å®ƒå°†æ‰€æœ‰ä»å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚å§”æ´¾åˆ°ç›¸åº”çš„å­ç³»ç»Ÿå», ä¼ é€’ç»™ç›¸åº”çš„å­ç³»ç»Ÿå¯¹è±¡å¤„ç†ã€‚ SubSystem(å­ç³»ç»Ÿè§’è‰²): åœ¨è½¯ä»¶ç³»ç»Ÿä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­ç³»ç»Ÿè§’è‰², æ¯ä¸€ä¸ªå­ç³»ç»Ÿå¯ä»¥ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±», è€Œæ˜¯ä¸€ä¸ªç±»çš„é›†åˆ, å®ƒå®ç°å­ç³»ç»Ÿçš„åŠŸèƒ½; æ¯ä¸€ä¸ªå­ç³»ç»Ÿéƒ½å¯ä»¥è¢«å®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨, æˆ–è€…è¢«å¤–è§‚è§’è‰²è°ƒç”¨, å®ƒå¤„ç†ç”±å¤–è§‚ç±»ä¼ è¿‡æ¥çš„è¯·æ±‚; å­ç³»ç»Ÿå¹¶ä¸çŸ¥é“å¤–è§‚çš„å­˜åœ¨, å¯¹äºå­ç³»ç»Ÿè€Œè¨€, å¤–è§‚è§’è‰²ä»…ä»…æ˜¯å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯è€Œå·²ã€‚ å¤–è§‚æ¨¡å¼çš„ä¸»è¦ç›®çš„åœ¨äºé™ä½ç³»ç»Ÿçš„å¤æ‚ç¨‹åº¦, åœ¨é¢å‘å¯¹è±¡è½¯ä»¶ç³»ç»Ÿä¸­, ç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»è¶Šå¤š, è¡¨ç¤ºç³»ç»Ÿä¸­ç±»ä¹‹é—´çš„è€¦åˆåº¦å¤ªå¤§, è¿™æ ·çš„ç³»ç»Ÿåœ¨ç»´æŠ¤å’Œä¿®æ”¹æ—¶éƒ½ç¼ºä¹çµæ´»æ€§, å› ä¸ºä¸€ä¸ªç±»çš„æ”¹åŠ¨ä¼šå¯¼è‡´å¤šä¸ªç±»å‘ç”Ÿå˜åŒ–, è€Œå¤–è§‚æ¨¡å¼çš„å¼•å…¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™ä½äº†ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚ å¼•å…¥å¤–è§‚æ¨¡å¼ä¹‹å, å¢åŠ æ–°çš„å­ç³»ç»Ÿæˆ–è€…ç§»é™¤å­ç³»ç»Ÿéƒ½éå¸¸æ–¹ä¾¿, å®¢æˆ·ç±»æ— é¡»è¿›è¡Œä¿®æ”¹(æˆ–è€…æå°‘çš„ä¿®æ”¹), åªéœ€è¦åœ¨å¤–è§‚ç±»ä¸­å¢åŠ æˆ–ç§»é™¤å¯¹å­ç³»ç»Ÿçš„å¼•ç”¨å³å¯ã€‚ ä»è¿™ä¸€ç‚¹æ¥è¯´, å¤–è§‚æ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¹¶ä¸ç¬¦åˆå¼€é—­åŸåˆ™, å¢åŠ æ–°çš„å­ç³»ç»Ÿéœ€è¦å¯¹åŸæœ‰ç³»ç»Ÿè¿›è¡Œä¸€å®šçš„ä¿®æ”¹, è™½ç„¶è¿™ä¸ªä¿®æ”¹å·¥ä½œé‡ä¸å¤§ã€‚ ~~æœªå®Œå¾…ç»­","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"08. Observer è§‚å¯Ÿè€…æ¨¡å¼","slug":"OOP/2016-05-28-OOP-08-Observer","date":"2016-05-28T03:13:17.000Z","updated":"2018-03-15T10:38:29.000Z","comments":true,"path":"2016/05/28/OOP/2016-05-28-OOP-08-Observer/","link":"","permalink":"http://blog.renyimin.com/2016/05/28/OOP/2016-05-28-OOP-08-Observer/","excerpt":"","text":"å‰è¨€ åœ¨è½¯ä»¶ç³»ç»Ÿä¸­, æœ‰äº›å¯¹è±¡ä¹‹é—´å­˜åœ¨ç±»ç€ä¼¼ äº¤é€šä¿¡å·ç¯å’Œæ±½è½¦ ä¹‹é—´çš„å…³ç³»: ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æˆ–è¡Œä¸ºçš„å˜åŒ–, å°†å¯¼è‡´å…¶ä»–å¯¹è±¡çš„çŠ¶æ€æˆ–è¡Œä¸ºä¹Ÿå‘ç”Ÿæ”¹å˜, å®ƒä»¬ä¹‹é—´å°†äº§ç”Ÿè”åŠ¨; ä¸ºäº†æ›´å¥½åœ°æè¿°å¯¹è±¡ä¹‹é—´å­˜åœ¨çš„è¿™ç§ä¸€å¯¹å¤š(åŒ…æ‹¬ä¸€å¯¹ä¸€)çš„è”åŠ¨, è§‚å¯Ÿè€…æ¨¡å¼åº”è¿è€Œç”Ÿ, å®ƒå®šä¹‰äº†å¯¹è±¡ä¹‹é—´ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³», è®©ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜èƒ½å¤Ÿå½±å“å…¶ä»–å¯¹è±¡; è§‚å¯Ÿè€…æ¨¡å¼ è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€, æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼; å®ƒç”¨äºå»ºç«‹ä¸€ç§å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³», ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶å°†è‡ªåŠ¨é€šçŸ¥å…¶ä»–å¯¹è±¡, å…¶ä»–å¯¹è±¡å°†ç›¸åº”ä½œå‡ºååº”; è§‚å¯Ÿè€…æ¨¡å¼(Observer Pattern)å®šä¹‰ï¼š å¯¹è±¡ä¹‹é—´çš„ä¸€ç§ä¸€å¯¹å¤šä¾èµ–å…³ç³», ä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶, å…¶ç›¸å…³ä¾èµ–å¯¹è±¡çš†å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°; åˆ«ååŒ…æ‹¬å‘å¸ƒ-è®¢é˜…(Publish/Subscribe)æ¨¡å¼ã€æ¨¡å‹-è§†å›¾(Model/View)æ¨¡å¼, æº-ç›‘å¬å™¨(Source/Listener)æ¨¡å¼ æˆ– ä»å±è€…(Dependents)æ¨¡å¼; æè¿°äº†å¦‚ä½•å»ºç«‹å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³», ä»¥åŠå¦‚ä½•æ„é€ æ»¡è¶³è¿™ç§éœ€æ±‚çš„ç³»ç»Ÿ; åŒ…å«è§‚å¯Ÿç›®æ ‡ å’Œ è§‚å¯Ÿè€… ä¸¤ç±»å¯¹è±¡, ä¸€ä¸ªç›®æ ‡å¯ä»¥æœ‰ä»»æ„æ•°ç›®çš„ä¸ä¹‹ç›¸ä¾èµ–çš„è§‚å¯Ÿè€…, ä¸€æ—¦ç›®æ ‡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜, æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½å°†å¾—åˆ°é€šçŸ¥;ä¸ºäº†è·å¾—è¿™ä¸ªé€šçŸ¥, æ¯ä¸ªè§‚å¯Ÿè€…éƒ½å°†ç›‘è§†è§‚å¯Ÿç›®æ ‡çš„çŠ¶æ€, ä»¥ä½¿å…¶çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€åŒæ­¥, è¿™ç§äº¤äº’ä¹Ÿç§°ä¸ºå‘å¸ƒ-è®¢é˜…(Publish-Subscribe)ã€‚ ç›®æ ‡æ˜¯é€šçŸ¥çš„å‘å¸ƒè€…, å®ƒå‘å‡ºé€šçŸ¥æ—¶å¹¶ä¸éœ€è¦çŸ¥é“è°æ˜¯å®ƒçš„è§‚å¯Ÿè€…, å¯ä»¥æœ‰ä»»æ„æ•°ç›®çš„è§‚å¯Ÿè€…è®¢é˜…å®ƒå¹¶æ¥æ”¶é€šçŸ¥; è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„ä¸­é€šå¸¸åŒ…æ‹¬ ç›®æ ‡ å’Œ è§‚å¯Ÿè€… ä¸¤ä¸ªç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œå…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨è§‚å¯Ÿè€…æ¨¡å¼ç»“æ„å›¾ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªè§’è‰²: Subject(æŠ½è±¡ç›®æ ‡): å®ƒæ˜¯è¢«è§‚å¯Ÿçš„å¯¹è±¡, å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»;åœ¨ç›®æ ‡ä¸­å®šä¹‰äº†ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆ, ä¸€ä¸ªç›®æ ‡å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…æ¥è§‚å¯Ÿç›®æ ‡è‡ªå·±;ç›®æ ‡æä¾›ä¸€ç³»åˆ—æ–¹æ³•æ¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡, åŒæ—¶å®ƒå®šä¹‰äº†é€šçŸ¥æ–¹æ³• notify(); ConcreteSubject(å…·ä½“ç›®æ ‡): é€šå¸¸å®ƒåŒ…å«æœ‰ç»å¸¸å‘ç”Ÿæ”¹å˜çš„æ•°æ®, å½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶, å‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥; Observer(æŠ½è±¡è§‚å¯Ÿè€…): è§‚å¯Ÿè€…å°†å¯¹ç›®æ ‡çš„æ”¹å˜åšå‡ºååº”, è¯¥æ¥å£/æŠ½è±¡ç±» å£°æ˜äº†æ›´æ–°æ•°æ®çš„æ–¹æ³• update() ConcreteObserver(å…·ä½“è§‚å¯Ÿè€…):åœ¨å…·ä½“è§‚å¯Ÿè€…ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…·ä½“ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨, å®ƒå­˜å‚¨äº†æœ¬è§‚å¯Ÿè€…çš„æœ‰å…³çŠ¶æ€, è¿™äº›çŠ¶æ€éœ€è¦å’Œå…·ä½“ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´;å®ƒå®ç°äº†åœ¨æŠ½è±¡è§‚å¯Ÿè€…Observerä¸­å®šä¹‰çš„update()æ–¹æ³•, å¯ä»¥è°ƒç”¨å…·ä½“ç›®æ ‡ç±»çš„ attach() æ–¹æ³•å°†è‡ªå·±æ·»åŠ åˆ°ç›®æ ‡ç±»çš„é›†åˆä¸­æˆ–é€šè¿‡ detach() æ–¹æ³•å°†è‡ªå·±ä»ç›®æ ‡ç±»çš„é›†åˆä¸­åˆ é™¤; Demo å…ˆçœ‹ç›®æ ‡ 12345678910111213141516171819202122232425262728293031323334353637383940414243interface Subject&#123; //æ³¨å†Œæ–¹æ³•, ç”¨äºå‘è§‚å¯Ÿè€…é›†åˆä¸­å¢åŠ ä¸€ä¸ªè§‚å¯Ÿè€… public function attach(Observer $observer); //æ³¨é”€æ–¹æ³•, ç”¨äºåœ¨è§‚å¯Ÿè€…é›†åˆä¸­åˆ é™¤ä¸€ä¸ªè§‚å¯Ÿè€… public function detach(Observer $observer); //é€šçŸ¥æ‰€æœ‰æ³¨å†Œè¿‡çš„è§‚å¯Ÿè€…å¯¹è±¡ public function notify();&#125;class ConcreteSubject&#123; // å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆ,ç”¨äºå­˜æ”¾æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ private $observers = []; //æ³¨å†Œæ–¹æ³•, ç”¨äºå‘è§‚å¯Ÿè€…é›†åˆä¸­å¢åŠ ä¸€ä¸ªè§‚å¯Ÿè€… public function attach(Observer $observer) &#123; return array_push($this-&gt;observers, $observer); &#125; //æ³¨é”€æ–¹æ³•, ç”¨äºåœ¨è§‚å¯Ÿè€…é›†åˆä¸­åˆ é™¤ä¸€ä¸ªè§‚å¯Ÿè€… public function detach(Observer $observer) &#123; $index = array_search($observer, $this-&gt;observers); if ($index === FALSE || ! array_key_exists($index, $this-&gt;observers)) &#123; return FALSE; &#125; unset($this-&gt;observers[$index]); return TRUE; &#125; //é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€… public function notify() &#123; if (!is_array($this-&gt;observers)) return false; foreach ($this-&gt;observers as $observer) $observer-&gt;update(); return true; &#125;&#125; è§‚å¯Ÿè€… 1234567891011121314151617181920//æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²interface Observer &#123; // æ›´æ–°æ–¹æ³• public function update();&#125;class ConcreteObserver implements Observer &#123; //è§‚å¯Ÿè€…çš„åç§° private $name; public function __construct($name) &#123; $this-&gt;name = $name; &#125; //æ›´æ–°æ–¹æ³• public function update() &#123; echo 'Observer ', $this-&gt;name, ' has notified.&lt;br /&gt;'; &#125;&#125; å®¢æˆ·ç«¯æ“ä½œ 1234567891011121314151617//å®ä¾‹åŒ–ä¸€ä¸ª'è§‚å¯Ÿç›®æ ‡'$subject = new ConcreteSubject();//å®ä¾‹åŒ–ä¸€ä¸ªè§‚å¯Ÿè€…$observer1 = new ConcreteObserver('lant01');//'è§‚å¯Ÿç›®æ ‡'æ·»åŠ ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…$subject-&gt;attach($observer1);//'è§‚å¯Ÿç›®æ ‡' é€šçŸ¥ å·²ç»è§‚å¯Ÿäº†ç›®æ ‡è‡ªå·±çš„è§‚å¯Ÿè€…$subject-&gt;notify();echo 'æ·»åŠ ç¬¬äºŒä¸ªè§‚å¯Ÿè€…å, å†æ¬¡é€šçŸ¥: &lt;br/&gt;';$observer2 = new ConcreteObserver('lant02');$subject-&gt;attach($observer2);$subject-&gt;notify();echo 'åˆ é™¤ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…å, å†æ¬¡é€šçŸ¥: &lt;br/&gt;';$subject-&gt;detach($observer1);$subject-&gt;notify(); ç»“æœ: 123456Observer lant01 has notified.æ·»åŠ ç¬¬äºŒä¸ªè§‚å¯Ÿè€…å, å†æ¬¡é€šçŸ¥:Observer lant01 has notified.Observer lant02 has notified.åˆ é™¤ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…å, å†æ¬¡é€šçŸ¥:Observer lant02 has notified.","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"07. Prototype Pattern åŸå‹æ¨¡å¼","slug":"OOP/2016-05-28-OOP-07-Prototype","date":"2016-05-28T02:50:21.000Z","updated":"2018-03-15T10:23:59.000Z","comments":true,"path":"2016/05/28/OOP/2016-05-28-OOP-07-Prototype/","link":"","permalink":"http://blog.renyimin.com/2016/05/28/OOP/2016-05-28-OOP-07-Prototype/","excerpt":"","text":"èƒŒæ™¯ å‡è®¾ä¸€å¥—OAè‡ªåŠ¨åŒ–åŠå…¬ç³»ç»Ÿåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­, ç”±äºæŸäº›å²—ä½æ¯å‘¨å·¥ä½œå­˜åœ¨é‡å¤æ€§, å·¥ä½œå‘¨æŠ¥å†…å®¹éƒ½å¤§åŒå°å¼‚, ä½†æ˜¯ç°åœ¨ç³»ç»Ÿæ¯å‘¨é»˜è®¤åˆ›å»ºçš„å‘¨æŠ¥éƒ½æ˜¯ç©ºç™½æŠ¥è¡¨ï¼Œç”¨æˆ·åªèƒ½é€šè¿‡é‡æ–°è¾“å…¥æˆ–ä¸æ–­å¤åˆ¶ç²˜è´´æ¥å¡«å†™é‡å¤çš„å‘¨æŠ¥å†…å®¹ï¼Œæå¤§é™ä½äº†å·¥ä½œæ•ˆç‡; å¼€å‘äººå‘˜é€šè¿‡å¯¹é—®é¢˜è¿›è¡Œä»”ç»†åˆ†æ, å†³å®šæŒ‰ç…§å¦‚ä¸‹æ€è·¯å¯¹å·¥ä½œå‘¨æŠ¥æ¨¡å—è¿›è¡Œé‡æ–°è®¾è®¡å’Œå®ç°ï¼š é™¤äº†å…è®¸ç”¨æˆ·åˆ›å»ºæ–°å‘¨æŠ¥å¤–, è¿˜å…è®¸ç”¨æˆ·å°†åˆ›å»ºå¥½çš„å‘¨æŠ¥ä¿å­˜ä¸ºæ¨¡æ¿; ç”¨æˆ·åœ¨å†æ¬¡åˆ›å»ºå‘¨æŠ¥æ—¶, å¯ä»¥åˆ›å»ºå…¨æ–°çš„å‘¨æŠ¥ï¼Œè¿˜å¯ä»¥é€‰æ‹©åˆé€‚çš„æ¨¡æ¿å¤åˆ¶ç”Ÿæˆä¸€ä»½ç›¸åŒçš„å‘¨æŠ¥ï¼Œç„¶åå¯¹æ–°ç”Ÿæˆçš„å‘¨æŠ¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œäº§ç”Ÿæ–°çš„å‘¨æŠ¥; åªè¦æŒ‰ç…§å¦‚ä¸Šä¸¤ä¸ªæ­¥éª¤è¿›è¡Œå¤„ç†, å·¥ä½œå‘¨æŠ¥çš„åˆ›å»ºæ•ˆç‡å°†å¾—ä»¥å¤§å¤§æé«˜ã€‚ ä¸Šé¢ä½ çš„è¿‡ç¨‹ç±»ä¼¼æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„ä¸¤ä¸ªåŸºæœ¬æ“ä½œ: å¤åˆ¶å’Œç²˜è´´(é€šè¿‡å¯¹å·²æœ‰å¯¹è±¡çš„å¤åˆ¶å’Œç²˜è´´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤§é‡çš„ç›¸åŒå¯¹è±¡)ã€‚ å¦‚ä½•åœ¨ä¸€ä¸ªé¢å‘å¯¹è±¡ç³»ç»Ÿä¸­å®ç°å¯¹è±¡çš„å¤åˆ¶å’Œç²˜è´´å‘¢ï¼Ÿ åŸå‹æ¨¡å¼ åœ¨ä½¿ç”¨åŸå‹æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå†é€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹å¯¹è±¡æ¥åˆ›å»ºæ›´å¤šåŒç±»å‹çš„å¯¹è±¡; åŸå‹æ¨¡å¼çš„å®šä¹‰å¦‚ä¸‹ï¼š åŸå‹æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼, å·¥ä½œåŸç†å¾ˆç®€å•: å°†ä¸€ä¸ªåŸå‹å¯¹è±¡ä¼ ç»™é‚£ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡, è¿™ä¸ªè¦å‘åŠ¨åˆ›å»ºçš„å¯¹è±¡é€šè¿‡åŸå‹å¯¹è±¡æ‹·è´è‡ªå·±æ¥å®ç°åˆ›å»ºè¿‡ç¨‹; åŸå‹æ¨¡å¼æ˜¯ä¸€ç§å¦ç±»çš„åˆ›å»ºå‹æ¨¡å¼, åˆ›å»ºå…‹éš†å¯¹è±¡çš„å·¥å‚å°±æ˜¯åŸå‹ç±»è‡ªèº«, å·¥å‚æ–¹æ³•ç”±å…‹éš†æ–¹æ³•æ¥å®ç°; ç”±äºåœ¨è½¯ä»¶ç³»ç»Ÿä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦åˆ›å»ºå¤šä¸ªç›¸åŒæˆ–è€…ç›¸ä¼¼å¯¹è±¡çš„æƒ…å†µï¼Œå› æ­¤åŸå‹æ¨¡å¼åœ¨çœŸå®å¼€å‘ä¸­çš„ä½¿ç”¨é¢‘ç‡è¿˜æ˜¯éå¸¸é«˜çš„ã€‚ PHPä¸­çš„æ‹·è´æœ‰ æ·±æ‹·è´ å’Œ æµ…æ‹·è´ æµ…æ‹·è´: è¢«æ‹·è´å¯¹è±¡çš„æ‰€æœ‰å˜é‡éƒ½å«æœ‰ä¸åŸå¯¹è±¡ç›¸åŒçš„å€¼, è€Œä¸”å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ä»ç„¶æ˜¯æŒ‡å‘åŸæ¥çš„å¯¹è±¡, å³æµ…æ‹·è´åªè´Ÿè´£å½“å‰å¯¹è±¡å®ä¾‹, å¯¹å¼•ç”¨çš„å¯¹è±¡ä¸åšæ‹·è´; æ·±æ‹·è´: è¢«æ‹·è´å¯¹è±¡çš„æ‰€æœ‰å˜é‡éƒ½å«æœ‰ä¸åŸå¯¹è±¡ç›¸åŒçš„å€¼, é™¤äº†é‚£äº›å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å˜é‡, é‚£äº›å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å˜é‡å°†æŒ‡å‘ä¸€ä¸ªè¢«æ‹·è´çš„æ–°å¯¹è±¡ï¼Œè€Œä¸å†æ˜¯åŸæ¥é‚£äº›è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚(å³æ·±æ‹·è´æŠŠè¦æ‹·è´çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¹Ÿæ‹·è´äº†ä¸€æ¬¡, è€Œè¿™ç§å¯¹è¢«å¼•ç”¨åˆ°çš„å¯¹è±¡æ‹·è´å«åšé—´æ¥æ‹·è´)ã€‚ åŸå‹æ¨¡å¼ç»“æ„å›¾ Prototype(æŠ½è±¡åŸå‹ç±»): å®ƒæ˜¯å£°æ˜å…‹éš†æ–¹æ³•çš„æ¥å£, æ˜¯æ‰€æœ‰å…·ä½“åŸå‹ç±»çš„çˆ¶ç±», å¯ä»¥æ˜¯æŠ½è±¡ç±»ä¹Ÿå¯ä»¥æ˜¯æ¥å£, ç”šè‡³è¿˜å¯ä»¥æ˜¯å…·ä½“å®ç°ç±»; ConcretePrototype(å…·ä½“åŸå‹ç±»): å®ƒå®ç°åœ¨æŠ½è±¡åŸå‹ç±»ä¸­å£°æ˜çš„å…‹éš†æ–¹æ³•, åœ¨å…‹éš†æ–¹æ³•ä¸­è¿”å›è‡ªå·±çš„ä¸€ä¸ªå…‹éš†å¯¹è±¡; Client(å®¢æˆ·ç±»): è®©ä¸€ä¸ªåŸå‹å¯¹è±¡å…‹éš†å…¶è‡ªèº«, ä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡, åœ¨å®¢æˆ·ç±»ä¸­åªéœ€è¦ç›´æ¥å®ä¾‹åŒ–æˆ–é€šè¿‡å·¥å‚æ–¹æ³•ç­‰æ–¹å¼åˆ›å»ºä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå†é€šè¿‡è°ƒç”¨è¯¥å¯¹è±¡çš„å…‹éš†æ–¹æ³•å³å¯å¾—åˆ°å¤šä¸ªç›¸åŒçš„å¯¹è±¡ã€‚ ç”±äºå®¢æˆ·ç±»é’ˆå¯¹æŠ½è±¡åŸå‹ç±»Prototypeç¼–ç¨‹ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å…·ä½“åŸå‹ç±»ï¼Œç³»ç»Ÿå…·æœ‰è¾ƒå¥½çš„å¯æ‰©å±•æ€§ï¼Œå¢åŠ æˆ–æ›´æ¢å…·ä½“åŸå‹ç±»éƒ½å¾ˆæ–¹ä¾¿ã€‚åŸå‹æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå¦‚ä½•å®ç°å…‹éš†æ–¹æ³• åŸå‹æ¨¡å¼ç®€å•æ¼”ç¤º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697&lt;?phpinterface Prototype&#123; //æµ…æ‹·è´ public function shallowCopy(); //æ·±æ‹·è´ public function deepCopy();&#125;class ConcretePrototype implements Prototype&#123; private $_name; public function __construct($name) &#123; $this-&gt;_name = $name; &#125; public function setName($name) &#123; $this-&gt;_name = $name; &#125; public function getName() &#123; return $this-&gt;_name; &#125; //æµ…æ‹·è´ public function shallowCopy() &#123; return clone $this; &#125; //æ·±æ‹·è´ public function deepCopy() &#123; $serialize_obj = serialize($this); $clone_obj = unserialize($serialize_obj); return $clone_obj; &#125;&#125;class Demo&#123; public $string;&#125;class UsePrototype&#123; public function shallow() &#123; $demo = new Demo(); $demo-&gt;string = \"susan\"; $object_shallow_first = new ConcretePrototype($demo); $object_shallow_second = $object_shallow_first-&gt;shallowCopy(); var_dump($object_shallow_first-&gt;getName()); echo '&lt;br/&gt;'; var_dump($object_shallow_second-&gt;getName()); echo '&lt;br/&gt;'; $demo-&gt;string = \"sacha\"; var_dump($object_shallow_first-&gt;getName()); echo '&lt;br/&gt;'; var_dump($object_shallow_second-&gt;getName()); echo '&lt;br/&gt;'; &#125; public function deep() &#123; $demo = new Demo(); $demo-&gt;string = \"Siri\"; $object_deep_first = new ConcretePrototype($demo); $object_deep_second = $object_deep_first-&gt;deepCopy(); var_dump($object_deep_first-&gt;getName()); echo '&lt;br/&gt;'; var_dump($object_deep_second-&gt;getName()); echo '&lt;br/&gt;'; $demo-&gt;string = \"Demo\"; var_dump($object_deep_first-&gt;getName()); echo '&lt;br/&gt;'; // è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºæ˜¯æ·±æ‹·è´äº†, å› ä¸ºè¿™é‡Œçš„demoå¯¹è±¡æ²¡æœ‰è·Ÿç€ä¸Šé¢å˜, è€Œæ˜¯æ‹·è´æ—¶çš„é—´æ¥æ·±åº¦æ‹·è´çš„ var_dump($object_deep_second-&gt;getName()); echo '&lt;br/&gt;'; &#125;&#125;$up = new UsePrototype;$up-&gt;shallow();echo '&lt;hr&gt;';$up-&gt;deep(); åŸå‹ç®¡ç†å™¨çš„å¼•å…¥å’Œå®ç°åŸå‹ç®¡ç†å™¨(Prototype Manager)æ˜¯å°†å¤šä¸ªåŸå‹å¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ªé›†åˆä¸­, ä¾›å®¢æˆ·ç«¯ä½¿ç”¨;å®ƒæ˜¯ä¸€ä¸ªä¸“é—¨è´Ÿè´£å…‹éš†å¯¹è±¡çš„å·¥å‚, å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ªé›†åˆç”¨äºå­˜å‚¨åŸå‹å¯¹è±¡, å¦‚æœéœ€è¦æŸä¸ªåŸå‹å¯¹è±¡çš„ä¸€ä¸ªå…‹éš†ï¼Œå¯ä»¥é€šè¿‡å¤åˆ¶é›†åˆä¸­å¯¹åº”çš„åŸå‹å¯¹è±¡æ¥è·å¾—ã€‚åœ¨åŸå‹ç®¡ç†å™¨ä¸­é’ˆå¯¹æŠ½è±¡åŸå‹ç±»è¿›è¡Œç¼–ç¨‹, ä»¥ä¾¿æ‰©å±•ã€‚å…¶ç»“æ„å¦‚ä¸‹å›¾ï¼š","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"05. Factory Method å·¥å‚æ–¹æ³•æ¨¡å¼","slug":"OOP/2016-05-27-OOP-05-Factory","date":"2016-05-27T07:37:21.000Z","updated":"2018-03-15T10:03:34.000Z","comments":true,"path":"2016/05/27/OOP/2016-05-27-OOP-05-Factory/","link":"","permalink":"http://blog.renyimin.com/2016/05/27/OOP/2016-05-27-OOP-05-Factory/","excerpt":"","text":"å‰è¨€å·¥å‚æ¨¡å¼æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç±»åˆ›å»ºå‹è®¾è®¡æ¨¡å¼, é€šå¸¸æ‰€è¯´çš„å·¥å‚æ¨¡å¼æ˜¯æŒ‡å·¥å‚æ–¹æ³•æ¨¡å¼, å®ƒä¹Ÿæ˜¯ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„å·¥å‚æ¨¡å¼ã€‚ æ—¥å¿—è®°å½•å™¨çš„è®¾è®¡å‡è®¾ç³»ç»Ÿéœ€è¦åšä¸€ä¸ªæ—¥å¿—è®°å½•å™¨(Logger), å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è®°å½•æ—¥å¿—(æ–‡ä»¶, Mysql, MongoDBâ€¦), ç”¨æˆ·å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶çµæ´»åœ°æ›´æ¢æ—¥å¿—è®°å½•æ–¹å¼;æ—¥å¿—è®°å½•å™¨è¿˜å¯èƒ½ä¼šè¿›è¡Œä¸€äº›è¾ƒä¸ºå¤æ‚çš„åˆå§‹åŒ–å·¥ä½œ(æ¯”å¦‚è¿æ¥æ•°æ®åº“, è¯»å–é…ç½®æ–‡ä»¶ç­‰), è¿™å°±ä¼šå¯¼è‡´ä»£ç è¾ƒé•¿, å¦‚æœå°†å®ƒä»¬éƒ½å†™åœ¨æ„é€ å‡½æ•°ä¸­, ä¼šå¯¼è‡´æ„é€ å‡½æ•°åºå¤§, ä¸åˆ©äºä»£ç çš„ä¿®æ”¹å’Œç»´æŠ¤; ç®€å•å·¥å‚æ¨¡å¼çš„è®¾è®¡ Sunnyå…¬å¸å¼€å‘äººå‘˜æœ€åˆä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼å¯¹æ—¥å¿—è®°å½•å™¨è¿›è¡Œäº†è®¾è®¡ï¼Œåˆå§‹ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º: åœ¨å›¾ä¸­, LoggerFactoryå……å½“åˆ›å»ºæ—¥å¿—è®°å½•å™¨çš„å·¥å‚, æä¾›äº†å·¥å‚æ–¹æ³• createLogger() ç”¨äºåˆ›å»ºæ—¥å¿—è®°å½•å™¨, Loggeræ˜¯æŠ½è±¡æ—¥å¿—è®°å½•å™¨æ¥å£, å…¶å­ç±»ä¸ºå…·ä½“æ—¥å¿—è®°å½•å™¨ã€‚å…¶ä¸­, å·¥å‚ç±»LoggerFactoryä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤º: 123456789101112131415161718192021222324252627//ä¸ºäº†çªå‡ºè®¾è®¡é‡ç‚¹, ä»£ç è¿›è¡Œäº†ç®€åŒ–, çœç•¥äº†å…·ä½“æ—¥å¿—è®°å½•å™¨ç±»çš„åˆå§‹åŒ–ä»£ç ã€‚//æ—¥å¿—è®°å½•å™¨å·¥å‚ class LoggerFactory &#123; //é™æ€å·¥å‚æ–¹æ³• public static function createLogger($type) &#123; if($type == 'db')) &#123; //è¿æ¥æ•°æ®åº“, ä»£ç çœç•¥ //... //åˆ›å»ºæ•°æ®åº“æ—¥å¿—è®°å½•å™¨å¯¹è±¡ $logger = new DatabaseLogger(); //åˆå§‹åŒ–æ•°æ®åº“æ—¥å¿—è®°å½•å™¨ï¼Œä»£ç çœç•¥ //... return logger; &#125; else if ($type == 'file') &#123; //åˆ›å»ºæ—¥å¿—æ–‡ä»¶ //... //åˆ›å»ºæ–‡ä»¶æ—¥å¿—è®°å½•å™¨å¯¹è±¡ Logger logger = new FileLogger(); //åˆå§‹åŒ–æ–‡ä»¶æ—¥å¿—è®°å½•å™¨ï¼Œä»£ç çœç•¥ //... return logger; &#125; else &#123; return null; &#125; &#125; &#125; æ­£å¦‚ä¹‹å‰å­¦ä¹ çš„ç®€å•å·¥å‚æ¨¡å¼, å­˜åœ¨é—®é¢˜: å·¥å‚ç±»è¿‡äºåºå¤§ï¼ŒåŒ…å«äº†å¤§é‡çš„ifâ€¦elseâ€¦ä»£ç ï¼Œå¯¼è‡´ç»´æŠ¤å’Œæµ‹è¯•éš¾åº¦å¢å¤§; ç³»ç»Ÿæ‰©å±•ä¸çµæ´»ï¼Œå¦‚æœå¢åŠ æ–°ç±»å‹çš„æ—¥å¿—è®°å½•å™¨ï¼Œå¿…é¡»ä¿®æ”¹é™æ€å·¥å‚æ–¹æ³•çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿åäº†â€œå¼€é—­åŸåˆ™â€ã€‚ å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜, è¿™å°±æ˜¯æœ¬æ–‡æ‰€ä»‹ç»çš„ å·¥å‚æ–¹æ³•æ¨¡å¼ çš„åŠ¨æœºä¹‹ä¸€ã€‚ å·¥å‚æ–¹æ³• åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­åªæä¾›ä¸€ä¸ªå·¥å‚ç±», è¯¥å·¥å‚ç±»å¤„äºå¯¹äº§å“ç±»è¿›è¡Œå®ä¾‹åŒ–çš„ä¸­å¿ƒä½ç½®, å®ƒéœ€è¦çŸ¥é“æ¯ä¸€ä¸ªäº§å“å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚, å¹¶å†³å®šä½•æ—¶å®ä¾‹åŒ–å“ªä¸€ä¸ªäº§å“ç±»ã€‚ ç®€å•å·¥å‚æ¨¡å¼æœ€å¤§çš„ç¼ºç‚¹æ˜¯: å½“æœ‰æ–°äº§å“è¦åŠ å…¥åˆ°ç³»ç»Ÿä¸­æ—¶, å¿…é¡»ä¿®æ”¹å·¥å‚ç±», éœ€è¦åœ¨å…¶ä¸­åŠ å…¥å¿…è¦çš„ä¸šåŠ¡é€»è¾‘, è¿™è¿èƒŒäº† å¼€é—­åŸåˆ™; æ­¤å¤–, åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­, æ‰€æœ‰çš„äº§å“éƒ½ç”±åŒä¸€ä¸ªå·¥å‚åˆ›å»º, å·¥å‚ç±»èŒè´£è¾ƒé‡, ä¸šåŠ¡é€»è¾‘è¾ƒä¸ºå¤æ‚, å…·ä½“äº§å“ä¸å·¥å‚ç±»ä¹‹é—´çš„è€¦åˆåº¦é«˜, ä¸¥é‡å½±å“äº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œæ‰©å±•æ€§, è€Œå·¥å‚æ–¹æ³•æ¨¡å¼åˆ™å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸€é—®é¢˜; åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­, ä¸å†æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å·¥å‚ç±»æ¥åˆ›å»ºæ‰€æœ‰çš„äº§å“å¯¹è±¡, è€Œæ˜¯æä¾›ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¥å£æ¥å£°æ˜ä¸€ä¸ªæŠ½è±¡çš„å·¥å‚, è€Œç”±å…¶å­ç±» å…·ä½“å·¥å‚ æ¥å®ç°å·¥å‚æ–¹æ³•, ä½ éœ€è¦é’ˆå¯¹ä¸åŒçš„äº§å“æä¾›ä¸åŒçš„å·¥å‚; åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ç»“æ„å›¾ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªè§’è‰²: Factoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰ï¼šåœ¨æŠ½è±¡å·¥å‚ç±»ä¸­, å£°æ˜äº†å·¥å‚æ–¹æ³•(Factory Method)ï¼Œç”¨äºè¿”å›ä¸€ä¸ªäº§å“ã€‚æŠ½è±¡å·¥å‚æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œæ‰€æœ‰å·¥å‚ç±»éƒ½å¿…é¡»å®ç°è¯¥æ¥å£ã€‚ ConcreteFactoryï¼ˆå…·ä½“å·¥å‚ï¼‰ï¼šå®ƒæ˜¯æŠ½è±¡å·¥å‚ç±»çš„å­ç±»ï¼Œå®ç°äº†æŠ½è±¡å·¥å‚ä¸­å®šä¹‰çš„å·¥å‚æ–¹æ³•ï¼Œå¹¶å¯ç”±å®¢æˆ·ç«¯è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚ Productï¼ˆæŠ½è±¡äº§å“ï¼‰ï¼šå®ƒæ˜¯å®šä¹‰äº§å“çš„æ¥å£ã€‚ ConcreteProductï¼ˆå…·ä½“äº§å“ï¼‰ï¼šå®ƒå®ç°äº†æŠ½è±¡äº§å“æ¥å£ï¼ŒæŸç§ç±»å‹çš„å…·ä½“äº§å“ç”±ä¸“é—¨çš„å…·ä½“å·¥å‚åˆ›å»º, å…·ä½“å·¥å‚å’Œå…·ä½“äº§å“ä¹‹é—´ä¸€ä¸€å¯¹åº”ã€‚ ä¸ç®€å•å·¥å‚æ¨¡å¼ç›¸æ¯”, å·¥å‚æ–¹æ³•æ¨¡å¼æœ€é‡è¦çš„åŒºåˆ«æ˜¯å¼•å…¥äº†æŠ½è±¡å·¥å‚è§’è‰²ï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 123interface Factory &#123; public Product factoryMethod(); &#125; åœ¨æŠ½è±¡å·¥å‚ä¸­å£°æ˜äº†å·¥å‚æ–¹æ³•, å…·ä½“äº§å“å¯¹è±¡çš„åˆ›å»ºç”±å…¶å­ç±»è´Ÿè´£, å®¢æˆ·ç«¯é’ˆå¯¹æŠ½è±¡å·¥å‚ç¼–ç¨‹, å¯åœ¨è¿è¡Œæ—¶å†æŒ‡å®šå…·ä½“å·¥å‚ç±», å…·ä½“å·¥å‚ç±»å®ç°äº†å·¥å‚æ–¹æ³•, ä¸åŒçš„å…·ä½“å·¥å‚å¯ä»¥åˆ›å»ºä¸åŒçš„å…·ä½“äº§å“ï¼Œå…¶å…¸å‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š12345678class ConcreteFactory implements Factory &#123; public function factoryMethod() &#123; // åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå…·ä½“å·¥å‚ç±»åœ¨å®ç°å·¥å‚æ–¹æ³•æ—¶, é™¤äº†åˆ›å»ºå…·ä½“äº§å“å¯¹è±¡ä¹‹å¤–ï¼Œ // è¿˜å¯ä»¥è´Ÿè´£äº§å“å¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œä»¥åŠä¸€äº›èµ„æºå’Œç¯å¢ƒé…ç½®å·¥ä½œï¼Œä¾‹å¦‚è¿æ¥æ•°æ®åº“ã€åˆ›å»ºæ–‡ä»¶ç­‰ã€‚ return new ConcreteProduct(); &#125; &#125; - åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œåªéœ€å…³å¿ƒå·¥å‚ç±»å³å¯ï¼Œ**ä¸åŒçš„å…·ä½“å·¥å‚å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“**ï¼Œå…¸å‹çš„å®¢æˆ·ç«¯ç±»ä»£ç ç‰‡æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š 1234Factory factory; factory = new ConcreteFactory(); //å¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥å®ç° (é€šè¿‡é…ç½®æ¥å†³å®šä½ è¦å…·ä½“ä½¿ç”¨å“ªä¸ªå…·ä½“çš„å·¥å‚ç±») Product product; product = factory-&gt;factoryMethod(); å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥å­˜å‚¨å…·ä½“å·¥å‚ç±»ConcreteFactoryçš„ç±»åï¼Œæ›´æ¢æ–°çš„å…·ä½“å·¥å‚æ—¶æ— é¡»ä¿®æ”¹æºä»£ç ï¼Œç³»ç»Ÿæ‰©å±•æ›´ä¸ºæ–¹ä¾¿ã€‚ å°ç»“å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„å»¶ä¼¸, å®ƒç»§æ‰¿äº†ç®€å•å·¥å‚æ¨¡å¼çš„ä¼˜ç‚¹, åŒæ—¶è¿˜å¼¥è¡¥äº†ç®€å•å·¥å‚æ¨¡å¼çš„ä¸è¶³;å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€, æ˜¯å¾ˆå¤šå¼€æºæ¡†æ¶å’ŒAPIç±»åº“çš„æ ¸å¿ƒæ¨¡å¼;","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"04. Simple Factory ç®€å•å·¥å‚æ¨¡å¼","slug":"OOP/2016-05-27-OOP-04-Factory","date":"2016-05-27T07:08:11.000Z","updated":"2018-03-15T09:39:34.000Z","comments":true,"path":"2016/05/27/OOP/2016-05-27-OOP-04-Factory/","link":"","permalink":"http://blog.renyimin.com/2016/05/27/OOP/2016-05-27-OOP-04-Factory/","excerpt":"","text":"å‰è¨€ å‡è®¾å…¬å¸å¼€å‘çš„CRMç³»ç»Ÿå¯ä»¥æ˜¾ç¤ºé¥¼çŠ¶å›¾çš„æ•ˆæœ,åŸå§‹è®¾è®¡æ–¹æ¡ˆå¦‚ä¸‹ 123456789101112131415161718192021222324class Client&#123; public $chartObject = null; public function __construct($type) &#123; switch ($chartType) &#123; case 'pie' : $this-&gt;chartObject = new PieChart(); break; case 'bar' : $this-&gt;chartObject = new BarChart(); break; default: //TODO break; &#125; &#125; public function show() &#123; $this-&gt;chartObject-&gt;display(); &#125;&#125; å®¢æˆ·ç«¯ä»£ç é€šè¿‡è°ƒç”¨ Clientç±» çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºå›¾è¡¨å¯¹è±¡, æ ¹æ®å‚æ•° type å¯ä»¥å¾—åˆ°ä¸åŒç±»å‹çš„å›¾è¡¨ï¼Œç„¶åå†è°ƒç”¨show()æ–¹æ³•æ¥æ˜¾ç¤ºç›¸åº”çš„å›¾è¡¨ã€‚ ä¼ ç»Ÿè®¾è®¡å­˜åœ¨é—®é¢˜ä¸éš¾çœ‹å‡ºï¼ŒClientç±»æ˜¯ä¸€ä¸ªå·¨å¤§çš„ç±» Clientç±»ä¸­åŒ…å«å¾ˆå¤š â€œifâ€¦elseâ€¦â€ / â€œswitchâ€¦caseâ€¦â€ä»£ç å—ï¼Œæ•´ä¸ªç±»çš„ä»£ç ç›¸å½“å†—é•¿, é˜…è¯»éš¾åº¦ã€ç»´æŠ¤éš¾åº¦å’Œæµ‹è¯•éš¾åº¦ä¹Ÿè¶Šå¤§, è€Œä¸”å¤§é‡æ¡ä»¶è¯­å¥çš„å­˜åœ¨è¿˜å°†å½±å“ç³»ç»Ÿçš„æ€§èƒ½ï¼Œç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦åšå¤§é‡çš„æ¡ä»¶åˆ¤æ–­; Clientç±»çš„èŒè´£è¿‡é‡, å®ƒå°†å„ç§å›¾è¡¨å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨é›†ä¸­åœ¨ä¸€ä¸ªç±»ä¸­å®ç°, è¿åäº†å•ä¸€èŒè´£åŸåˆ™, ä¸åˆ©äºç±»çš„é‡ç”¨å’Œç»´æŠ¤; å½“éœ€è¦å¢åŠ æ–°ç±»å‹çš„å›¾è¡¨æ—¶ï¼Œå¿…é¡»ä¿®æ”¹Clientç±»çš„æºä»£ç ï¼Œè¿åäº†å¼€é—­åŸåˆ™; å®¢æˆ·ç«¯åªèƒ½é€šè¿‡newå…³é”®å­—æ¥ç›´æ¥åˆ›å»ºå›¾åƒå¯¹è±¡, å›¾åƒç±»ä¸å®¢æˆ·ç«¯Clientç±»è€¦åˆåº¦è¾ƒé«˜ (æ¯”å¦‚ä¸€æ—¦ç±»çš„åå­—æˆ–å‚æ•°å‘ç”Ÿå˜æ›´, ä½ ä¹Ÿå¿…é¡»ä¿®æ”¹Clientä»£ç çš„æºä»£ç ); å®¢æˆ·ç«¯åœ¨åˆ›å»ºChartå¯¹è±¡ä¹‹å‰å¯èƒ½è¿˜éœ€è¦è¿›è¡Œå¤§é‡åˆå§‹åŒ–è®¾ç½®, ä¾‹å¦‚è®¾ç½®æŸ±çŠ¶å›¾çš„é¢œè‰²ã€é«˜åº¦ç­‰, å¦‚æœåœ¨Clientç±»çš„æ„é€ å‡½æ•°ä¸­æ²¡æœ‰æä¾›ä¸€ä¸ªé»˜è®¤è®¾ç½®, é‚£å°±åªèƒ½ç”±å®¢æˆ·ç«¯æ¥å®Œæˆåˆå§‹è®¾ç½®ï¼Œè¿™äº›ä»£ç åœ¨æ¯æ¬¡åˆ›å»ºå›¾åƒå¯¹è±¡æ—¶éƒ½ä¼šå‡ºç°, å¯¼è‡´ä»£ç çš„é‡å¤ã€‚ ç®€å•å·¥å‚æ¨¡å¼ ä¸ºäº†å°†å›¾åƒå¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦», ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼å¯¹å›¾è¡¨åº“è¿›è¡Œé‡æ„, é‡æ„åçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åœ¨å›¾ä¸­, Chartæ¥å£å……å½“æŠ½è±¡äº§å“ç±», å…¶å­ç±»PieChartå’ŒBarChartå……å½“å…·ä½“äº§å“ç±», ChartFactoryå……å½“å·¥å‚ç±»ã€‚ ç°åœ¨, æˆ‘ä»¬ä½¿ç”¨å·¥å‚ç±»çš„ é™æ€å·¥å‚æ–¹æ³• æ¥åˆ›å»ºäº§å“å¯¹è±¡, å¦‚æœéœ€è¦æ›´æ¢äº§å“, è™½ç„¶ä¹Ÿéœ€è¦æ›´æ”¹Clientæºç , ä½†æ˜¯åªéœ€ä¿®æ”¹ä¼ é€’ç»™é™æ€å·¥å‚æ–¹æ³•ä¸­çš„å‚æ•°å³å¯, ä¾‹å¦‚å°†æŸ±çŠ¶å›¾æ”¹ä¸ºé¥¼çŠ¶å›¾, åªéœ€å°†ä»£ç  $chartObject = ChartFactory::getChart(&quot;bar&quot;); æ”¹ä¸ºï¼š$chartObject = ChartFactory::getChart(&quot;pie&quot;); æ”¹è¿› ç°åœ¨ä½ ä¼šå‘ç°: åœ¨åˆ›å»ºå…·ä½“å›¾åƒå¯¹è±¡æ—¶, æ¯æ›´æ¢ä¸€ä¸ªå›¾åƒå¯¹è±¡, éƒ½éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ä¸­é™æ€å·¥å‚æ–¹æ³•çš„å‚æ•°(è™½ç„¶ä¿®æ”¹éƒ½å¾ˆå°), è¿™å¯¹äºå®¢æˆ·ç«¯è€Œè¨€, è¿˜æ˜¯è¿åäº†â€œå¼€é—­åŸåˆ™â€; æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹æ›´æ¢å…·ä½“äº§å“å¯¹è±¡å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¸‹é¢å°†ä»‹ç»ä¸€ç§å¸¸ç”¨çš„å®ç°æ–¹å¼: å¯ä»¥å°†é™æ€å·¥å‚æ–¹æ³•çš„å‚æ•°æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­, åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å³å¯, è¿™æ ·å®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼šç”±$chartObject = ChartFactory::getChart(&quot;bar&quot;);æ”¹ä¸ºï¼š$type = Config::get('chartType'); $chartObject = ChartFactory::getChart($type); ç®€å•å·¥å‚æ¨¡å¼æ€»ç»“ ç®€å•å·¥å‚æ¨¡å¼æä¾›äº†ä¸“é—¨çš„å·¥å‚ç±»ç”¨äºåˆ›å»ºå¯¹è±¡, å°†å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡çš„ä½¿ç”¨åˆ†ç¦»å¼€, å®ƒä½œä¸ºä¸€ç§æœ€ç®€å•çš„å·¥å‚æ¨¡å¼åœ¨è½¯ä»¶å¼€å‘ä¸­å¾—åˆ°äº†è¾ƒä¸ºå¹¿æ³›çš„åº”ç”¨; ä¸»è¦ä¼˜ç‚¹ å·¥å‚ç±»åŒ…å«å¿…è¦çš„åˆ¤æ–­é€»è¾‘, å¯ä»¥å†³å®šåœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå“ªä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹, å®¢æˆ·ç«¯å¯ä»¥å…é™¤ç›´æ¥åˆ›å»ºäº§å“å¯¹è±¡çš„èŒè´£, è€Œä»…ä»…æ¶ˆè´¹äº§å“, ç®€å•å·¥å‚æ¨¡å¼å®ç°äº†å¯¹è±¡åˆ›å»ºå’Œä½¿ç”¨çš„åˆ†ç¦»; å®¢æˆ·ç«¯æ— é¡»çŸ¥é“æ‰€åˆ›å»ºçš„å…·ä½“äº§å“ç±»çš„ç±»åï¼Œåªéœ€è¦çŸ¥é“åˆ›å»ºå…·ä½“äº§å“ç±»æ‰€éœ€è¦å¯¹åº”çš„å‚æ•°å³å¯, å¯¹äºä¸€äº›å¤æ‚çš„ç±»å, é€šè¿‡ç®€å•å·¥å‚æ¨¡å¼å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦å‡å°‘ä½¿ç”¨è€…çš„è®°å¿†é‡; é€šè¿‡å¼•å…¥é…ç½®æ–‡ä»¶, å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹æ›´æ¢å’Œå¢åŠ æ–°çš„å…·ä½“äº§å“ç±», åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§, åšåˆ°äº† ä¸€å®šç¨‹åº¦çš„â€å¼€æ”¾-å°é—­åŸåˆ™â€, ä¸‹é¢ä¼šçœ‹åˆ°å…¶å®å·¥å‚ç±»éƒ¨åˆ†è¿˜æ˜¯è¿åçš„ã€‚ ä¸»è¦ç¼ºç‚¹ ç”±äºå·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰äº§å“çš„åˆ›å»ºé€»è¾‘, èŒè´£è¿‡é‡, ä¸€æ—¦ä¸èƒ½æ­£å¸¸å·¥ä½œ, æ•´ä¸ªç³»ç»Ÿéƒ½è¦å—åˆ°å½±å“; ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼åŠ¿, åŠ¿å¿…ä¼šå¢åŠ ç³»ç»Ÿä¸­ç±»çš„ä¸ªæ•°(å¼•å…¥äº†æ–°çš„å·¥å‚ç±»), å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç†è§£éš¾åº¦; ç³»ç»Ÿæ‰©å±•å›°éš¾ï¼Œä¸€æ—¦æ·»åŠ æ–°äº§å“å°±ä¸å¾—ä¸ä¿®æ”¹å·¥å‚é€»è¾‘, åœ¨äº§å“ç±»å‹è¾ƒå¤šæ—¶, æœ‰å¯èƒ½é€ æˆå·¥å‚é€»è¾‘è¿‡äºå¤æ‚, ä¸åˆ©äºç³»ç»Ÿçš„æ‰©å±•å’Œç»´æŠ¤ã€‚(æ­¤å¤„è¿˜æ˜¯è¿åâ€œå¼€æ”¾-å°é—­åŸåˆ™â€) ç®€å•å·¥å‚æ¨¡å¼ç”±äºä½¿ç”¨äº†é™æ€å·¥å‚æ–¹æ³•ï¼Œé€ æˆå·¥å‚è§’è‰²æ— æ³•å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„ã€‚ é€‚ç”¨åœºæ™¯, åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¯ä»¥è€ƒè™‘ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼: å·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘, ç”±äºåˆ›å»ºçš„å¯¹è±¡è¾ƒå°‘, ä¸ä¼šé€ æˆå·¥å‚æ–¹æ³•ä¸­çš„ä¸šåŠ¡é€»è¾‘å¤ªè¿‡å¤æ‚ã€‚ å®¢æˆ·ç«¯åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°, å¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡å¹¶ä¸å…³å¿ƒã€‚ æ€»ä¹‹, ä»æœªå®Œå…¨åšåˆ° â€œå¼€æ”¾-å°é—­åŸåˆ™â€","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"03. å¼•å…¥å·¥å‚ç±»","slug":"OOP/2016-05-27-OOP-03-Why-Factory","date":"2016-05-27T06:33:19.000Z","updated":"2018-03-15T09:33:04.000Z","comments":true,"path":"2016/05/27/OOP/2016-05-27-OOP-03-Why-Factory/","link":"","permalink":"http://blog.renyimin.com/2016/05/27/OOP/2016-05-27-OOP-03-Why-Factory/","excerpt":"","text":"å‰è¨€ å·¥å‚æ¨¡å¼, åŒ…æ‹¬ç®€å•å·¥å‚æ¨¡å¼ã€å·¥å‚æ–¹æ³•æ¨¡å¼ å’Œ æŠ½è±¡å·¥å‚æ¨¡å¼ é€šå¸¸, åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç›´æ¥ä½¿ç”¨newå…³é”®å­—æ˜¯æœ€ç®€å•çš„ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼, ä½†æ˜¯å®ƒçš„ çµæ´»æ€§è¾ƒå·® å‡è®¾ç³»ç»Ÿå¯ä»¥æ˜¾ç¤ºé¥¼çŠ¶å›¾çš„æ•ˆæœ, åŸå§‹è®¾è®¡æ–¹æ¡ˆå¦‚ä¸‹å›¾: 1234567891011121314151617181920212223242526272829303132&lt;?php class PieChart &#123; public function display() &#123; echo 'piechart', '&lt;br/&gt;'; &#125; &#125; class BarChart &#123; public function display() &#123; echo 'barchart', '&lt;br/&gt;'; &#125; &#125; //Client class Client &#123; public $chartObject = null; public function __construct() &#123; $this-&gt;chartObject = new PieChart(); &#125; public function show() &#123; $this-&gt;chartObject-&gt;display(); &#125; &#125; ä¸Šä¾‹åœ¨clientç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºäº†PieChartç±»å‹çš„å¯¹è±¡ï¼Œå¹¶åœ¨showæ–¹æ³•ä¸­è°ƒç”¨äº†chartObjectå¯¹è±¡çš„display()æ–¹æ³•, è¿™æ®µä»£ç çœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜; ä½†äº‹å®ä¸Š: Clientç±»å³è´Ÿè´£ å¯¹è±¡çš„åˆ›å»º, åˆè´Ÿè´£ å¯¹è±¡çš„ä½¿ç”¨, åˆ›å»ºå¯¹è±¡å’Œä½¿ç”¨å¯¹è±¡çš„èŒè´£è€¦åˆåœ¨ä¸€èµ·; åŒæ—¶, è¿™æ ·çš„è®¾è®¡ä¼šå¯¼è‡´ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜, è¿™ç§å¼ºè€¦åˆå¿…ç„¶è¿èƒŒäº† å¼€é—­åŸåˆ™å¦‚æœåœ¨ Client ä¸­å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨å¦ä¸€ä¸ªç§ç±»å‹çš„å›¾åƒæ–¹æ¡ˆ, æ¯”å¦‚ä½¿ç”¨æŸ±çŠ¶å›¾BarChartç±»ï¼Œé‚£å°±å¿…é¡»ä¿®æ”¹Clientç±»çš„æºä»£ç , è¿åäº†â€å¼€é—­åŸåˆ™â€ã€‚ å¼•å‡ºå·¥å‚ç±» æœ€å¸¸ç”¨çš„ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å°† chartObject å¯¹è±¡çš„åˆ›å»ºèŒè´£ä» Client ç±»ä¸­ç§»é™¤, é€šè¿‡å¼•å…¥å·¥å‚ç±», åœ¨ Client ç±»ä¹‹å¤–åˆ›å»ºå¯¹è±¡: å®¢æˆ·ç±»å°±ä¸ä¼šå†æ¶‰åŠå¯¹è±¡çš„åˆ›å»º, åªæ˜¯å¯¹å¯¹è±¡è¿›è¡Œä½¿ç”¨ è€Œåˆ›å»ºå¯¹è±¡çš„å·¥å‚ç±»è‡ªç„¶ä¹Ÿåªæ˜¯è´Ÿè´£åˆ›å»ºå¯¹è±¡, ä¹Ÿä¸ä¼šæ¶‰åŠå¯¹è±¡çš„ä½¿ç”¨ å¼•å…¥å·¥å‚ç±» ChartFactory ä¹‹åçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º: å·¥å‚ç±»çš„å¼•å…¥å°†é™ä½ç»´æŠ¤å·¥ä½œé‡ï¼š å¦‚æœéœ€è¦æ·»åŠ æˆ–ç§»é™¤ä¸åŒçš„å›¾åƒç±», ä½ åªè¦å»ç»´æŠ¤ ChartFactory çš„ä»£ç , å°±ä¸ä¼šå½±å“åˆ°Clientçš„ä»£ç ; è€Œä¸”å¦‚æœ Chart æŠ½è±¡æ¥å£å‘ç”Ÿæ”¹å˜, ä¾‹å¦‚æ·»åŠ ã€ç§»é™¤æ–¹æ³•æˆ–æ”¹å˜æ–¹æ³•å, åªéœ€è¦ä¿®æ”¹Clientä»£ç , ä¸ä¼šç»™ChartFactoryå¸¦æ¥ä»»ä½•å½±å“; æ­¤å¤–, å°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»è¿˜æœ‰ä¸€ä¸ªå¥½å¤„: é˜²æ­¢ç”¨æ¥å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„ä»£ç åœ¨å¤šä¸ªç±»ä¸­åˆ°å¤„éƒ½æ˜¯, å¯ä»¥å°†æœ‰å…³åˆ›å»ºçš„ä»£ç æ¬ç§»åˆ°ä¸€ä¸ªå·¥å‚ç±»ä¸­; æœ‰æ—¶å€™åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¸åªæ˜¯ç®€å•è°ƒç”¨å…¶æ„é€ å‡½æ•°, è¿˜éœ€è¦è®¾ç½®ä¸€äº›å‚æ•°, å¯èƒ½è¿˜éœ€è¦é…ç½®ç¯å¢ƒ, æ­¤æ—¶, å¯ä»¥å¼•å…¥å·¥å‚ç±»æ¥å°è£…å¯¹è±¡çš„åˆ›å»ºé€»è¾‘å’Œå®¢æˆ·ä»£ç çš„å®ä¾‹åŒ–/é…ç½®é€‰é¡¹ã€‚","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"01. Singletonå•ä¾‹æ¨¡å¼","slug":"OOP/2016-05-27-OOP-01-Singleton","date":"2016-05-27T03:13:34.000Z","updated":"2018-03-15T09:22:43.000Z","comments":true,"path":"2016/05/27/OOP/2016-05-27-OOP-01-Singleton/","link":"","permalink":"http://blog.renyimin.com/2016/05/27/OOP/2016-05-27-OOP-01-Singleton/","excerpt":"","text":"TP3.2åˆ†æ æ¡†æ¶åº•å±‚çš„æ•°æ®åº“æ¨¡å‹å±‚å¯¹å•ä¾‹çš„ä½¿ç”¨ è™½ç„¶ æ•°æ®åº“æ¨¡å‹å±‚ ä½¿ç”¨äº†å•ä¾‹, ä½†å¹¶éä¼ ç»Ÿæ„ä¹‰ä¸Šæ‰€è°“ ä¸‰å…¬ä¸€ç§ çš„å•ä¾‹;TP3.2åˆ›å»ºæ•°æ®åº“æ¨¡å‹å®ä¾‹çš„è¿‡ç¨‹å¤§æ¦‚ä¸º: Think\\Model -&gt; Think\\Db -&gt; Think\\Db\\Driver\\Mysql -&gt; Think\\Db\\DriverD()/M() æ–¹æ³•éƒ½å¯ä»¥è°ƒç”¨ Think\\Model è¿™ä¸ªæ¨¡å‹ç±», è™½ç„¶ Think\\Model å±‚å¹¶æœªåšåˆ°å•ä¾‹, å³ new Model(â€¦) å®ä¾‹å‡ºçš„å¯¹è±¡ä¸ºéå•ä¾‹,ä½†å…¶é€šè¿‡è°ƒç”¨ä¸‹å±‚ Think\\Db çš„ getInstance(), ç„¶åç®€å•ç»“åˆä¸€ä¸ª æ•°æ®åº“å¯¹è±¡æ± $_db(æ³¨å†Œæ ‘æ¨¡å¼) æ¥ä¿è¯åº•å±‚å„ä¸åŒæ•°æ®åº“å¯¹è±¡çš„å•ä¾‹æ€§;è€Œ Think\\Db å…¶å†…éƒ¨ä¸åº•å±‚æ²Ÿé€šçš„æ–¹æ³•å…¨æ˜¯staticå‹, ç”¨æˆ·åœ¨é¡¶å±‚æ§åˆ¶å™¨ä¸­ç›´æ¥newä¹Ÿæ²¡æ„ä¹‰; åªæœ‰åœ¨é¡¶å±‚æ§åˆ¶å™¨ç›´æ¥ new Think\\Db\\Driver\\Mysql ä½ ä¼šè·å¾—ä¸åŒçš„æ•°æ®åº“è¿æ¥å®ä¾‹, ä½†ä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥newåº•å±‚!æœ€ä¸‹å±‚ Think\\Db\\Driver ä¸ºæŠ½è±¡å±‚ ä¼˜ç‚¹ æä¾›äº†å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—® ç”±äºåœ¨ç³»ç»Ÿå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡å•ä¾‹æ¨¡å¼æ— ç–‘å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½; æ³¨æ„äº‹é¡¹åºåˆ—åŒ–é—®é¢˜ é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯éµå¾ªæ­£å¸¸çš„â€ä¸‰ç§ä¸€å…¬â€æ¥å†™å•ä¾‹, ä½†æ˜¯å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ä¼šå› ä¸º åºåˆ—åŒ–, ååºåˆ—åŒ– è€Œå¯¼è‡´å•ä¾‹å‡ºé—®é¢˜ 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpclass Singleton&#123; private static $instance = null; private function __construct() &#123; &#125; private function __clone() &#123; &#125; public static function getInstance() &#123; if (null === self::$instance) self::$instance = new self(); return self::$instance; &#125;&#125;echo &apos;&lt;pre/&gt;&apos;;$test_1 = Singleton::getInstance();$test_2 = Singleton::getInstance();var_dump($test_1); //å®ä¾‹1var_dump($test_2); //å®ä¾‹1var_dump($test_1 === $test_2); // trueecho &apos;unserialize, serialize:---------------------------&lt;br/&gt;&apos;;$test_1 = unserialize(serialize($test_1));var_dump($test_1); //å®ä¾‹2var_dump(Singleton::getInstance()); //å®ä¾‹1var_dump( Singleton::getInstance() === $test_1); //falseecho &apos;unserialize, serialize:---------------------------&lt;br/&gt;&apos;;$test_3 = Singleton::getInstance();var_dump($test_3); //å®ä¾‹1$test_3 = unserialize(serialize($test_3));var_dump($test_3); //å®ä¾‹3var_dump(Singleton::getInstance()); //å®ä¾‹1var_dump( Singleton::getInstance() === $test_3); //false é¸Ÿå“¥åšæ–‡å…¶å®å¹¶ä¸èƒ½å®Œå…¨è§£å†³, çœ‹ä¸‹é¢ä¾‹å­: è™½ç„¶æ¯æ¬¡ååºåˆ—åŒ–åçš„æ‰€æœ‰å®ä¾‹éƒ½ä¸€è‡´, ä½†æ˜¯ä¸€æ—¦ç¢°åˆ°å†æ¬¡ååºåˆ—åŒ–, è¿˜æ˜¯ä¼šå‡ºé—®é¢˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?phpclass Singleton&#123; private static $instance = null; private function __construct() &#123; &#125; private function __clone() &#123; &#125; public function __wakeup() &#123; self::$instance = $this; &#125; public static function getInstance() &#123; if (null === self::$instance) self::$instance = new self(); return self::$instance; &#125; public function __destruct() &#123; &#125;&#125;echo '&lt;pre/&gt;';$test_1 = Singleton::getInstance(); $test_2 = Singleton::getInstance(); var_dump($test_1); //å®ä¾‹1var_dump($test_2); //å®ä¾‹1var_dump($test_1 === $test_2); //trueecho 'unserialize, serialize:---------------------------&lt;br/&gt;';$test_1 = unserialize(serialize($test_1));var_dump($test_1); //å®ä¾‹2var_dump(Singleton::getInstance()); //å®ä¾‹2var_dump( Singleton::getInstance() === $test_1); //trueecho 'unserialize, serialize:---------------------------&lt;br/&gt;';$test_3 = Singleton::getInstance();var_dump($test_3); //å®ä¾‹2$test_3 = unserialize(serialize($test_3));var_dump($test_3); //å®ä¾‹3var_dump(Singleton::getInstance()); //å®ä¾‹3var_dump( Singleton::getInstance() === $test_3); //true å¯ä»¥çœ‹åˆ°è¿˜æ˜¯å‡ºç°äº†å¤šä¸ªä¸åŒçš„å®ä¾‹!!! å•ä¾‹ç»§æ‰¿é—®é¢˜å¦å¤–, å•ä¾‹æ¨¡å¼å‡ºç°ç»§æ‰¿å…³ç³»æ—¶, éœ€è¦æ³¨æ„: PHPçš„ self å’Œ static å…³é”®å­—çš„åŒºåˆ« å­ç±»éœ€è¦ æ¸…ç©ºé™æ€å®ä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;?phpclass Singleton&#123; protected static $instance = null; protected function __construct() &#123; &#125; protected function __clone() &#123; &#125; protected function __wakeup() &#123; static::$instance = $this; &#125; public static function getInstance() &#123; if (null === static::$instance) static::$instance = new static(); return static::$instance; &#125;&#125;echo &apos;&lt;pre/&gt;&apos;;$test_1 = Singleton::getInstance();$test_2 = Singleton::getInstance();var_dump($test_1);var_dump($test_2);var_dump($test_1 === $test_2);class Log extends Singleton&#123; // æ³¨æ„: æ¯ä¸ªç»§æ‰¿å•ä¾‹çš„å­ç±», å¿…é¡»è¦åšæ¸…ç©º, å¦åˆ™æ‰€æœ‰çš„å®ä¾‹éƒ½æ˜¯ä¸Šé¢çš„å®ä¾‹ç»“æœ protected static $instance = null; public function write() &#123; echo &apos;success write something&apos;; &#125;&#125;class Model extends Singleton&#123; // æ³¨æ„: æ¯ä¸ªç»§æ‰¿å•ä¾‹çš„å­ç±», å¿…é¡»è¦åšæ¸…ç©º, å¦åˆ™æ‰€æœ‰çš„å®ä¾‹éƒ½æ˜¯ä¸Šé¢çš„å®ä¾‹ç»“æœ protected static $instance = null; public function select() &#123; echo &apos;success select something&apos;; &#125;&#125;$log_1 = Log::getInstance();$log_2 = Log::getInstance();var_dump($log_1);var_dump($log_2);var_dump($log_1 === $log_2);$model_1 = Model::getInstance();$model_2 = Model::getInstance();var_dump($model_1);var_dump($model_2);var_dump($model_1 === $model_2);var_dump($model_1 === $test_2); // false","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"0. S.O.L.I.D","slug":"OOP/2016-05-27-OOP-00-SOLID","date":"2016-05-27T02:07:12.000Z","updated":"2018-03-15T09:22:11.000Z","comments":true,"path":"2016/05/27/OOP/2016-05-27-OOP-00-SOLID/","link":"","permalink":"http://blog.renyimin.com/2016/05/27/OOP/2016-05-27-OOP-00-SOLID/","excerpt":"","text":"å•ä¸€èŒè´£åŸåˆ™ SRPThe Single Responsibility Principle å•ä¸€èŒè´£åŸåˆ™æ˜¯æœ€ç®€å•çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™, ç”¨äºæ§åˆ¶ç±»çš„ç²’åº¦å¤§å°; æ­¤åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯ è§£è€¦ å’Œ å¢å¼ºå†…èšæ€§ å•ä¸€èŒè´£åŸåˆ™å®šä¹‰ä¸º: ä¸€ä¸ªç±»æˆ–è€…æ¨¡å—åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªè¢«æ”¹å˜çš„åŸå› ; å¦‚æœä¸€ä¸ªç±»æ‰¿æ‹…çš„èŒè´£è¿‡å¤š(è€¦åˆåº¦å°±è¶Šå¤§), å®ƒè¢«å¤ç”¨çš„å¯èƒ½æ€§å°±è¶Šå°; ä¸€ä¸ªèŒè´£çš„å˜åŒ–å¯èƒ½ä¼šå½±å“å…¶ä»–çš„èŒè´£, è¿™ç§è€¦åˆä¼šå¯¼è‡´è„†å¼±çš„è®¾è®¡, å½“å‘ç”Ÿå˜åŒ–æ—¶, è®¾è®¡ä¼šé­å—åˆ°æ„æƒ³ä¸åˆ°çš„ç ´å(å› æ­¤è¦å°†è¿™äº›èŒè´£è¿›è¡Œåˆ†ç¦»ï¼Œå°†ä¸åŒçš„èŒè´£å°è£…åœ¨ä¸åŒçš„ç±»ä¸­); å¼€æ”¾å°é—­åŸåˆ™ OCPThe Open/Closed Principle å¼€æ”¾-å°é—­åŸåˆ™: ä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾, å¯¹ä¿®æ”¹å…³é—­(å³è½¯ä»¶å®ä½“åº”å°½é‡åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œæ‰©å±•); å¦‚æœä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿè®¾è®¡ç¬¦åˆå¼€é—­åŸåˆ™, åˆ™å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¯¹ç³»ç»Ÿè¿›è¡Œæ‰©å±•ï¼Œè€Œä¸”åœ¨æ‰©å±•æ—¶æ— é¡»ä¿®æ”¹ç°æœ‰ä»£ç ã€‚éšç€è½¯ä»¶è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œè½¯ä»¶å¯¿å‘½è¶Šæ¥è¶Šé•¿ï¼Œè½¯ä»¶ç»´æŠ¤æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œè®¾è®¡æ»¡è¶³å¼€é—­åŸåˆ™çš„è½¯ä»¶ç³»ç»Ÿä¹Ÿå˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ æ­¤åŸåˆ™çš„æ ¸å¿ƒæ˜¯ å¯¹æŠ½è±¡ç¼–ç¨‹, è€Œä¸å¯¹å…·ä½“ç¼–ç¨‹; ä¸ºäº†æ»¡è¶³å¼€é—­åŸåˆ™ï¼Œéœ€è¦å¯¹ç³»ç»Ÿè¿›è¡ŒæŠ½è±¡åŒ–è®¾è®¡, æŠ½è±¡åŒ–æ˜¯å¼€é—­åŸåˆ™çš„å…³é”®; ä¾‹å­, å‡è®¾ç³»ç»Ÿå¯ä»¥æ˜¾ç¤ºå„ç§ç±»å‹çš„å›¾è¡¨, å¦‚ é¥¼çŠ¶å›¾ å’Œ æŸ±çŠ¶å›¾ ç­‰, ä¸ºäº†æ”¯æŒå¤šç§å›¾è¡¨æ˜¾ç¤ºæ–¹å¼ åŸå§‹è®¾è®¡æ–¹æ¡ˆå¦‚ä¸‹ ä»£ç å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phpclass PieChart&#123; public function display() &#123; echo 'piechart', '&lt;br/&gt;'; &#125;&#125;class BarChart&#123; public function display() &#123; echo 'barchart', '&lt;br/&gt;'; &#125;&#125;class ChartDisplay&#123; public $chartObject = null; public function __construct() &#123; //TODO &#125; public function display($chartType) &#123; switch ($chartType) &#123; case 'pie' : $piechart = new PieChart(); $piechart-&gt;display(); break; case 'bar' : $barchart = new BarChart(); $barchart-&gt;display(); break; default: //TODO break; &#125; &#125;&#125; é—®é¢˜: ç°åœ¨å¦‚æœéœ€è¦å¢åŠ ä¸€ä¸ªæŠ˜çº¿å›¾LineChart, ä½ å°±è¦éœ€è¦ä¿®æ”¹ChartDisplayç±»çš„display()æ–¹æ³•çš„æºä»£ç , å¢åŠ æ–°çš„åˆ¤æ–­é€»è¾‘, è¿åäº†å¼€é—­åŸåˆ™; ç°å¯¹è¯¥ç³»ç»Ÿè¿›è¡Œé‡æ„, ä½¿ä¹‹ç¬¦åˆå¼€é—­åŸåˆ™ å¼•å…¥æŠ½è±¡å›¾è¡¨ç±»AbstractChart, å¹¶ä¸”è®©ChartDisplayé’ˆå¯¹æŠ½è±¡å›¾è¡¨ç±»è¿›è¡Œç¼–ç¨‹(ä¾èµ–æŠ½è±¡), å†åœ¨ChartDisplayçš„display()æ–¹æ³•ä¸­è°ƒç”¨å…·ä½“chartå¯¹è±¡çš„display()æ–¹æ³•æ˜¾ç¤ºå›¾è¡¨ã€‚ æ¥ä¸‹æ¥, åªéœ€è¦å°†LineChartä½œä¸ºAbstractChartçš„å­ç±», åœ¨å®¢æˆ·ç«¯å‘ChartDisplayä¸­æ³¨å…¥ä¸€ä¸ªLineChartå¯¹è±¡å³å¯, æ— é¡»ä¿®æ”¹ç°æœ‰ç±»åº“çš„æºä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpabstract class AbstractChart&#123; protected function display() &#123; &#125;&#125;class PieChart extends AbstractChart&#123; public function display() &#123; echo 'piechart', '&lt;br/&gt;'; &#125;&#125;class BarChart extends AbstractChart&#123; public function display() &#123; echo 'barchart', '&lt;br/&gt;'; &#125;&#125;class ChartDisplay&#123; public function __construct() &#123; //TODO &#125; public function display(AbstractChart $chart) &#123; $chart-&gt;display(); &#125;&#125;$cd = new ChartDisplay();$cd-&gt;display(new PieChart());$cd-&gt;display(new BarChart()); é‡Œæ°æ›¿æ¢åŸåˆ™LSPThe Liskov Substitution Principle æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹, å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»å¯¹è±¡; å­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•, ä½†æ˜¯ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•, ä¹Ÿå°±æ˜¯å­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½, ä½†æ˜¯ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½; ä¸»è¦å°±æ˜¯è¯´, å¦‚æœä¾èµ–çš„ç±»å°†æ¥æœ‰å¯èƒ½è¢«æ‰©å±•, ä½ æœ€å¥½è®¾è®¡ä¸€ä¸ªæŠ½è±¡çˆ¶ç±»æˆ–æ¥å£, å­ç±»ç»§æ‰¿ã€å®ç°çˆ¶ç±»; é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦æ–¹å¼ä¹‹ä¸€, ç”±äºä½¿ç”¨åŸºç±»å¯¹è±¡çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å¯¹è±¡, å› æ­¤åœ¨ç¨‹åºä¸­å°½é‡ä½¿ç”¨åŸºç±»ç±»å‹æ¥å¯¹å¯¹è±¡è¿›è¡Œå®šä¹‰, è€Œåœ¨è¿è¡Œæ—¶å†ç¡®å®šå…¶å­ç±»ç±»å‹, ç”¨å­ç±»å¯¹è±¡æ¥æ›¿æ¢çˆ¶ç±»å¯¹è±¡ã€‚ æ¥å£åˆ†ç¦»åŸåˆ™ISPThe Interface Segregation Principle è¯¥åŸåˆ™æ¯”è¾ƒå¥½ç†è§£: ä¸è¦å®šä¹‰è¿‡äºè‡ƒè‚¿çš„æ¥å£, æ¥å£ä¸­ä¸è¦æœ‰å¾ˆå¤šä¸ç›¸å…³çš„é€»è¾‘æ–¹æ³•(å¦åˆ™ä¸€å®šä¹Ÿè¿èƒŒå•ä¸€èŒè´£åŸåˆ™); è¿‡äºè‡ƒè‚¿çš„æ¥å£å¯èƒ½ä¼šå¼ºè¿«ç”¨æˆ·å»å®ç°æ¥å£å†…éƒ¨ç”¨æˆ·å¹¶ä¸éœ€è¦çš„æ–¹æ³•, æ¢å¥è¯è¯´, ä½¿ç”¨ å¤šä¸ªä¸“é—¨çš„æ¥å£ æ¯”ä½¿ç”¨ ä¸€ä¸ªè‡ƒè‚¿çš„æ€»æ¥å£ è¦å¥½å¾ˆå¤š; å¦‚æœä½ åœ¨ç±»ä¸­å®ç°çš„æ¥å£ä¸­æœ‰ä½ ä¸éœ€è¦ä½¿ç”¨æ–¹æ³•, ä¼°è®¡ä¹Ÿæ˜¯é‡å†™ä¸ºç©ºæ–¹æ³•, è¿™å…¶å®å·²ç»è¿èƒŒäº†æ¥å£åˆ†ç¦»åŸåˆ™ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ¥å£æˆ–è€…ç±»åº”è¯¥æ‹¥æœ‰å°½å¯èƒ½å°‘çš„è¡Œä¸º, å°±æ˜¯å°‘åˆ°æ°å¥½èƒ½å®Œæˆå®ƒè‡ªèº«çš„èŒè´£, è¿™ä¹Ÿæ˜¯ä¿è¯è½¯ä»¶ç³»ç»Ÿæ¨¡å—çš„ç²’åº¦å°½å¯èƒ½å°‘, ä»¥è¾¾åˆ°é«˜åº¦å¯é‡ç”¨çš„ç›®çš„; ä¾èµ–åè½¬åŸåˆ™DIPThe Dependency Inversion Principleè¦é’ˆå¯¹æ¥å£ç¼–ç¨‹, è€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ å¦‚æœè¯´å¼€é—­åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ç›®æ ‡çš„è¯, é‚£ä¹ˆä¾èµ–å€’è½¬åŸåˆ™å°±æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ä¸»è¦å®ç°æœºåˆ¶ä¹‹ä¸€, å®ƒæ˜¯ç³»ç»ŸæŠ½è±¡åŒ–çš„å…·ä½“å®ç°; ä¸Šå±‚ä¸ç”¨å»å®šä¹‰è‡ªå·±è¦ä¾èµ–å“ªä¸ªå…·ä½“çš„ç±», è€Œæ˜¯å®šä¹‰è‡ªå·±ä¾èµ–å“ªä¸ª æŠ½è±¡; ç„¶åè®©åº•å±‚ä»£ç æ ¹æ®ä¸Šå±‚çš„è¦æ±‚, å»å®ç°ç›¸åº”çš„ æŠ½è±¡; è¿™æ ·å°±å˜æˆäº†åº•å±‚å¯¹ä¸Šå±‚çš„ä¾èµ–, åº•å±‚ä»£ç éœ€è¦å» å®ç° ä¸Šå±‚ä»£ç å®šä¹‰çš„æŠ½è±¡; åœ¨å®ç°ä¾èµ–å€’è½¬åŸåˆ™æ—¶, æˆ‘ä»¬éœ€è¦é’ˆå¯¹æŠ½è±¡å±‚ç¼–ç¨‹, å°†å…·ä½“ç±»çš„å¯¹è±¡é€šè¿‡ä¾èµ–æ³¨å…¥(DependencyInjection, DI)çš„æ–¹å¼æ³¨å…¥åˆ°å…¶ä»–å¯¹è±¡ä¸­ï¼Œä¾èµ–æ³¨å…¥æ˜¯æŒ‡å½“ä¸€ä¸ªå¯¹è±¡è¦ä¸å…¶ä»–å¯¹è±¡å‘ç”Ÿä¾èµ–å…³ç³»æ—¶ï¼Œé€šè¿‡æŠ½è±¡æ¥æ³¨å…¥æ‰€ä¾èµ–çš„å¯¹è±¡; å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šæ„é€ æ³¨å…¥ï¼Œè®¾å€¼æ³¨å…¥(Setteræ³¨å…¥) å’Œ æ¥å£æ³¨å…¥ã€‚ æ„é€ æ³¨å…¥æ˜¯æŒ‡é€šè¿‡æ„é€ å‡½æ•°æ¥ä¼ å…¥å…·ä½“ç±»çš„å¯¹è±¡ è®¾å€¼æ³¨å…¥æ˜¯æŒ‡é€šè¿‡Setteræ–¹æ³•æ¥ä¼ å…¥å…·ä½“ç±»çš„å¯¹è±¡ è€Œæ¥å£æ³¨å…¥æ˜¯æŒ‡é€šè¿‡åœ¨æ¥å£ä¸­å£°æ˜çš„ä¸šåŠ¡æ–¹æ³•æ¥ä¼ å…¥å…·ä½“ç±»çš„å¯¹è±¡ å°ç»“åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, å¼€é—­åŸåˆ™ã€é‡Œæ°ä»£æ¢åŸåˆ™ å’Œ ä¾èµ–å€’è½¬åŸåˆ™ è¿™ä¸‰ä¸ªè®¾è®¡åŸåˆ™ä¼šåŒæ—¶å‡ºç°: - å¼€é—­åŸåˆ™æ˜¯ç›®æ ‡ - é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯åŸºç¡€ - ä¾èµ–å€’è½¬åŸåˆ™æ˜¯æ‰‹æ®µ å®ƒä»¬ç›¸è¾…ç›¸æˆ, ç›¸äº’è¡¥å……, ç›®æ ‡ä¸€è‡´, åªæ˜¯åˆ†æé—®é¢˜æ—¶æ‰€ç«™è§’åº¦ä¸åŒè€Œå·²","categories":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/categories/OOP/"}],"tags":[{"name":"OOP","slug":"OOP","permalink":"http://blog.renyimin.com/tags/OOP/"}]},{"title":"04. æˆæƒç æ¨¡å¼å„é˜¶æ®µå‚æ•°åˆ†æ","slug":"oauth/2016-10-25-OAuth-04","date":"2016-05-25T12:10:12.000Z","updated":"2018-03-14T01:33:15.000Z","comments":true,"path":"2016/05/25/oauth/2016-10-25-OAuth-04/","link":"","permalink":"http://blog.renyimin.com/2016/05/25/oauth/2016-10-25-OAuth-04/","excerpt":"","text":"ç¬¬ä¸€é˜¶æ®µ: ç¬¬ä¸‰æ–¹ç«™ç‚¹å°†å¯¼å‘æˆæƒé¡µ ç¬¬ä¸‰æ–¹åº”ç”¨å°†ç”¨æˆ·å¯¼å‘æˆæƒé¡µæ—¶, ä¼ é€’çš„å‚æ•°å¦‚ä¸‹: response_type: è¡¨ç¤ºæˆæƒç±»å‹, å¿…é€‰é¡¹, æ­¤å¤„ç”±äºé‡‡ç”¨çš„æ˜¯æˆæƒç æ¨¡å¼, æ‰€ä»¥å€¼å›ºå®šä¸º â€œcodeâ€ client_id/AppID: è¡¨ç¤ºå®¢æˆ·ç«¯çš„ID, å¿…é€‰é¡¹ç”±äºä½ å¯èƒ½ä¼šæœ‰å¤šä¸ªç«™ç‚¹éœ€è¦å¯¹æ¥OAuthæˆæƒæœåŠ¡å™¨, æ‰€ä»¥ä¸€èˆ¬åœ¨æˆæƒæœåŠ¡å¹³å°ç™»å½•ä¹‹å, æ˜¯å¯ä»¥åˆ›å»ºå¤šä¸ª åº”ç”¨ çš„ (ä¸åŒçš„ç«™ç‚¹å¯¹æ¥æˆæƒæœåŠ¡å™¨ä¸­ä¸åŒçš„åº”ç”¨);æ¯ä¸ªåº”ç”¨å¯¹åº”ä½ çš„ä¸€ä¸ª ç¬¬ä¸‰æ–¹ç«™ç‚¹, å¼€æ”¾å¹³å°ä¼šä¸ºæ¯ä¸ªåº”ç”¨(ç¬¬ä¸‰æ–¹ç«™ç‚¹)ç”Ÿæˆç›¸åº”çš„ AppID å’Œ AppSecret/AppKey, ä¸»è¦ç”¨æ¥éªŒè¯åº”ç”¨çš„åˆæ³•æ€§; redirect_uri: è®¾å®šçš„é‡å®šå‘åˆ°ç¬¬ä¸‰æ–¹ç«™ç‚¹URI, å¿…é€‰é¡¹ scope: è¡¨ç¤ºç”³è¯·çš„æƒé™èŒƒå›´, å¯é€‰é¡¹ state: è¡¨ç¤ºå®¢æˆ·ç«¯çš„å½“å‰çŠ¶æ€, å¯ä»¥æŒ‡å®šä»»æ„å€¼, è®¤è¯æœåŠ¡å™¨ä¼šåŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå€¼ ä¸‹é¢æ˜¯å„å¼€æ”¾å¹³å°çš„å‚æ•°å¯¹æ¯”: æ–°æµª QQ å¾®ä¿¡ GitHub èš‚èšé‡‘æœ ç®€å•æµ‹è¯•: redirect_uriåœ¨OAuthæœåŠ¡å™¨ä¸­ä¸ºç¬¬ä¸‰æ–¹ç«™ç‚¹åˆ›å»º åº”ç”¨ çš„æ—¶å€™, è®¾å®šçš„å›è°ƒåœ°å€, æ— è®ºåœ¨è®¤è¯æœåŠ¡å™¨, è¿˜æ˜¯åœ¨ç¬¬ä¸‰æ–¹ç«™ç‚¹, éƒ½ä¼šå¯¹å…¶è¿›è¡Œæ ¡éªŒ, ä»¥é˜²ç¯¡æ”¹; æ–°æµªæˆæƒä¼ é€’é”™è¯¯ redirect_uri ç®€ä¹¦qqæˆæƒä¼ é€’é”™è¯¯ redirect_uri stateç¬¬ä¸‰æ–¹ç«™ç‚¹ä¼šå¯¹stateåšæ ¡éªŒç»™äº†ä¸€ä¸ªæ–°çš„å¼¹æ¡†ç”¨æ¥è¿›è¡Œæˆæƒ, ä½†æ˜¯å¦‚æœæ¶æ„ç”¨æˆ·å¤åˆ¶å‡ºå¼¹æ¡†ä¸­çš„url, ä¹‹åå†ä¿®æ”¹stateå¹¶åˆ·æ–°é¡µé¢, æˆæƒåå‘ç°: ä»ä¸Šé¢å„å¹³å°ä¹Ÿå¯ä»¥çœ‹åˆ°, è¿”å›å‚æ•°ç›¸å¯¹æ¯”è¾ƒç®€å•; è¿”å›çš„codeæ˜¯å’Œæˆæƒé¡µç™»å½•çš„ç”¨æˆ·èº«ä»½ç›¸å…³çš„; (åé¢çš„access_tokenä¹Ÿæ˜¯é€šè¿‡codeå’Œç”¨æˆ·èº«ä»½å…³è”èµ·æ¥çš„) ç¬¬äºŒé˜¶æ®µ: é€šè¿‡Authorization Codeè·å–Access Token å¦‚æœç¬¬ä¸‰æ–¹ç«™ç‚¹çš„ç”¨æˆ·åœ¨ç¬¬ä¸€é˜¶æ®µçš„æˆæƒé¡µä¸­é€‰æ‹©å¯¹ç¬¬ä¸‰æ–¹ç«™ç‚¹æˆæƒ, é‚£ä¹ˆå°±ç¬¬ä¸‰æ–¹ç«™ç‚¹å°±ä¼šæ”¶åˆ°æˆæƒæœåŠ¡å™¨çš„Authorization Code, è¿›è€Œè¿›å…¥æœ¬é˜¶æ®µ;(æ¯ä¸ªç”¨æˆ·åœ¨æˆæƒå, ç¬¬ä¸‰æ–¹ç«™ç‚¹éƒ½éœ€è¦åˆ°æˆæƒæœåŠ¡å™¨ä¸Šä¸ºç”¨æˆ·è·å–ä¸€ä¸ªaccess_token, è¿™ä¸ªaccess_tokenå°±æ˜¯ä»¥åç¬¬ä¸‰æ–¹ç«™ç‚¹ä»æˆæƒæœåŠ¡å™¨ä¸Šè·å–ç”¨æˆ·ä¿¡æ¯çš„å‡­è¯äº†, ä¸€èˆ¬åœ¨è·å–åˆ°access_tokenä»¤ç‰Œä¹‹å, å¯ä»¥å­˜å‚¨åˆ°sessionä¸­) æœ¬é˜¶æ®µ, æˆ‘ä»¬åœ¨è‡ªå·±çš„ç¬¬ä¸‰æ–¹ç«™ç‚¹ä¸­å°±å¯ä»¥ä½¿ç”¨ç¬¬ä¸€é˜¶æ®µçš„Authorization Codeè·å–Access Token: å¾®ä¿¡ qq åŸºæœ¬ä¸Šå…¥å‚å°±åƒQQäº’è”é‚£æ ·å¤§æ¦‚æœ‰5ä¸ª (éœ€è¦å¯¹æ¯ä¸ªå‚æ•°è¿›è¡Œäº†è§£); æœ¬é˜¶æ®µçš„è¿”å›å‚æ•°æ¯”è¾ƒæœ‰è®²ç©¶, ä¸€èˆ¬ä¸ºå¦‚ä¸‹ä¸‰ä¸ª access_token æˆæƒä»¤ç‰Œaccess_tokenä¸€èˆ¬åœ¨è·å–åˆ°ä¹‹å, ç¬¬ä¸‰æ–¹ç«™ç‚¹å¯ä»¥å°†å…¶ ä¿å­˜åˆ°ç”¨æˆ·çš„sessionä¸­ , ç¬¬ä¸‰æ–¹ç«™ç‚¹ä¹‹åè¦è·å–ç”¨æˆ·åœ¨æˆæƒæœåŠ¡å™¨ä¸Šçš„èµ„æºçš„æ—¶å€™, å°±éœ€è¦å¸¦ä¸Šå½“å‰sessionä¸­ç”¨æˆ·çš„access_tokenå»è·å–; expires_in è¯¥access tokençš„æœ‰æ•ˆæœŸ,å•ä½ä¸ºç§’ (å¾®ä¿¡å…¬ä¼—å¹³å°access_tokenæœ‰æ•ˆæœŸä¸º2å°æ—¶, qqäº’è”å¹³å°ä¸º3ä¸ªæœˆ å¯ä»¥ä½œä¸ºå‚è€ƒ)è®¾ç½®access_tokenæœ‰æ•ˆæœŸä¹Ÿæ˜¯ä¸ºäº†å®šæœŸä¿®æ”¹access_token, ä»¥æé«˜å®‰å…¨æ€§;(å¹¶ä¸”å¾®ä¿¡å¯¹è·å–access_tokenè¿™ä¸ªåŸºç¡€APIæ˜¯æœ‰é™åˆ¶çš„ï¼Œæ¯å¤©æœ€å¤šè¯·æ±‚2000æ¬¡, å› ä¸ºæœ‰æ•ˆæœŸä¸º2å°æ—¶, æ¯å¤©2000æ¬¡ä¹Ÿè¶³å¤Ÿäº†;) refresh_token æˆæƒè‡ªåŠ¨ç»­æœŸæ—¶ä½¿ç”¨ (å¾®ä¿¡å…¬ä¼—å¹³å°refresh_tokenæœ‰æ•ˆæœŸä¸º30å¤©, qqäº’è”å¹³å°å…·ä½“ä¸è¯¦, å¯ä»¥ä½œä¸ºå‚è€ƒ) (å¯é€‰)æƒé™è‡ªåŠ¨ç»­æœŸé—®é¢˜ æ³¨æ„å¾®ä¿¡å…¬ä¼—å¹³å°: 1.è‹¥access_tokenå·²è¶…æ—¶ï¼Œé‚£ä¹ˆè¿›è¡Œrefresh_tokenä¼šè·å–ä¸€ä¸ªæ–°çš„access_tokenï¼Œæ–°çš„è¶…æ—¶æ—¶é—´, å¹¶ä¸”ä¸€æ—¦ä½¿ç”¨refresh_tokenæ¥åˆ·æ–°access_tokençš„è¯, refresh_tokençš„è¿‡æœŸæ—¶é—´ä¹Ÿä¼šæ›´æ–°(è‡ªåŠ¨å»¶æœŸ) ; 2.è‹¥access_tokenæœªè¶…æ—¶ï¼Œé‚£ä¹ˆè¿›è¡Œrefresh_tokenä¸ä¼šæ”¹å˜access_tokenï¼Œä½†è¶…æ—¶æ—¶é—´ä¼šåˆ·æ–°ï¼Œç›¸å½“äºç»­æœŸaccess_token ; è¿™é‡Œè¯´çš„è¶…æ—¶æ—¶é—´åˆ·æ–°, æŒ‡çš„è‡ªç„¶æ˜¯ç¬¬ä¸‰æ–¹ç«™ç‚¹å’ŒæˆæƒæœåŠ¡å™¨ä¸Šçš„è¶…æ—¶æ—¶é—´éƒ½è¦æ›´æ–°äº†(åªä¸è¿‡ä½ å¦‚æœåªæ˜¯åšå¯¹æ¥çš„è¯, æˆæƒæœåŠ¡å™¨è¿™éƒ¨åˆ†äººå®¶å·²ç»å¼€å‘å¥½äº†, å¦‚æœä½ æ˜¯æˆæƒæœåŠ¡å™¨ä¹Ÿæ˜¯è‡ªå·±å¼€å‘çš„è¯, é‚£ä½ å°±éœ€è¦æ³¨æ„è¿™é‡Œäº†) å…¶å®ç¬¬ä¸‰æ–¹ç«™ç‚¹åœ¨å—åˆ°æˆæƒæœåŠ¡å™¨åˆ†é…ç»™å½“å‰ç”¨æˆ·çš„access_tokenä¹‹å, å‡è®¾è¯´æˆæƒæœåŠ¡å™¨è¿”å›access_tokençš„è¿‡æœŸæ—¶é—´ä¸º7200s(2å°æ—¶), é‚£ä¹ˆç¬¬ä¸‰æ–¹ç«™ç‚¹å°†access_tokenä¿å­˜åˆ°ç”¨æˆ·sessionä¸­, å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º6600s(ä¸­é—´å¯ä»¥æœ‰ä¸ª10åˆ†é’Ÿçš„æœåŠ¡å™¨æ—¶é—´å·®); å¦‚æœç¬¬ä¸‰æ–¹ç«™ç‚¹åœ¨ä½¿ç”¨access_tokenä¸ºç”¨æˆ·è·å–æˆæƒæœåŠ¡å™¨ä¸­çš„èµ„æºæ—¶, å‘ç°sessionä¸­çš„access_tokenå¹¶æ²¡æœ‰è¿‡æœŸ, é‚£ä¹ˆè¯·æ±‚åå°±éœ€è¦ä¸ºaccess_tokenç»­æœŸ(ç¬¬ä¸‰æ–¹ç«™ç‚¹å’ŒæˆæƒæœåŠ¡å™¨ä¸Šéƒ½è¦åšç»­æœŸ) å¦‚æœç¬¬ä¸‰æ–¹ç«™ç‚¹åœ¨ä½¿ç”¨access_tokenä¸ºç”¨æˆ·è·å–æˆæƒæœåŠ¡å™¨ä¸­çš„èµ„æºæ—¶, å‘ç°sessionä¸­çš„access_tokenè¿‡æœŸ, åˆ™å°±éœ€è¦ä½¿ç”¨refresh_tokenè°ƒç”¨ç”Ÿæˆaccess_tokençš„apiæ¥å£é‡æ–°ç”Ÿæˆaccess_tokenæ¥è¿›è¡Œç»­æœŸï¼› qq: è¿™æ ·ä¸‹æ¥, åŸºæœ¬ä¸Šç¬¬ä¸‰æ–¹ç«™ç‚¹åªæœ‰åœ¨å¤§äºrefresh_tokençš„è¿‡æœŸæ—¶é—´éƒ½æ²¡æœ‰è°ƒç”¨è¿‡æˆæƒæœåŠ¡å™¨çš„è¯, æ‰éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•; ç¬¬ä¸‰é˜¶æ®µ(æ¯”è¾ƒç®€å•): ç¬¬ä¸‰æ–¹ç«™ç‚¹é€šè¿‡access_tokenè·å–æˆæƒå¹³å°èµ„æºæœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·èµ„æº è·å–access_tokenåï¼Œè¿›è¡Œæ¥å£è°ƒç”¨ï¼Œæœ‰ä»¥ä¸‹å‰æï¼š access_tokenæœ‰æ•ˆä¸”æœªè¶…æ—¶ï¼› å¾®ä¿¡ç”¨æˆ·å·²æˆæƒç»™ç¬¬ä¸‰æ–¹åº”ç”¨å¸å·ç›¸åº”æ¥å£ä½œç”¨åŸŸ(scope);ä¹Ÿå°±æ˜¯åœ¨æˆæƒæœåŠ¡å™¨ä¸Šè¿˜ä¼šä½¿ç”¨access_tokenå»æ£€æµ‹å¯¹åº”çš„scopeæƒé™æ˜¯å¦æ­£ç¡®; è®¸å¤šå¼€æ”¾å¹³å°åœ¨ç”³è¯·å®Œaccess_tokenä»¤ç‰Œä¹‹å, éƒ½æä¾›äº†å¯¹åº”æ¥å£æ¥è·å–ç”¨æˆ·ç›¸å…³ä¿¡æ¯QQäº’è”æä¾›äº†ç›¸åº”çš„æ¥å£, ä½¿ç”¨Access Tokenæ¥è·å–ç”¨æˆ·çš„OpenID;æ–°æµªå¼€æ”¾å¹³å°æä¾›äº†ç›¸åº”çš„æ¥å£æ¥è·å–access_tokenå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯;è€Œå¾®ä¿¡å…¬ä¼—å¹³å°: åœ¨è·å–access_tokençš„æ—¶å€™, ä¼šåŒæ—¶è¿”å›openidè¡¨ç¤ºå¾®ä¿¡ç”¨æˆ·åœ¨æœ¬å…¬ä¼—å·ä¸­çš„å”¯ä¸€æ ‡è¯†;","categories":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/categories/OAuth2-0/"}],"tags":[{"name":"OAuth2.0","slug":"OAuth2-0","permalink":"http://blog.renyimin.com/tags/OAuth2-0/"}]},{"title":"22. åˆ†å¸ƒå¼","slug":"memcache/2016-03-12-memcache-22","date":"2016-03-12T13:30:31.000Z","updated":"2018-03-12T05:58:58.000Z","comments":true,"path":"2016/03/12/memcache/2016-03-12-memcache-22/","link":"","permalink":"http://blog.renyimin.com/2016/03/12/memcache/2016-03-12-memcache-22/","excerpt":"","text":"å‰è¨€ memcachedè™½ç„¶ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡å™¨, ä½†æœåŠ¡å™¨ç«¯å¹¶æ²¡æœ‰åˆ†å¸ƒå¼åŠŸèƒ½ã€‚æœåŠ¡å™¨ç«¯ä»…åŒ…æ‹¬å†…å­˜å­˜å‚¨åŠŸèƒ½ï¼Œå…¶å®ç°éå¸¸ç®€å•ã€‚è‡³äºå…¶åˆ†å¸ƒå¼ç‰¹æ€§ï¼Œåˆ™æ˜¯å®Œå…¨ç”±å®¢æˆ·ç«¯ç¨‹åºåº“å®ç°çš„, è¿™ç§åˆ†å¸ƒå¼æ˜¯memcachedçš„æœ€å¤§ç‰¹ç‚¹ã€‚ å¥½åœ¨phpè¯­è¨€å·²ç»åœ¨memcache/memcachedæ‰©å±•ä¸­å®ç°äº†åˆ†å¸ƒå¼ç®—æ³•, å¯ä»¥é€‚å½“çš„é…ç½®æˆ–ä½¿ç”¨æ­£ç¡®çš„å‚æ•°æ¥ä½¿ç”¨ç®—æ³•; ç†è§£Memcachedçš„åˆ†å¸ƒå¼ å‡è®¾memcachedæœåŠ¡å™¨æœ‰node1ï½node3ä¸‰å°, åº”ç”¨ç¨‹åºè¦ä¿å­˜é”®åä¸ºâ€™tokyoâ€™, â€˜beijingâ€™â€¦ç­‰çš„æ•°æ® å­˜å‚¨: è¦å‘memcachedæœåŠ¡ä¸­æ·»åŠ key, é¦–å…ˆå°±éœ€è¦å°†keyä¼ ç»™å®¢æˆ·ç«¯ç¨‹åºï¼Œç„¶åå®¢æˆ·ç«¯å®ç°çš„ç®—æ³•å°±ä¼šæ ¹æ®keyæ¥å†³å®šæ•°æ®åº”è¯¥ä¿å­˜åˆ°å“ªå°memcachedæœåŠ¡å™¨, æœåŠ¡å™¨é€‰å®šåï¼Œåˆ™ä¼šåœ¨è¯¥æœåŠ¡å™¨ä¸Šå®ƒä¿å­˜keyåŠå…¶å€¼ è·å–: è·å–ä¿å­˜çš„keyæ—¶, ä¹Ÿè¦å°†è¦keyä¼ é€’ç»™å®¢æˆ·ç«¯ç¨‹åº, å®¢æˆ·ç«¯ç¨‹åºè¦é€šè¿‡ä¸è®¾ç½®keyæ—¶ç›¸åŒçš„ç®—æ³•, æ ¹æ®keyé€‰æ‹©æœåŠ¡å™¨ã€‚ ä½¿ç”¨çš„ç®—æ³•ç›¸åŒ, å°±èƒ½é€‰ä¸­ä¸ä¿å­˜keyæ—¶ç›¸åŒçš„æœåŠ¡å™¨, ç„¶åå‘é€getå‘½ä»¤, å°±èƒ½è·å¾—ä¿å­˜çš„å€¼ è¿™æ ·åˆ†å¸ƒå¼éƒ¨ç½²å, å°±å°†ä¸€å°memcachedçš„å·¥ä½œå¹³å‡åˆ†é…ç»™å¤šä¸ªmemcacheæ¥åˆ†æ‹…, æ‰€å­˜å‚¨çš„é”®å€¼å¯¹å°±ä¼šåˆ†æ•£, å³ä½¿ä¸€å°memcachedæœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ— æ³•è¿æ¥, ä¹Ÿä¸ä¼šå½±å“å…¶ä»–çš„ç¼“å­˜æ•°æ®, ç³»ç»Ÿä¾ç„¶èƒ½ç»§ç»­è¿è¡Œã€‚ åˆ†å¸ƒå¼ç®—æ³•å–æ¨¡(å–ä½™)ç®—æ³• è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„åˆ†å¸ƒå¼ç®—æ³•, è®¡ç®—æ–¹æ³•æ¯”è¾ƒç®€å•: key%memcacheèŠ‚ç‚¹æ•°é‡ å‘ä¸Šé¢è¿™æ ·, å–æ¨¡çš„ç»“æœä¸ºå‡ , å°±æŠŠæ•°æ®ç¼“å­˜åˆ°ç¬¬å‡ å°memcachedæœåŠ¡å™¨ä¸Š, æ•°æ®çš„åˆ†æ•£æ€§ä¹Ÿç›¸å½“ä¼˜ç§€, ä½†ä¹Ÿæœ‰å…¶ç¼ºç‚¹, é‚£å°±æ˜¯å½“æ·»åŠ æˆ–è€…ç§»é™¤æœåŠ¡å™¨çš„æ—¶å€™, ç¼“å­˜é‡ç»„çš„ä»£ä»·ç›¸å½“å·¨å¤§, å› ä¸ºæ·»åŠ æœåŠ¡å™¨ä¹‹å, ä½™æ•°å°±ä¼šäº§ç”Ÿå‰§å˜, è¿™æ ·å°±æ— æ³•è·å–ä¸ä¿å­˜æ—¶ç›¸åŒçš„æœåŠ¡å™¨, ä»è€Œå½±å“ç¼“å­˜çš„å‘½ä¸­ç‡; å‡è®¾ä¸€ä¸ªèŠ‚ç‚¹æ‰çº¿, å°±ä¼šå¯¼è‡´å…¶ä»–èŠ‚ç‚¹ä¹Ÿæ— æ³•æ­£å¸¸å‘½ä¸­ å¹¶ä¸”é€šè¿‡è¿ç®—å¯ä»¥å¾—å‡º, æœåŠ¡å™¨çš„èŠ‚ç‚¹æ•°è¶Šå¤§, åœ¨å‡ºç°æ•…éšœæ—¶, åæœè¶Šä¸¥é‡, ç»“æœå°±æ˜¯ä½ ä¹°è¶Šå¤šçš„æœåŠ¡å™¨, èŠ±äº†è¶Šå¤šçš„é’±, å´é€ æˆäº†è¶Šå¤§çš„åæœ; å–æ¨¡ç®—æ³•å¾ˆä¸é€‚åˆç”¨ä½œmemcachedæœåŠ¡çš„åˆ†å¸ƒå¼ç®—æ³•; ä¸€è‡´æ€§hashç®—æ³• é¦–å…ˆæ±‚å‡ºmemcachedæœåŠ¡å™¨(èŠ‚ç‚¹)çš„å“ˆå¸Œå€¼å¹¶å°†å…¶åˆ†é…åˆ°0ï½2^32çš„åœ†(continuum)ä¸Š; ä¸€èˆ¬æƒ…å†µä¸‹å¯¹æœºå™¨çš„hashè®¡ç®—æ˜¯é‡‡ç”¨æœºå™¨çš„IPæˆ–è€…æœºå™¨å”¯ä¸€çš„åˆ«åä½œä¸ºè¾“å…¥å€¼ ç„¶åé‡‡ç”¨åŒæ ·çš„æ–¹æ³•æ±‚å‡ºå­˜å‚¨æ•°æ®çš„é”®çš„å“ˆå¸Œå€¼, å¹¶æ˜ å°„åˆ°ç›¸åŒçš„åœ†ä¸Š; ç„¶åä»æ•°æ®æ˜ å°„åˆ°çš„ä½ç½®å¼€å§‹é¡ºæ—¶é’ˆæŸ¥æ‰¾, å°†æ•°æ®ä¿å­˜åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨(èŠ‚ç‚¹)ä¸Š; å¦‚æœè¶…è¿‡2^32ä»ç„¶æ‰¾ä¸åˆ°æœåŠ¡å™¨, å°±ä¼šä¿å­˜åˆ°ç¬¬ä¸€å°memcachedæœåŠ¡å™¨ä¸Š ; å¦‚ä¸‹å›¾ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡º, å¦‚æœnode3å¤±æ•ˆ, é€ æˆçš„ç»“æœå°±æ˜¯node4åˆ°node3ä¹‹é—´çš„é”®ä¼šè·‘åˆ°node1ä¸Šå»å¯»æ‰¾, é‚£è‡ªç„¶å°±æ‰¾ä¸åˆ°äº†, ç„¶åmysqlå°±ä¼šæŠŠè¿™ä¸ªkeyå’Œå€¼é‡æ–°æŸ¥è¯¢å‡ºæ¥, å†æ¬¡å†™å…¥åˆ°node1ä¸­å³å¯;è¿™æ ·å°±åªå½±å“äº†node4åˆ°node3ä¹‹é—´çš„èŠ‚ç‚¹, åªæœ‰node4åˆ°node3ä¹‹é—´çš„èŠ‚ç‚¹éœ€è¦åˆ°æ•°æ®åº“ä¸­é‡æ–°æŸ¥è¯¢å¹¶å†™å…¥node1ä¸­, å…¶ä»–ç¼“å­˜æ•°æ®çš„æŸ¥è¯¢éƒ½æ²¡æœ‰å—åˆ°å½±å“ ;å½“ç„¶, æ·»åŠ èŠ‚ç‚¹ä¹Ÿæ˜¯ä¸€æ ·çš„, å½±å“éƒ½å¾ˆå° ; ä¸€è‡´æ€§hashåœ¨å¢åŠ /å‡å°‘ä¸€å°æœºå™¨å, å‘½ä¸­ç‡ä¸º: (N-1)/N, ä¹Ÿå°±æ˜¯ä¼šæœ‰1/NèŠ‚ç‚¹æœªå‘½ä¸­; è¿™æ ·æœåŠ¡å™¨è¶Šå¤š, åœ¨æ·»åŠ æœåŠ¡å™¨çš„æ—¶å€™, å‘½ä¸­ç‡å°±è¶Šé«˜äº† ; è™šæ‹ŸèŠ‚ç‚¹ ä¸€è‡´æ€§hashçš„å½±å“è™½ç„¶å·²ç»æ¯”å–æ¨¡åˆ†å¸ƒå¼ç®—æ³•å°å¾ˆå¤šäº†, ä½†æ˜¯ä»æœ‰ä¸€ä¸ªé—®é¢˜, é‚£å°±æ˜¯æˆ‘ä»¬å¸Œæœ›åœ¨node3ä¸¢å¤±ä¹‹å, node4-node3ä¹‹é—´çš„è¿™äº›ç¼“å­˜æ•°æ®èƒ½å¤Ÿå¹³å‡åˆ†é…åˆ°å‰©ä½™æ‰€æœ‰èŠ‚ç‚¹ä¸Š, è€Œä¸æ˜¯å…¨éƒ¨å‹åœ¨node1èŠ‚ç‚¹ä¸Š, å¯¼è‡´node1èŠ‚ç‚¹å‹åŠ›å¾ˆå¤§ï¼Œè¿™å°±å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹çš„æ¦‚å¿µ; è™šæ‹ŸèŠ‚ç‚¹(virtual node)å…¶å®å°±æ˜¯å®é™…èŠ‚ç‚¹(æœºå™¨)åœ¨hashç©ºé—´çš„å¤åˆ¶å“ ä¸€ä¸ªå®é™…èŠ‚ç‚¹(æœºå™¨)å¯¹åº”äº†è‹¥å¹²ä¸ªâ€è™šæ‹ŸèŠ‚ç‚¹â€, è¿™ä¸ªå¯¹åº”ä¸ªæ•°ä¹Ÿç§°ä¸ºâ€å¤åˆ¶ä¸ªæ•°â€ ; ä¹‹å‰ç”±äºåªéƒ¨ç½²äº†node1,node2,node3,node4å››ä¸ªå®é™…èŠ‚ç‚¹, ä¹‹å‰çš„keyåœ¨æœºå™¨ä¸Šçš„åˆ†å¸ƒå¾ˆä¸å‡è¡¡, ç°åœ¨æˆ‘ä»¬ä»¥2ä¸ªå‰¯æœ¬(å¤åˆ¶ä¸ªæ•°)ä¸ºä¾‹, è¿™æ ·æ•´ä¸ªhashç¯ä¸­å°±å­˜åœ¨äº†8ä¸ªè™šæ‹ŸèŠ‚ç‚¹è¿™æ ·, keyå°±ä¸åªæ˜¯åˆ†å¸ƒåˆ°node1,node2,node3,node4å››ä¸ªèŠ‚ç‚¹ä¸­äº†, è€Œæ˜¯ä¼šæ›´åŠ å‡åŒ€åœ°åˆ†å¸ƒåˆ°node1-1,node1-2,node2-1,node2-2,node3-1,node3-2,node4-1,node4-2è¿™å…«ä¸ªèŠ‚ç‚¹ä¸­äº† å¦‚ä¸‹å›¾, è“è‰²æœåŠ¡å™¨å®•æœºä¹‹å, åŸæœ¬åœ¨è“è‰²æœåŠ¡å™¨ä¸Šçš„keyä¼šå‡åŒ€åœ°ä¸¢ç»™å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹, è€Œå…¶ä»–é˜¶æ®µä¸ä¼šå—å½±å“ : phpå®ç°ä¸€è‡´æ€§hash123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293&lt;?phpinterface hash&#123; public function _hash($str);&#125;interface distribution&#123; public function lookUp($key); public function addNode($node); public function removeNode($node);&#125;// ä¸€è‡´æ€§hashclass Consistent implements hash, distribution&#123; // è®¾ç½®ä¸€ä¸ªèŠ‚ç‚¹ä¼šå¢åŠ 64ä¸ªè™šæ‹ŸèŠ‚ç‚¹ protected $_mul = 64; // è™šæ‹ŸèŠ‚ç‚¹çš„ä½ç½® protected $position = []; // æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆ32ä½æ— ç¬¦å·æ•´æ•° public function _hash($node) &#123; return sprintf(&apos;%u&apos;, crc32($node)); &#125; // æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ public function addNode($node) &#123; for ($i = 0; $i &lt; $this-&gt;_mul; $i++) &#123; $virtualNode = $node . &apos;-&apos; . $i; $this-&gt;position[$this-&gt;_hash($virtualNode)] = $node; &#125; // ç„¶åæ’åºè™šæ‹ŸèŠ‚ç‚¹ ksort($this-&gt;position); &#125; public function lookUp($key) &#123; $key = $this-&gt;_hash($key); // å…ˆå–åœ†ç¯ä¸Šæœ€å°çš„èŠ‚ç‚¹ä½œä¸ºç»“æœ $point = current($this-&gt;position); foreach ($this-&gt;position as $k =&gt; $val) &#123; if ($key &lt;= $k) &#123; $point = $k; break; &#125; &#125; // è¿”å›keyæ‰€åº”è¯¥å­˜æ”¾çš„ä½ç½® return $point; &#125; public function getNodes() &#123; echo &apos;&lt;pre/&gt;&apos;; print_r($this-&gt;position); &#125; public function removeNode($node) &#123; foreach ($this-&gt;position as $k =&gt; $v) &#123; if ($v == $node) &#123; unset($this-&gt;position[$k]); &#125; &#125; &#125;&#125;$c = new Consistent();$c-&gt;addNode(&apos;a&apos;);$c-&gt;addNode(&apos;b&apos;);$c-&gt;addNode(&apos;c&apos;);$c-&gt;getNodes();echo $c-&gt;_hash(&apos;title&apos;), &apos;&lt;br/&gt;&apos;;echo $c-&gt;lookUp(&apos;title&apos;);$c-&gt;removeNode(&apos;b&apos;);$c-&gt;getNodes();/*$m = new Moder();$m-&gt;addNode(&apos;a&apos;);$m-&gt;addNode(&apos;b&apos;);$m-&gt;addNode(&apos;c&apos;);$m-&gt;getNodes();echo $m-&gt;lookup(&apos;a&apos;);echo $m-&gt;lookup(&apos;b&apos;);echo $m-&gt;lookup(&apos;c&apos;);*/ ä½¿ç”¨memcacheæ‰©å±•çš„ä¸€è‡´æ€§ç®—æ³•å¯ä»¥åœ¨php.iniä¸­é…ç½® : 1234[Memcache] Memcache.allow_failover = 1 Memcache.hash_strategy =consistent Memcache.hash_function =crc32 ä¹Ÿå¯ä»¥åŠ¨æ€é…ç½® : 12ini_set(&apos;memcache.hash_function&apos;,&apos;crc32&apos;);ini_set(&apos;memcache.hash_strategy&apos;,&apos;consistent&apos;); // standardä¸ºå–æ¨¡åˆ†å¸ƒå¼ç®—æ³•","categories":[{"name":"memcached","slug":"memcached","permalink":"http://blog.renyimin.com/categories/memcached/"}],"tags":[{"name":"memcached","slug":"memcached","permalink":"http://blog.renyimin.com/tags/memcached/"}]},{"title":"è®©Jsonæ›´æ‡‚ä¸­æ–‡(JSON_UNESCAPED_UNICODE)","slug":"PHP/2016-03-11-json","date":"2016-03-11T03:43:54.000Z","updated":"2018-03-14T01:45:01.000Z","comments":true,"path":"2016/03/11/PHP/2016-03-11-json/","link":"","permalink":"http://blog.renyimin.com/2016/03/11/PHP/2016-03-11-json/","excerpt":"","text":"å½“jsonä¸­æœ‰ä¸­æ–‡æ—¶ 1234567$data = [ &apos;name&apos; =&gt; &apos;ä»»ç›Šæ°‘&apos;, &apos;age&apos; =&gt; &apos;20&apos;, &apos;gender&apos; =&gt; &apos;ç”·&apos;];return json_encode($data);// ç»“æœè¿”å› &#123;&quot;name&quot;:&quot;\\u4efb\\u76ca\\u6c11&quot;,&quot;age&quot;:&quot;20&quot;,&quot;gender&quot;:&quot;\\u7537&quot;&#125; ä¸ºäº†è®©jsonæ›´æ‡‚ä¸­æ–‡, PHP5.4, Jsonæ–°å¢äº†ä¸€ä¸ªé€‰é¡¹: JSON_UNESCAPED_UNICODE, æ•…åæ€è®®, å°±æ˜¯è¯´, Jsonä¸è¦ç¼–ç Unicode 1234567$data = [ &apos;name&apos; =&gt; &apos;ä»»ç›Šæ°‘&apos;, &apos;age&apos; =&gt; &apos;20&apos;, &apos;gender&apos; =&gt; &apos;ç”·&apos;];return json_encode($data, JSON_UNESCAPED_UNICODE);// ç»“æœè¿”å› &#123;&quot;name&quot;:&quot;ä»»ç›Šæ°‘&quot;,&quot;age&quot;:&quot;20&quot;,&quot;gender&quot;:&quot;ç”·&quot;&#125; å‚è€ƒ: é¸Ÿå“¥","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]},{"title":"21. è¿‡æœŸæ•°æ®åˆ é™¤æœºåˆ¶","slug":"memcache/2016-03-10-memcache-21","date":"2016-03-10T11:21:31.000Z","updated":"2018-03-12T05:10:31.000Z","comments":true,"path":"2016/03/10/memcache/2016-03-10-memcache-21/","link":"","permalink":"http://blog.renyimin.com/2016/03/10/memcache/2016-03-10-memcache-21/","excerpt":"","text":"åœ¨memcachedä¸­, å½“æŸä¸ªkeyè¿‡æœŸ, æˆ–è€…è¢«åˆ é™¤ä¹‹å, è¿™ä¸ªkeyå¹¶ä¸ä¼šç«‹å³ä»å†…å­˜ä¸­åˆ é™¤, è€Œæ˜¯ å½“æŸä¸ªæ–°çš„keyå»å ç”¨å®ƒçš„chunkæ—¶, å®ƒçš„chunkå°±ä¼šè¢«å½“æˆç©ºçš„; å½“ä½ å†æ¬¡getè¿™ä¸ªkeyæ—¶, æ‰ä¼šè¿›è¡Œåˆ é™¤; ä¸Šé¢è¿™ç§æœºåˆ¶å« lazy expiration æƒ°æ€§å¤±æ•ˆ LRU : memcacheåœ¨è®¾ç½®æ–°çš„keyæ—¶, æˆ–ä¼˜å…ˆä½¿ç”¨å·²ç»è¶…æ—¶çš„keyçš„chunkç©ºé—´, ä½†å³ä½¿å¦‚æ­¤, ä¹Ÿä¼šå‘ç”Ÿç©ºé—´ä¸è¶³çš„æƒ…å†µ; æ­¤æ—¶ä¼šä½¿ç”¨ Leasr Recently Used(LRU æœ€è¿‘æœ€å°‘ä½¿ç”¨)æœºåˆ¶æ¥åˆ†é…ç©ºé—´, å°†æœ€è¿‘æœªè¢«ä½¿ç”¨çš„è®°å½•çš„ç©ºé—´åˆ†é…ç»™æ–°çš„key; æ³¨æ„: å³ä½¿æŸä¸ªkeyè®¾ç½®çš„æ˜¯æ°¸ä¹…æœ‰æ•ˆ, ä¹Ÿä¸€æ ·æœ‰å¯èƒ½è¢«è¸¢å‡º;","categories":[{"name":"memcached","slug":"memcached","permalink":"http://blog.renyimin.com/categories/memcached/"}],"tags":[{"name":"memcached","slug":"memcached","permalink":"http://blog.renyimin.com/tags/memcached/"}]},{"title":"20. ç®€ä»‹slab allocatorå†…å­˜åˆ†é…æœºåˆ¶","slug":"memcache/2016-03-10-memcache-20","date":"2016-03-10T10:51:28.000Z","updated":"2018-03-12T05:01:07.000Z","comments":true,"path":"2016/03/10/memcache/2016-03-10-memcache-20/","link":"","permalink":"http://blog.renyimin.com/2016/03/10/memcache/2016-03-10-memcache-20/","excerpt":"","text":"åœ¨memcachedä¸­, ä¸ºäº†ç¼“è§£ å†…å­˜ç¢ç‰‡åŒ– çš„é—®é¢˜, ä½¿ç”¨äº† slab allocator æœºåˆ¶æ¥ç®¡ç†å†…å­˜; slab allocatorçš„åŸç†æ¯”è¾ƒç®€å• æŒ‰ç…§é¢„å…ˆè§„å®šçš„å¤§å°, å°†åˆ†é…çš„å†…å­˜åˆ†å‰²æˆç‰¹å®šé•¿åº¦çš„å—(chunk) å¹¶æŠŠå°ºå¯¸ç›¸åŒçš„å—åˆ†æˆç»„ (slab) éœ€è¦å­˜å†…å®¹æ—¶, memcacheä¼šæ ¹æ®å†…å®¹çš„å¤§å°, ä¸ºå…¶é€‰æ‹©åˆç†çš„slab ä»åŸç†å¯ä»¥çœ‹å‡º, slab allocator æœºåˆ¶å…¶å®ä¾ç„¶æ˜¯æ— æ³•å®Œå…¨è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜çš„, åªæ˜¯ç¼“è§£äº†é—®é¢˜ å› ä¸ºslabä¸­çš„ä¸€ä¸ªä¸ªchunckçš„å¤§å°éƒ½æ˜¯å›ºå®šçš„, å¦‚æœé¢„å…ˆåˆ†å‰²çš„chunkä¹‹é—´å¤§å°å·®è·è¿‡å¤§, åˆ™éš¾å…ä¼šæœ‰æµªè´¹; å¢é•¿å› å­Grow factor åº”è¯¥è§‚å¯Ÿç¼“å­˜æ•°æ®å¤§å°çš„å˜åŒ–è§„å¾‹, è®¾ç½®åˆç†çš„å¢é•¿å› å­Grow factor, é»˜è®¤æ˜¯1.25å€, å¯ä»¥æ ¹æ®è‡ªå·±ç½‘ç«™ç¼“å­˜çš„å¤§å°æ¥è°ƒæ•´æ¯”ä¾‹å› å­; åœ¨å¯åŠ¨memcachedæœåŠ¡å™¨çš„æ—¶å€™, ç¡®å®å¯ä»¥çœ‹åˆ°slabå’Œchunckçš„æ¦‚å¿µå¯ä»¥çœ‹åˆ°æ¯ç§chunckä¹‹é—´çš„æ¯”ä¾‹å·®ä¸å¤šå°±æ˜¯åœ¨1.25å€å·¦å³(æ‰€ä»¥å¢é•¿å› å­åˆ«è®¾ç½®çš„å¤ªå¤§äº†, å°±å¥½æ¯”, å°ç¢—åƒç±³å¤ªå°‘, ç„¶åæ‹¿äº†ä¸ªæ¡¶åˆå¤ªå¤§, å› æ­¤åº”è¯¥æ‹¿ä¸ªç¨å¾®å¤§çš„ç¢—, æ¯”ä¾‹ä¸è¦å¢é•¿çš„å¤ªå¤§) å¯ä»¥åœ¨å¯åŠ¨æ—¶, é€šè¿‡ -f å‚æ•°æ¥è®¾ç½®å¢é•¿å› å­","categories":[{"name":"memcached","slug":"memcached","permalink":"http://blog.renyimin.com/categories/memcached/"}],"tags":[{"name":"memcached","slug":"memcached","permalink":"http://blog.renyimin.com/tags/memcached/"}]},{"title":"Output Control é™æ€åŒ–åŸç†","slug":"PHP/2015-07-15-output-control","date":"2015-08-21T11:51:23.000Z","updated":"2018-03-16T02:44:47.000Z","comments":true,"path":"2015/08/21/PHP/2015-07-15-output-control/","link":"","permalink":"http://blog.renyimin.com/2015/08/21/PHP/2015-07-15-output-control/","excerpt":"","text":"ä½¿ç”¨è¾“å‡ºç¼“å†²æ§åˆ¶ä¸­çš„å‡½æ•°ä¸éœ€è¦å®‰è£…ä»»ä½•æ‰©å±•ï¼Œå®ƒä»¬æ˜¯PHPæ ¸å¿ƒçš„ä¸€éƒ¨åˆ†; php.inié…ç½®è¾“å‡ºç¼“å†²æ§åˆ¶ä¸­çš„å‡½æ•°, å®ƒä»¬çš„è¡Œä¸ºå— php.ini é…ç½®çš„å½±å“ output_buffering è¯¥é€‰é¡¹è®¾ç½®ä¸º On æ—¶, å°†åœ¨æ‰€æœ‰çš„è„šæœ¬ä¸­ä½¿ç”¨è¾“å‡ºæ§åˆ¶; å¦‚æœè¦é™åˆ¶è¾“å‡ºç¼“å†²åŒºçš„æœ€å¤§å€¼, å¯å°†è¯¥é€‰é¡¹è®¾å®šä¸ºæŒ‡å®šçš„æœ€å¤§å­—èŠ‚æ•°(ä¾‹å¦‚: output_buffering=4096); ä»PHP 4.3.5 ç‰ˆå¼€å§‹ï¼Œè¯¥é€‰é¡¹åœ¨PHP-CLIä¸‹æ€»æ˜¯ä¸ºOff; output_handlerè¯¥é€‰é¡¹å¯å°†è„šæœ¬æ‰€æœ‰çš„è¾“å‡º, é‡å®šå‘åˆ°ä¸€ä¸ªå‡½æ•°; implicit_flush é»˜è®¤ä¸ºFALSE, å¦‚å°†è¯¥é€‰é¡¹æ”¹ä¸ºTRUE, PHPå°†ä½¿è¾“å‡ºå±‚åœ¨æ¯æ®µä¿¡æ¯å—è¾“å‡ºå, è‡ªåŠ¨åˆ·æ–°; è¿™ç­‰åŒäºåœ¨æ¯æ¬¡ä½¿ç”¨print, echo, include ç­‰å‡½æ•°ä¹‹å, è‡ªåŠ¨è°ƒç”¨äº†PHPä¸­çš„ flush() å‡½æ•°; ä¸åœ¨webç¯å¢ƒä¸­ä½¿ç”¨PHPæ—¶, æ‰“å¼€è¿™ä¸ªé€‰é¡¹å¯¹ç¨‹åºæ‰§è¡Œçš„æ€§èƒ½æœ‰ä¸¥é‡çš„å½±å“, é€šå¸¸åªæ¨èåœ¨è°ƒè¯•æ—¶ä½¿ç”¨ã€‚åœ¨ CLI SAPI çš„æ‰§è¡Œæ¨¡å¼ä¸‹, è¯¥æ ‡è®°é»˜è®¤ä¸º TRUE; Output Control å¸¸ç”¨å‡½æ•°ob_startbool ob_start ([ callback $output_callback [, int $chunk_size [, bool $erase ]]] ) : æ­¤å‡½æ•°å°†æ‰“å¼€è¾“å‡ºç¼“å†² (å¯ä»¥å¤šæ¬¡æ‰“å¼€, ç›¸å½“äºåµŒå¥—è¾“å‡ºç¼“å†²åŒº);å½“è¾“å‡ºç¼“å†²æ¿€æ´»å, è„šæœ¬å°†ä¸ä¼šè¾“å‡ºå†…å®¹(é™¤httpæ ‡å¤´å¤–), ç›¸åéœ€è¦è¾“å‡ºçš„å†…å®¹è¢«å­˜å‚¨åœ¨ å†…éƒ¨ç¼“å†²åŒºä¸­;ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ ob_start() ç›´æ¥æ‰“å¼€å†…éƒ¨è¾“å‡ºç¼“å†²åŒº; å¦‚æœæ¶‰åŠå‚æ•°éƒ¨åˆ†, åˆ°æ—¶å†è¿›è¡Œè¡¥å…… ob_get_level int ob_get_level ( void ) : è¿”å›è¾“å‡ºç¼“å†²æœºåˆ¶çš„åµŒå¥—çº§åˆ«, å¦‚æœæ²¡æœ‰å¼€å¯ç¼“å†²åŒº, æˆ–ç¼“å†²åŒºå·²è¢«å…³é—­, åˆ™è¿”å›é›¶; Demo: 1234567891011121314&lt;?php&lt;?phpvar_dump(ob_get_level()); //0ob_start();ob_start();var_dump(ob_get_level()); //2ob_start();var_dump(ob_get_level()); //3ob_end_flush();var_dump(ob_get_level()); //2ob_end_flush();var_dump(ob_get_level()); //1ob_end_flush();var_dump(ob_get_level()); //0 ob_get_length int ob_get_length ( void ): è¿”å›è¾“å‡ºç¼“å†²åŒºå†…å®¹çš„é•¿åº¦, å¦‚æœæ²¡æœ‰å¼€å¯ç¼“å†²åŒº, æˆ–ç¼“å†²åŒºå·²è¢«å…³é—­, åˆ™è¿”å›FALSE; demo 12345&lt;?phpob_start();echo 123 . &apos;ä»»ç›Šæ°‘&apos;;$a = ob_get_length();var_dump($a); // 12 ob_get_contentsstring ob_get_contents ( void ): è·å–è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹ (åªæ˜¯å¾—åˆ°è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹); å¦‚æœæ²¡æœ‰å¼€å¯ç¼“å†²åŒº, æˆ–ç¼“å†²åŒºå·²è¢«å…³é—­, åˆ™è¿”å›FALSE; ob_end_flushbool ob_end_flush ( void ) : å†²åˆ·å‡º(é€å‡º)è¾“å‡ºç¼“å†²åŒºå†…å®¹, å¹¶å…³é—­ç¼“å†²;å¦‚æœæƒ³è¿›ä¸€æ­¥å¤„ç†ç¼“å†²åŒºä¸­çš„å†…å®¹, å¿…é¡»åœ¨ob_end_flush()ä¹‹å‰è°ƒç”¨ob_get_contents() ob_end_cleanbool ob_end_clean ( void ) : æ¸…ç©º(æ“¦é™¤)ç¼“å†²åŒºå¹¶å…³é—­è¾“å‡ºç¼“å†²;å¦‚æœæƒ³è¿›ä¸€æ­¥å¤„ç†ç¼“å†²åŒºä¸­çš„å†…å®¹, å¿…é¡»åœ¨ob_end_clean()ä¹‹å‰è°ƒç”¨ob_get_contents() ob_flushvoid ob_flush ( void ) : å†²åˆ·å‡º(é€å‡º)è¾“å‡ºç¼“å†²åŒºä¸­çš„å†…å®¹, ä¸ ob_end_flush ç›¸æ¯”, å®ƒä¸ä¼šå…³é—­ç¼“å†²åŒº ob_cleanvoid ob_clean ( void ) : æ¸…ç©º(æ“¦æ‰)è¾“å‡ºç¼“å†²åŒº, ä¸ ob_end_clean() ç›¸æ¯”, å®ƒä¸ä¼šå…³é—­ç¼“å†²åŒº ob_get_cleanstring ob_get_clean ( void ): å¾—åˆ°å½“å‰ç¼“å†²åŒºçš„å†…å®¹ï¼Œ å¹¶æ¸…ç©ºå½“å‰è¾“å‡ºç¼“å†²åŒº, å¹¶ä¸”ä¼šå…³é—­ç¼“å†²åŒº; (æ‰‹å†Œè¯´é”™äº†, å·²æœ‰äººåœ¨æ‰‹å†ŒæŒ‡å‡º) ob_get_clean() å®è´¨ä¸Šæ˜¯ä¸€èµ·æ‰§è¡Œäº† ob_get_contents() å’Œ ob_end_clean(); å¦‚æœæ²¡æœ‰å¼€å¯ç¼“å†²åŒº, æˆ–ç¼“å†²åŒºå·²è¢«å…³é—­, åˆ™è¿”å›FALSE; ob_get_flushstring ob_get_flush ( void ): å¾—åˆ°å½“å‰ç¼“å†²åŒºçš„å†…å®¹, å¹¶ç›´æ¥åˆ·å‡º(é€å‡º)ç¼“å†²åŒº, æœ€åå…³é—­è¾“å‡ºç¼“å†²åŒº;å¦‚æœè¾“å‡ºç¼“å†²åŒºä¸æ˜¯æ´»è·ƒçš„(æœªå¼€å¯), åˆ™è¿”å› FALSE; ob_implicit_flush ob_implicit_flush : æ‰“å¼€/å…³é—­ç»å¯¹(éšå¼)åˆ·é€, ä¹‹å‰åœ¨æåˆ°pnp.iniçš„é…ç½®æ—¶, å·²ç»æåˆ°è¿‡; ç»å¯¹(éšå¼)åˆ·é€: å°†å¯¼è‡´åœ¨æ¯æ¬¡è¾“å‡ºè°ƒç”¨åæœ‰ä¸€æ¬¡åˆ·é€æ“ä½œ, ä»¥ä¾¿ä¸å†éœ€è¦å¯¹ flush() çš„æ˜¾å¼è°ƒç”¨; ä¹Ÿå°±æ˜¯, æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„ ob_flush, ob_get_flush, ob_end_flush å‡½æ•°åªæ˜¯å°†è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹åˆ·å‡ºPHPç¼“å†²; è€Œè¦æƒ³ç«‹å³åˆ·åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨, åˆ™è¿˜éœ€è¦ä½¿ç”¨ flush(); ob_flush å’Œ flushå…¶å®è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«ç½‘ä¸Šæœ‰å¾ˆå¤šè¯´æ˜, ä¸è¿‡å¯èƒ½ä¼šç”±äºApache, Nginxçš„é…ç½®å½±å“, åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¸æ‰‹å†Œæè¿°ä¸ç¬¦çš„ç°è±¡;ä¸ªäººæ„Ÿè§‰é‡ç‚¹æ˜¯é¢†ä¼šå³å¯; é¡µé¢é™æ€åŒ–åŸç†ä¸ä½¿ç”¨obå‡½æ•°è¿›è¡Œé™æ€åŒ–é€šè¿‡ç®€å•çš„æ¨¡æ¿ç¼–è¯‘æ¡ˆä¾‹æ¥äº†è§£ è°ƒç”¨æ¨¡æ¿ç¼–è¯‘ç±» assign() æ–¹æ³•, æŠŠå³å°†å¡«å……åˆ°æ¨¡æ¿ä¸­çš„å˜é‡assignåˆ°æ¨¡æ¿ç¼–è¯‘ç±»ä¸­; è°ƒç”¨æ¨¡æ¿ç¼–è¯‘ç±» display() æ–¹æ³•, æŒ‡å®šæ¨¡æ¿çš„è·¯å¾„; display()æ–¹æ³•è°ƒç”¨æ¨¡æ¿ç¼–è¯‘ç±»ä¸­çš„ complie() ç¼–è¯‘æ–¹æ³•, å¹¶ä¼ å…¥æ¨¡æ¿è·¯å¾„; complie()ä¸­file_get_contents()è¯»å–æ¨¡æ¿çš„å†…å®¹ complie()è·å–assignè¿›æ¥çš„å˜é‡, ä¸æ¨¡æ¿å†…å®¹è¿›è¡Œæ›¿æ¢æ•´åˆ, å¾—åˆ°ç¼–è¯‘åçš„å†…å®¹; // æ£€æŸ¥ç¼–è¯‘åçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶åšè¿‡æœŸè¡Œæ£€æµ‹, å¦‚æœç¼–è¯‘åçš„é™æ€æ–‡ä»¶æ²¡æœ‰è¿‡æœŸ, ç›´æ¥è¿”å›é™æ€æ–‡ä»¶, å¦‚æœè¿‡æœŸ, åˆ™é‡æ–°è¿›è¡Œç¼–è¯‘å¹¶ç”Ÿæˆç¼–è¯‘æ–‡ä»¶ file_put_content() æœ€ç»ˆå°†ç¼–è¯‘å¥½çš„å†…å®¹ç”Ÿæˆç¼–è¯‘æ–‡ä»¶; æœ€åå°†æ–‡ä»¶è·¯å¾„è¿”å›ç»™display()æ–¹æ³•; æœ€ådisplay()æ–¹æ³•ç›´æ¥ include è¯¥æ–‡ä»¶å³å¯; demo 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?php// ç®€åŒ–ç¼–è¯‘ç±»class EasyComplie&#123; // æ¨¡æ¿è·¯å¾„ public $template_dir = &apos;&apos;; // ç¼–è¯‘åçš„é™æ€æ–‡ä»¶è·¯å¾„ public $compile_dir = &apos;&apos;; // æ¥æ”¶assignçš„å˜é‡ public $arr; public function compile($template) &#123; $templateFile = $this-&gt;template_dir . &apos;/&apos; . $template; $compileFile = $this-&gt;compile_dir . &apos;/&apos; . $template . &apos;.php&apos;; if (file_exists($compileFile) &amp;&amp; filemtime($templateFile) &lt; filemtime($compileFile)) &#123; return $compileFile; &#125; else &#123; //è¯»å–æ¨¡æ¿çš„å†…å®¹ $con = file_get_contents($templateFile); // ç¼–è¯‘, æ¯”å¦‚ str_replace() è¿›è¡Œæ›¿æ¢ $res = $con; // å‡è®¾æ‹¿åˆ°äº†æ›¿æ¢åçš„å†…å®¹ //ä¿å­˜, $compileFile æ˜¯ç¼–è¯‘æ–‡ä»¶çš„è·¯å¾„ file_put_contents($compileFile, $res); // æœ€ç»ˆè¿”å›è·¯å¾„ return $compileFile; &#125; &#125; public function display($template) &#123; $path = $this-&gt;compile($template); include($path); &#125; public function assign($k, $v) &#123; $this-&gt;arr[$k] = $v; return $this-&gt;arr; &#125;&#125; å°ç»“å¯ä»¥çœ‹åˆ°, ä¸Šé¢å¹¶æ²¡æœ‰ä½¿ç”¨obç³»åˆ—å‡½æ•°, å°±å¯ä»¥å®ç°é¡µé¢é™æ€åŒ–; ä½¿ç”¨obç¼“å­˜å®ç°é™æ€åŒ– è°ƒç”¨æ¨¡æ¿ç¼–è¯‘ç±» assign() æ–¹æ³•, æŠŠå³å°†å¡«å……åˆ°æ¨¡æ¿ä¸­çš„å˜é‡assignåˆ°æ¨¡æ¿ç¼–è¯‘ç±»ä¸­; è°ƒç”¨æ¨¡æ¿ç¼–è¯‘ç±» display() æ–¹æ³•, æŒ‡å®šæ¨¡æ¿çš„è·¯å¾„; display()æ–¹æ³•è°ƒç”¨æ¨¡æ¿ç¼–è¯‘ç±»ä¸­çš„ complie() ç¼–è¯‘æ–¹æ³•, å¹¶ä¼ å…¥æ¨¡æ¿è·¯å¾„; complie()ä¸­å…ˆå¼€å¯ob_start(), ç„¶åå¯ä»¥include()ç›´æ¥å°†æ¨¡æ¿å†…å®¹æ”¾å…¥è¾“å‡ºç¼“å­˜åŒº ob_get_contents è·å–è¾“å‡ºç¼“å­˜åŒºä¸­çš„æ¨¡æ¿å†…å®¹ complie()è·å–assignè¿›æ¥çš„å˜é‡, ä¸æ¨¡æ¿å†…å®¹è¿›è¡Œæ›¿æ¢æ•´åˆ, å¾—åˆ°ç¼–è¯‘åçš„å†…å®¹;// æ£€æŸ¥ç¼–è¯‘åçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¹¶åšè¿‡æœŸè¡Œæ£€æµ‹, å¦‚æœç¼–è¯‘åçš„é™æ€æ–‡ä»¶æ²¡æœ‰è¿‡æœŸ, ç›´æ¥è¿”å›é™æ€æ–‡ä»¶, å¦‚æœè¿‡æœŸ, åˆ™é‡æ–°è¿›è¡Œç¼–è¯‘å¹¶ç”Ÿæˆç¼–è¯‘æ–‡ä»¶ file_put_content() æœ€ç»ˆå°†ç¼–è¯‘å¥½çš„å†…å®¹ç”Ÿæˆç¼–è¯‘æ–‡ä»¶; ob_end_clean() æ¸…ç©ºå¹¶å…³é—­è¾“å‡ºç¼“å†²; (æˆ–è€…ç›´æ¥éƒ½æ²¡æœ‰ä¸‹é¢çš„æ­¥éª¤äº†, ç›´æ¥ob_end_flushå°†å†…å®¹è¾“å‡ºå¹¶å…³é—­ç¼“å†²) æœ€åå°†æ–‡ä»¶è·¯å¾„è¿”å›ç»™display()æ–¹æ³•; æœ€ådisplay()æ–¹æ³•ç›´æ¥ include è¯¥æ–‡ä»¶å³å¯; Demo: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&lt;?php// ç®€åŒ–ç¼–è¯‘ç±»class EasyComplie&#123; // æ¨¡æ¿è·¯å¾„ public $template_dir = &apos;&apos;; // ç¼–è¯‘åçš„é™æ€æ–‡ä»¶è·¯å¾„ public $compile_dir = &apos;&apos;; // æ¥æ”¶assignçš„å˜é‡ public $arr; public function compile($template) &#123; $templateFile = $this-&gt;template_dir . &apos;/&apos; . $template; $compileFile = $this-&gt;compile_dir . &apos;/&apos; . $template . &apos;.php&apos;; if (file_exists($compileFile) &amp;&amp; filemtime($templateFile) &lt; filemtime($compileFile)) &#123; return $compileFile; &#125; else &#123; ob_start(); include($templateFile); $con = ob_get_contents(); // ç¼–è¯‘, æ¯”å¦‚ str_replace() è¿›è¡Œæ›¿æ¢ $res = $con; // å‡è®¾æ‹¿åˆ°äº†æ›¿æ¢åçš„å†…å®¹ //ä¿å­˜, $compileFile æ˜¯ç¼–è¯‘æ–‡ä»¶çš„è·¯å¾„ file_put_contents($compileFile, $res); // æ¥ä¸‹æ¥ç›´æ¥å…³é—­å¹¶æ¸…ç©ºè¾“å‡ºç¼“å†² ob_end_clean(); // æœ€ç»ˆè¿”å›è·¯å¾„ return $compileFile; // æ¥ä¸‹æ¥ç›´æ¥å…³é—­è¾“å‡ºç¼“å†²å¹¶ç›´æ¥è¿›è¡Œè¾“å‡º // ob_end_flush(); // flush(); &#125; &#125; public function display($template) &#123; $path = $this-&gt;compile($template); include($path); &#125; public function assign($k, $v) &#123; $this-&gt;arr[$k] = $v; return $this-&gt;arr; &#125;&#125;","categories":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/categories/PHP/"}],"tags":[{"name":"PHP","slug":"PHP","permalink":"http://blog.renyimin.com/tags/PHP/"}]}]}
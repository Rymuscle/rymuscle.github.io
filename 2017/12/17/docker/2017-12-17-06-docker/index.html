<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件 | Rymuscle&#39;s</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Docker,Docker 入门">
    <meta name="description" content="容器中管理数据主要有两种方式：数据卷(Volumes) 和 挂载主机目录(Bind mounts) 数据卷(Volumes)简介 数据卷 是一个可供一个或多个容器使用的特殊目录, 它绕过UFS, 可以提供很多有用的特性:  数据卷可以在容器之间共享和重用 对数据卷的修改会立马生效 对数据卷的更新,不会影响镜像 数据卷默认会一直存在, 即使容器被删除   注意: 数据卷的使用, 类似于 Linux">
<meta name="keywords" content="Docker,Docker 入门">
<meta property="og:type" content="article">
<meta property="og:title" content="06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录&#x2F;文件">
<meta property="og:url" content="http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/index.html">
<meta property="og:site_name" content="Rymuscle&#39;s">
<meta property="og:description" content="容器中管理数据主要有两种方式：数据卷(Volumes) 和 挂载主机目录(Bind mounts) 数据卷(Volumes)简介 数据卷 是一个可供一个或多个容器使用的特殊目录, 它绕过UFS, 可以提供很多有用的特性:  数据卷可以在容器之间共享和重用 对数据卷的修改会立马生效 对数据卷的更新,不会影响镜像 数据卷默认会一直存在, 即使容器被删除   注意: 数据卷的使用, 类似于 Linux">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.renyimin.com/img/docker/volume-01.png">
<meta property="og:updated_time" content="2018-08-06T02:24:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录&#x2F;文件">
<meta name="twitter:description" content="容器中管理数据主要有两种方式：数据卷(Volumes) 和 挂载主机目录(Bind mounts) 数据卷(Volumes)简介 数据卷 是一个可供一个或多个容器使用的特殊目录, 它绕过UFS, 可以提供很多有用的特性:  数据卷可以在容器之间共享和重用 对数据卷的修改会立马生效 对数据卷的更新,不会影响镜像 数据卷默认会一直存在, 即使容器被删除   注意: 数据卷的使用, 类似于 Linux">
<meta name="twitter:image" content="http://blog.renyimin.com/img/docker/volume-01.png">
    
        <link rel="alternate" type="application/atom+xml" title="Rymuscle&#39;s" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.13">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand4.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Rymuscle</h5>
          <a href="mailto:18625036504@163.com" title="18625036504@163.com" class="mail">18625036504@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/rymuscle" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h5 class="subtitle">
            
                <time datetime="2017-12-17T07:30:21.000Z" itemprop="datePublished" class="page-time">
  2017-12-17
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Docker/">Docker</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据卷-Volumes"><span class="post-toc-number">1.</span> <span class="post-toc-text">数据卷(Volumes)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据卷操作"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">数据卷操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#启动容器时挂载数据卷"><span class="post-toc-number">2.</span> <span class="post-toc-text">启动容器时挂载数据卷</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#挂载主机目录-文件"><span class="post-toc-number">3.</span> <span class="post-toc-text">挂载主机目录/文件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据卷挂载的问题"><span class="post-toc-number">4.</span> <span class="post-toc-text">数据卷挂载的问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#docker-cp-命令"><span class="post-toc-number">5.</span> <span class="post-toc-text">docker cp 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#启动nginx容器"><span class="post-toc-number">6.</span> <span class="post-toc-text">启动nginx容器</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-docker/2017-12-17-06-docker"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-12-17 15:30:21" datetime="2017-12-17T07:30:21.000Z"  itemprop="datePublished">2017-12-17</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Docker/">Docker</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>容器中管理数据主要有两种方式：<strong>数据卷(Volumes)</strong> 和 <strong>挂载主机目录(Bind mounts)</strong></p>
<h2 id="数据卷-Volumes"><a href="#数据卷-Volumes" class="headerlink" title="数据卷(Volumes)"></a>数据卷(Volumes)</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ol>
<li><p>数据卷 是一个可供<strong>一个或多个</strong>容器使用的特殊目录, 它绕过UFS, 可以提供很多有用的特性:</p>
<ul>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改会立马生效</li>
<li>对数据卷的更新,不会影响镜像</li>
<li>数据卷默认会一直存在, 即使容器被删除</li>
</ul>
</li>
<li><p>注意: 数据卷的使用, 类似于 Linux 下对目录或文件进行 <code>mount</code>, 镜像中被指定为挂载点的目录中的文件会隐藏掉, 能显示看的是挂载的数据卷;</p>
</li>
</ol>
<h3 id="数据卷操作"><a href="#数据卷操作" class="headerlink" title="数据卷操作"></a>数据卷操作</h3><ol>
<li><p>创建一个数据卷: <code>docker volume create my-vol</code> (其实还有一种方式就是在docker run的时候直接指定一个数据卷名, 就会自动帮你创建数据卷)</p>
</li>
<li><p>查看所有数据卷: <code>docker volume ls</code></p>
</li>
<li><p>查看指定数据卷的信息: <code>docker volume inspect my-vol</code><br> 查看容器的数据卷挂载信息: <code>docker inspect 容器名</code></p>
</li>
<li><p>删除数据卷 <code>$ docker volume rm my-vol</code></p>
<ul>
<li>数据卷 是被设计用来<strong>持久化</strong>数据的, 它的生命周期独立于容器, Docker不会在容器被删除后自动删除数据卷, 并且<strong>也不存在垃圾回收这样的机制来处理没有任何容器引用的数据卷</strong>;</li>
<li>如果需要在删除容器的同时移除数据卷, 可以在删除容器的时候使用 <code>docker rm -v</code> 这个命令, <strong>这个命令貌似只是移除该容器和数据卷之间的关系</strong>, 除非这个数据卷没有任何容器引用了, 才可以使用下面介绍的命令来删除掉;</li>
</ul>
</li>
<li><p><strong>无主的数据卷</strong>可能会占据很多空间，要清理请使用命令 <code>$ docker volume prune</code></p>
<ul>
<li>可以看到清除时会提醒你 <code>WARNING! This will remove all volumes not used by at least one container</code></li>
<li>清除的是没有被<strong>至少一个</strong>容器使用的数据卷!</li>
</ul>
</li>
</ol>
<h2 id="启动容器时挂载数据卷"><a href="#启动容器时挂载数据卷" class="headerlink" title="启动容器时挂载数据卷"></a>启动容器时挂载数据卷</h2><ol>
<li><p>在使用 <code>docker run</code> 命令的时候, 还可以使用 <code>--mount</code> 参数来将 <code>数据卷</code> 挂载到容器里, 另外, 在一次 <code>docker run</code> 中可以挂载多个数据卷</p>
</li>
<li><p>下面创建一个名为 <code>nginx_conf</code> 的数据卷</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:~ renyimin$ docker volume create nginx-default-html-root</div><div class="line">nginx-default-html-root</div><div class="line">renyimindeMacBook-Pro:~ renyimin$ docker volume inspect nginx-default-html-root</div><div class="line">[</div><div class="line">    &#123;</div><div class="line">        &quot;CreatedAt&quot;: &quot;2017-12-17T08:28:10Z&quot;,</div><div class="line">        &quot;Driver&quot;: &quot;local&quot;,</div><div class="line">        &quot;Labels&quot;: &#123;&#125;,</div><div class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/nginx-default-html-root/_data&quot;,</div><div class="line">        &quot;Name&quot;: &quot;nginx-default-html-root&quot;,</div><div class="line">        &quot;Options&quot;: &#123;&#125;,</div><div class="line">        &quot;Scope&quot;: &quot;local&quot;</div><div class="line">    &#125;</div><div class="line">]</div><div class="line">renyimindeMacBook-Pro:~ renyimin$</div></pre></td></tr></table></figure>
</li>
<li><p>以 <code>nginx:stable</code> 镜像运行容器, 同时加载上面的数据卷’nginx-default-html-root’到容器内的 ‘/usr/share/nginx/html’ 目录</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:~ renyimin$ docker run -d -p 8000:80 --name nginx --mount source=nginx-default-html-root,target=/usr/shar/nginx/html nginx:stable</div><div class="line">d9272900ba7f2a59e6ff402aeee642856679ac073787e08997baa4c97fff051c</div><div class="line">renyimindeMacBook-Pro:~ renyimin$</div></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p><strong>另外值得注意的是</strong>:</p>
<ul>
<li>如果容器中对应的目录不存在, 容器会自动创建目录;</li>
<li>如果运行容器时, 加载的数据卷不存在, 则会自动创建, 通过<code>docker volume ls</code>也可以看到自动创建的数据卷</li>
<li><strong>数据卷只能挂载目录, 不能挂载文件</strong></li>
</ul>
</li>
<li><p>可以在主机里使用以下命令查看 <code>nginx</code> 容器的信息, 数据卷信息在 <code>&quot;Mounts&quot;</code> Key 下面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ docker inspect nginx</div><div class="line">&quot;Mounts&quot;: [</div><div class="line">    &#123;</div><div class="line">        &quot;Type&quot;: &quot;volume&quot;,</div><div class="line">        &quot;Name&quot;: &quot;nginx-default-html-root&quot;,</div><div class="line">        &quot;Source&quot;: &quot;/var/lib/docker/volumes/nginx-default-html-root/_data&quot;,</div><div class="line">        &quot;Destination&quot;: &quot;/usr/shar/nginx/html&quot;,</div><div class="line">        &quot;Driver&quot;: &quot;local&quot;,</div><div class="line">        &quot;Mode&quot;: &quot;z&quot;,</div><div class="line">        &quot;RW&quot;: true,</div><div class="line">        &quot;Propagation&quot;: &quot;&quot;</div><div class="line">    &#125;</div><div class="line">],</div><div class="line">...</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="挂载主机目录-文件"><a href="#挂载主机目录-文件" class="headerlink" title="挂载主机目录/文件"></a>挂载主机目录/文件</h2><ol>
<li><p>挂载一个主机目录作为数据卷: 使用 <code>--mount</code> 标记可以指定挂载一个本地主机的目录到容器中去</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:~ renyimin$ docker run -d -p 8001:80 --name nginx_t1 --mount type=bind,source=/Users/renyimin/Desktop/nginx_transfer,target=/transfer nginx:stable</div><div class="line">f5313881baa9bb4522552ba0b02dcad9f315d8a4e5245e2b362dc674ac9d4c4f</div><div class="line">renyimindeMacBook-Pro:~ renyimin$</div><div class="line">renyimindeMacBook-Pro:~ renyimin$ docker exec -it f5313881baa9bb4522552ba0b02dcad9f315d8a4e5245e2b362dc674ac9d4c4f /bin/sh</div><div class="line">// 下面可以看到容器自己创建的transfer目录</div><div class="line"># ls</div><div class="line">bin  boot  dev	etc  home  lib	lib64  media  mnt  opt	proc  root  run  sbin  srv  sys  tmp  transfer	usr  var</div></pre></td></tr></table></figure>
</li>
<li><p>查看容器的挂载信息, 发现和数据卷相比, <code>Type</code> 信息是 <code>bind</code> 而不是 <code>volume</code>, 并且没有数据卷的 <code>name</code> 信息, <code>docker volume ls</code> 也不会看到有新的数据卷被创建, 所以…可以认为只是一次简单的目录绑定</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:testVip renyimin$ docker inspect testVip</div><div class="line">&quot;Mounts&quot;: [</div><div class="line">    &#123;</div><div class="line">        &quot;Type&quot;: &quot;bind&quot;,</div><div class="line">        &quot;Source&quot;: &quot;/Users/renyimin/Desktop/nginx_transfer&quot;,</div><div class="line">        &quot;Destination&quot;: &quot;/transfer&quot;,</div><div class="line">        &quot;Mode&quot;: &quot;&quot;,</div><div class="line">        &quot;RW&quot;: true,</div><div class="line">        &quot;Propagation&quot;: &quot;rprivate&quot;</div><div class="line">    &#125;</div><div class="line">],</div></pre></td></tr></table></figure>
</li>
<li><p>也可以挂载文件</p>
<ul>
<li>注意, 如果你直接在本地新建一个nginx.conf就想在启动的时候直接挂载到容器中的nginx.conf, 那么nginx容器可能压根就启动不起来了, 后面会使用 <code>docker cp</code> 来解决这个问题<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:~ renyimin$ docker run -d -p 8002:80 --name nginx_t2 --mount type=bind,source=/Users/renyimin/Desktop/nginx_transfer1/index.html,target=/usr/share/nginx/html/index.html nginx:stable</div><div class="line">b85543ee9562647195ab094579b8e17fd8f439094ab5f0054215af435d33681c</div><div class="line">renyimindeMacBook-Pro:~ renyimin$</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>选择 <code>-v</code> 还是 <code>--mount</code> 参数?</p>
<ul>
<li>Docker 新用户应该选择 <code>--mount</code> 参数, 经验丰富的 Docker 使用者对 <code>-v</code> 或者 <code>--volume</code> 已经很熟悉了, 但是推荐使用 <code>--mount</code> 参数;</li>
<li>可以理解为, <code>--mount</code> 参数应该可以挂载数据卷, 也可以代替-v来进行目录关联;</li>
</ul>
</li>
<li><p>Docker 挂载主机目录的默认权限是 <code>读写</code>, 用户也可以通过增加 <code>readonly</code> 指定为 <strong>只读</strong></p>
<ul>
<li><p>加了 readonly 之后, 就挂载为 只读 了, 如果你在容器内 /haha 目录新建文件, 会显示如下错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:testVip renyimin$ docker run -d -p 8090:80 --name testVip --mount type=bind,source=/Users/renyimin/Desktop/testVip,target=/haha,readonly vipservice</div><div class="line">27863a3a8f70fa4bddb9c97fabfee2db7f35d5615d4b90ad0be13717dc23d092</div><div class="line">renyimindeMacBook-Pro:testVip renyimin$ docker exec -it 27863a3a8f70fa4bddb9c97fabfee2db7f35d5615d4b90ad0be13717dc23d092 /bin/sh</div><div class="line">sh-4.2# </div><div class="line">sh-4.2# cd /</div><div class="line">sh-4.2# ls</div><div class="line">anaconda-post.log  bin	data  dev  etc	haha  home  lib  lib64	lost+found  media  mnt	opt  proc  root  run  run.sh  sbin  srv  sys  tmp  usr	var</div><div class="line">sh-4.2# cd haha</div><div class="line">sh-4.2# ls</div><div class="line">myfirstregistry  registry.tar</div><div class="line">// 可以看到报错了</div><div class="line">sh-4.2# touch a.txt</div><div class="line">touch: cannot touch &apos;a.txt&apos;: Read-only file system</div><div class="line">sh-4.2#</div></pre></td></tr></table></figure>
</li>
<li><p>查看数据卷的具体信息 <code>$ docker inspect testVip</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&quot;Mounts&quot;: [</div><div class="line">    &#123;</div><div class="line">        &quot;Type&quot;: &quot;bind&quot;,</div><div class="line">        &quot;Source&quot;: &quot;/Users/renyimin/Desktop/testVip&quot;,</div><div class="line">        &quot;Destination&quot;: &quot;/haha&quot;,</div><div class="line">        &quot;Mode&quot;: &quot;&quot;,</div><div class="line">        &quot;RW&quot;: false,</div><div class="line">        &quot;Propagation&quot;: &quot;rprivate&quot;</div><div class="line">    &#125;</div><div class="line">],</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="数据卷挂载的问题"><a href="#数据卷挂载的问题" class="headerlink" title="数据卷挂载的问题"></a>数据卷挂载的问题</h2><ol>
<li><p>上面提到的数据卷, 对很多容器都非常有用, 比如 </p>
<ul>
<li>mysql容器中存储数据文件的 <code>/var/lib/mysql</code> 目录你就需要挂载数据卷;</li>
<li>mysql, php-fpm, nginx等容器中, 关于服务配置的目录你也需要挂载到数据卷, 这些配置你可能需要进行改动;</li>
</ul>
</li>
<li><p>但是挂载数据卷有个问题, 一旦挂载之后, 容器中的目录就是空的, 原本服务的配置文件就被清空了, 也就导致有些容器在挂载数据卷之后, 无法正常启动;</p>
</li>
</ol>
<h2 id="docker-cp-命令"><a href="#docker-cp-命令" class="headerlink" title="docker cp 命令"></a>docker cp 命令</h2><ol>
<li><p>可以将本地目录/文件拷贝到容器, 也可以将容器中的目录/文件拷贝到本地; 格式: </p>
<ul>
<li><code>docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</code></li>
<li><code>docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</code></li>
</ul>
</li>
<li><p>所以为了避免挂载导致容器无法正常启动, 挂载的可以这样来:</p>
<ul>
<li>先确定你需要挂载的容器中目录的位置(比如: nginx容器中的配置文件在<code>/etc/nginx/conf.d/default.conf</code> )</li>
<li>使用 <code>docker cp</code> 命令, 将需要映射的目录从容器复制到本地; (比如:  <code>docker cp nginx_test:/etc/nginx/ ./conf/</code>)</li>
<li>然后再将本地default.conf文件挂载到nginx容器的/etc/nginx/conf.d/default.conf</li>
</ul>
</li>
</ol>
<h2 id="启动nginx容器"><a href="#启动nginx容器" class="headerlink" title="启动nginx容器"></a>启动nginx容器</h2><ol>
<li><p>先简单启动: </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:html renyimin$ docker run -d -p 8005:80 --name nginx nginx:stable</div><div class="line">1b22387039746639bf5eec39c5eea597a078d0d6003c31c94bb65d82485f0da4</div><div class="line">renyimindeMacBook-Pro:html renyimin$ docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">1b2238703974        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   3 seconds ago       Up 2 seconds        0.0.0.0:8005-&gt;80/tcp     nginx</div><div class="line">983a64953864        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   7 hours ago         Up 3 hours          0.0.0.0:8088-&gt;80/tcp     nginx_test</div><div class="line">0e7070854958        registry            &quot;/entrypoint.sh /e...&quot;   5 months ago        Up 5 days           0.0.0.0:5000-&gt;5000/tcp   registry</div></pre></td></tr></table></figure>
</li>
<li><p>从nginx容器copy 挂载主机目录/文件 需要的内容</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// 将nginx默认的root目录拷贝到宿主机</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$ docker cp nginx:/usr/share/nginx/html ./html</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$ ls</div><div class="line">html</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$ cd html</div><div class="line">renyimindeMacBook-Pro:html renyimin$ ls</div><div class="line">50x.html	index.html</div><div class="line">renyimindeMacBook-Pro:html renyimin$</div><div class="line"></div><div class="line">// 再将nginx相关配置拷贝到宿主机</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$ docker cp nginx:/etc/nginx ./conf</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$ ls</div><div class="line">conf	html</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$ tree conf</div><div class="line">conf</div><div class="line">├── conf.d</div><div class="line">│   └── default.conf</div><div class="line">├── fastcgi_params</div><div class="line">├── koi-utf</div><div class="line">├── koi-win</div><div class="line">├── mime.types</div><div class="line">├── modules -&gt; /usr/lib/nginx/modules</div><div class="line">├── nginx.conf</div><div class="line">├── scgi_params</div><div class="line">├── uwsgi_params</div><div class="line">└── win-utf</div><div class="line"></div><div class="line">1 directory, 10 files</div><div class="line">renyimindeMacBook-Pro:nginx_test renyimin$</div></pre></td></tr></table></figure>
</li>
<li><p>然后关掉nginx容器并删除</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:conf renyimin$ docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">1b2238703974        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   8 minutes ago       Up 8 minutes        0.0.0.0:8005-&gt;80/tcp     nginx</div><div class="line">983a64953864        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   8 hours ago         Up 3 hours          0.0.0.0:8088-&gt;80/tcp     nginx_test</div><div class="line">0e7070854958        registry            &quot;/entrypoint.sh /e...&quot;   5 months ago        Up 5 days           0.0.0.0:5000-&gt;5000/tcp   registry</div><div class="line">renyimindeMacBook-Pro:conf renyimin$ docker stop nginx</div><div class="line">nginx</div><div class="line">renyimindeMacBook-Pro:conf renyimin$ docker rm nginx</div><div class="line">nginx</div><div class="line">renyimindeMacBook-Pro:conf renyimin$ docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">983a64953864        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   8 hours ago         Up 3 hours          0.0.0.0:8088-&gt;80/tcp     nginx_test</div><div class="line">0e7070854958        registry            &quot;/entrypoint.sh /e...&quot;   5 months ago        Up 5 days           0.0.0.0:5000-&gt;5000/tcp   registry</div><div class="line">renyimindeMacBook-Pro:conf renyimin$</div></pre></td></tr></table></figure>
</li>
<li><p>最后, 重新以为挂载主机目录/文件的方式启动nginx镜像   </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">renyimindeMacBook-Pro:conf.d renyimin$ docker run -d -p 8005:80 --name nginx --mount type=bind,source=/Users/renyimin/Desktop/nginx_test/html,target=/usr/share/nginx/html --mount type=bind,source=/Users/renyimin/Desktop/nginx_test/conf/nginx.conf,target=/etc/nginx/nginx.conf --mount type=bind,source=/Users/renyimin/Desktop/nginx_test/conf/conf.d/,target=/etc/nginx/conf.d nginx:stable</div><div class="line">dee610e0caefe889fcf7073c5679b4ab640e4620e74c5864bccb07b6718a1670</div><div class="line">renyimindeMacBook-Pro:conf.d renyimin$ docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</div><div class="line">dee610e0caef        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   3 seconds ago       Up 2 seconds        0.0.0.0:8005-&gt;80/tcp     nginx</div><div class="line">983a64953864        nginx:stable        &quot;nginx -g &apos;daemon ...&quot;   8 hours ago         Up 4 hours          0.0.0.0:8088-&gt;80/tcp     nginx_test</div><div class="line">0e7070854958        registry            &quot;/entrypoint.sh /e...&quot;   5 months ago        Up 5 days           0.0.0.0:5000-&gt;5000/tcp   registry</div></pre></td></tr></table></figure>
</li>
<li><p>尝试访问 <code>http://locahost:8005</code>, 成功; 在宿主机修改index.html文件, 直接刷新页面, 效果正常! 宿主机的挂载文件如下 (多余的哪些本地并没有进行映射的文件, 也可以直接删除)<br> <img src="/img/docker/volume-01.png"></p>
</li>
<li><p>修改nginx配置之后, 可以重启容器来使新配置生效 <code>docker restart nginx</code>   </p>
</li>
</ol>
<p>参考: <a href="https://yeasy.gitbooks.io/docker_practice/content/data_management/" target="_blank" rel="external">https://yeasy.gitbooks.io/docker_practice/content/data_management/</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        

        
    </div>
    <footer>
        <a href="http://blog.renyimin.com">
            <img src="/img/avatar.jpeg" alt="Rymuscle">
            Rymuscle
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker-入门/">Docker 入门</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/&title=《06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件》 — Rymuscle's&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/&title=《06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件》 — Rymuscle's&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件》 — Rymuscle's&url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
      <div class="waves-block waves-effect prev">
        <a href="/2017/12/16/docker/2017-12-16-05-docker/" id="post-prev" class="post-nav-link">
          <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i>Prev </div>
          <h4 class="title">05. 容器</h4>
        </a>
      </div>
    
  
    <div class="waves-block waves-effect next">
      <a href="/2018/03/10/linux/2018-03-10-17/" id="post-next" class="post-nav-link">
        <div class="tips">Next<i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">17. 软链</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rymuscle',
            repo: 'rymuscle.github.io',
            oauth: {
                client_id: '49b906f6d47dbab8d929',
                client_secret: '17fd73f24f616a09d4c09bca9480e0deba75a9a2',
            },
        })
        gitment.render('comments')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赞赏支持
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="bottom">
        <p><span>Rymuscle &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/&title=《06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件》 — Rymuscle's&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/&title=《06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件》 — Rymuscle's&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《06. Docker数据管理 - 数据卷(Volumes), 挂载主机目录/文件》 — Rymuscle's&url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2017/12/17/docker/2017-12-17-06-docker/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtUlEQVR42u3aW24CMQwFUPa/aSr1qxIQfO1koNLJFyqP5KRS4rF9u5XH/XdU3n385P3PePXdx5GuYTTw8PDwWktfT1NfYh3cW1t9zXh4eHineZXjfr3QNWm9EenVElweeHh4eB/lVY7seri86+LBw8PD+1+89HVzieHFg4eHh3cNLz3E01RsPZWQJke25Vrw8PDwyry0APYNrw/W9/Dw8PAGVfX6QV8/+itB8LYrBA8PD+9UdHqrhNF7A+hKMSy9EoInBjw8PLwxr9ccUG8ISFsB1phmYwEeHh7eJl4a5qbpgDovbcwqrRMPDw/vAC+9GNLEbi9Z3LucggYCPDw8vDGvlzhI0xNpQDxpz7rN8yJ4eHh4rbaA3tInx3rl3XgWPDw8vAO8erohPcQnDaaV39nwxICHh4cX8tJAOZ04TdSml1OzXQAPDw9vwEubA9bTp+FvmtpIW2bx8PDwTvMmIWw9XTtnxD1leHh4eFt59YxFmoBIGwvm6Ykns+Ph4eEd4M2r7WmpLD36J60MeHh4eNfwRrH54CifNCsEZTw8PDy8Ma9+iK+nrKcqeldOekng4eHhXclLW6YqmPlGpAllPDw8vHO8XjmqgqlvTbrFMQwPDw9vK68XNM9L++l2pIWuN/ceHh4e3oC3DnwnyYi0DDb5tTefwcPDw9vK6yVn64vrdS6km/JSgYeHh3cJb9JclZb501TvhicGPDw8vDEvLe3XF9RLMdQD6HTNeHh4eLt493BMWqnqwXSvwPZkW/Hw8PAO8OrjxMT1v+zdRDw8PLw5r17i6hW00uukskHB/wcPDw/vGK8XKKdLGfU49BIoeHh4eB/l9cLf+gb1Er5vLHh4eHhfxtsVIu/dgifJCDw8PLwDvDQZ0SubzX85zj/g4eHhHeD1vjBvKUiTGunseHh4eAd4P+unnHHqTmLsAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.13"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.13" async></script>










</body>
</html>

<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>05. MySQL5.7 源码编译安装 | Lant&#39;s</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="《高性能MySQL》">
    <meta name="description" content="源码下载 mysql5.7.25 源码下载   因为 mysql5.7系列要求安装boost_1_59_0, 这里我们选择包含boost的版本 (相对于前者, 它内部已经准备好了boost, 不用你再去下载对应的boost版本)    依赖安装 参考  cmake: mysql使用cmake跨平台工具预编译源码, 用于设置mysql的编译参数 (如: 安装目录、数据存放目录、字符编码、排序规则等,">
<meta name="keywords" content="《高性能MySQL》">
<meta property="og:type" content="article">
<meta property="og:title" content="05. MySQL5.7 源码编译安装">
<meta property="og:url" content="http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/index.html">
<meta property="og:site_name" content="Lant&#39;s">
<meta property="og:description" content="源码下载 mysql5.7.25 源码下载   因为 mysql5.7系列要求安装boost_1_59_0, 这里我们选择包含boost的版本 (相对于前者, 它内部已经准备好了boost, 不用你再去下载对应的boost版本)    依赖安装 参考  cmake: mysql使用cmake跨平台工具预编译源码, 用于设置mysql的编译参数 (如: 安装目录、数据存放目录、字符编码、排序规则等,">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.renyimin.com/img/mysql/install/install-01.png">
<meta property="og:image" content="http://blog.renyimin.com/img/mysql/install/install-02.png">
<meta property="og:updated_time" content="2019-04-26T11:01:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="05. MySQL5.7 源码编译安装">
<meta name="twitter:description" content="源码下载 mysql5.7.25 源码下载   因为 mysql5.7系列要求安装boost_1_59_0, 这里我们选择包含boost的版本 (相对于前者, 它内部已经准备好了boost, 不用你再去下载对应的boost版本)    依赖安装 参考  cmake: mysql使用cmake跨平台工具预编译源码, 用于设置mysql的编译参数 (如: 安装目录、数据存放目录、字符编码、排序规则等,">
<meta name="twitter:image" content="http://blog.renyimin.com/img/mysql/install/install-01.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lant&#39;s" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.13">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand4.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lant</h5>
          <a href="mailto:18625036504@163.com" title="18625036504@163.com" class="mail">18625036504@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">05. MySQL5.7 源码编译安装</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h5 class="subtitle">
            
                <time datetime="2018-04-14T06:20:27.000Z" itemprop="datePublished" class="page-time">
  2018-04-14
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MySQL/">MySQL</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#源码下载"><span class="post-toc-number">1.</span> <span class="post-toc-text">源码下载</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#依赖安装"><span class="post-toc-number">2.</span> <span class="post-toc-text">依赖安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#编译、安装"><span class="post-toc-number">3.</span> <span class="post-toc-text">编译、安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#my-cnf"><span class="post-toc-number">4.</span> <span class="post-toc-text">my.cnf</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#问题"><span class="post-toc-number">5.</span> <span class="post-toc-text">问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#编码相关"><span class="post-toc-number">6.</span> <span class="post-toc-text">编码相关</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#运行用户"><span class="post-toc-number">7.</span> <span class="post-toc-text">运行用户</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#root密码忘记"><span class="post-toc-number">8.</span> <span class="post-toc-text">root密码忘记</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置环境变量"><span class="post-toc-number">9.</span> <span class="post-toc-text">设置环境变量</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#初始化数据库"><span class="post-toc-number">10.</span> <span class="post-toc-text">初始化数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#开机启动"><span class="post-toc-number">11.</span> <span class="post-toc-text">开机启动</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置密码"><span class="post-toc-number">12.</span> <span class="post-toc-text">设置密码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#编译过程中的问题"><span class="post-toc-number">13.</span> <span class="post-toc-text">编译过程中的问题</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-MySQL 暂停/2018-04-14-mysql-05"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">05. MySQL5.7 源码编译安装</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-04-14 14:20:27" datetime="2018-04-14T06:20:27.000Z"  itemprop="datePublished">2018-04-14</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MySQL/">MySQL</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2><ol>
<li><p><a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener">mysql5.7.25</a> 源码下载<br> <img src="/img/mysql/install/install-01.png" width="450"></p>
</li>
<li><p>因为 mysql5.7系列要求安装<a href="https://www.boost.org/users/history/" target="_blank" rel="noopener">boost_1_59_0</a>, 这里我们选择包含boost的版本<br> (相对于前者, 它内部已经准备好了boost, 不用你再去下载对应的boost版本)<br> <img src="/img/mysql/install/install-02.png" width="500"></p>
</li>
</ol>
<h2 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h2><ol>
<li><p><a href="https://dev.mysql.com/doc/refman/5.7/en/source-installation.html" target="_blank" rel="noopener">参考</a></p>
<ul>
<li>cmake: mysql使用cmake跨平台工具预编译源码, 用于设置mysql的编译参数 (如: 安装目录、数据存放目录、字符编码、排序规则等, 安装最新版本即可)</li>
<li>make3.75 : mysql源代码是由C和C++语言编写, 在linux下使用make对源码进行编译和构建, 要求必须安装 make 3.75或以上版本 (yum默认都是安装最新版的软件)</li>
<li>gcc4.4.6 : GCC是Linux下的C语言编译工具, mysql源码编译完全由C和C++编写, 要求必须安装GCC4.4.6或以上版本</li>
<li>Boost1.59.0 : mysql源码中用到了C++的Boost库, 要求必须安装boost1.59.0或以上版本</li>
<li>bison2.1 : Linux下C/C++语法分析器</li>
<li>ncurses : 字符终端处理库</li>
</ul>
</li>
<li><p>所以在安装前, 需先安装相关的依赖库</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ ncurses ncurses-devel bison libgcrypt perl make cmake</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="编译、安装"><a href="#编译、安装" class="headerlink" title="编译、安装"></a>编译、安装</h2><ol>
<li><p>相比之前的Mysql编译选项, CMake编译选项现在都是大写的, <a href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_cmake_install_prefix" target="_blank" rel="noopener">参考</a></p>
</li>
<li><p>在编译时通常会设置的编译选项如下: (可参考 <a href="https://lnmp.org/download.html" target="_blank" rel="noopener">lnmp1.6</a> 中的MySQL5.7编译脚本)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cmake </span><br><span class="line">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql         // 指定MySQL程序的安装目录, 默认 /usr/local/mysql</span><br><span class="line">-DSYSCONFDIR=/usr/local/mysql/etc               // 初始化参数文件my.cnf的目录, 貌似没有默认值, 需要指定</span><br><span class="line">-DWITH_MYISAM_STORAGE_ENGINE=1                  // 指定静态编译到mysql的存储引擎, InnoDB, MyISAM, MERGE, MEMORY和CSV引擎是必需的（始终编译到服务器中）, 无需显式安装。</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1                // 指定静态编译到mysql的存储引擎, InnoDB, MyISAM, MERGE, MEMORY和CSV引擎是必需的（始终编译到服务器中）, 无需显式安装。</span><br><span class="line">-DWITH_PARTITION_STORAGE_ENGINE=1               // 指定静态编译到mysql的存储引擎, InnoDB, MyISAM, MERGE, MEMORY和CSV引擎是必需的（始终编译到服务器中）, 无需显式安装。</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1               // 指定静态编译到mysql的存储引擎, InnoDB, MyISAM, MERGE, MEMORY和CSV引擎是必需的（始终编译到服务器中）, 无需显式安装。</span><br><span class="line">-DEXTRA_CHARSETS=all                            // 默认就是all</span><br><span class="line">-DDEFAULT_CHARSET=utf8mb4                       // 指定服务器默认字符集, 默认 latin1</span><br><span class="line">-DDEFAULT_COLLATION=utf8mb4_general_ci          // 指定服务器默认的校对规则, 默认 latin1_general_ci</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1    </span><br><span class="line">-DENABLED_LOCAL_INFILE=1                        // 指定是否允许本地执行 LOAD DATA INFILE, 默认OFF</span><br><span class="line">-DWITH_BOOST=/usr/local/src/mysql-5.7.25/boost  // 不用指定 -DENABLE_DOWNLOADS=1</span><br><span class="line"></span><br><span class="line"># 以下选项, lnmp1.6 并没有指定</span><br><span class="line">-DWITH_ARCHIVE_STORAGE_ENGINE=1 </span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 </span><br><span class="line">-DWITH_MEMORY_STORAGE_ENGINE=1 </span><br><span class="line">-DMYSQL_TCP_PORT                        // 指定服务器默认的端口号, 默认 3306</span><br><span class="line">-DMYSQL_DATADIR=/usr/local/mysql/data   // 数据文件目录 (这个没有默认值)</span><br><span class="line">-MYSQL_UNIX_ADDR                        // socket文件路径, 默认 /tmp/mysql.sock</span><br><span class="line">-DENABLE_DOWNLOADS=1                    // 是否要下载可选的文件。例如, 启用此选项（设置为1）, cmake将下载谷歌所使用的测试套件运行单元测试。</span><br><span class="line">-DMYSQL_USER=mysql                      // 官网没找到该选项</span><br><span class="line">-DDOWNLOAD_BOOST                        // 不用指定, 因为本次选择的是 mysql-boost 版本的, 所以不用下载boost, 而且下载过程很容易被墙而下载失败</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译安装</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DSYSCONFDIR=/usr/local/mysql/etc -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_FEDERATED_STORAGE_ENGINE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_EMBEDDED_SERVER=1 -DENABLED_LOCAL_INFILE=1 -DWITH_BOOST=/usr/local/src/mysql-5.7.25/boost -DMYSQL_DATADIR=/usr/local/mysql/data</span><br><span class="line">make    // 花费时间可能会比较长</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ul>
<li>已经生成 /usr/local/mysql</li>
</ul>
</li>
</ol>
<h2 id="my-cnf"><a href="#my-cnf" class="headerlink" title="my.cnf"></a>my.cnf</h2><ol>
<li><p>首先, 在编译时, 我们通过 <code>-DSYSCONFDIR</code> 指定的 my.cnf 的路径是在 /usr/local/mysql/etc 下, 但是编译完成后, /usr/local/mysql/ 下并没有 etc 目录<br> 这个选项只是指定将来 my.cnf 的位置, 不会帮我们创建目录和文件 (包括之前在编译时通过 -DMYSQL_DATADIR=/usr/local/mysql/data 指定的mysql的数据目录, 都是需要自己创建)</p>
</li>
<li><p>另外, mysql5.7.18之后, 貌似已经不在解压包的support-files目录中提供my-default.cnf文件, <a href="https://dev.mysql.com/doc/refman/5.7/en/binary-installation.html" target="_blank" rel="noopener">参考</a></p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/5.7/en/option-files.html" target="_blank" rel="noopener">参考</a>, 在Unix和类Unix系统上, MySQL程序按照指定的顺序从下表中显示的文件中读取启动选项（首先列出的文件首先读取, 后面读取的文件优先）<br> (你会发现在centos7-minimal系统的/etc下默认就有my.cnf文件)</p>
</li>
<li><p>自己准备 my.cnf 文件</p>
<ul>
<li>Mysql参数优化对于新手来讲, 是比较难懂的东西, 其实这个参数优化, 是个很复杂的东西, 对于不同的网站, 及其在线量, 访问量, 帖子数量, 网络情况, 以及机器硬件配置都有关系, 优化不可能一次性完成, 需要不断的观察以及调试, 才有可能得到最佳效果</li>
<li>下面是个my.cnf示例: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">[client]                                            # 客户端设置，即客户端默认的连接参数</span><br><span class="line">default-character-set = utf8mb4                 </span><br><span class="line">port = 3306                                         # 默认连接端口</span><br><span class="line">socket = /usr/local/mysql/mysql.sock                # 用于本地连接的socket套接字 (注意client的socket要和mysqld是一样的，因为客户端和服务端通信靠的就是这个文件，肯定要一致)</span><br><span class="line"></span><br><span class="line">[mysql]                                             # 服务端基本设置</span><br><span class="line">#auto-rehash                                        # MySQL开启命令自动补全功能, mysql命令行工具自带这个功能, 但是默认是禁用的, 想启用其实很简单, 打开配置文件找到 no-auto-rehash, 用符号 # 将其注释, 另外增加auto-rehash即可</span><br><span class="line">                                                    # 亲测, 感觉不咋实用</span><br><span class="line">[mysqld]</span><br><span class="line">user=mysql                                          # ?? mysqld程序在启动后将在给定UNIX/Linux账户下执行 mysqld必须从root账户启动才能在启动后切换到另一个账户下执行; mysqld_safe脚本将默认使用–user=mysql选项来启动mysqld程序</span><br><span class="line">socket = /usr/local/mysql/mysql.sock                # 为MySQL客户端程序和服务器之间的本地通讯指定一个套接字文件 (编译时未指定socket位置, 就用默认的位置)</span><br><span class="line">port=3306                                           # MySQL监听端口</span><br><span class="line">basedir=/usr/local/mysql                            # 指定了安装 MySQL 的安装路径, 填写全路径可以解决相对路径所造成的问题</span><br><span class="line">datadir=/usr/local/mysql/data                       # 数据文件存放的目录</span><br><span class="line">tmpdir = /usr/local/mysql/tmp                       # ?? MySQL存放临时文件的目录</span><br><span class="line">symbolic-links=0                                    # ?? 是否支持符号链接, 即数据库或表可以存储在my.cnf中指定datadir之外的分区或目录, 为0不开启</span><br><span class="line">log-error=/usr/local/mysql/logs/mysql.log           # 错误日志位置</span><br><span class="line">pid-file=/usr/local/mysql/mysqld.pid</span><br><span class="line"></span><br><span class="line">skip-name-resolve                                   # ?? 禁用主机名解析 (待答疑)</span><br><span class="line">default-storage-engine = InnoDB                     # 默认的数据库引擎</span><br><span class="line"></span><br><span class="line">innodb-file-per-table=1                             # ??</span><br><span class="line">innodb_force_recovery = 1                           # ??</span><br><span class="line">group_concat_max_len = 10240                        # ??</span><br><span class="line">#sql_mode = &apos;PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,NO_KEY_OPTIONS,NO_TABLE_OPTIONS,NO_FIELD_OPTIONS,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;</span><br><span class="line">sql_mode = NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER   # sql_mode, 定义了mysql应该支持的sql语法，数据校验等</span><br><span class="line">                                                        # NO_AUTO_CREATE_USER: 禁止GRANT创建密码为空的用户</span><br><span class="line">                                                        # NO_ENGINE_SUBSTITUTION: 如果需要的存储引擎被禁用或未编译, 可以防止自动替换存储引擎</span><br><span class="line">expire_logs_days = 7                                # ??</span><br><span class="line">memlock                                             # ??</span><br><span class="line"></span><br><span class="line">### 字符集配置</span><br><span class="line">character-set-client-handshake = FALSE</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect=&apos;SET NAMES utf8mb4&apos;                    # ??</span><br><span class="line"></span><br><span class="line">### GTID</span><br><span class="line">server_id = 330759                                  # ?? 服务端ID，用来高可用时做区分</span><br><span class="line">binlog_format = row                                 # ?? 为保证 GTID 复制的稳定, 行级日志</span><br><span class="line"></span><br><span class="line">binlog_rows_query_log_events=1                      # 在row模式下, 开启该参数, 将把sql语句打印到binlog日志里面, 默认是0(off), 虽然将语句放入了binlog,但不会执行这个sql,就相当于注释一样.但对于dba来说,在查看binlog的时候,很有用处.</span><br><span class="line">binlog_row_image=&apos;minimal&apos;                          # 默认为full, 在binlog为row格式下, full将记录update前后所有字段的值, minimal时, 只记录更改字段的值和where字段的值, noblob时, 记录除了blob和text的所有字段的值, 如果update的blob或text字段,也只记录该字段更改后的值,更改前的不记录;</span><br><span class="line">                                                    # 大家都知道row格式下的binlog增长速度太快, 对存储空间, 主从传输都是一个不小的压力.因为每个event记录了所有更改数据前后的值,不管数据是否有改动都会记录.binlog_row_image的引入就大大减少了binlog记录的数据.在结合binlog_rows_query_log_events,对于dba日常维护binlog是完全没有压力的,而且节省了硬盘空间开销,减小I/O,减少了主从传输压力;</span><br><span class="line"></span><br><span class="line">gtid_mode = on                                      # ?? 开启 gtid 功能</span><br><span class="line"># 保障 GTID 事务安全</span><br><span class="line"># 当启用 enforce_gtid_consistency 功能时</span><br><span class="line"># MySQL只允许能够保障事务安全, 并且能够被日志记录的SQL语句被执行</span><br><span class="line"># 像create table ... select 和 create temporarytable语句</span><br><span class="line"># 以及同时更新事务表和非事务表的SQL语句或事务都不允许执行</span><br><span class="line">enforce-gtid-consistency = true </span><br><span class="line"></span><br><span class="line"># 以下两条配置为主从切换, 数据库高可用的必须配置</span><br><span class="line"></span><br><span class="line">log_bin = mysql57-bin                               # 开启 binlog 日志功能</span><br><span class="line">log-slave-updates = on                              # ?? 开启从库更新 binlog 日志</span><br><span class="line">skip_slave_start=1                                  # ?? slave复制进程不随mysql启动而启动</span><br><span class="line"></span><br><span class="line">### 慢查询日志</span><br><span class="line">slow_query_log = 1                                  # 打开慢查询日志功能</span><br><span class="line">long_query_time = 2                                 # 超过2秒的查询记录下来</span><br><span class="line">log_queries_not_using_indexes = 0                   # 记录下没有使用索引的查询</span><br><span class="line">slow_query_log_file =/usr/local/mysql/logs/slow.log # 慢查询日志文件</span><br><span class="line">#log=/data/logs/mysql57/all.log</span><br><span class="line"></span><br><span class="line">### 自动修复</span><br><span class="line"></span><br><span class="line">relay_log_info_repository = TABLE                   # 记录 relay.info 到数据表中</span><br><span class="line">master_info_repository = TABLE                      # 记录 master.info 到数据表中 </span><br><span class="line">relay_log_recovery = on                             # 启用 relaylog 的自动修复功能</span><br><span class="line">relay_log_purge = 1                                 # 在 SQL 线程执行完一个 relaylog 后自动删除</span><br><span class="line"></span><br><span class="line">### 数据安全性配置</span><br><span class="line">log_bin_trust_function_creators = on                # wei关闭 master 创建 function 的功能</span><br><span class="line">sync_binlog = 1                                     # 每执行一个事务都强制写入磁盘</span><br><span class="line">explicit_defaults_for_timestamp=true                # 设置 timestamp 的列值为 null, 不会被设置为 current timestamp</span><br><span class="line">                                                    # timestamp 列如果没有显式定义为 not null, 则支持null属性</span><br><span class="line">### 优化配置</span><br><span class="line">ft_min_word_len = 1                                 # 优化中文全文模糊索引</span><br><span class="line">lower_case_table_names = 1                          # 默认库名表名保存为小写, 不区分大小写</span><br><span class="line">max_allowed_packet = 256M                           # 单条记录写入最大的大小限制, 过小可能会导致写入(导入)数据失败</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#rpl_semi_sync_master_enabled = 1                   # ?? 半同步复制开启</span><br><span class="line">#rpl_semi_sync_slave_enabled = 1                    </span><br><span class="line"></span><br><span class="line">#rpl_semi_sync_master_timeout = 1000                # ?? 半同步复制超时时间设置</span><br><span class="line">#rpl_semi_sync_master_wait_point = AFTER_SYNC       # ?? 复制模式(保持系统默认)</span><br><span class="line"></span><br><span class="line">#rpl_semi_sync_master_wait_slave_count = 1          # 多线程复制</span><br><span class="line">                                                    # ?? 后端只要有一台收到日志并写入 relaylog 就算成功</span><br><span class="line">slave_parallel_type = logical_clock                 # ?? 在MySQL5.7版本后可以利用逻辑时钟方式分配SQL多线程</span><br><span class="line">slave_parallel_workers = 4                          # ?? 并行的SQL线程数量, 此参数只有设置 1&lt;N 的情况下才会才起N个线程进行SQL重做</span><br><span class="line">                                                    # ?? 经过测试对比发现, 如果主库的连接线程为M, 只有M &lt; N的情况下, 备库的延迟才可以完全避免</span><br><span class="line"></span><br><span class="line">### 连接数限制</span><br><span class="line">max_connections = 1500                              </span><br><span class="line">max_connect_errors = 200                            # 验证密码超过20次拒绝连接</span><br><span class="line"></span><br><span class="line"># back_log值指出在mysql暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中</span><br><span class="line"># 也就是说, 如果MySql的连接数达到max_connections时, 新来的请求将会被存在堆栈中</span><br><span class="line"># 以等待某一连接释放资源, 该堆栈的数量即back_log, 如果等待连接的数量超过back_log</span><br><span class="line"># 将不被授予连接资源</span><br><span class="line">back_log = 500</span><br><span class="line"></span><br><span class="line">open_files_limit = 65535                            # 服务器关闭交互式连接前等待活动的秒数</span><br><span class="line">interactive_timeout = 3600                          # 服务器关闭非交互连接之前等待活动的秒数</span><br><span class="line">wait_timeout = 3600</span><br><span class="line"></span><br><span class="line">### 内存分配</span><br><span class="line"># 指定表高速缓存的大小。每当MySQL访问一个表时, 如果在表缓冲区中还有空间</span><br><span class="line"># 该表就被打开并放入其中, 这样可以更快地访问表内容</span><br><span class="line">table_open_cache = 1024                            </span><br><span class="line">binlog_cache_size = 4M                              # 为每个session 分配的内存, 在事务过程中用来存储二进制日志的缓存</span><br><span class="line"></span><br><span class="line">tmp_table_size = 128M                               # 在内存的临时表最大大小</span><br><span class="line"></span><br><span class="line"># 创建内存表的最大大小(保持系统默认, 不允许创建过大的内存表)</span><br><span class="line"># 如果有需求当做缓存来用, 可以适当调大此值</span><br><span class="line">max_heap_table_size = 16M</span><br><span class="line"># 顺序读, 读入缓冲区大小设置</span><br><span class="line"># 全表扫描次数多的话, 可以调大此值</span><br><span class="line">read_buffer_size = 1M</span><br><span class="line"># 随机读, 读入缓冲区大小设置</span><br><span class="line">read_rnd_buffer_size = 8M</span><br><span class="line"># 高并发的情况下, 需要减小此值到64K-128K</span><br><span class="line">sort_buffer_size = 1M</span><br><span class="line"># 每个查询最大的缓存大小是1M, 最大缓存64M 数据</span><br><span class="line">query_cache_size = 64M</span><br><span class="line">query_cache_limit = 1M</span><br><span class="line"># 提到 join 的效率</span><br><span class="line">join_buffer_size = 16M</span><br><span class="line"># 线程连接重复利用</span><br><span class="line">thread_cache_size = 64</span><br><span class="line"></span><br><span class="line">### InnoDB 优化</span><br><span class="line">## 内存利用方面的设置</span><br><span class="line"># 数据缓冲区</span><br><span class="line">innodb_buffer_pool_size=2G</span><br><span class="line">## 日志方面设置</span><br><span class="line"># 事务日志大小</span><br><span class="line">innodb_log_file_size = 256M</span><br><span class="line"># 日志缓冲区大小</span><br><span class="line">innodb_log_buffer_size = 4M</span><br><span class="line"># 事务在内存中的缓冲</span><br><span class="line">innodb_log_buffer_size = 3M</span><br><span class="line"># 主库保持系统默认, 事务立即写入磁盘, 不会丢失任何一个事务</span><br><span class="line">innodb_flush_log_at_trx_commit = 1</span><br><span class="line"># mysql 的数据文件设置, 初始100, 以10M 自动扩展</span><br><span class="line">#innodb_data_file_path = ibdata1:100M:autoextend</span><br><span class="line"># 为提高性能, MySQL可以以循环方式将日志文件写到多个文件</span><br><span class="line">innodb_log_files_in_group = 3</span><br><span class="line"></span><br><span class="line">##其他设置</span><br><span class="line"># 如果库里的表特别多的情况, 请增加此值</span><br><span class="line">#innodb_open_files = 800</span><br><span class="line"># 为每个 InnoDB 表分配单独的表空间</span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line"># InnoDB 使用后台线程处理数据页上写 I/O（输入）请求的数量</span><br><span class="line">innodb_write_io_threads = 8</span><br><span class="line"># InnoDB 使用后台线程处理数据页上读 I/O（输出）请求的数量</span><br><span class="line">innodb_read_io_threads = 8</span><br><span class="line"># 启用单独的线程来回收无用的数据</span><br><span class="line">innodb_purge_threads = 1</span><br><span class="line"># 脏数据刷入磁盘(先保持系统默认, swap 过多使用时, 调小此值, 调小后, 与磁盘交互增多, 性能降低)</span><br><span class="line">innodb_max_dirty_pages_pct = 90 </span><br><span class="line"># 事务等待获取资源等待的最长时间</span><br><span class="line">innodb_lock_wait_timeout = 120  </span><br><span class="line"># 开启 InnoDB 严格检查模式, 不警告, 直接报错 1开启 0关闭</span><br><span class="line">innodb_strict_mode=1    </span><br><span class="line"># 允许列索引最大达到3072</span><br><span class="line">innodb_large_prefix = on</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line"># 开启快速导出</span><br><span class="line">quick</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line">max_allowed_packet = 256M</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># include all files from the config directory</span><br><span class="line">#</span><br><span class="line">!includedir /etc/my.cnf.d</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/pengineer/p/4845218.html" target="_blank" rel="noopener">https://www.cnblogs.com/pengineer/p/4845218.html</a></p>
</li>
</ol>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li><p>貌似开启 skip-name-resolve模式 后, 启动mysqld的话, 会报警告  (貌似是因为初始数据库的时候, 会默认有一个 root | localhost 用户生成, 有该模式不支持反向dns, 但是默认却使用了localhost，所以会有警告)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user,host from user;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| user          | host      |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| root          | localhost |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p> 参考: <a href="http://blog.itpub.net/14184018/viewspace-1061224/" target="_blank" rel="noopener">http://blog.itpub.net/14184018/viewspace-1061224/</a></p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2019-03-29T09:21:02.228170Z 0 [Note] Server hostname (bind-address): &apos;*&apos;; port: 3306</span><br><span class="line">2019-03-29T09:21:02.228201Z 0 [Note] IPv6 is available.</span><br><span class="line">2019-03-29T09:21:02.228211Z 0 [Note]   - &apos;::&apos; resolves to &apos;::&apos;;</span><br><span class="line">2019-03-29T09:21:02.228223Z 0 [Note] Server socket created on IP: &apos;::&apos;.</span><br><span class="line">2019-03-29T09:21:02.231618Z 0 [Warning] &apos;user&apos; entry &apos;mysql.session@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.231654Z 0 [Warning] &apos;user&apos; entry &apos;mysql.sys@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.231665Z 0 [Warning] &apos;user&apos; entry &apos;lant@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.231671Z 0 [Warning] &apos;user&apos; entry &apos;lant1@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.231695Z 0 [Warning] &apos;db&apos; entry &apos;performance_schema mysql.session@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.231699Z 0 [Warning] &apos;db&apos; entry &apos;sys mysql.sys@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.231717Z 0 [Warning] &apos;proxies_priv&apos; entry &apos;@ root@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.232858Z 0 [Warning] &apos;tables_priv&apos; entry &apos;user mysql.session@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.232897Z 0 [Warning] &apos;tables_priv&apos; entry &apos;sys_config mysql.sys@localhost&apos; ignored in --skip-name-resolve mode.</span><br><span class="line">2019-03-29T09:21:02.242378Z 0 [Note] Event Scheduler: Loaded 0 events</span><br><span class="line">2019-03-29T09:21:02.242750Z 0 [Note] /usr/local/mysql/bin/mysqld: ready for connections.</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="编码相关"><a href="#编码相关" class="headerlink" title="编码相关"></a>编码相关</h2><p><a href="https://blog.csdn.net/javandroid/article/details/81235387" target="_blank" rel="noopener">https://blog.csdn.net/javandroid/article/details/81235387</a></p>
<h2 id="运行用户"><a href="#运行用户" class="headerlink" title="运行用户"></a>运行用户</h2><ol>
<li><p>(-M: 不要自动建立用户的登入目录; -s: 指定用户登入后所使用的shell; -g: 指定用户所属的起始群组 )</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -s /sbin/nologin -M -g mysql mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建所需目录</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/</span><br><span class="line">mkdir logs tmp data</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li>设置目录相关权限 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /usr/local/mysql/</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="root密码忘记"><a href="#root密码忘记" class="headerlink" title="root密码忘记"></a>root密码忘记</h2><ol>
<li><code>mysqld --skip-grant-tables &amp;</code></li>
<li><code>mysql -uroot -p</code> 直接回车即可<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2></li>
<li><p>环境变量设置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;PATH=/usr/local/mysql/bin:/usr/local/mysql/lib:$PATH&apos; &gt;&gt; /etc/profile // 设置环境变量, 并开机运行</span><br><span class="line">echo &apos;export PATH&apos; &gt;&gt; /etc/profile  //把PATH设为全局变量</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>此时就可以全局使用/usr/local/mysql/bin下的命令</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@lant mysql]# mysqld --help</span><br><span class="line">2019-03-28T04:11:28.230733Z 0 [ERROR] mysqld: option &apos;--init_connect&apos; requires an argument</span><br><span class="line">mysqld  Ver 5.7.25 for Linux on x86_64 (Source distribution)</span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Starts the MySQL database server.</span><br><span class="line"></span><br><span class="line">Usage: mysqld [OPTIONS]</span><br><span class="line"></span><br><span class="line">For more help options (several pages), use mysqld --verbose --help.</span><br><span class="line">2019-03-28T04:11:28.231753Z 0 [ERROR] Aborting</span><br><span class="line"></span><br><span class="line">[root@lant mysql]#</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><ol>
<li>会自动在/usr/local/mysql下生成data目录, 并且是mysql用户身份 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h2><ol>
<li><p>将mysql添加到systemctl系统服务</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/src/mysql-5.7.23/scripts/systemd/mysqld.service.in /usr/lib/systemd/system/mysqld.service</span><br><span class="line">cd /usr/lib/systemd/system/</span><br><span class="line">vi mysqld.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line"></span><br><span class="line">Type=forking</span><br><span class="line"></span><br><span class="line">PIDFile=/usr/local/mysql/mysqld.pid</span><br><span class="line"></span><br><span class="line"># Disable service start and stop timeout logic of systemd for mysqld service.</span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line"># Execute pre and post scripts as root</span><br><span class="line">PermissionsStartOnly=true</span><br><span class="line"></span><br><span class="line"># Needed to create system tables // 这里没找到这个脚本, 就先注释掉了</span><br><span class="line">#ExecStartPre=/usr/local/mysql/bin/mysqld_pre_systemd</span><br><span class="line"></span><br><span class="line"># Start main service</span><br><span class="line">ExecStart=/usr/local/mysql/bin/mysqld --daemonize --pid-file=/usr/local/mysql/mysqld.pid $MYSQLD_OPTS</span><br><span class="line"></span><br><span class="line"># Use this to switch malloc implementation</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mysql</span><br><span class="line"></span><br><span class="line"># Sets open_files_limit</span><br><span class="line">LimitNOFILE = 5000</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">RestartPreventExitStatus=1</span><br><span class="line"></span><br><span class="line">PrivateTmp=false</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后设置开机自动启动:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start mysqld</span><br><span class="line">netstat -anpt | grep 3306</span><br><span class="line">systemctl enable mysqld</span><br><span class="line"></span><br><span class="line">[root@lant mysql]# ps aux |grep mysql</span><br><span class="line">mysql     2833  0.1  9.8 1768144 179708 ?      Sl   02:40   0:00 /usr/local/mysql/bin/mysqld --daemonize --pid-file=/usr/local/mysql/mysqld.pid</span><br><span class="line">root      2867  0.0  0.0 112704   972 pts/0    S+   02:43   0:00 grep --color=auto mysql</span><br><span class="line">[root@lant mysql]#</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h2><ol>
<li><p>默认没有密码, 所以直接设置新密码后即可登录</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root -p password &quot;renyimin&quot;;</span><br><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>
</li>
<li><p>外部客户端连接?</p>
</li>
</ol>
<p>最后更新时间 2018/08/16</p>
<p>安装存储引擎 : <a href="https://www.cnblogs.com/wt645631686/p/8086682.html" target="_blank" rel="noopener">https://www.cnblogs.com/wt645631686/p/8086682.html</a></p>
<h2 id="编译过程中的问题"><a href="#编译过程中的问题" class="headerlink" title="编译过程中的问题"></a>编译过程中的问题</h2><ol>
<li>CMAKE 编译参数指定后, 是否在启动 mysql 时, 还可以动态修改配置?</li>
<li>CMAKE 编译参数未指定的话, 是否在启动mysql时, 还可以动态修改配置?<ul>
<li>存储引擎是以插件形式存在的, 如果编译时没有将某个存储引擎编译进来, 后续应该就不能用了<br><a href="https://www.cnblogs.com/hllnj2008/p/4043778.html" target="_blank" rel="noopener">https://www.cnblogs.com/hllnj2008/p/4043778.html</a></li>
<li>如果忘记编译进某个存储引擎 <a href="https://help.aliyun.com/knowledge_detail/41107.html?spm=5176.11065259.1996646101.searchclickresult.35c13f8dXRN0Rx" target="_blank" rel="noopener">https://help.aliyun.com/knowledge_detail/41107.html?spm=5176.11065259.1996646101.searchclickresult.35c13f8dXRN0Rx</a></li>
</ul>
</li>
</ol>
<p>3</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        

        
    </div>
    <footer>
        <a href="http://blog.renyimin.com">
            <img src="/img/avatar.jpeg" alt="Lant">
            Lant
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/《高性能MySQL》/">《高性能MySQL》</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/&title=《05. MySQL5.7 源码编译安装》 — Lant's&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/&title=《05. MySQL5.7 源码编译安装》 — Lant's&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《05. MySQL5.7 源码编译安装》 — Lant's&url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
      <div class="waves-block waves-effect prev">
        <a href="/2018/04/13/PHP/2018-04-13-phpstorm/" id="post-prev" class="post-nav-link">
          <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i>Prev </div>
          <h4 class="title">PhpStorm</h4>
        </a>
      </div>
    
  
    <div class="waves-block waves-effect next">
      <a href="/2018/04/14/PHP/2018-04-14-03/" id="post-next" class="post-nav-link">
        <div class="tips">Next<i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">No title</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rymuscle',
            repo: 'rymuscle.github.io',
            oauth: {
                client_id: '49b906f6d47dbab8d929',
                client_secret: '17fd73f24f616a09d4c09bca9480e0deba75a9a2',
            },
        })
        gitment.render('comments')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赞赏支持
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="bottom">
        <p><span>Lant &copy; 2016 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/&title=《05. MySQL5.7 源码编译安装》 — Lant's&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/&title=《05. MySQL5.7 源码编译安装》 — Lant's&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《05. MySQL5.7 源码编译安装》 — Lant's&url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2018/04/14/MySQL 暂停/2018-04-14-mysql-05/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACwElEQVR42u3a0YobMQwF0P3/n26hTy1lsvdKdprCmaewzHp8ErA0kr6+4uvHr+vvz6/v//06u87hCw8PD2+09afraStP9+QrvN7J668j2TMeHh7ebV4SDJK/5EEl2VwbVPDw8PA+jbd58D5dxsPDw/sfeVEKuyhwvF4TDw8P79N4SSkhSXzbdHlGulJrwcPDwzt6kuel1fd8flN/Dw8PD6/squfHepTarv+33i0eHh7eBV5Som1b+206nj9l1n7Dw8PDu8ebFSDygkI7jNXu6nFNPDw8vAu8dlAgT5GTRHw2lJAEJzw8PLz38KJb468gOdxnBYh6+AAPDw/vEC9//CaNnq3QhpxhGQIPDw9vxGtf/tsCQc44PNyAh4eHd4GXPyxJrPMHtIl7UlAeBgw8PDy8BS9/yS/a9mUAmI0XRGk6Hh4e3iFeu+k8sZ7VBw6MCGxmFvDw8PBGb+XtS347NDBrmA33j4eHh/cWXt64Olu2aMew6jkyPDw8vLfw2mM6LyskZdk8mX78OvDw8PAu8DZNrBzWNsbawPPN+nh4eHhHefmI1axUsSlhJKlz9Lvh4eHhHeW1bfskCW5JbVtuWPbFw8PDu8Zrm/2btlnb0FoNE+Dh4eEd4rWl0va4zwdbN4MC3/xieHh4eBd4+yN4VjJI2mCzYQI8PDy89/CSIz7Z4n4MaxOK/lgNDw8P7wIvX2g/IHU2DKxmGfDw8PAWvFPBYD8Q0ObA0WsAHh4e3mVecp0dMmiT5mQ/j8k0Hh4e3iFem3YnG82bYa9DxXACYvNWgYeHhzeqc86Wbo/svHjRPgUPDw/vnbykGNEWamfpb1u0/SY44eHh4f1T3qqFXza62rLy4wp4eHh4H8lrhwPazn4etK4EBjw8PLyyDZYs0Q4EtGGjvRMPDw/vNm/TAMsP8eIoH5UkVhceHh5eev0EXb/PFM6ZJ50AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.13"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.13" async></script>










<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>

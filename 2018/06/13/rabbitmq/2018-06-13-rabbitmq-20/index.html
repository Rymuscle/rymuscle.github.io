<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>20. 消费者预取 Consumer Prefetch | Lant&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="RabbitMQ">
    <meta name="description" content="Consumer Prefetch1.官方文档: https://www.rabbitmq.com/consumer-prefetch.html 2.译文:限制 unack 消息数量的更自然有效的方法;AMQP 0-9-1 指定了 basic.qos 方法, 以便你在消费者进行消费时, 可以限制channel(或connection)上未确认消息的数量;  不幸的是, channel 并不是理想的">
<meta name="keywords" content="RabbitMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="20. 消费者预取 Consumer Prefetch">
<meta property="og:url" content="http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/index.html">
<meta property="og:site_name" content="Lant&#39;s Blog">
<meta property="og:description" content="Consumer Prefetch1.官方文档: https://www.rabbitmq.com/consumer-prefetch.html 2.译文:限制 unack 消息数量的更自然有效的方法;AMQP 0-9-1 指定了 basic.qos 方法, 以便你在消费者进行消费时, 可以限制channel(或connection)上未确认消息的数量;  不幸的是, channel 并不是理想的">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.renyimin.com/img/rabbitmq/qos-test01.png">
<meta property="og:image" content="http://blog.renyimin.com/img/rabbitmq/qos-test02.png">
<meta property="og:image" content="http://blog.renyimin.com/img/rabbitmq/qos-test03.png">
<meta property="og:image" content="http://blog.renyimin.com/img/rabbitmq/qos-test03.png">
<meta property="og:image" content="http://blog.renyimin.com/img/rabbitmq/qos-prefetch-size-error.png">
<meta property="og:updated_time" content="2018-06-21T07:33:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="20. 消费者预取 Consumer Prefetch">
<meta name="twitter:description" content="Consumer Prefetch1.官方文档: https://www.rabbitmq.com/consumer-prefetch.html 2.译文:限制 unack 消息数量的更自然有效的方法;AMQP 0-9-1 指定了 basic.qos 方法, 以便你在消费者进行消费时, 可以限制channel(或connection)上未确认消息的数量;  不幸的是, channel 并不是理想的">
<meta name="twitter:image" content="http://blog.renyimin.com/img/rabbitmq/qos-test01.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lant&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.13">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lant</h5>
          <a href="mailto:564613464@qq.com" title="564613464@qq.com" class="mail">564613464@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">20. 消费者预取 Consumer Prefetch</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">20. 消费者预取 Consumer Prefetch</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-06-13T11:23:36.000Z" itemprop="datePublished" class="page-time">
  2018-06-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/RabbitMQ/">RabbitMQ</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Consumer-Prefetch"><span class="post-toc-number">1.</span> <span class="post-toc-text">Consumer Prefetch</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简要分析"><span class="post-toc-number">2.</span> <span class="post-toc-text">简要分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#测试1"><span class="post-toc-number">3.</span> <span class="post-toc-text">测试1</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#测试2"><span class="post-toc-number">4.</span> <span class="post-toc-text">测试2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#小结"><span class="post-toc-number">5.</span> <span class="post-toc-text">小结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#扩展"><span class="post-toc-number">6.</span> <span class="post-toc-text">扩展</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-rabbitmq/2018-06-13-rabbitmq-20"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">20. 消费者预取 Consumer Prefetch</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-06-13 19:23:36" datetime="2018-06-13T11:23:36.000Z"  itemprop="datePublished">2018-06-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/RabbitMQ/">RabbitMQ</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Consumer-Prefetch"><a href="#Consumer-Prefetch" class="headerlink" title="Consumer Prefetch"></a>Consumer Prefetch</h2><p>1.官方文档: <a href="https://www.rabbitmq.com/consumer-prefetch.html" target="_blank" rel="external">https://www.rabbitmq.com/consumer-prefetch.html</a></p>
<p>2.译文:<br>限制 unack 消息数量的更自然有效的方法;<br>AMQP 0-9-1 指定了 basic.qos 方法, 以便你在消费者进行消费时, 可以限制channel(或connection)上未确认消息的数量; </p>
<p>不幸的是, channel 并不是理想的范围 - 因为单个channel可能从多个队列进行消费, channel和queue需要为每个发送的消息相互协调, 以确保它们不会超出限制, 这在单台机器上会慢, 而在整个集群中使用时会非常慢;<br>此外, 对于许多用途, 指定<strong>适用于每个消费者的预取计数</strong>更会简单一些;</p>
<p>因此, RabbitMQ在basic.qos方法中重新定义了<strong>全局标志</strong>的含义 (在php-amqplib中basic_qos()的第三个参数a_global):</p>
<table>
<thead>
<tr>
<th>global</th>
<th style="text-align:right">Meaning of prefetch_count in AMQP 0-9-1</th>
<th style="text-align:center">Meaning of prefetch_count in RabbitMQ</th>
</tr>
</thead>
<tbody>
<tr>
<td>false</td>
<td style="text-align:right">shared across all consumers on the channel(在channel中的所有消费者中分享)</td>
<td style="text-align:center">applied separately to each new consumer on the channel(在频道上分别应用于每个新消费者)</td>
</tr>
<tr>
<td>true</td>
<td style="text-align:right">shared across all consumers on the connection(在连接上的所有消费者中共享)</td>
<td style="text-align:center">shared across all consumers on the channel(在渠道中的所有消费者中分享)</td>
</tr>
</tbody>
</table>
<p>请注意, 在大多数API中, 全局标志的默认值为false; (php-amqplib的basic_qos()方法的第三个参数a_global参数需要手动设置为false)</p>
<p>官网中有关于Java的相关示例可以参考;</p>
<h2 id="简要分析"><a href="#简要分析" class="headerlink" title="简要分析"></a>简要分析</h2><ol>
<li><p>在使用RabbitMQ时, 如果完全不配置QoS, RabbitMQ会将队列中的所有消息轮发到与队列绑定的consumers端; 而consumer会在本地缓存所有的message, 这样的话, 如果某个消费者的业务逻辑处理比较复杂, 那么将会在较长时间之后才会操作完成并ack;</p>
<ul>
<li>如果RabbitMQ并不考虑Consumer端的感受, 而采用默认的轮发方式, 消费慢的Consumer将会在本地堆积很多消息, 从而导致内存不足或者对其他进程造成影响;</li>
</ul>
</li>
<li><p>只有在手动ack的时候会生效 (prefetch_count在no_ask=false的情况下生效，在自动应答的情况下这两个值是不生效的)</p>
</li>
<li><p>你在Rabbit有一个队列, 然后一些消费者从这个队列中消费, 如果你根本没有设置QoS(basic.qos), 那么Rabbit会把所有的队列消息都按照网络和客户端允许的速度推送给客户端, 消费者将会飞速增加它们的内存占用, 因为它们将所有消息都缓存在自己的RAM中</p>
<ul>
<li>如果您添加新的消费者, 队列中也不会有消息发送给新的消费者;<br>即使有其他消费者可用于更快地处理这样的消息, 但由于消息已经被现有的客户端缓存，并且可能在那里很长一段时间</li>
<li>这种方式是相当次优的</li>
</ul>
</li>
</ol>
<h2 id="测试1"><a href="#测试1" class="headerlink" title="测试1"></a>测试1</h2><ol>
<li><p>本测试比较简单, 主要测试在默认不设置Qos的情况下, 两个不同消费能力的消费者(比如机器配置有差异)在处理时, 消费能力高的消费者可能很快消费完消息并处于闲置状态, 而消费能力低的消费者却在很慢地进行消费, <strong>这样就造成了限制资源的浪费</strong></p>
<ul>
<li>创建消费者1 ‘testQosCustomer1’ (简单打印消息内容) , 代码参考, <a href="https://github.com/rymuscle/Laravel-RabbitMQ/blob/master/app/Console/Commands/testQosConsumer1.php" target="_blank" rel="external">此处</a>, <strong>启动消费者</strong> <code>php artisan testQosConsumer1</code></li>
<li>创建消费者1 ‘testQosCustomer2’ (sleep 5秒, 模拟处理能力比较差) , 代码参考, <a href="https://github.com/rymuscle/Laravel-RabbitMQ/blob/master/app/Console/Commands/testQosConsumer2.php" target="_blank" rel="external">此处</a>, <strong>启动消费者</strong>  <code>php artisan testQosConsumer1</code></li>
<li>创建一个生产者 ‘testQosProducer’, 一次向队列 ‘qosTestQueue’ 中推送10条消息 , 代码参考, <a href="https://github.com/rymuscle/Laravel-RabbitMQ/blob/master/app/Http/Controllers/Demo/TestQosController.php" target="_blank" rel="external">此处</a>, <strong>请求一次生产者</strong> <a href="http://www.rabbit.com/testQos" target="_blank" rel="external">http://www.rabbit.com/testQos</a></li>
<li>注意需要先启动消费者, 再请求生产者; (如果先请求了生产者, 可能在启动第一个消费者之后, 其会迅速消费完10条消息, 这样就无法模拟效果了)</li>
</ul>
</li>
<li><p>测试发现</p>
<ul>
<li>testQosCustomer1 : 迅速打印出结果(1,3,5,7,9), 然后就处于闲置状态了</li>
<li>testQosCustomer2 : 还在缓慢打印(2,4,6,8,10)</li>
</ul>
</li>
<li><p>所以: 为了避免这种浪费资源的情况, 你可能就需要根据上一篇讲解的 prefetch_count 来针对不同消费者进行设置; (当然, 一般如果, 消费者都在同一台机器的话, 而且处理同一个业务, 消费能力不会差异太大, 但仍需要根据网络和处理能力给消费者设置合理的prefetch_count)</p>
</li>
</ol>
<h2 id="测试2"><a href="#测试2" class="headerlink" title="测试2"></a>测试2</h2><ol>
<li><p>根据上面的描述, 有如下疑问 </p>
<ul>
<li>在默认模式下, 这难道意味着, 生产者发布的消息会尽可能全部推送给消费者进程, 队列中会尽可能将消息全部推出? 全部缓存在消费者本地? 那当消费者断开时, 消息是如何恢复到队列中的? 或者不会恢复到队列中?<br>为了答疑, 下面进行测试 </li>
</ul>
</li>
<li><p>准备测试代码</p>
<ul>
<li>创建消费者1 ‘testQosConsumerPrefetchCount1’ (sleep 5秒, 模拟耗时业务需求; prefetch=100; 简单输出消息), 代码参考, <a href="https://github.com/rymuscle/Laravel-RabbitMQ/blob/master/app/Console/Commands/testQosConsumerPrefetchCount1.php" target="_blank" rel="external">此处</a></li>
<li>创建消费者1 ‘testQosConsumerPrefetchCount2’ (sleep 5秒, 模拟耗时业务需求; prefetch=100; 简单输出消息), 代码参考, <a href="https://github.com/rymuscle/Laravel-RabbitMQ/blob/master/app/Console/Commands/testQosConsumerPrefetchCount2.php" target="_blank" rel="external">此处</a></li>
<li>使用之前测试的生产者 ‘testQosProducer’, 一次向队列 ‘qosTestQueue’ 中推送100条消息 , 代码参考, <a href="https://github.com/rymuscle/Laravel-RabbitMQ/blob/master/app/Http/Controllers/Demo/TestQosController.php" target="_blank" rel="external">此处</a></li>
</ul>
</li>
<li><p>运行实例:</p>
<ul>
<li>请求一次生产者 <a href="http://www.rabbit.com/testQos" target="_blank" rel="external">http://www.rabbit.com/testQos</a></li>
<li>启动消费者1 <code>php artisan testQosConsumerPrefetchCount1</code></li>
</ul>
</li>
<li><p>测试效果:</p>
<ul>
<li>在运行生产者之后, <code>ready : 100, unack: 0, total : 100</code>, 表示队列中已经有100条消息已经就绪, 等待发出<br><img src="/img/rabbitmq/qos-test01.png" width="450"></li>
<li>运行第一个<code>php artisan testQosConsumerPrefetchCount1</code>之后, <code>ready : 0, unack : 100, total : 100</code> (也就是说, queue中已经没有 ready状态, 即准备好待发送的消息了, 消息都传递给消费者1了)<br><img src="/img/rabbitmq/qos-test02.png" width="450"></li>
<li><p>随着消费者的缓慢消费, <code>ready : 0, unack : 97, total : 97</code>  ()<br><img src="/img/rabbitmq/qos-test03.png" width="450"></p>
</li>
<li><p>如果模拟 挂掉第一个消费者之后, 会发现, <code>ready : 88， unack : 0, total : 88</code> (<strong>也就是说消费者意外宕掉之后, 队列中的消息会重新处于就绪状态</strong>, 等待着新的消费者来消费)<br><img src="/img/rabbitmq/qos-test03.png" width="450"></p>
</li>
<li><p>再次启动消费者2 <code>php artisan testQosConsumerPrefetchCount2</code>之后, <code>ready : 0, unack : 88, total : 88</code> (消息又会被全量发送给消费者2)</p>
<p>注意: 如果此时启动消费者1, 你会发现, 它是无法帮助消费者1进行消费的, 因为它还活着, 并且消息都在消费者2的本地, 所以队列中是没有 ready状态的就绪消息的;</p>
</li>
</ul>
</li>
</ol>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ol>
<li><p>消费者的unack消息数量如果未达到, Qos设置的 prefetch_count 量, <strong>Rabbit不会顾及消费者的消费能力, 会尽可能将queue中的消息全部推送出去给消费者</strong>;</p>
</li>
<li><p>因此, 当你发现消费者消费缓慢, 产生大量 unack 消息时, 即便增加新的消费者, 也无法帮助之前的消费者分担消息(除非消费者1的 unack达到了 prefetch_count 限制), 并且队列中此时并无 ready 状态的消息;</p>
</li>
<li><p>除非你断开之前的消费者, 然后启动一个新的消费者, 它才会重新开始处理 (因为之前的消费者挂掉之后, 其处理后的剩余消息在 queue中会恢复为 ready 状态)<br> 但是注意: 新启动的这个消费者如果设置额prefetch_count不合理的话, 假设与之前消费者的 预取值 设置一样大, 它很快也会产生大量 unack 消息<br> 所以, 在新启消费者的时候, 需要设计好 prefetch_count 的大小, 然后可以启动多个消费者来共同进行消费;</p>
</li>
<li><p>RabbitMQ服务器会在短时间内发送大量的消息给Consumer，而消费者处理能力有限, 没有来得及Ack的话, 那么服务端会积压大量的UnAcked消息, 而Consumer也可能会处于假死(可能引起程序崩溃);</p>
</li>
</ol>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ol>
<li><p>rabbitmq对basic.qos信令的处理</p>
<ul>
<li>首先, basic.qos 是针对channel进行设置的, 也就是说只有在channel建立之后才能发送basic.qos信令; RabbitMQ只支持通道级的预取计数, 而不是connection级的 或者 基于大小的预取;<br><a href="http://www.bubuko.com/infodetail-1955647.html" target="_blank" rel="external">预取</a></li>
<li>在rabbitmq的实现中, 每个channel都对应会有一个rabbit_limiter进程, 当收到basic.qos信令后, 在rabbit_limiter进程中记录信令中prefetch_count的值, 同时记录的还有该channel未ack的消息个数;</li>
</ul>
</li>
<li><p>在<code>php-amqplib</code>中, 可以使用信道的 <code>basic_qos()</code> 来进行控制, <code>basic_qos()</code> 有三个参数:</p>
<ul>
<li>prefetch_size : 限制预取的消息大小的参数, rabbitmq暂时没有实现 (如果prefetch_size字段不是默认值0, 则会通知客户端出错, 通知客户端<strong>RabbitMQ系统没有实现该参数的功能</strong>, 还可以参考<a href="https://github.com/sky-big/RabbitMQ/blob/d7a773e11f93fcde4497c764c9fa185aad049ce2/src/rabbit_channel.erl" target="_blank" rel="external">此文</a>)<br>当你设置prefetch_size大于0的时候, 会出现如下报错<br><img src="/img/rabbitmq/qos-prefetch-size-error.png" width="400"></li>
<li>prefetch_count : 预取消息数量</li>
<li>global, 但是RabbitMQ没有实现prefetch_size, 并在3.3.0版本中对global这个参数的含义进行了重新定义, 即glotal=true时表示在当前channel上所有的consumer都生效, 否则只对设置了之后新建的consumer生效;</li>
</ul>
</li>
</ol>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        

        
    </div>
    <footer>
        <a href="http://blog.renyimin.com">
            <img src="/img/avatar.jpeg" alt="Lant">
            Lant
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/&title=《20. 消费者预取 Consumer Prefetch》 — Lant's Blog&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/&title=《20. 消费者预取 Consumer Prefetch》 — Lant's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《20. 消费者预取 Consumer Prefetch》 — Lant's Blog&url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
      <div class="waves-block waves-effect prev">
        <a href="/2018/06/12/rabbitmq/2018-06-07-rabbitmq-11/" id="post-prev" class="post-nav-link">
          <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i>Prev </div>
          <h4 class="title">11. Dead Letter Exchanges 死信交换机</h4>
        </a>
      </div>
    
  
    <div class="waves-block waves-effect next">
      <a href="/2018/06/15/rabbitmq/2018-06-15-rabbitmq-21/" id="post-next" class="post-nav-link">
        <div class="tips">Next<i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">21. Consumer Priorities 消费者优先级</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rymuscle',
            repo: 'rymuscle.github.io',
            oauth: {
                client_id: '49b906f6d47dbab8d929',
                client_secret: '17fd73f24f616a09d4c09bca9480e0deba75a9a2',
            },
        })
        gitment.render('comments')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赞赏支持
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Lant &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/&title=《20. 消费者预取 Consumer Prefetch》 — Lant's Blog&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/&title=《20. 消费者预取 Consumer Prefetch》 — Lant's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《20. 消费者预取 Consumer Prefetch》 — Lant's Blog&url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2018/06/13/rabbitmq/2018-06-13-rabbitmq-20/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACt0lEQVR42u3aS24jMQwFwL7/pZ1tgMDux49sB6heBY4nrdJC1DzyuuLn8evJv5k/yRuTtzcfPDw8vMHSn7044T1bSu/nv+969p2bzcLDw8M7xsuXm/CS7cvflRcJPDw8vG/mVY/y5HDPtw8PDw/vf/F6RSK/oL++1uPh4eF9Dy8JI3oZaXIt7v12OWvBw8PDq/Wbrvyg/4afj/T38PDw8MZd9YUD91h/P1otHh4e3gFeNVxIrtrJ2EF+9PeiXjw8PLx38pLjuBr+5o20m4W2BhHw8PDwzvGqTamkJFQv0NVIN3ojHh4e3gFe4XoajwVUNy4pLXkBw8PDwzvNywHV63WvMPS24Or9Yzw8PLwiLz+Uq5FuNeqdXLVv+nt4eHh4q7ykcVUtGHmwWw1885VE/z/Aw8PDG/OqowDJX6jGvvn3m2EuHh4e3piXN+AngcXkuM+HDMpDA3h4eHgtXpWRt8TyAYV86CrfuJuZMjw8PLwBb2uh1evyVjNsobOHh4eH1+LlS+xdbfO2Vm+M4Olq8fDw8N7Oy9tLvcIweW+ylXh4eHgneNXrcj5eUA2Fk4VOxrzw8PDwtniTA3ey3ORKPXlXlLXg4eHhtXjVEOGKn2rAUW254eHh4X2KVy0D5UO5dU3PxwhuyhseHh7eAd5WeagOTk0KTH41x8PDwzvHWx51ihedhxGjjcPDw8N7Oy9vem1FCb3L/U3Fw8PDwzvASz55/XkvMujFxHkUgoeHh7fLexSf6nac2KxCGcPDw8M7wNuNU7fmZ0fztpPagoeHhxfzJsUgb5vlf6FXGKKsBQ8PD2+V12t6VdtUo9RkN6vAw8PD+xAvD4Wr5Wcr4MDDw8P7Bt6j9fTaYNX3LhQGPDw8vJhXDWSTz3sRQ741y1kLHh4e3lJXvVo8eozJhX4hwsDDw8NL1/YDNm4W24mvw1YAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.13"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.13" async></script>










</body>
</html>

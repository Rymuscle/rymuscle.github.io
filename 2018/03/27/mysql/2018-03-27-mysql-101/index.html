<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>101. 分区,分表,分库 | Lant&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="MySQL">
    <meta name="description" content="前言 MySQL是从5.1开始支持分区功能的, 在MySQL中, 数据是以文件的形势存在磁盘上的, 默认放在 ‘/mysql/data/‘ 下(可以通过my.cnf中的datadir来指定)  MyISAM引擎中, 一张表主要对应着三个文件:   .frm(与表相关的元数据信息都存放在frm文件, 包括表结构的定义信息等) .myd(存放表数据) .myi(存表索引)   InnoDB引擎中, 一">
<meta name="keywords" content="MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="101. 分区,分表,分库">
<meta property="og:url" content="http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/index.html">
<meta property="og:site_name" content="Lant&#39;s Blog">
<meta property="og:description" content="前言 MySQL是从5.1开始支持分区功能的, 在MySQL中, 数据是以文件的形势存在磁盘上的, 默认放在 ‘/mysql/data/‘ 下(可以通过my.cnf中的datadir来指定)  MyISAM引擎中, 一张表主要对应着三个文件:   .frm(与表相关的元数据信息都存放在frm文件, 包括表结构的定义信息等) .myd(存放表数据) .myi(存表索引)   InnoDB引擎中, 一">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-03-28T02:09:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="101. 分区,分表,分库">
<meta name="twitter:description" content="前言 MySQL是从5.1开始支持分区功能的, 在MySQL中, 数据是以文件的形势存在磁盘上的, 默认放在 ‘/mysql/data/‘ 下(可以通过my.cnf中的datadir来指定)  MyISAM引擎中, 一张表主要对应着三个文件:   .frm(与表相关的元数据信息都存放在frm文件, 包括表结构的定义信息等) .myd(存放表数据) .myi(存表索引)   InnoDB引擎中, 一">
    
        <link rel="alternate" type="application/atom+xml" title="Lant&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.13">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lant</h5>
          <a href="mailto:564613464@qq.com" title="564613464@qq.com" class="mail">564613464@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/rymuscle" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">101. 分区,分表,分库</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">101. 分区,分表,分库</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-03-27T03:37:12.000Z" itemprop="datePublished" class="page-time">
  2018-03-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MySQL/">MySQL</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#查看当前MySQL版本是否支持分区"><span class="post-toc-number">2.</span> <span class="post-toc-text">查看当前MySQL版本是否支持分区</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#分区的2种方式"><span class="post-toc-number">3.</span> <span class="post-toc-text">分区的2种方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#横向分区"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">横向分区</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#纵向分区"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">纵向分区</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#横向分区-1"><span class="post-toc-number">4.</span> <span class="post-toc-text">横向分区</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#range分区"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">range分区</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#List分区"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">List分区</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hash分区"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">hash分区</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#key分区"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">key分区</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#子分区"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">子分区</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-mysql/2018-03-27-mysql-101"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">101. 分区,分表,分库</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-03-27 11:37:12" datetime="2018-03-27T03:37:12.000Z"  itemprop="datePublished">2018-03-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/MySQL/">MySQL</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ol>
<li><p>MySQL是从5.1开始支持分区功能的, 在MySQL中, 数据是以文件的形势存在磁盘上的, 默认放在 ‘/mysql/data/‘ 下(可以通过my.cnf中的datadir来指定)</p>
</li>
<li><p>MyISAM引擎中, 一张表主要对应着三个文件: </p>
<ul>
<li><code>.frm</code>(与表相关的元数据信息都存放在frm文件, 包括表结构的定义信息等)</li>
<li><code>.myd</code>(存放表数据)</li>
<li><code>.myi</code>(存表索引)</li>
</ul>
</li>
<li><p>InnoDB引擎中, 一张表也是对应着三个文件: </p>
<ul>
<li><code>.frm</code>(和MyISAM差不多)</li>
<li><code>.ibd</code>文件和<code>.ibdata</code>文件, 都是存放innodb数据的文件, 之所以用两种文件来存放innodb的数据, 是因为innodb的数据存储方式能够通过配置来决定是使用共享表空间存放存储数据, 还是用独享表空间存放存储数据<br>独享表空间存储方式使用.ibd文件,并且每个表一个ibd文件;<br>共享表空间存储方式使用.ibdata文件，所有表共同使用一个ibdata文件<br>可在mysql的配置文件通过<code>innodb_file_per_table</code>进行配置</li>
</ul>
</li>
<li><p>如果一张表的数据量太大, <code>.ibd</code>, <code>.myd</code>, <code>.myi</code> 之类的文件就会变的很大, 查找数据就会变的很慢, 此时就可以利用mysql的分区功能, 在物理上将这一张表对应的三个文件, 分割成许多个小块, 这样之后, 如果查找一条数据时, 就不用全部查找了, 只要知道这条数据在哪一块, 然后在那一块找即可;<br> 如果表的数据太大, 可能一个磁盘放不下, 此时, 还可以把数据分配到不同的磁盘里面去;</p>
</li>
</ol>
<h2 id="查看当前MySQL版本是否支持分区"><a href="#查看当前MySQL版本是否支持分区" class="headerlink" title="查看当前MySQL版本是否支持分区"></a>查看当前MySQL版本是否支持分区</h2><ol>
<li><p>对于MySQL5.6以下版本, 如果查询结果显示Empty, 表示不支持分区:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like &apos;%partition%&apos;;</div><div class="line">Empty set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>对于mysql5.6以及以上版本, 需要使用下面的查询命令:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show plugins;</div></pre></td></tr></table></figure>
<p> 上面的查询方法会显示所有插件, 如果有如下插件的话, 表示支持分区:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">| partition                  | ACTIVE   | STORAGE ENGINE     | NULL    | GPL     |</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="分区的2种方式"><a href="#分区的2种方式" class="headerlink" title="分区的2种方式"></a>分区的2种方式</h2><h3 id="横向分区"><a href="#横向分区" class="headerlink" title="横向分区"></a>横向分区</h3><p>横向分区: 比如, 有1000W条数据, 分成十份, 前10W条数据放到第一个分区, 第二个10W条数据放到第二个分区, 依此类推; </p>
<ul>
<li>也就是把表分成了十份(和使用<code>merge</code>来分表有点像, 取出一条数据的时候, 这条数据包含了表结构中的所有字段);</li>
<li>横向分区, 并没有改变表的结构;</li>
</ul>
<h3 id="纵向分区"><a href="#纵向分区" class="headerlink" title="纵向分区"></a>纵向分区</h3><p>纵向分区: 比如, 在设计用户表的时候, 开始的时候没有考虑好, 把用户的所有信息都放到了一张表里面去, 这样这个表里面就会有比较大的字段, 如个人简介..等, 而这些简介也许不会有好多人去看，所以等到有人要看的时候, 再去查找(分表的时候, 可以把这样的大字段与主表分开来);</p>
<h2 id="横向分区-1"><a href="#横向分区-1" class="headerlink" title="横向分区"></a>横向分区</h2><p>mysql提供的分区属于第一种 <code>横向分区</code>, 并且细分成很多种方式</p>
<h3 id="range分区"><a href="#range分区" class="headerlink" title="range分区"></a>range分区</h3><ol>
<li><p>按照<code>RANGE</code>分区的表是通过如下方式进行分区的, 分区表达式的值位于一个给定的连续区间内的那些行, 会被放到一个分区中</p>
<ul>
<li><p>创建表同时进行分区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS `user` (  </div><div class="line">`id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;用户ID&apos;,  </div><div class="line">`name` varchar(50) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;名称&apos;,  </div><div class="line">`sex` int(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0为男，1为女&apos;,  </div><div class="line">PRIMARY KEY (`id`)  </div><div class="line">) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1  </div><div class="line">PARTITION BY RANGE (id) (  </div><div class="line">PARTITION p0 VALUES LESS THAN (3),  </div><div class="line">PARTITION p1 VALUES LESS THAN ( 6 ),</div><div class="line">PARTITION p2 VALUES LESS THAN (9),  </div><div class="line">PARTITION p3 VALUES LESS THAN (12),  </div><div class="line">PARTITION p4 VALUES LESS THAN MAXVALUE  </div><div class="line">);</div></pre></td></tr></table></figure>
</li>
<li><p>查看分区效果 (到数据表文件的存放处 <code>$ cd /Library/Application\ Support/appsolute/MAMP\ PRO/db/mysql56/</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ ls |grep user |xargs du -sh</div><div class="line">0B	    user#P#p0.MYD</div><div class="line">4.0K	    user#P#p0.MYI</div><div class="line">0B	    user#P#p1.MYD</div><div class="line">4.0K	    user#P#p1.MYI</div><div class="line">0B	    user#P#p2.MYD</div><div class="line">4.0K	    user#P#p2.MYI</div><div class="line">0B	    user#P#p3.MYD</div><div class="line">4.0K	    user#P#p3.MYI</div><div class="line">0B	    user#P#p4.MYD</div><div class="line">4.0K	    user#P#p4.MYI</div><div class="line">12K	    user.frm</div><div class="line">4.0K	    user.par</div></pre></td></tr></table></figure>
</li>
<li><p>插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">INSERT INTO `test`.`user` (`name` ,`sex`)VALUES (&apos;tank&apos;, &apos;0&apos;)  </div><div class="line">,(&apos;zhang&apos;,1),(&apos;ying&apos;,1),(&apos;张&apos;,1),(&apos;映&apos;,0),(&apos;test1&apos;,1),(&apos;tank2&apos;,1)  </div><div class="line">,(&apos;tank1&apos;,1),(&apos;test2&apos;,1),(&apos;test3&apos;,1),(&apos;test4&apos;,1),(&apos;test5&apos;,1),(&apos;tank3&apos;,1)  </div><div class="line">,(&apos;tank4&apos;,1),(&apos;tank5&apos;,1),(&apos;tank6&apos;,1),(&apos;tank7&apos;,1),(&apos;tank8&apos;,1),(&apos;tank9&apos;,1)  </div><div class="line">,(&apos;tank10&apos;,1),(&apos;tank11&apos;,1),(&apos;tank12&apos;,1),(&apos;tank13&apos;,1),(&apos;tank21&apos;,1),(&apos;tank42&apos;,1);</div></pre></td></tr></table></figure>
</li>
<li><p>再次查看分区效果<br>如下可以看到, 文件大小都是4.0K, 从这儿我们可以看出<strong>MyISAM引擎下, 分区的最小区块是4K (InnoDB貌似是96k)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ ls |grep user |xargs du -sh</div><div class="line">4.0K	    user#P#p0.MYD</div><div class="line">4.0K	    user#P#p0.MYI</div><div class="line">4.0K	    user#P#p1.MYD</div><div class="line">4.0K	    user#P#p1.MYI</div><div class="line">4.0K	    user#P#p2.MYD</div><div class="line">4.0K	    user#P#p2.MYI</div><div class="line">4.0K    	user#P#p3.MYD</div><div class="line">4.0K	    user#P#p3.MYI</div><div class="line">4.0K	    user#P#p4.MYD</div><div class="line">4.0K    	user#P#p4.MYI</div><div class="line">12K	    user.frm</div><div class="line">4.0K	    user.par</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>数据测试</p>
<ul>
<li><p>初始数据为25条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select count(id) as count from user;</div><div class="line">+-------+</div><div class="line">| count |</div><div class="line">+-------+</div><div class="line">|    25 |</div><div class="line">+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>删除第四个分区</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; alter table user drop partition p4; </div><div class="line">Query OK, 0 rows affected (0.15 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure>
</li>
<li><p>可以发现, 存放在第四个分区里面的14条数据丢失了, 剩下的3个分区只有11条数据  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select count(id) as count from user; </div><div class="line">+-------+</div><div class="line">| count |</div><div class="line">+-------+</div><div class="line">|    11 |</div><div class="line">+-------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>
</li>
<li><p>查看分区文件, 发现第四个分区确实被删除了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ ls |grep user |xargs du -sh</div><div class="line">4.0K	    user#P#p0.MYD</div><div class="line">4.0K	    user#P#p0.MYI</div><div class="line">4.0K	    user#P#p1.MYD</div><div class="line">4.0K	    user#P#p1.MYI</div><div class="line">4.0K	    user#P#p2.MYD</div><div class="line">4.0K	    user#P#p2.MYI</div><div class="line">4.0K	    user#P#p3.MYD</div><div class="line">4.0K	    user#P#p3.MYI</div><div class="line">12K	    user.frm</div><div class="line">4.0K    	user.par</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>小结: 可以发现, 在进行range分区后</p>
<ul>
<li>会生成一个 <code>.par</code>文件,用来存储分区信息;</li>
<li>MyISAM/InnoDB引擎, 原有的 <code>.frm</code> 表结构文件没有被分隔;</li>
<li>MyISAM引擎, 原有的 <code>.MYD</code>数据文件, <code>.MYI</code>索引文件都被分隔了;</li>
<li>InnoDB引擎, 原有的 <code>.idb</code>数据文件被分隔了;</li>
</ul>
</li>
<li><p>注意</p>
<ul>
<li>当往分区列中插入null值, RANG分区会将其当作最小值来处理即插入最小的分区中</li>
<li>list分区中, NULL值必须出现在分区枚举值中, 否在在插入数据是会报错</li>
<li>hash和key会将NULL当做0处理</li>
</ul>
</li>
</ol>
<h3 id="List分区"><a href="#List分区" class="headerlink" title="List分区"></a>List分区</h3><ol>
<li><p>RANGE分区是从属于一个连续区间值的集合, 而LIST分区是基于某列的值从属于一个值列表集中的一个值</p>
</li>
<li><p>如果不用主键, 如下list分区可以创建成功，一般情况下, 一张表肯定会有一个主键(所以如果需要用其他键来做分区, 参考下一篇博文<a href="2017/12/17/mysql/2017-12-17-mysql-102/">分区键, 主键, 唯一索引关系</a>)</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS `list_part` (  </div><div class="line">`id` int(11) NOT NULL COMMENT &apos;用户ID&apos;,  </div><div class="line">`province_id` int(2) NOT NULL DEFAULT 0 COMMENT &apos;省&apos;,  </div><div class="line">`name` varchar(50) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;名称&apos;,  </div><div class="line">`sex` int(1) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;0为男, 1为女&apos;</div><div class="line">) ENGINE=INNODB DEFAULT CHARSET=utf8</div><div class="line">PARTITION BY LIST (province_id) (  </div><div class="line">	PARTITION p0 VALUES IN (1,2,3,4,5,6,7,8),  </div><div class="line">	PARTITION p1 VALUES IN (9,10,11,12,16,21),  </div><div class="line">	PARTITION p2 VALUES IN (13,14,15,19),  </div><div class="line">	PARTITION p3 VALUES IN (17,18,20,22,23,24)</div><div class="line">);</div><div class="line"></div><div class="line">// 创建成功, 会看到分区效果 (InnoDB默认分区最小是96k)</div><div class="line">$ ls |grep list_part |xargs du -sh</div><div class="line">96K	    list_part#P#p0.ibd</div><div class="line">96K	    list_part#P#p1.ibd</div><div class="line">96K	    list_part#P#p2.ibd</div><div class="line">96K	    list_part#P#p3.ibd</div><div class="line">12K	    list_part.frm</div><div class="line">4.0K	    list_part.par</div></pre></td></tr></table></figure>
</li>
<li><p>注意</p>
<ul>
<li>当往分区列中插入null值, RANG分区会将其当作最小值来处理即插入最小的分区中</li>
<li>list分区中, NULL值必须出现在分区枚举值中, 否在在插入数据是会报错</li>
<li>hash和key会将NULL当做0处理</li>
<li>RANGE分区必须的连续的且不能重叠(<code>3,6,9,12,MAXVALUE</code>可以, <code>3,6,5,12,MAXVALUE</code>就会报错)</li>
</ul>
</li>
</ol>
<h3 id="hash分区"><a href="#hash分区" class="headerlink" title="hash分区"></a>hash分区</h3><ol>
<li><p>HASH分区主要用来确保数据在预先确定数目的分区中平均分布, 你所要做的只是</p>
<ul>
<li>对将要被哈希的列值, 指定一个列值或表达式;</li>
<li>指定被分区的表将要被分割成的分区数量;</li>
<li>对HASH分区，使用的用户函数必须返回一个大于0的整数值;</li>
</ul>
</li>
<li><p>创建表同时进行hash分区</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS `hash_part` (  </div><div class="line">	`id` int(11) NOT NULL AUTO_INCREMENT COMMENT &apos;评论ID&apos;,  </div><div class="line">	`comment` varchar(1000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;评论&apos;,  </div><div class="line">	`ip` varchar(25) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;来源IP&apos;,  </div><div class="line">	PRIMARY KEY (`id`)  </div><div class="line">) ENGINE=INNODB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1  </div><div class="line">PARTITION BY HASH(id)  </div><div class="line">PARTITIONS 3;</div></pre></td></tr></table></figure>
</li>
<li><p>查看分区效果</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ls |grep hash_part |xargs du -sh</div><div class="line">96K	    hash_part#P#p0.ibd</div><div class="line">96K	    hash_part#P#p1.ibd</div><div class="line">96K	    hash_part#P#p2.ibd</div><div class="line">12K	    hash_part.frm</div><div class="line">4.0K    	hash_part.par</div></pre></td></tr></table></figure>
</li>
<li><p>注意</p>
<ul>
<li>当往分区列中插入null值, RANG分区会将其当作最小值来处理即插入最小的分区中</li>
<li>list分区中, NULL值必须出现在分区枚举值中, 否在在插入数据是会报错</li>
<li>hash和key会将NULL当做0处理</li>
<li>RANGE分区必须的连续的且不能重叠(<code>3,6,9,12,MAXVALUE</code>可以, <code>3,6,5,12,MAXVALUE</code>就会报错)</li>
</ul>
</li>
</ol>
<h3 id="key分区"><a href="#key分区" class="headerlink" title="key分区"></a>key分区</h3><ol>
<li><p>按照KEY进行分区, 类似于按照HASH分区</p>
<ul>
<li>HASH分区是使用用户定义的表达式</li>
<li>而KEY分区的哈希函数是由MySQL服务器提供</li>
</ul>
</li>
<li><p>创建表同时进行key分区</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS `key_part` (  </div><div class="line">	`news_id` int(11) NOT NULL  COMMENT &apos;新闻ID&apos;,  </div><div class="line">	`content` varchar(1000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;新闻内容&apos;,  </div><div class="line">	`u_id` varchar(25) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;来源IP&apos;,  </div><div class="line">	`create_time` DATE NOT NULL DEFAULT &apos;0000-00-00 00:00:00&apos; COMMENT &apos;时间&apos;  </div><div class="line">	) ENGINE=INNODB  DEFAULT CHARSET=utf8  </div><div class="line">	PARTITION BY LINEAR HASH(YEAR(create_time))  </div><div class="line">	PARTITIONS 3;</div></pre></td></tr></table></figure>
</li>
<li><p>查看分区效果</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ ls |grep key_part |xargs du -sh</div><div class="line">96K	key_part#P#p0.ibd</div><div class="line">96K	key_part#P#p1.ibd</div><div class="line">96K	key_part#P#p2.ibd</div><div class="line">12K	key_part.frm</div><div class="line">4.0K	key_part.par</div></pre></td></tr></table></figure>
</li>
<li><p>注意</p>
<ul>
<li>当往分区列中插入null值, RANG分区会将其当作最小值来处理即插入最小的分区中</li>
<li>list分区中, NULL值必须出现在分区枚举值中, 否在在插入数据是会报错</li>
<li>hash和key会将NULL当做0处理</li>
<li>RANGE分区必须的连续的且不能重叠(<code>3,6,9,12,MAXVALUE</code>可以, <code>3,6,5,12,MAXVALUE</code>就会报错)</li>
</ul>
</li>
</ol>
<h3 id="子分区"><a href="#子分区" class="headerlink" title="子分区"></a>子分区</h3><ol>
<li><p>子分区是分区表中每个分区的再次分割, 对于已经通过<code>RANGE</code>或<code>LIST</code>分区了的表再进行子分区是可能的, 子分区既可以使用<code>HASH</code>分区, 也可以使用<code>KEY</code>分区; 这也被称为复合分区(composite partitioning)</p>
<ul>
<li>如果一个分区中创建了子分区, 其他分区也要有子分区</li>
<li>如果创建了子分区, 每个分区中的<strong>子分区数必须相同</strong></li>
<li>同一分区内的子分区, 名字不相同, 不同分区内的子分区名子可以相同(5.1.50不适用)</li>
</ul>
</li>
<li><p>创建表同时, 进行子分区操作</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE IF NOT EXISTS `sub_part` (  </div><div class="line">`news_id` int(11) NOT NULL  COMMENT &apos;新闻ID&apos;,  </div><div class="line">`content` varchar(1000) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;新闻内容&apos;,  </div><div class="line">`u_id`  int(11) NOT NULL DEFAULT 0 COMMENT &apos;来源IP&apos;,  </div><div class="line">`create_time` DATE NOT NULL DEFAULT &apos;0000-00-00 00:00:00&apos; COMMENT &apos;时间&apos;  </div><div class="line">) ENGINE=INNODB  DEFAULT CHARSET=utf8  </div><div class="line">PARTITION BY RANGE(YEAR(create_time))  </div><div class="line">SUBPARTITION BY HASH(TO_DAYS(create_time))(  </div><div class="line">    	PARTITION p0 VALUES LESS THAN (1990)(</div><div class="line">    	    SUBPARTITION s0,SUBPARTITION s1,SUBPARTITION s2</div><div class="line">    	),  </div><div class="line">    	PARTITION p1 VALUES LESS THAN (2000)(</div><div class="line">    	    SUBPARTITION s3,SUBPARTITION s4,SUBPARTITION good</div><div class="line">    	),  </div><div class="line">	    PARTITION p2 VALUES LESS THAN MAXVALUE(</div><div class="line">	        SUBPARTITION tank0,SUBPARTITION tank1,SUBPARTITION tank3</div><div class="line">	    )  </div><div class="line">);</div></pre></td></tr></table></figure>
</li>
<li><p>查看分区后, 数据表文件结构</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ ls |grep sub_part |xargs du -sh</div><div class="line">96K	    sub_part#P#p0#SP#s0.ibd</div><div class="line">96K	    sub_part#P#p0#SP#s1.ibd</div><div class="line">96K	    sub_part#P#p0#SP#s2.ibd</div><div class="line">96K	    sub_part#P#p1#SP#good.ibd</div><div class="line">96K	    sub_part#P#p1#SP#s3.ibd</div><div class="line">96K	    sub_part#P#p1#SP#s4.ibd</div><div class="line">96K	    sub_part#P#p2#SP#tank0.ibd</div><div class="line">96K	    sub_part#P#p2#SP#tank1.ibd</div><div class="line">96K	    sub_part#P#p2#SP#tank3.ibd</div><div class="line">12K	    sub_part.frm</div><div class="line">4.0K    	sub_part.par</div></pre></td></tr></table></figure></li>
</ol>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        

        
    </div>
    <footer>
        <a href="http://blog.renyimin.com">
            <img src="/img/avatar.jpeg" alt="Lant">
            Lant
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/&title=《101. 分区,分表,分库》 — Lant's Blog&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/&title=《101. 分区,分表,分库》 — Lant's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《101. 分区,分表,分库》 — Lant's Blog&url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
      <div class="waves-block waves-effect prev">
        <a href="/2018/01/13/PHP/2018-01-13-yield/" id="post-prev" class="post-nav-link">
          <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i>Prev </div>
          <h4 class="title">yield 协程</h4>
        </a>
      </div>
    
  
    <div class="waves-block waves-effect next">
      <a href="/2018/03/27/mysql/2018-03-27-mysql-102/" id="post-next" class="post-nav-link">
        <div class="tips">Next<i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">102. 分区键, 主键, 唯一索引关系</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rymuscle',
            repo: 'rymuscle.github.io',
            oauth: {
                client_id: '49b906f6d47dbab8d929',
                client_secret: '17fd73f24f616a09d4c09bca9480e0deba75a9a2',
            },
        })
        gitment.render('comments')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赞赏支持
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Lant &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/&title=《101. 分区,分表,分库》 — Lant's Blog&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/&title=《101. 分区,分表,分库》 — Lant's Blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《101. 分区,分表,分库》 — Lant's Blog&url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2018/03/27/mysql/2018-03-27-mysql-101/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACs0lEQVR42u3aQW7jMBAEwPz/09nrAht6u4ekokPpZCSOxWIAcdwzX1/x9b24/v3t6q/+/snn18kdD194eHh4h5a+Any+WbKU9vPz9/9wXzw8PLxrvNUi2gf66vbJ03u2nv9Y8PDw8F7DSwrottadbTEeHh7e+3mzJSYbNAsy8PDw8H6Ll8QBCSwJET6/M4+DD2cteHh4eDEvL3/f8/pKfw8PDw9vu6ueN8PysnvnQKpXi4eHh3eBlz9wv7evs2NeeYSBh4eHd5bXhrOzMHd2zOyHIHh4eHj3eLOyOI9W2zbYsXYaHh4e3gVe+/DNBw5adguu/4d4eHh4h3jJcED7sN4pr5P2W9EYw8PDw7vG+3yD/JBot6ONbutWHB4eHt4FXnKztvjeKZfzA6OIMPDw8PCu8WahalHgjoKM2RADHh4e3pO8vDE2a31FLf/4WIo2Fw8PD+9BXnubU0ucbeLy0/Dw8PAu8PLSNg8UcvZODNGW8nh4eHj7vFm0mhffO82zvLhfWvDw8PAu8GZtqtk3/dlxMivNl6MDeHh4eNu8Nq49G0nMBhGKrcTDw8N7hLff4G9bZTtNsuE3Bjw8PLxDvHYRbRycj0m1we5yzXh4eHgXePnQVf5Q3glh90v24UwZHh4e3miAIG9BzaYS2kMoHzKIji48PDy8o7y2wZ9HCXkBnYcdbTiCh4eHd4+3E6e2o1dtQJwHJT9sGR4eHt6DvNlYQP64b+81HMnCw8PDO8rbKYVnA1VtHJzHFnh4eHjP8PLr1C3bA6NtdNUwPDw8vBEvbywli26HpZJPm7XK8PDw8G7z2tAhf2Q/eoLh4eHhvZKXHx77m7K/3Xh4eHjv4c0a//uFchKLRCcMHh4e3jZvp/mU/DzfxHa8FQ8PD+95Xv31PghwW0becjsbW+Dh4eGVvD/L/QMnvdomJwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.13"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.13" async></script>










</body>
</html>

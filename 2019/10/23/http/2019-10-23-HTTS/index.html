<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>HTTPS是什么?SSL/TLS又是什么? | Lant&#39;s</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="HTTP">
    <meta name="description" content="前言之前曾谈到过 HTTP 的一些缺点, 其中的 无状态 在加入 Cookie 后得到了解决, 而另两个缺点 — 明文 和 不安全 仅凭 HTTP 自身是无力解决的, 需要引 入新的 HTTPS 协议  由于 HTTP 天生 明文 的特点, 整个传输过程完全透明, 任何人都能够在链路中截获、 修改或者伪造请求 / 响应报文, 数据不具有可信性比如, “代理服务”, 它作为 HTTP 通信的中间人,">
<meta name="keywords" content="HTTP">
<meta property="og:type" content="article">
<meta property="og:title" content="HTTPS是什么?SSL&#x2F;TLS又是什么?">
<meta property="og:url" content="http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/index.html">
<meta property="og:site_name" content="Lant&#39;s">
<meta property="og:description" content="前言之前曾谈到过 HTTP 的一些缺点, 其中的 无状态 在加入 Cookie 后得到了解决, 而另两个缺点 — 明文 和 不安全 仅凭 HTTP 自身是无力解决的, 需要引 入新的 HTTPS 协议  由于 HTTP 天生 明文 的特点, 整个传输过程完全透明, 任何人都能够在链路中截获、 修改或者伪造请求 / 响应报文, 数据不具有可信性比如, “代理服务”, 它作为 HTTP 通信的中间人,">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.renyimin.com/img/http/https-01.png">
<meta property="og:image" content="http://blog.renyimin.com/img/http/https-publickey-01.png">
<meta property="og:image" content="http://blog.renyimin.com/img/http/https-publickey-02.png">
<meta property="og:updated_time" content="2019-11-01T06:35:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HTTPS是什么?SSL&#x2F;TLS又是什么?">
<meta name="twitter:description" content="前言之前曾谈到过 HTTP 的一些缺点, 其中的 无状态 在加入 Cookie 后得到了解决, 而另两个缺点 — 明文 和 不安全 仅凭 HTTP 自身是无力解决的, 需要引 入新的 HTTPS 协议  由于 HTTP 天生 明文 的特点, 整个传输过程完全透明, 任何人都能够在链路中截获、 修改或者伪造请求 / 响应报文, 数据不具有可信性比如, “代理服务”, 它作为 HTTP 通信的中间人,">
<meta name="twitter:image" content="http://blog.renyimin.com/img/http/https-01.png">
    
        <link rel="alternate" type="application/atom+xml" title="Lant&#39;s" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.13">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand4.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Lant</h5>
          <a href="mailto:18625036504@163.com" title="18625036504@163.com" class="mail">18625036504@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">HTTPS是什么?SSL/TLS又是什么?</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h5 class="subtitle">
            
                <time datetime="2019-10-23T12:31:09.000Z" itemprop="datePublished" class="page-time">
  2019-10-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/HTTP/">HTTP</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#前言"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#什么是安全"><span class="post-toc-number">2.</span> <span class="post-toc-text">什么是安全?</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#机密性-Secrecy-Confidentiality"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">机密性(Secrecy/Confidentiality)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#完整性-Integrity-也叫一致性"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">完整性(Integrity, 也叫一致性)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#身份认证-Authentication"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">身份认证(Authentication)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#不可否认-Non-repudiation-Undeniable"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">不可否认(Non-repudiation/Undeniable)</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#HTTPS"><span class="post-toc-number">3.</span> <span class="post-toc-text">HTTPS</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#HTTPS如何为-HTTP-增加四个特性的"><span class="post-toc-number">4.</span> <span class="post-toc-text">HTTPS如何为 HTTP 增加四个特性的</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#机密性"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">机密性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对称加密"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">对称加密</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#加密分组模式"><span class="post-toc-number">4.1.2.</span> <span class="post-toc-text">加密分组模式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#非对称加密"><span class="post-toc-number">4.1.3.</span> <span class="post-toc-text">非对称加密</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#混合加密"><span class="post-toc-number">4.1.4.</span> <span class="post-toc-text">混合加密</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TLS1-2连接过程解析"><span class="post-toc-number">5.</span> <span class="post-toc-text">TLS1.2连接过程解析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#HTTPS-建立连接"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">HTTPS 建立连接</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TLS-协议的组成"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">TLS 协议的组成</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#迁移HTTPS的必要性"><span class="post-toc-number">6.</span> <span class="post-toc-text">迁移HTTPS的必要性</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-http/2019-10-23-HTTS"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">HTTPS是什么?SSL/TLS又是什么?</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-10-23 20:31:09" datetime="2019-10-23T12:31:09.000Z"  itemprop="datePublished">2019-10-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/HTTP/">HTTP</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前曾谈到过 HTTP 的一些缺点, 其中的 <code>无状态</code> 在加入 <code>Cookie</code> 后得到了解决, 而另两个缺点 — <code>明文</code> 和 <code>不安全</code> 仅凭 HTTP 自身是无力解决的, 需要引 入新的 <code>HTTPS</code> 协议</p>
<blockquote>
<p>由于 HTTP 天生 <code>明文</code> 的特点, 整个传输过程完全透明, 任何人都能够在链路中截获、 修改或者伪造请求 / 响应报文, 数据不具有可信性<br>比如, “代理服务”, 它作为 HTTP 通信的中间人, 在数据上下行的时候可以添加或删除部分头字段, 也可以使用黑白名单过滤 body 里的关键字, 甚至直接发送虚假的请求、响应, 而浏览器和源服务器都没有办法判断报文的真伪<br>因此 HTTP 明文这一特性, 对于网络购物、网上银行、证券交易等需要高度信任的应用场景来说是非常致命的。<br>如果没有基本的安全保护, 使用互联网进行各种电子商务、电子政务就根本无从谈起<br>对于安全性要求不那么高的新闻、视频、搜索等网站来说, 由于互联网上的恶意用户、恶意代理越来越多, 也很容易遭到 “流量劫持” 的攻击, 在页面里强行嵌入广告, 或者分流用户, 导致各种利益损失<br>对于你我这样的普通网民来说, HTTP 不安全的隐患就更大了, 上网的记录会被轻易截获, 网站是否真实也无法验证, 黑客可以伪装成银行网站, 盗取真实姓名、密码、银行卡等敏感信息, 威胁人身安全和财产安全</p>
</blockquote>
<h1 id="什么是安全"><a href="#什么是安全" class="headerlink" title="什么是安全?"></a>什么是安全?</h1><p>通常认为, 如果通信过程具备了四个特性, 就可以认为是安全的, 这四个特性是: <code>机密性</code>、<code>完整性</code>, <code>身份认证(真实性)</code> 和 <code>不可否认</code> (HTTPS 的出场, 为 HTTP 增加了这四大安全特性)</p>
<h2 id="机密性-Secrecy-Confidentiality"><a href="#机密性-Secrecy-Confidentiality" class="headerlink" title="机密性(Secrecy/Confidentiality)"></a>机密性(Secrecy/Confidentiality)</h2><p>机密性是指传输的数据是采用Session Key（会话密钥）加密的, 在网络上是看不到明文的</p>
<h2 id="完整性-Integrity-也叫一致性"><a href="#完整性-Integrity-也叫一致性" class="headerlink" title="完整性(Integrity, 也叫一致性)"></a>完整性(Integrity, 也叫一致性)</h2><p>是指为了避免网络中传输的数据被非法篡改, 使用MAC算法来保证消息的完整性 (每部分数据均有mac验证, 验证时计算数据的mac然后与接收到的mac比较, 即可确定数据是否完整)</p>
<h2 id="身份认证-Authentication"><a href="#身份认证-Authentication" class="headerlink" title="身份认证(Authentication)"></a>身份认证(Authentication)</h2><p>真实性是指通信的对方是可信的, 利用了PKI（Public Key Infrastructure 即『公钥基础设施』）来保证公钥的真实性</p>
<h2 id="不可否认-Non-repudiation-Undeniable"><a href="#不可否认-Non-repudiation-Undeniable" class="headerlink" title="不可否认(Non-repudiation/Undeniable)"></a>不可否认(Non-repudiation/Undeniable)</h2><p>是这个消息就是你给我发的, 无法伪装和否认, 是因为使用了签名的技术来保证的<br>session key 只有通信双方有, 并且不在网络上传输, 因此攻击者无法伪造使用session key加密的数据, 所以具有不可抵赖性<br><a href="https://zhidao.baidu.com/question/1435954777259099899.html" target="_blank" rel="noopener">https://zhidao.baidu.com/question/1435954777259099899.html</a></p>
<p>（机密性由对称加密AES保证, 完整性由SHA384摘要算法保证, 身份认证和不可否认由RSA 非对称加密保证）</p>
<h1 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h1><p>HTTPS 是如何做到这些安全特性呢?<br>秘密就在于 HTTPS 名字里的 <code>S</code>, 它把 HTTP 下层的传输协议由 <code>TCP/IP</code> 换成了 <code>SSL/TLS</code>, 由 <code>HTTP over TCP/IP</code> 变成了 <code>HTTP over SSL/TLS</code>, 让 HTTP 运行在了安全的 SSL/TLS 协议上, 收发报文不再使用 Socket API, 而是调用专门的安全接口<br><img src="/img/http/https-01.png"><br>所以说, HTTPS 本身并没有什么 惊世骇俗的本事, 全是靠着后面的 <code>SSL/TLS</code> “撑腰”, 只要学会了 SSL/TLS, HTTPS 自然就OK了</p>
<blockquote>
<p>SSL 即安全套接层(Secure Sockets Layer), 在 OSI 模型中处于第 5 层(会话层), 由 网景公司于 1994 年发明, 有 v2 和 v3 两个版本, 而 v1 因为有严重的缺陷从未公开过<br>SSL 发展到 v3 时已经证明了它自身是一个非常好的安全通信协议, 于是互联网工程组 IETF 在 1999 年把它改名为 TLS(传输层安全, Transport Layer Security), 正式标准化, 版 本号从 1.0 重新算起, 所以 TLS1.0 实际上就是 SSLv3.1<br>到今天 TLS 已经发展出了三个版本, 分别是 2006 年的 1.1、2008 年的 1.2 和去年 (2018)的 1.3, 每个新版本都紧跟密码学的发展和互联网的现状, 持续强化安全和性能, 已经成为了信息安全领域中的权威标准<br>目前应用的最广泛的 TLS 是 1.2, 而之前的协议(TLS1.1/1.0、SSLv3/v2)都已经被认为是不安全的, 各大浏览器即将在 2020 年左右停止支持, 所以接下来的讲解都针对的是 TLS1.2</p>
</blockquote>
<ol>
<li><p>TLS 由记录协议、握手协议、警告协议、变更密码规范协议、扩展协议等几个子协议组成,  综合使用了对称加密、非对称加密、身份认证等许多密码学前沿技术</p>
</li>
<li><p>浏览器 和 服务器在使用 TLS 建立连接时需要选择一组恰当的加密算法来实现安全通信, 这些算法的组合被称为 <code>密码套件</code>(cipher suite, 也叫加密套件)<br>TLS 的密码套件命名非常规范, 格式很固定, 基本的形式是 <code>密钥交换算法 + 签名算法 + 对称加密算法 + 摘要算法</code><br>(比如 <code>ECDHE-RSA-AES256-GCM-SHA384</code> 的意思就是: “握手时使用 ECDHE 算法进行密钥交换, 用 RSA 签名和身份认证, 握手后的通信使用 AES 对称算法, 密钥长度 256 位, 分组模式是 GCM, 摘要算法 SHA384 用于消息认证和 产生随机数”)</p>
</li>
</ol>
<blockquote>
<p>说到 TLS, 就不能不谈到 OpenSSL, 它是一个著名的开源密码学程序库和工具包, 几乎支 持所有公开的加密算法和协议, 已经成为了事实上的标准, 许多应用软件都会使用它作为底层库来实现 TLS 功能, 包括常用的 Web 服务器 Apache、Nginx 等<br>OpenSSL 目前有三个主要的分支, 1.0.2 和 1.1.0 都将在今年(2019)年底不再维护, 最新的长期支持版本是 1.1.1<br>由于 OpenSSL 是开源的, 所以它还有一些代码分支, 比如 Google 的 BoringSSL、 OpenBSD 的 LibreSSL, 这些分支在 OpenSSL 的基础上删除了一些老旧代码, 也增加了一些新特性, 虽然背后有 大金主, 但离取代 OpenSSL 还差得很远</p>
</blockquote>
<h1 id="HTTPS如何为-HTTP-增加四个特性的"><a href="#HTTPS如何为-HTTP-增加四个特性的" class="headerlink" title="HTTPS如何为 HTTP 增加四个特性的"></a>HTTPS如何为 HTTP 增加四个特性的</h1><h2 id="机密性"><a href="#机密性" class="headerlink" title="机密性"></a>机密性</h2><p>机密性是信息安全的基础; 实现机密性最常用的手段是 “加密(encrypt)”, 只有掌握特殊 “钥匙”(密钥(key)) 的人才能再转换出原始文本; 加密前的消息叫 “明文”(plain text/clear text), 加密后的乱码叫”密文”(cipher text), 加密解密的操作过程就是”加密算法”<br>所有的加密算法都是公开的, 任何人都可以去分析研究, 而算法使用的 “密钥” 则必须保密, “密钥”就是一长串的数字, 但约定俗成的度量单位是 “位”(bit), 而不是”字节”(byte)<br>按照密钥的使用方式, 加密可以分为两大类: 对称加密和非对称加密</p>
<h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><ol>
<li><p>“对称加密”就是指加密和解密时使用的密钥都是同一个, 是 “对称” 的。只要保证了密钥的安全, 那整个通信过程就可以说具有了 机密性</p>
</li>
<li><p>TLS 里有非常多的对称加密算法可供选择, 比如 RC4、DES、3DES、AES、ChaCha20 等, 但前三种算法都被认为是不安全的, 通常都禁止使用, 目前常用的只有 <code>AES</code> 和 <code>ChaCha20</code></p>
<ul>
<li><code>AES</code> 的意思是 高级加密标准(Advanced Encryption Standard), 密钥长度可以是 128、192 或 256; 它是 DES 算法的替代者, 安全强度很高, 性能也很好, 而且有的硬件还会做特殊优化, 所以非常流行, 是应用最广泛的对称加密算法</li>
<li><code>ChaCha20</code> 是 Google 设计的另一种加密算法, 密钥长度固定为 256 位, 纯软件运行性能要超过 AES, 曾经在移动客户端上比较流行, 但 ARMv8 之后也加入了 AES 硬件优化, 所以现在不再具有明显的优势, 但仍然算得上是一个不错算法</li>
</ul>
</li>
</ol>
<h3 id="加密分组模式"><a href="#加密分组模式" class="headerlink" title="加密分组模式"></a>加密分组模式</h3><p>对称算法还有一个 <code>分组模式</code> 的概念, 它可以让算法用固定长度的密钥加密任意长度的明文<br>最早的分组模式有 ECB、CBC、CFB、OFB 等几种, 但都陆续被发现有安全漏洞, 所以现在基本都不怎么用了; 最新的分组模式被称为 AEAD(Authenticated Encryption with Associated Data),在加密的同时增加了认证的功能, 常用的是 GCM、CCM 和 Poly1305<br>把上面这些组合起来, 就可以得到 TLS 密码套件中定义的对称加密算法。比如:<br><code>AES128-GCM</code>, 意思是密钥长度为 128 位的 AES 算法, 使用的分组模式是 GCM;<br><code>ChaCha20-Poly1305</code> 的意思是 ChaCha20 算法, 使用的分组模式是 Poly1305;</p>
<h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>对称加密看上去好像完美地实现了机密性, 但其中有一个很大的问题: 如何把密钥安全地传递给对方, 术语叫 “密钥交换”; 因为在对称加密算法中只要持有密钥就可以解密, 如果你和网站约定的密钥在传递途中被黑客窃取, 那他就可以在之后随意解密收发的数据, 通信过程也就没有机密性可言了, 这个问题该怎么解决呢?</p>
<blockquote>
<p>这个问题该怎么解决呢?<br>你或许会说:“把密钥再加密一下发过去就好了”, 但传输“加密密钥的密钥”又成了新问题。这就像是”鸡生蛋、蛋生鸡”, 可以无限递归下去。只用对称加密算法, 是绝对无法解决密钥交换的问题的</p>
</blockquote>
<p>所以就出现了 非对称加密(也叫公钥加密算法)</p>
<ol>
<li>非对称加密 有两个密钥, 一个叫 <code>公钥</code>(public key), 一个叫 <code>私钥</code>(private key), 两个密钥是不同的(不对称), 公钥可以公开给任何人使用, 而私钥必须严格保密</li>
<li>公钥和私钥有个特别的 <code>单向</code> 性, 虽然都可以用来加密解密, 但公钥加密后只能用私钥解密, 反过来, 私钥加密后也只能用公钥解密</li>
<li><p>非对称加密可以解决 密钥交换 的问题。网站秘密保管私钥, 在网上任意分发公钥, 你想要登录网站只要用公钥加密就行了, 密文只能由私钥持有者才能解密。而黑客因为没有私钥, 所以就无法破解密文<br><img src="/img/http/https-publickey-01.png"></p>
</li>
<li><p>非对称加密算法的设计要比对称算法难得多, 在 TLS 里只有很少的几种, 比如 <code>DH</code>、 <code>DSA</code>、<code>RSA</code>、<code>ECC</code> 等</p>
</li>
</ol>
<ul>
<li><p><code>RSA</code> 可能是其中最著名的一个, 几乎可以说是非对称加密的代名词, 它的安全性基于 “整数分解” 的数学难题, 使用两个超大素数的乘积作为生成密钥的材料, 想要从公钥推算出私钥是非常困难的<br>10 年前 RSA 密钥的推荐长度是 1024, 但随着计算机运算能力的提高, 现在 1024 已经不安全, 普遍认为至少要 2048 位</p>
</li>
<li><p><code>ECC(Elliptic Curve Cryptography)</code> 是非对称加密里的 “后起之秀”, 它基于 “椭圆曲线 离散对数” 的数学难题, 使用特定的曲线方程和基点生成公钥和私钥<br>子算法 <code>ECDHE</code> 用于 密钥交换, <code>ECDSA</code> 用于数字签名<br>(比起 RSA, ECC 在安全强度和性能上都有明显的优势。160 位的 ECC 相当于 1024 位的 RSA, 而 224 位的 ECC 则相当于 2048 位的 RSA。因为密钥短, 所以相应的计算量、消耗 的内存和带宽也就少, 加密解密的性能就上去了, 对于现在的移动互联网非常有吸引力。)</p>
</li>
</ul>
<h3 id="混合加密"><a href="#混合加密" class="headerlink" title="混合加密"></a>混合加密</h3><ol>
<li><p>虽然非对称加密没有 密钥交换 的问题, 但因为它们都是基于复杂的数学难题, 运算速度很慢(即使是 ECC 也要比 对称加密算法AES 差上好几个数量级), 如果仅用非对称加密, 虽然保证了安全, 但实用性就变成了零</p>
</li>
<li><p>因此就需要考虑, 是不是能够把对称加密和非对称加密结合起来呢, 两者互相取长补短, 即能高效地加密解密, 又能安全地密钥交换, <strong>这就是现在 TLS 里使用的混合加密方式</strong>: </p>
<ul>
<li>在通信刚开始的时候使用 非对称算法, 比如 <code>RSA</code>、<code>ECDHE</code>, 首先解决密钥交换的问题</li>
<li>然后用随机数产生对称算法使用的 <code>会话密钥 (session key)</code>, 再用公钥加密。因为会话密钥很短, 通常只有 16 字节或 32 字节, 所以慢一点也无所谓</li>
<li>对方拿到密文后用私钥解密, 取出会话密钥。这样, 双方就实现了对称密钥的安全交换, 后续就不再使用非对称加密, 全都使用对称加密</li>
</ul>
</li>
<li><p>从下往上如下图<br><img src="/img/http/https-publickey-02.png"><br>这样混合加密就解决了对称加密算法的密钥交换问题, 而且安全和性能兼顾, 完美地实现了机密性</p>
</li>
</ol>
<p>不过这只是 “万里长征的第一步”, 后面还有完整性、身份认证、不可否认等特性没有实现, 所以现在的通信还不是绝对安全</p>
<h1 id="TLS1-2连接过程解析"><a href="#TLS1-2连接过程解析" class="headerlink" title="TLS1.2连接过程解析"></a>TLS1.2连接过程解析</h1><h2 id="HTTPS-建立连接"><a href="#HTTPS-建立连接" class="headerlink" title="HTTPS 建立连接"></a>HTTPS 建立连接</h2><ol>
<li><p>当你在浏览器地址栏里键入 <code>https</code> 开头的 URI, 再按下回车, 会发生什么呢?<br>浏览器首先要从 URI 里提取出协议名和域名, 因为协议名是 https, 所以浏览器就知道了端口号是默认的 443, 它再用 DNS 解析域名,  得到目标的 IP 地址, 然后就可以使用三次握手与网站建立 TCP 连接了</p>
</li>
<li><p>在 HTTP 协议里, 建立连接后, 浏览器会立即发送请求报文。但现在是 HTTPS 协议, 它需要再用另外一个 握手 过程, 在 TCP 上建立安全连接, 之后才是收发 HTTP 报文。<br> 这个 握手 过程与 TCP 有些类似, 是 HTTPS 和 TLS 协议里最重要、最核心的部分, 懂了它, 你就可以自豪地说自己 掌握了HTTPS</p>
</li>
</ol>
<h2 id="TLS-协议的组成"><a href="#TLS-协议的组成" class="headerlink" title="TLS 协议的组成"></a>TLS 协议的组成</h2><p>在讲 TLS 握手之前, 先简单介绍一下 TLS 协议的组成<br>TLS 包含几个子协议, 你也可以理解为它是由几个不同职责的模块组成, 比较常用的有 <code>记录协议</code>、<code>警报协议</code>、<code>握手协议</code>、<code>变更密码规范协议</code> 等</p>
<ul>
<li><code>记录协议</code>(Record Protocol) 规定了 TLS 收发数据的基本单位: 记录(record), 它有点像是 TCP 里的 segment, 所有的其他子协议都需要通过记录协议发出。但多个记录数据可以在一个 TCP 包里一次性发出, 也并不需要像 TCP 那样返回 ACK</li>
<li><code>警报协议</code>(Alert Protocol) 的职责是向对方发出警报信息, 有点像是 HTTP 协议里的状态码。比如, protocol_version 就是不支持旧版本, bad_certificate 就是证书有问题, 收到 警报后另一方可以选择继续, 也可以立即终止连接</li>
<li><code>握手协议</code>(Handshake Protocol) 是 TLS 里最复杂的子协议, 要比 TCP 的 SYN/ACK 复 杂的多, 浏览器和服务器会在握手过程中协商 TLS 版本号、随机数、密码套件等信息, 然 后交换证书和密钥参数, 最终双方协商得到会话密钥, 用于后续的混合加密系统</li>
<li>最后一个是 <code>变更密码规范协议</code>(Change Cipher Spec Protocol), 它非常简单, 就是一个“通知”, 告诉对方, 后续的数据都将使用加密保护。那么反过来, 在它之前, 数据都是明文的</li>
</ul>
<p>……………</p>
<h1 id="迁移HTTPS的必要性"><a href="#迁移HTTPS的必要性" class="headerlink" title="迁移HTTPS的必要性"></a>迁移HTTPS的必要性</h1><p>如果你做移动应用开发的话, 那么就一定知道, Apple、Android、某信等开发平台在 2017 年就相继发出通知, 要求所有的应用必须使用 HTTPS 连接, 禁止不安全的 HTTP<br>在台式机上, 主流的浏览器 Chrome、Firefox 等也早就开始 强推 HTTPS, 把 HTTP 站 点打上 不安全 的标签, 给用户以 心理压力<br>Google 等搜索巨头还利用自身的“话语权”优势, 降低 HTTP 站点的排名, 而给 HTTPS 更大的权重, 力图让网民只访问到 HTTPS 网站<br>这些手段都逐渐 挤压 了纯明文 HTTP 的生存空间,  迁移到 HTTPS 已经不是要不要做的问题, 而是要怎么做的问题了, HTTPS 的大潮无法阻挡, 如果还是死守着 HTTP, 那么无疑会被冲刷到互联网的角落里<br>目前国内外的许多知名大站都已经实现了 全站 HTTPS , 打开常用的某宝、某东、某 浪, 都可以在浏览器的地址栏里看到 小锁头 , 如果你正在维护的网站还没有实施 HTTPS,  那可要抓点紧了</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        

        
    </div>
    <footer>
        <a href="http://blog.renyimin.com">
            <img src="/img/avatar.jpeg" alt="Lant">
            Lant
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/">HTTP</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/&title=《HTTPS是什么?SSL/TLS又是什么?》 — Lant's&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/&title=《HTTPS是什么?SSL/TLS又是什么?》 — Lant's&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《HTTPS是什么?SSL/TLS又是什么?》 — Lant's&url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
      <div class="waves-block waves-effect prev">
        <a href="/2019/10/23/http/2019-10-23-HTTP-Proxy-cache/" id="post-prev" class="post-nav-link">
          <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i>Prev </div>
          <h4 class="title">HTTP 缓存代理</h4>
        </a>
      </div>
    
  
    <div class="waves-block waves-effect next">
      <a href="/2019/10/24/http/2019-10-24-HTTS/" id="post-next" class="post-nav-link">
        <div class="tips">Next<i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">HTTPS 证书申请</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'rymuscle',
            repo: 'rymuscle.github.io',
            oauth: {
                client_id: '49b906f6d47dbab8d929',
                client_secret: '17fd73f24f616a09d4c09bca9480e0deba75a9a2',
            },
        })
        gitment.render('comments')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        赞赏支持
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="bottom">
        <p><span>Lant &copy; 2016 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/&title=《HTTPS是什么?SSL/TLS又是什么?》 — Lant's&pic=http://blog.renyimin.com/img/avatar.jpeg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/&title=《HTTPS是什么?SSL/TLS又是什么?》 — Lant's&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《HTTPS是什么?SSL/TLS又是什么?》 — Lant's&url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/&via=http://blog.renyimin.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.renyimin.com/2019/10/23/http/2019-10-23-HTTS/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aS27DMAwFwN7/0u42QGDnkXQCWBqtAjdINV4Q/P39xed4Oa9P3j9f//V4O9fPbz4YGBiPZRyX5+yiyS8kjPn3MTAw9mGcXa4aNK/DdB4587thYGBgXDPy36mGbAwMDIweYxJAczwGBgbGpIi9fp78s3kb7oZaHAMD44GMSWH57c9fmW9gYGA8inEUz/U4Mylic0bhVhgYGEsz5mPFXjMufxGF1BMDA2NRxvxf5oPMeWMOAwNjZ0beJqsOLxN2vqhx+nIxMDA2YNybtOVN/OrLiuI0BgbG0ox8xSEJr5PSt9p6w8DA2IdRDcrVBbLJkPLDPTEwMJZm5JeYN8h6I8xC7oeBgbEo465ELY9+vSTyQ8jGwMDYgFFdtshb+XkbLh82lBfCMDAwHs7oBb48KawOBnrBFwMDYwfGL0k5oNBow8DA2IYxKTXzQjdZDus17zAwMFZlVJO2fKjZu3TSzjtdtsDAwFiU8ftca5IO5qkqBgbGeoy8TZ83v6ojhyTEFwaZGBgYSzOS9axJM27SvPvw+jAwMJZmFEaDrYZab8BZDb4YGBirMo7i6a1E9AJrXgZjYGCszaiGuQm196SXjGJgYKzHmDfF8pFnNWUsBFwMDIwNGEm5mIN7vF7ox8DAwMjL1F6Aruaw5U4hBgbGlow8RFaHkdXvYGBg7MaYDCZ7K2W9Ztxt7TYMDIxHMaorDnlQTgJxb8mjOdTEwMB4HuMfoZitY6u3KlIAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.13"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.13" async></script>










</body>
</html>
